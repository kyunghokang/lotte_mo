!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteSns","lotteCommFooter"]);d.controller("usedMainCtrl",["$http","$scope","LotteCommon","$window","LotteStorage","$timeout","commInitData","$location",function(d,e,f,g,h,i,j,k){e.showWrap=!0,e.contVisible=!0,e.subTitle="#중고라운지",e.screenID="중고라운지",(e.screenDataReset=function(){e.screenData={subCate:j.query.ctgDispNo,page:0,pageSize:20,pageEnd:!1,data:null,storedLoc:null,storedScrollY:0,myList:"N",keyword:"",ctgDispNo:j.query.ctgDispNo}})(),e.use_pop_show=!1,e.showInfoPop=function(){e.use_pop_show=!0},b.element(g).on("unload",function(a){e.screenData.storedLoc=k.absUrl(),e.screenData.storedScrollY=b.element(g).scrollTop(),h.setSessionStorage("used_mall",e.screenData,"json")}),e.selectCate=function(a){e.screenDataReset(),e.screenData.subCate=a,e.loadData()},e.selectSearch=function(a){if("search"==a&&(""==e.screenData.keyword||e.screenData.keyword.length<=1))return void alert("검색어를 입력하세요");var b=e.screenData.keyword;e.screenData.page=0,e.screenData.keyword=b,$("#my_csh")[0].checked?e.screenData.myList="Y":e.screenData.myList="N",e.loadData()},e.loadData=function(){if(!e.screenData.pageEnd){e.screenData.page++,e.ajaxLoadFlag=!0;var a={method:"post",url:f.used_main,params:{dispNo:e.screenData.subCate,ctgDispNo:e.screenData.ctgDispNo,page:e.screenData.page,myBoard:e.screenData.myList,sort:e.screenData.keyword}};d(a).success(function(a){1==e.screenData.page?e.screenData.data=a:0==a.boardListInfo.boardList.items.length?e.screenData.pageEnd=!0:e.screenData.data.boardListInfo.boardList.items=e.screenData.data.boardListInfo.boardList.items.concat(a.boardListInfo.boardList.items),e.screenData.data.boardListInfo.boardList.items.length==e.screenData.data.boardListInfo.maxCount&&(e.screenData.pageEnd=!0)})["finally"](function(){e.ajaxLoadFlag=!1})}},e.smp=h.getSessionStorage("used_mall","json"),null!=e.smp&&""!=e.smp&&(e.screenData=e.smp),e.screenData.storedLoc==a.location.href?(e.screenDataReset(),e.loadData()):(e.screenDataReset(),e.loadData());var l=b.element(g),m=(b.element("body"),l.height());b.element(g).on("scroll",function(a){l.scrollTop()>=95?($(".addbtn_box").addClass("fix"),$(".cate_box").addClass("fix")):($(".addbtn_box").removeClass("fix"),$(".cate_box").removeClass("fix")),e.screenData.pageEnd||e.ajaxLoadFlag||$("#footer").offset().top<l.scrollTop()+m&&e.loadData()}),e.loadReply=function(a){var b={method:"get",url:f.used_reply_list,params:{bbcNo:a.bbcNo}};d(b).success(function(b){a.reply_list=b.reply_info.item,a.more=!0}).error(function(a){console.log(a)})},e.reply_write=function(a,b,g){e.used_logincheck();var h="",i="";if(null==b?(b={upRplNo:null,rplno:null},h=a.insstr,i=a.inscheck):h=b.insstr,"edit"==g&&(h=b.rplCont),h==c||""==h)return void alert("내용을 입력하세요");var j={method:"post",url:f.used_reply_write,data:{bbcNo:a.bbcNo,uprRplNo:b.upRplNo,rplNo:b.rplNo,scrtRplUseYn:i,rplCont:h,mod_flag:g}};d(j).success(function(c){alert(c.reply_write.response_msg),"0000"==c.reply_write.response_code&&(e.loadReply(a),a.insstr="",b.insstr="")}).error(function(a){console.log(a)})},e.reply_delete=function(a,b){if(confirm("해당 글을 삭제하시겠습니까?")){var c={method:"post",url:f.used_reply_delete,data:{rplNo:a}};d(c).success(function(a){alert(a.reply_delete.response_msg),"0000"==a.reply_delete.response_code&&e.loadReply(b)}).error(function(a){console.log(a)})}},e.board_delete=function(a,b){if(confirm("해당 판매 글을 삭제하시겠습니까?")){var c={method:"post",url:f.used_delete,data:{bbcNo:a.bbcNo}};d(c).success(function(a){alert(a.response_msg),"0000"==a.response_code&&e.screenData.data.market_list.items.splice(b,1)}).error(function(a){console.log(a)})}},e.board_edit=function(a){var b="";null!=a&&(b="mode=edit&");var c={ctgList:e.screenData.data.ctgList.items,item:a};h.setSessionStorage("used_mall_edit_item",c,"json"),location.href=f.used_write_link+"?"+b+e.baseParam},e.recommend=function(a){if(e.used_logincheck(),"Y"==a.modifyYn)return void alert("본인이 작성한 글은 추천 할 수 없습니다");var b={method:"post",url:f.used_recommend,data:{bbcNo:a.bbcNo,tgtTpCd:"10"}};d(b).success(function(b){alert(b.response_msg),"0000"==b.response_code&&(a.recommCnt=b.response_cnt,a.recomm_on=!0)}).error(function(a){console.log(a)})},e.dcl=function(a){if(e.used_logincheck(),"Y"==a.modifyYn)return void alert("본인이 작성한 글은 신고 할 수 없습니다");if(confirm("해당 판매글을 신고하시겠습니까?")){var b={method:"post",url:f.used_declare,data:{bbcNo:a.bbcNo,tgtTpCd:"10"}};d(b).success(function(b){alert(b.response_msg),"0000"==b.response_code&&(a.dclCnt=b.response_cnt,a.dcl_on=!0)}).error(function(a){console.log(a)})}},e.used_logincheck=function(){if(!e.loginInfo.isLogin){alert("로그인 후 참여하실 수 있습니다.");var a="&targetUrl="+encodeURIComponent(g.location.href,"UTF-8");g.location.href=f.loginUrl+"?"+e.baseParam+a}}}]),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/mall/used_main_container.html",replace:!0,link:function(a,b,c){}}})}(window,window.angular);