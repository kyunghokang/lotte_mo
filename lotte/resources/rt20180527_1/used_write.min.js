angular.module("ngPinchZoom",[]).directive("ngPinchZoom",function(){function a(a,b,c){function d(a){var b=a.originalEvent?a.originalEvent.touches:a.touches;y=b[0].clientX,z=b[0].clientY,u=s,v=t,A=0,B=0}function e(a){var c=a.originalEvent?a.originalEvent.touches:a.touches;""===l&&(1===c.length&&o>1?l="swipe":2===c.length&&(l="pinch",q=o,n=g(c),w=c[0].clientX-parseInt((c[0].clientX-c[1].clientX)/2,10)-b[0].offsetLeft-u,x=c[0].clientY-parseInt((c[0].clientY-c[1].clientY)/2,10)-b[0].offsetTop-v)),"swipe"===l?(a.preventDefault(),A=c[0].clientX-y,B=c[0].clientY-z,s=u+A,t=v+B,h()):"pinch"===l&&(a.preventDefault(),m=g(c),p=m/n,o=p*q,s=w*(1-p)+u+A,t=x*(1-p)+v+B,h())}function f(a){var b=a.originalEvent?a.originalEvent.touches:a.touches;""===l||b.length>0||(1>o?(o=1,s=0,t=0):o>r?(o=r,p=o/q,s=w*(1-p)+u+A,t=x*(1-p)+v+B):(s>0?s=0:j*(1-o)>s&&(s=j*(1-o)),t>0?t=0:k*(1-o)>t&&(t=k*(1-o))),h(.1),l="")}function g(a){var b=Math.sqrt(Math.pow(a[0].clientX-a[1].clientX,2)+Math.pow(a[0].clientY-a[1].clientY,2));return parseInt(b,10)}function h(a){var c=a?"all cubic-bezier(0,0,.5,1) "+a+"s":"",d=[o,0,0,o,s,t],e="matrix("+d.join(",")+")";b.css({"-webkit-transition":c,transition:c,"-webkit-transform":e+" translate3d(0,0,0)",transform:e})}function i(){o=1,s=0,t=0,h(.1),l=""}console.log("pinch zoom -----");var j,k,l="",m=0,n=0,o=1,p=1,q=1,r=parseInt(c.maxScale,10);(isNaN(r)||1>=r)&&(r=3);var s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=new Image;C.onload=function(){j=b[0].clientWidth,k=b[0].clientHeight,b.css({"-webkit-transform-origin":"0 0","transform-origin":"0 0"}),b.on("touchstart",d),b.on("touchmove",e),b.on("touchend",f),b.on("resetPinch",i)};var D=c.ngSrc?c.ngSrc:c.src;a.isValidString(D)&&(C.src=D)}var b={restrict:"A",scope:!1,link:a};return b}),function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","ngPinchZoom"]);d.controller("usedWriteCtrl",["$http","$scope","LotteCommon","commInitData","$location","LotteStorage","$timeout",function(a,d,e,f,g,h,i){function j(a){return"image/jpeg"==a||"image/png"==a?!0:!1}function k(a){var b=0;for(n=0;n<a.length;n++){var c=a.charAt(n);escape(c).length>4?b+=2:"\n"==c?"\r"!=a.charAt(n-1)&&(b+=1):b+="<"==c||">"==c?4:1}return b}d.showWrap=!0,d.contVisible=!0,d.subTitle="판매 글 등록하기",d.screenID="판매 등록하기",d.AccessUpload=!0,d.used_data=h.getSessionStorage("used_mall_edit_item","json"),d.show_term=!1,d.photoCount=0,null==d.used_data&&(location.href=e.mainUrl+"?"+d.baseParam),d.check_list=[!1,!1,!1,!1],d.phoneArr=["","",""],d.rotateCode=new Array(10),d.scrmode=!0;var l=e.used_write;if(null==d.used_data.item)d.used_data.item={bbcNo:"",loginId:"",regDate:"",dispNo:"",bbcTitNm:"",salePrc:"",dlexInclusYn:"",cellNo:"",shaGoodsStatCd:"미사용",saleStatCd:"10",dirTradePsbYn:"",dirTradeRgnNm:"",bbcCont:"",rplCnt:0,recommCnt:0,dclCnt:0,modifyYn:"Y",imgInfo:[]};else{d.subTitle="판매 글 수정하기",d.check_list[0]="Y"==d.used_data.item.dlexInclusYn?!0:!1,d.check_list[2]="Y"==d.used_data.item.dirTradePsbYn?!0:!1,d.phoneArr=d.used_data.item.cellNo.split("-"),l=e.used_rewrite;for(var m=[],n=0;n<d.used_data.item.imgList.items.length;n++)m.push(d.used_data.item.imgList.items[n].imgUrl);d.used_data.item.imgInfo=m,d.scrmode=!1}d.popOption={open:!1,data:"",close:function(){d.popOption.open=!1},show:function(a){""!=a&&(d.popOption.data=a,d.popOption.open=!0)}};for(var n=d.used_data.item.imgInfo.length;10>n;n++)d.used_data.item.imgInfo.push("");""==d.used_data.item.dispNo?d.selectCtg=d.used_data.ctgList[0].dispNo:d.selectCtg=d.used_data.item.dispNo;var o=!1;d.dataForm={},d.submit=function(){o||(o=!0,d.dataForm={bbcNo:d.used_data.item.bbcNo,dispNo:d.used_data.item.dispNo,bbcTitNm:d.used_data.item.bbcTitNm,salePrc:d.used_data.item.salePrc,dlexInclusYn:d.check_list[0]?"Y":"N",cellNo:d.phoneArr[0]+""+d.phoneArr[1]+d.phoneArr[2],shaGoodsStatCd:d.used_data.item.shaGoodsStatCd,cellNoOppbAgrYn:d.check_list[1]?"Y":"N",dirTradePsbYn:d.check_list[2]?"Y":"N",shaBbcRegAgrYn:d.check_list[3]?"Y":"N",dirTradeRgnNm:d.used_data.item.dirTradeRgnNm,bbcCont:d.used_data.item.bbcCont,imgInfo:d.used_data.item.imgInfo,rotateCode:d.rotateCode,saleStatCd:d.used_data.item.saleStatCd},b.element("#board_write").bind("submit",function(a){var b=new FormData($(this)[0]);d.dataForm;$.ajax({url:l,type:"post",data:b,async:!1,ache:!1,contentType:!1,processData:!1,success:function(a){console.log("success!!")},error:function(a){console.log(a)}}),a.preventDefault()}),b.element("#board_write").submit(),i(function(){console.log(d.dataForm),b.element("#board_write").unbind("submit")},1e3))};var p=8,q=292,r=217;d.appObj.isApp&&d.appObj.isAndroid&&(!d.appObj.isSktApp&&d.appObj.verNumber<q||d.appObj.isSktApp&&d.appObj.verNumber<r)&&(d.AccessUpload=!1),d.userVersionCheck=function(){if(confirm("롯데닷컴 앱 업데이트 후 이용 가능합니다. 지금 업데이트 하시겠습니까?")){var a="market://details?id=com.lotte";d.appObj.isSktApp&&(a="https://www.onestore.co.kr/userpoc/apps/view?pid=0000677011"),location.href=a}},d.getOrientation=function(a,b){var c=new FileReader;c.onload=function(a){var c=new DataView(a.target.result);if(65496!=c.getUint16(0,!1))return b(-2);for(var d=c.byteLength,e=2;d>e;){var f=c.getUint16(e,!1);if(e+=2,65505==f){if(1165519206!=c.getUint32(e+=2,!1))return b(-1);var g=18761==c.getUint16(e+=6,!1);e+=c.getUint32(e+4,g);var h=c.getUint16(e,g);e+=2;for(var i=0;h>i;i++)if(274==c.getUint16(e+12*i,g))return b(c.getUint16(e+12*i+8,g))}else{if(65280!=(65280&f))break;e+=c.getUint16(e,!1)}}return b(-1)},c.readAsArrayBuffer(a)},d.photoPreview=function(a,e){if(d.AccessUpload){var f=a.files[0],g=b.element(a).attr("index"),h=(new FileReader,1e3*p*1e3),i=b.element(a).parent().find("figure");i.children().remove(),d.rotateCode[g]=null;try{d.$apply()}catch(k){}if(f&&f!=c){if(!j(f.type))return void alert("jpg/png 파일만 업로드 가능합니다.");if(f.size>h)return void alert("사진 용량이 "+p+"MB 초과하였습니다.");loadImage(f,function(a){try{d.used_data.item.imgInfo[g]=a.toDataURL(),d.check_photoCount()}catch(b){i.append(a)}try{d.$apply()}catch(b){}},{maxWidth:800,minWidth:216,minHeight:216,cover:!0,canvas:!0}),d.getOrientation(f,function(a){d.rotateCode[g]=a;try{d.$apply()}catch(b){}})}}},d.addPhoto=function(){for(var a=0,b=0;10>b;b++)""==d.used_data.item.imgInfo[b]&&(a=b,b=10);$("#pli_"+a).trigger("click")},d.deletePhoto=function(a,c){d.used_data.item.imgInfo[c]="",d.rotateCode[c]="",b.element(a).parent().find("input[type=file]").val("")},d.check_photoCount=function(){d.photoCount=0;for(var a=0;10>a;a++)""!=d.used_data.item.imgInfo[a]&&d.photoCount++},d.selectCate=function(a){d.selectCtg=a},d.selectGoodStat=function(a){d.used_data.item.shaGoodsStatCd=a},d.nowbyte=0;var s="",t=0;d.check_byte=function(){d.nowbyte=k(d.used_data.item.bbcCont),d.nowbyte>=300?(alert("최대 300바이트 입력 가능합니다."),d.used_data.item.bbcCont=s,d.nowbyte=t):(s=d.used_data.item.bbcCont,t=d.nowbyte)},d.check_photoCount(),i(function(){d.check_byte()},500)}]),d.directive("orientable",function(){return{link:function(a,b,c){b.bind("load",function(b){a.imageSize={width:this.width,height:this.height}})}}}),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/mall/used_write_container.html",replace:!0,link:function(a,b,c){function d(a){var b=$(a);isNaN(b.val())&&(alert("숫자로 입력해 주세요."),b.val(b.val().match(/[0-9]*/)))}$("#phone1").keyup(function(){d("#phone1")}),$("#phone2").keyup(function(){d("#phone2")}),$("#phone3").keyup(function(){d("#phone3")})}}})}(window,window.angular);