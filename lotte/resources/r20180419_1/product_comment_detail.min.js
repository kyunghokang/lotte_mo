angular.module("ngPinchZoom",[]).directive("ngPinchZoom",function(){function a(a,b,c){function d(a){var b=a.originalEvent?a.originalEvent.touches:a.touches;y=b[0].clientX,z=b[0].clientY,u=s,v=t,A=0,B=0}function e(a){var c=a.originalEvent?a.originalEvent.touches:a.touches;""===l&&(1===c.length&&o>1?l="swipe":2===c.length&&(l="pinch",q=o,n=g(c),w=c[0].clientX-parseInt((c[0].clientX-c[1].clientX)/2,10)-b[0].offsetLeft-u,x=c[0].clientY-parseInt((c[0].clientY-c[1].clientY)/2,10)-b[0].offsetTop-v)),"swipe"===l?(a.preventDefault(),A=c[0].clientX-y,B=c[0].clientY-z,s=u+A,t=v+B,h()):"pinch"===l&&(a.preventDefault(),m=g(c),p=m/n,o=p*q,s=w*(1-p)+u+A,t=x*(1-p)+v+B,h())}function f(a){var b=a.originalEvent?a.originalEvent.touches:a.touches;""===l||b.length>0||(1>o?(o=1,s=0,t=0):o>r?(o=r,p=o/q,s=w*(1-p)+u+A,t=x*(1-p)+v+B):(s>0?s=0:j*(1-o)>s&&(s=j*(1-o)),t>0?t=0:k*(1-o)>t&&(t=k*(1-o))),h(.1),l="")}function g(a){var b=Math.sqrt(Math.pow(a[0].clientX-a[1].clientX,2)+Math.pow(a[0].clientY-a[1].clientY,2));return parseInt(b,10)}function h(a){var c=a?"all cubic-bezier(0,0,.5,1) "+a+"s":"",d=[o,0,0,o,s,t],e="matrix("+d.join(",")+")";b.css({"-webkit-transition":c,transition:c,"-webkit-transform":e+" translate3d(0,0,0)",transform:e})}function i(){o=1,s=0,t=0,h(.1),l=""}console.log("pinch zoom -----");var j,k,l="",m=0,n=0,o=1,p=1,q=1,r=parseInt(c.maxScale,10);(isNaN(r)||1>=r)&&(r=3);var s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=new Image;C.onload=function(){j=b[0].clientWidth,k=b[0].clientHeight,b.css({"-webkit-transform-origin":"0 0","transform-origin":"0 0"}),b.on("touchstart",d),b.on("touchmove",e),b.on("touchend",f),b.on("resetPinch",i)};var D=c.ngSrc?c.ngSrc:c.src;a.isValidString(D)&&(C.src=D)}var b={restrict:"A",scope:!1,link:a};return b}),function(a,b,c){"use strict";var d=b.module("lotteSlider",[]);d.controller("LotteSlideCtrl",["$scope",function(b){b.getTranslateXCssObj=function(a,b){var c={"-webkit-backface-visibility":"hidden","-moz-backface-visibility":"hidden","backface-visibility":"hidden","-webkit-transform":"translateX("+a+"px)","-ms-transform":"translateX("+a+"px)","-moz-transform":"translateX("+a+"px)",transform:"translateX("+a+"px)","-webkit-transition":"","-moz-transition":"","-o-transition":"",transition:""};return b&&b>0&&(c["-webkit-transition"]="-webkit-transform "+b+"ms",c["-moz-transition"]="-moz-transform "+b+"ms",c["-o-transition"]="-o-transform "+b+"ms",c.transition="transform "+b+"ms"),c},b.removeTranslateCSS=function(){return{"-webkit-backface-visibility":"","-moz-backface-visibility":"","backface-visibility":"","-webkit-transform":"","-ms-transform":"","-moz-transform":"",transform:""}},b.getCoordinates=function(a){var b=a.touches&&a.touches.length?a.touches:[a],c=a.changedTouches&&a.changedTouches[0]||a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]||b[0].originalEvent||b[0];return{x:c.clientX,y:c.clientY}},b.getTransXPos=function(b){var c=a.getComputedStyle(b.get(0)),d=new WebKitCSSMatrix(c.webkitTransform);return d.m41}}]),d.directive("lotteSlider",["$window","$timeout","$parse",function(a,c,d){return{controller:"LotteSlideCtrl",link:function(d,e,f,g){function h(){m=k.outerWidth(),l.css({display:"inline-block"}),n=l.outerWidth(),x=-(n-m);var a=d.getTransXPos;(a.x>0||a.x<x)&&i(0,500)}function i(a,b){l.css(d.getTranslateXCssObj(a,b)),k.trigger({type:"slide",posX:a,wrapWidth:m,contWidth:n})}function j(){k.on({"touchstart.lotteSlider":function(a){m=k.outerWidth(),n=l.outerWidth(),y=!1,z=!1,n>m&&(a.stopPropagation(),o=!0,q=d.getCoordinates(a),p=d.getTransXPos(l),t=Date.now())},"touchmove.lotteSlider":function(a){if(o){var b,c;if(r=d.getCoordinates(a),b=Math.abs(r.x-q.x),c=Math.abs(r.y-q.y),y||(z=b>c,y=!0),z){b>5&&a.preventDefault(),a.stopPropagation();var e=p+r.x-q.x;e>0?e/=3:x>e&&(e=x+(e-x)/3),i(e,0)}}},"touchend.lotteSlider":function(a){if(s=d.getCoordinates(a),o&&q.x!=s.x&&(Math.abs(q.x-s.x)>5&&a.preventDefault(),event.stopPropagation(),y=!1,z)){m=k.outerWidth();var b=d.getTransXPos(l);u=Date.now(),w=q.x>s.x?-1:1,v=u-t;var c=Math.abs(q.x-s.x),e=.4,f=c*e/v,g=b+m*f*w;g>0?g=0:x>g&&(g=x),(Math.abs(b-g)>30||0==g||g==x)&&i(g,500)}},"touchcancel.lotteSlider":function(a){}}),b.element(a).on("resize.lotteSlider orientationchange.lotteSlider",function(){h()})}var k=b.element(e),l=k.find(">").eq(0),m=k.width(),n=l.width(),o=!1,p=0,q=null,r=null,s=null,t=0,u=0,v=0,w=0,x=0;d.lotteSliderMoveXPos=function(a,b){m=k.width(),n=l.width(),a>0?a=0:Math.abs(a)>n-m&&(a=-(n-m)),b||(b=0),i(a,b)},d.reset=function(){o=!1,i(0,0),c(function(){h()})};var y=!1,z=!1;c(function(){h(),j()})}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("product-sub-header",[]);d.directive("productSubHeader",["$http","$timeout","$window","$location","LotteCommon","LotteCookie","LotteStorage","LotteUtil",function(a,b,c,d,e,f,g,h){return{templateUrl:"/lotte/resources_dev/product/m/sub/product_sub_header.html",replace:!0,link:function(a,b,c){a.gotoPrepage=function(){a.jsonLoading=!0,a.sendTclick("m_RDC_header_new_pre"),a.appObj.isNativeHeader?appSendBack():history.go(-1)}}}}]),"undefined"!=typeof module&&module.exports&&(module.exports=d.name)}(window,window.angular),function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","product-sub-header","lotteSns","ngPinchZoom","lotteSlider"]);d.controller("ProductCommentDetailCtrl",["$window","$http","$scope","$timeout","$compile","LotteCommon","commInitData",function(a,c,d,e,f,g,h){function i(a){var b=a,c=0;for(b.photoItems=[],c;c<b.critList.items.length;c++)b.critList.items[c].photoList&&b.critList.items[c].photoList.items.length>0&&b.photoItems.push({items:b.critList.items[c].photoList.items,type:b.critList.items[c].critTpCd,gdasNo:b.critList.items[c].gdasNo,videoUrl:b.critList.items[c].videoUrl});return b}function j(a){a="undefined"!=typeof a?a:500;var c=b.element("#thumbList"),e=c.find(">li").eq(d.pageUI.curIdx),f=c.parent().width(),g=c.width(),h=e.width(),i=e.offset().left-c.offset().left,j=f/2-h/2-i;g>f&&(j>0?j=0:-(g-f)>j&&(j=-(g-f)),b.element("#thumbList").css({transform:"translateX("+j+"px)",backfaceVisibility:"hidden",transition:"transform "+a+"ms"}))}d.showWrap=!0,d.contVisible=!0,d.productSubTitle="상품평 상세보기",d.screenID="product_comment_detail",d.jsonLoading=!1,d.pageUI={gdasNo:null,baseParam:d.baseParam,curIdx:0,imgIdx:0,loadData:null,reqParam:{}},d.pageUI.reqParam.goods_no=h.query.goods_no?h.query.goods_no:"",d.pageUI.reqParam.usm_goods_no=h.query.usm_goods_no?h.query.usm_goods_no:"",d.pageUI.reqParam.photoview="Y",d.pageUI.reqParam.tot_cnt=h.query.tot_cnt?h.query.tot_cnt:"1",d.pageUI.gdasNo=h.query.gdas_no?h.query.gdas_no:null,d.pageUI.imgIdx=h.query.id?h.query.id:null,d.loadData=function(){d.jsonLoading=!0,c.get(g.productSubCommentAllData,{params:d.pageUI.reqParam}).success(function(a){a.data&&(console.log("상품평 상세보기 데이터 로드"),d.pageUI.loadData=i(a.data),d.pageUI.gdasNo&&d.pageUI.loadData.photoItems.length>0&&(d.pageUI.curIdx=d.pageUI.loadData.photoItems.findIndex(function(a,b,c){return d.pageUI.gdasNo==a.gdasNo}),d.pageUI.curIdx<0&&(d.pageUI.curIdx=0)),e(function(){(d.pageUI.imgIdx<0||d.pageUI.imgIdx>d.pageUI.loadData.photoItems[d.pageUI.curIdx].items.length-1)&&(d.pageUI.imgIdx=0),j(0)},500)),d.autoVdoPlay()}).error(function(){console.log("Data Error : 상품평 상세보기 데이터 로드 실패")})["finally"](function(){d.jsonLoading=!1})},d.loadData(),d.prdCommentDetailSwipe=function(a){var b=-1,c=-1;"prev"==a?(d.pageUI.curIdx>0||d.pageUI.imgIdx>0)&&(d.pageUI.imgIdx>0?c=d.pageUI.imgIdx-1:d.pageUI.curIdx>0&&(b=d.pageUI.curIdx-1,c=d.pageUI.loadData.photoItems[d.pageUI.curIdx].items.length-1)):(a="next")&&(d.pageUI.curIdx<d.pageUI.loadData.photoItems.length-1||d.pageUI.imgIdx<d.pageUI.loadData.photoItems[d.pageUI.curIdx].items.length-1)&&(d.pageUI.imgIdx<d.pageUI.loadData.photoItems[d.pageUI.curIdx].items.length-1?c=d.pageUI.imgIdx+1:d.pageUI.curIdx<d.pageUI.loadData.photoItems.length-1&&(b=d.pageUI.curIdx+1,c=0)),console.log(b),d.setCurIdx(b,c)},d.setCurIdx=function(a,c){"undefined"!=typeof a&&a>-1&&a<d.pageUI.loadData.photoItems.length&&(d.pageUI.curIdx=a),"undefined"!=typeof c&&c>-1&&c<d.pageUI.loadData.photoItems[d.pageUI.curIdx].items.length&&(d.pageUI.imgIdx=c),b.element("#pinchArea >img").trigger("resetPinch"),d.autoVdoPlay(),j()},d.recommClick=function(b){if(d.loginInfo.isLogin)b.regRecommUrl&&(b.myRecomm=!0,c.get(g.isTestFlag?g.regRecomUrl:b.regRecommUrl).success(function(a){if(a.data){if(alert(a.data.resultMsg),a.data.resultCode)switch(a.data.resultCode){case"01":case"02":b.recommCnt=b.recommCnt+1;case"03":b.recommYn=!0;case"04":break;case"05":}}else alert("다시 한번 시도해주시기 바랍니다.")}));else{alert("로그인을 해주세요.");var e="&targetUrl="+encodeURIComponent(a.location.href,"UTF-8");a.location.href=g.loginUrl+"?"+d.baseParam+e}},d.autoVdoPlay=function(){setTimeout(function(){b.element("#autoVideoCommentView").load()},100),e(function(){autoVideoPlay("autoVideoCommentView","#autoVideoCommentView")},100)}}]),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/product/m/sub/product_comment_detail_container.html",replace:!0,link:function(a,b,c){a.isShowBtnTalk=!1}}}),d.filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),d.filter("starScorePolicy",function(){return function(a,b){if(!a)return 0;var d=5,e=Math.ceil(2*a)/2;return b!=c&&(e=e/d*b),e}})}(window,window.angular);