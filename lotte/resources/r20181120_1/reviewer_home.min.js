!function(a,b,c){"use strict";var d=b.module("lotteVideo",[]);d.controller("LotteVideoCtrl",["$scope",function(a){}]),d.directive("lotteVideo",["$window","$timeout","LotteUtil",function(c,d,e){return{controller:"LotteVideoCtrl",link:function(c,f,g,h){function i(){n.src="",d(function(){n.src=j},300),q.appObj.isIOS||n.removeAttribute("controls"),c.movMode=0,c.$apply()}c.movMode=0,c.mute=!1;var j=g.lvSrc,k=g.lvDetailUrl,l=g.lvNoAlert,m=g.lvPoster,n=b.element(f).find("video")[0],o=g.lvTime||2e3;n.setAttribute("poster",m),n.addEventListener("ended",i,!1);var p={play:function(){a.videoStateModel.setPlay(!0,String(9999999*Math.random()))},pause:function(){a.videoStateModel.setPlay(!1)}};n.addEventListener("play",p.play,!1),n.addEventListener("pause",p.pause,!1);var q=e.getAbsScope(c);c.playVideo=function(){if(l||confirm("3G/LTE에서 재생시 데이터 요금이 부과할 수 있으니 유의하세요~")){var a=b.element(document.body).data("play_video")||"";if(a){var e=b.element("#"+a);if(e&&e.length>0){e[0].pause();var g=e.scope();g.movMode=0}}c.movMode=1,n.src||(n.src=j),n.play(),b.element(document.body).data("play_video",b.element(n).attr("id")),d(function(){1==c.movMode&&$(f).find(".btns").fadeOut(600,function(){c.movMode=2,$(this).attr("style",""),c.$apply()})},o)}},c.clickCover=function(){c.movMode=1,d(function(){1==c.movMode&&$(f).find(".btns").fadeOut(600,function(){c.movMode=2,$(this).attr("style",""),c.$apply()})},o)},c.stopVideo=function(){n.pause(),c.movMode=0},c.muteVideo=function(){n.muted?(c.mute=!1,n.muted=!1):(c.mute=!0,n.muted=!0)},c.fullVideo=function(){n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.webkitEnterFullscreen&&n.webkitEnterFullscreen(),q.appObj.isIOS||n.setAttribute("controls","controls")},c.goDetailPage=function(){location.href=k},b.element(f).find("video").bind("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(a){var b=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen,d=b?"FullscreenOn":"FullscreenOff";"FullscreenOff"==d&&(c.stopVideo(),q.appObj.isIOS||n.removeAttribute("controls"),c.$apply())})}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteSideMylotte","lotteCommFooter","lotteVideo"]);d.controller("ReviewerHomeCtrl",["$scope","LotteCommon",function(a,b){a.showWrap=!0,a.contVisible=!0,a.subTitle="리뷰어 홈",a.gaCtgName="MO_리뷰어홈",a.pageUI={gdasNo:null,goodsNo:null,loadData:null},a.dataLoaded=!1,a.reportList=[],a.objLink={reviewBest:b.reviewBest,critViewUrl:b.critViewUrl},a.dummyUrl="http://image.lotte.com/lotte/mo2018/reviews/default_profile.png"}]),d.filter("starScorePolicy",function(){return function(a,b){if(!a)return 0;var d=5,e=Math.ceil(2*a)/2;return b!=c&&(e=e/d*b),e}}),d.filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),d.directive("onImgLoaded",function(){return{link:function(a,c,d){b.element(c).on("load",function(){var b=this,c=d.curIdx;console.log("load  "+c),setTimeout(function(){console.log(b.clientWidth,b.clientHeight),b.clientWidth&&b.clientHeight&&(b.clientWidth>=b.clientHeight?a.pageUI.loadData.review_list.items[c].photoList.items[0].typeClass="wid":a.pageUI.loadData.review_list.items[c].photoList.items[0].typeClass="hei")},500)}).each(function(){this.complete&&b.element(this).trigger("load")})}}}),d.directive("lotteContainer",["$timeout","$http","$window","LotteCommon","commInitData","LotteGA","LotteUtil","LotteForm",function(a,c,d,e,f,g,h,i){return{templateUrl:"/lotte/resources_dev/product/m/reviewer_home_container.html",replace:!0,link:function(j,k,l){function m(a){a.preventDefault()}j.currentRows=0,j.pageNum=1,(j.loadData=function(){f.query.revr_mbr_no&&(j.jsonLoading=!0,i.FormSubmitForAjax(e.reviewerHomeInfo,{revr_mbr_no:f.query.revr_mbr_no,page:j.pageNum}).success(function(a){a.data&&(1==j.pageNum?j.pageUI.loadData=a.data:j.pageUI.loadData.review_list.items=j.pageUI.loadData.review_list.items.concat(a.data.review_list.items),j.pageNum++,a.data.review_list&&a.data.review_list.total_count&&(j.currentRows+=a.data.review_list.total_count))}).error(function(){console.log("Data Error : 리뷰어 홈 데이터 로드 실패")})["finally"](function(){j.jsonLoading=!1,j.dataLoaded=!0}))})(),j.addFav=function(){if(g.evtTag(j.gaCtgName,"프로필영역","즐겨찾기"),!j.loginInfo.isLogin){alert("로그인을 해주세요.");var a="&targetUrl="+encodeURIComponent(d.location.href,"UTF-8");return void(d.location.href=e.loginUrl+"?"+j.baseParam+a)}i.FormSubmitForAjax(e.addFavReviewer,{revr_mbr_no:f.query.revr_mbr_no}).success(function(a){return a&&a.data?void("01"==a.data.resultCode?j.pageUI.loadData.profile.favoriteYn=!0:a.data.resultMsg&&alert(a.data.resultMsg)):void alert("다시 한번 시도해주시기 바랍니다.")}).error(function(){alert("다시 한번 시도해주시기 바랍니다.")})},j.delFav=function(){if(g.evtTag(j.gaCtgName,"프로필영역","즐겨찾기 취소"),!j.loginInfo.isLogin){alert("로그인을 해주세요.");var a="&targetUrl="+encodeURIComponent(d.location.href,"UTF-8");return void(d.location.href=e.loginUrl+"?"+j.baseParam+a)}i.FormSubmitForAjax(e.delFavReviewer,{revr_mbr_no_list:f.query.revr_mbr_no}).success(function(a){return a&&a.data?void("01"==a.data.resultCode?j.pageUI.loadData.profile.favoriteYn=!1:a.data.resultMsg&&alert(a.data.resultMsg)):void alert("다시 한번 시도해주시기 바랍니다.")}).error(function(){alert("다시 한번 시도해주시기 바랍니다.")})},a(function(){j.supportPassive=h.supportPassive()},300),j.showReviewOne=function(b,c){g.evtTag(j.gaCtgName,"리뷰내용","해당 상품평 사진/영상 크게보기",c);var d=!1;j.supportPassive&&(document.addEventListener("touchmove",m,{passive:!1}),d=!0),j.dimmedOpen({callback:j.hideReviewOne,scrollEventFlag:d}),a(function(){j.sb_review_index=1,j.arrReviewOne=b},200)},j.hideReviewOne=function(){j.arrReviewOne=[],j.supportPassive&&document.removeEventListener("touchmove",m,!1)},j.reviewSwipeCurIdx=0,j.sb_review_index=1,j.swipeReviewEnd=function(a){a!=j.reviewSwipeCurIdx&&(j.swipeReviewVideoStop(),j.sb_review_index=a+1,j.reviewSwipeCurIdx=a)},j.swipeReviewVideoStop=function(){$(".lv_wrap video").each(function(b,c){$(c).siblings(".stop_cover:visible, .click_cover:visible").length>=1&&a(function(){$(c).siblings(".btn_stop").trigger("click")},10)})},j.getReviewSwipeControl=function(a){j.swipeReviewControl=a,j.reviewSwipeCurIdx=j.swipeReviewControl.getIndex()},j.swipeBeforeReview=function(){0===j.reviewSwipeCurIdx?j.reviewSwipeCurIdx=j.arrReviewOne.length:j.reviewSwipeCurIdx--,j.swipeReviewControl.moveIndex(j.reviewSwipeCurIdx),1==j.sb_review_index?j.sb_review_index=j.arrReviewOne.length:j.sb_review_index--},j.swipeNextReview=function(){j.reviewSwipeCurIdx===j.arrReviewOne.length-1?j.reviewSwipeCurIdx=0:j.reviewSwipeCurIdx++,j.swipeReviewControl.moveIndex(j.reviewSwipeCurIdx),j.sb_review_index==j.arrReviewOne.length?j.sb_review_index=1:j.sb_review_index++},j.showReportPop=function(c){if(g.evtTag(j.gaCtgName,"리뷰내용","상품평 신고",c.gdasNo),j.loginInfo.isLogin){if(!j.pageUI.loadData.badList||!j.pageUI.loadData.badList.items)return;j.pageUI.goodsNo=c.goodsNo,j.pageUI.gdasNo=c.gdasNo,i.FormSubmitForAjax(e.checkCommentReport,{goods_no:c.goodsNo,gdas_no:c.gdasNo}).success(function(d){if(!d||!d.data)return void alert("다시 한번 시도해주시기 바랍니다.");if("02"==d.data.resultCode||"03"==d.data.resultCode)d.data.resultMsg&&alert(d.data.resultMsg);else if("01"==d.data.resultCode){var e=!1;j.supportPassive&&(document.addEventListener("touchmove",m,{passive:!1}),e=!0),j.dimmedOpen({callback:j.hideReportPop,scrollEventFlag:e}),j.pageUI.gdasItem=c,j.badList=j.pageUI.loadData.badList.items,a(function(){b.element("#reportPop").css({"margin-top":-1*b.element("#reportPop").height()/2+"px"})},500)}}).error(function(){alert("다시 한번 시도해주시기 바랍니다.")})}else{alert("로그인을 해주세요.");var f="&targetUrl="+encodeURIComponent(d.location.href,"UTF-8");d.location.href=e.loginUrl+"?"+j.baseParam+f}},j.showReportHomePop=function(c){if(g.evtTag(j.gaCtgName,"프로필영역","프로필 신고"),j.loginInfo.isLogin){if(!j.pageUI.loadData.reportList||!j.pageUI.loadData.reportList.items)return;if(j.pageUI.loadData.profile.badYn)return void alert("동일 리뷰어는 일주일에 한 번 신고 가능합니다.");j.stopScroll=!0;var f=!1;j.supportPassive&&(document.addEventListener("touchmove",m,{passive:!1}),f=!0),j.dimmedOpen({callback:j.hideReportHomePop,scrollEventFlag:f}),j.pageUI.gdasItem=c,j.reportList=j.pageUI.loadData.reportList.items,j.inputData="",a(function(){b.element("#reportHomePop").css({"margin-top":-1*b.element("#reportHomePop").height()/2+"px"})},500)}else{alert("로그인을 해주세요.");var h="&targetUrl="+encodeURIComponent(d.location.href,"UTF-8");d.location.href=e.loginUrl+"?"+j.baseParam+h}},j.hideReportPop=function(){j.dimmedClose(),j.badList=[],j.supportPassive&&document.removeEventListener("touchmove",m,!1)},j.hideReportHomePop=function(){j.dimmedClose(),j.stopScroll=!1,j.reportList=[],j.supportPassive&&document.removeEventListener("touchmove",m,!1)},j.recommClick=function(a){if(g.evtTag(j.gaCtgName,"리뷰내용","상품평 추천",a.gdasNo),j.loginInfo.isLogin)a.regRecommUrl&&(a.myRecomm=!0,c.get(e.isTestFlag?e.regRecomUrl:a.regRecommUrl).success(function(b){if(b.data){if(alert(b.data.resultMsg),b.data.resultCode)switch(b.data.resultCode){case"01":case"02":a.recommCnt=a.recommCnt+1;case"03":a.recommYn=!0;break;case"04":case"05":case"06":a.recommYn=!1}}else alert("다시 한번 시도해주시기 바랍니다."),a.recommYn=!1}));else{alert("로그인을 해주세요.");var b="&targetUrl="+encodeURIComponent(d.location.href,"UTF-8");d.location.href=e.loginUrl+"?"+j.baseParam+b}},j.goProduct=function(b){g.evtTag(j.gaCtgName,"리뷰내용","상품 상세 가기",b.goodsNo),a(function(){location.href="/product/product_view.do?"+j.baseParam+"&goods_no="+b.goodsNo},300)},j.commentDetail=function(b,c){g.evtTag(j.gaCtgName,"리뷰내용","상품평 상세보기",b),a(function(){location.href=e.productSubCommentEach+"?"+j.baseParam+"&goods_no="+c+"&gdas_no="+b},300)},j.goBestReview=function(){g.evtTag(j.gaCtgName,"이동구좌","베스트 상품평 가기"),a(function(){location.href=j.objLink.reviewBest+"?"+j.baseParam},300)},j.goMyReview=function(){g.evtTag(j.gaCtgName,"이동구좌","내 상품평 가기"),a(function(){location.href=j.objLink.critViewUrl+"?"+j.baseParam},300)};var n=b.element("body")[0];j.$on("winScroll",function(a,b){j.stopScroll||!j.pageUI.loadData||!j.pageUI.loadData.totalCnt||j.currentRows>=j.pageUI.loadData.totalCnt||j.reportList&&j.reportList.length||j.badList&&j.badList.length||!j.jsonLoading&&n.scrollHeight-2*b.winHeight<=b.scrollPos+b.winHeight&&j.loadData()})}}}]),d.directive("onErrorSrc",function(){return{link:function(a,b,c){b.bind("error",function(){a.pageUI.loadData.profile.imgUrl!=a.dummyUrl&&(a.pageUI.loadData.profile.imgUrl=a.dummyUrl)})}}}),d.directive("reportPop",["$window","$location","LotteCommon","commInitData","$timeout","$http",function(a,b,c,d,e,f){return{link:function(b,d,e){b.sendReport=function(){if(!d.find("input[type=radio]:checked").length)return void alert("신고사유를 선택해주세요.");if(b.loginInfo.isLogin)f.get(c.commentReport,{params:{site_no:1,goods_no:b.pageUI.goodsNo,gdas_no:b.pageUI.gdasNo,dcl_accp_tp_cd:d.find("input[type=radio]:checked").val()}}).success(function(a){return a&&a.data?void(a.data.resultMsg&&(alert(a.data.resultMsg),b.hideReportPop())):void alert("다시 한번 시도해주시기 바랍니다.")}).error(function(){alert("다시 한번 시도해주시기 바랍니다.")});else{alert("로그인을 해주세요.");var e="&targetUrl="+encodeURIComponent(a.location.href,"UTF-8");a.location.href=c.loginUrl+"?"+b.baseParam+e}}}}}]),d.directive("reportHomePop",["$window","$location","LotteCommon","LotteForm","commInitData","$timeout","$http",function(a,c,d,e,f,g,h){return{link:function(c,g,h){function i(a){var b=/[`~!@#$%^&*|\\\'\";:\/?]/gi;return b.test(a)?!0:!1}c.sendReportHome=function(){if(!g.find("input[type=radio]:checked").length)return void alert("신고사유를 선택해주세요.");if(i(c.inputData))return alert("특수문자는 입력할수 없습니다."),void $("#inputReportPop").focus();if(c.loginInfo.isLogin)e.FormSubmitForAjax(d.reportBadReviewer,{revr_mbr_no:f.query.revr_mbr_no,dcl_accp_tp_cd:g.find("input[type=radio]:checked").val(),note_cont:g.find("#inputReportPop").val()}).success(function(a){return a&&a.data?(a.data.resultCode&&"01"==a.data.resultCode&&(c.pageUI.loadData.profile.badYn=!0),void(a.data.resultMsg&&(alert(a.data.resultMsg),c.hideReportPop()))):void alert("다시 한번 시도해주시기 바랍니다.")}).error(function(){alert("다시 한번 시도해주시기 바랍니다.")});else{alert("로그인을 해주세요.");var b="&targetUrl="+encodeURIComponent(a.location.href,"UTF-8");a.location.href=d.loginUrl+"?"+c.baseParam+b}},c.calcByte=function(){var a,d=b.element("#inputReportPop"),e=b.element("#curbyte"),f=0,g=0,h="",i=50;if(d.val().length)for(var j=0;j<d.val().length;j++){if(a=d.val().charAt(j),g=f,escape(a).length>4?f+=2:f++,f>i){alert("50바이트를 초과할 수 없습니다."),d.val(h),e.text(g);break}h+=a,e.text(f)}else e.text(f);c.inputData=h},c.changeRadio=function(){c.selectedR=b.element("#reportHomePop").find("input[type=radio]:checked").val()}}}}])}(window,window.angular);