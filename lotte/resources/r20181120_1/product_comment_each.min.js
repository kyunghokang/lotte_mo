!function(a,b,c){"use strict";var d=b.module("lotteVideo",[]);d.controller("LotteVideoCtrl",["$scope",function(a){}]),d.directive("lotteVideo",["$window","$timeout","LotteUtil",function(c,d,e){return{controller:"LotteVideoCtrl",link:function(c,f,g,h){function i(){n.src="",d(function(){n.src=j},300),q.appObj.isIOS||n.removeAttribute("controls"),c.movMode=0,c.$apply()}c.movMode=0,c.mute=!1;var j=g.lvSrc,k=g.lvDetailUrl,l=g.lvNoAlert,m=g.lvPoster,n=b.element(f).find("video")[0],o=g.lvTime||2e3;n.setAttribute("poster",m),n.addEventListener("ended",i,!1);var p={play:function(){a.videoStateModel.setPlay(!0,String(9999999*Math.random()))},pause:function(){a.videoStateModel.setPlay(!1)}};n.addEventListener("play",p.play,!1),n.addEventListener("pause",p.pause,!1);var q=e.getAbsScope(c);c.playVideo=function(){if(l||confirm("3G/LTE에서 재생시 데이터 요금이 부과할 수 있으니 유의하세요~")){var a=b.element(document.body).data("play_video")||"";if(a){var e=b.element("#"+a);if(e&&e.length>0){e[0].pause();var g=e.scope();g.movMode=0}}c.movMode=1,n.src||(n.src=j),n.play(),b.element(document.body).data("play_video",b.element(n).attr("id")),d(function(){1==c.movMode&&$(f).find(".btns").fadeOut(600,function(){c.movMode=2,$(this).attr("style",""),c.$apply()})},o)}},c.clickCover=function(){c.movMode=1,d(function(){1==c.movMode&&$(f).find(".btns").fadeOut(600,function(){c.movMode=2,$(this).attr("style",""),c.$apply()})},o)},c.stopVideo=function(){n.pause(),c.movMode=0},c.muteVideo=function(){n.muted?(c.mute=!1,n.muted=!1):(c.mute=!0,n.muted=!0)},c.fullVideo=function(){n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.webkitEnterFullscreen&&n.webkitEnterFullscreen(),q.appObj.isIOS||n.setAttribute("controls","controls")},c.goDetailPage=function(){location.href=k},b.element(f).find("video").bind("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(a){var b=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen,d=b?"FullscreenOn":"FullscreenOff";"FullscreenOff"==d&&(c.stopVideo(),q.appObj.isIOS||n.removeAttribute("controls"),c.$apply())})}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("product-sub-header",[]);d.directive("productSubHeader",["$http","$timeout","$window","$location","LotteCommon","LotteCookie","LotteStorage","LotteUtil",function(a,b,c,d,e,f,g,h){return{templateUrl:"/lotte/resources_dev/product/m/sub/product_sub_header.html",replace:!0,link:function(a,b,c){a.gotoPrepage=function(){a.jsonLoading=!0,a.sendTclick("m_RDC_header_new_pre"),a.appObj.isNativeHeader?appSendBack():history.go(-1)}}}}]),"undefined"!=typeof module&&module.exports&&(module.exports=d.name)}(window,window.angular),function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","product-sub-header","lotteVideo"]);d.controller("ProductCommentEachCtrl",["$window","$http","$scope","$timeout","$compile","LotteCommon","commInitData","LotteGA","LotteUtil",function(a,b,d,e,f,g,h,i,j){function k(a,b,d){return a!=c&&null!=a&&""!=a&&(a=a.split(b).join(d)),a}function l(a){a.preventDefault()}d.showWrap=!0,d.contVisible=!0,d.productSubTitle="상품평 상세보기",d.screenID="product_comment_each",d.jsonLoading=!1,d.gaCtgName="MO_상품상세_상품평 상세보기",d.pageUI={gdasNo:null,goodsNo:null,usmGoodsNo:"",loadData:null},d.dummyUrl="http://image.lotte.com/lotte/mo2018/reviews/default_profile.png",d.pageUI.goodsNo=h.query.goods_no?h.query.goods_no:"",d.pageUI.gdasNo=h.query.gdas_no?h.query.gdas_no:null,d.pageUI.usmGoodsNo=h.query.usm_goods_no||"",d.addZero=function(a,b){for(var c=a+"",d=b||2;c.length<d;)c="0"+c;return c},d.loadData=function(){d.jsonLoading=!0,b.get(g.isTestFlag?"/json/product/comment_each_"+d.pageUI.goodsNo+".json":"/json/product_new/comment_each.json",{params:{goods_no:d.pageUI.goodsNo,gdas_no:d.pageUI.gdasNo,usm_goods_no:d.pageUI.usmGoodsNo}}).success(function(a){a.data&&(d.pageUI.loadData=a.data,a.data.critList&&a.data.critList.items&&a.data.critList.items[0]&&(d.pageUI.loadData.item=a.data.critList.items[0],d.pageUI.loadData.item.critCont&&(d.pageUI.loadData.item.critContHtml=k(d.pageUI.loadData.item.critCont,"\r\n","<br />"))))}).error(function(){console.log("Data Error : 상품평 상세보기 데이터 로드 실패")})["finally"](function(){d.jsonLoading=!1})},d.loadData(),d.recommClick=function(c){if(i.evtTag(d.gaCtgName,"개별상품평","추천하기"),d.loginInfo.isLogin)c.regRecommUrl&&(c.myRecomm=!0,b.get(c.regRecommUrl).success(function(a){if(a.data){if(alert(a.data.resultMsg),a.data.resultCode)switch(a.data.resultCode){case"01":case"02":c.recommCnt=c.recommCnt+1;case"03":c.recommYn=!0;case"04":break;case"05":break;case"06":c.recommYn=!1}}else alert("다시 한번 시도해주시기 바랍니다."),c.recommYn=!1}));else{alert("로그인을 해주세요.");var e="&targetUrl="+encodeURIComponent(a.location.href,"UTF-8");a.location.href=g.loginUrl+"?"+d.baseParam+e}},e(function(){d.supportPassive=j.supportPassive()},300),d.showReportPop=function(c){if(i.evtTag(d.gaCtgName,"개별상품평","신고하기"),d.loginInfo.isLogin){if(!d.pageUI.loadData.badList.items)return;b.get(g.checkCommentReport,{params:{goods_no:d.pageUI.goodsNo,gdas_no:d.pageUI.gdasNo}}).success(function(a){if(!a||!a.data)return void alert("다시 한번 시도해주시기 바랍니다.");if("02"==a.data.resultCode||"03"==a.data.resultCode)a.data.resultMsg&&alert(a.data.resultMsg);else if("01"==a.data.resultCode){var b=!1;d.supportPassive&&(document.addEventListener("touchmove",l,{passive:!1}),b=!0),d.dimmedOpen({target:"pop_report",callback:d.hideReportPop,scrollEventFlag:b}),d.pageUI.gdasItem=c,d.pageUI.loadData.reportList=d.pageUI.loadData.badList.items}}).error(function(){alert("다시 한번 시도해주시기 바랍니다.")})}else{alert("로그인을 해주세요.");var e="&targetUrl="+encodeURIComponent(a.location.href,"UTF-8");a.location.href=g.loginUrl+"?"+d.baseParam+e}},d.hideReportPop=function(){d.dimmedClose(),d.pageUI.loadData.reportList=null,d.supportPassive&&document.removeEventListener("touchmove",l,!1)},d.productClick=function(){if(d.pageUI.goodsNo){i.evtTag(d.gaCtgName,"리뷰 상품","상품상세로 이동",d.pageUI.goodsNo);var b=g.productviewUrl+"?"+d.baseParam+"&goods_no="+d.pageUI.goodsNo;e(function(){a.location.href=b},300)}},d.showReviewOne=function(a,b,c){var f=!1;d.supportPassive&&(document.addEventListener("touchmove",l,{passive:!1}),f=!0),d.dimmedOpen({callback:d.hideReviewOne,scrollEventFlag:f}),e(function(){for(var f=0;f<a.length;f++)a[f].videoUrl=b;d.arrReviewOne=a,e(function(){d.reviewSwipeCurIdx=parseInt(c,10),d.sb_review_index=parseInt(c,10)+1,d.swipeReviewControl.moveIndex(d.reviewSwipeCurIdx)},300)},200),i.evtTag(d.gaCtgName,"개별상품평","사진",d.addZero(c+1))},d.hideReviewOne=function(){d.dimmedClose(),d.arrReviewOne=[],d.supportPassive&&document.removeEventListener("touchmove",l,!1)},d.reviewSwipeCurIdx=0,d.sb_review_index=1,d.swipeReviewEnd=function(a){a!=d.reviewSwipeCurIdx&&(d.swipeReviewVideoStop(),d.sb_review_index=a+1,d.reviewSwipeCurIdx=a)},d.swipeReviewVideoStop=function(){$(".lv_wrap video").each(function(a,b){$(b).siblings(".stop_cover:visible, .click_cover:visible").length>=1&&e(function(){$(b).siblings(".btn_stop").trigger("click")},10)})},d.getReviewSwipeControl=function(a){d.swipeReviewControl=a,d.reviewSwipeCurIdx=d.swipeReviewControl.getIndex()},d.swipeBeforeReview=function(){0===d.reviewSwipeCurIdx?d.reviewSwipeCurIdx=d.arrReviewOne.length:d.reviewSwipeCurIdx--,d.swipeReviewControl.moveIndex(d.reviewSwipeCurIdx),1==d.sb_review_index?d.sb_review_index=d.arrReviewOne.length:d.sb_review_index--},d.swipeNextReview=function(){d.reviewSwipeCurIdx===d.arrReviewOne.length-1?d.reviewSwipeCurIdx=0:d.reviewSwipeCurIdx++,d.swipeReviewControl.moveIndex(d.reviewSwipeCurIdx),d.sb_review_index==d.arrReviewOne.length?d.sb_review_index=1:d.sb_review_index++}}]),d.directive("onImgLoaded",function(){return{link:function(a,c,d){b.element(c).on("load",function(){var b=this,c=d.curIdx;setTimeout(function(){b.clientWidth&&b.clientHeight&&(b.clientWidth>=b.clientHeight?a.pageUI.loadData.item.photoList.items[c].typeClass="wid":a.pageUI.loadData.item.photoList.items[c].typeClass="hei")},500)}).each(function(){this.complete&&b.element(this).trigger("load")})}}}),d.directive("lotteContainer",["LotteGA","$timeout",function(a,b){return{templateUrl:"/lotte/resources_dev/product/m/sub/product_comment_each_container.html",replace:!0,link:function(c,d,e){c.isShowBtnTalk=!1,c.goReviewerHome=function(d){if(d.reviewerHomeUrl){if(d.reviewerHomeUrl.indexOf("revr_mbr_no=")>-1){var e=d.reviewerHomeUrl.split("revr_mbr_no=");try{a.evtTag(c.gaCtgName,"리뷰어","리뷰어홈가기",e[1].split("&")[0])}catch(f){}}else d.reviewerHomeUrl.indexOf("/mylotte_crit_view.do")>-1&&a.evtTag(c.gaCtgName,"리뷰어","리뷰어홈가기",c.loginInfo.mbrNo);b(function(){location.href=d.reviewerHomeUrl.indexOf("?")>-1?d.reviewerHomeUrl+"&"+c.baseParam:d.reviewerHomeUrl+"?"+c.baseParam},300)}}}}}]),d.filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),d.filter("starScorePolicy",function(){return function(a,b){if(!a)return 0;var d=5,e=Math.ceil(2*a)/2;return b!=c&&(e=e/d*b),e}}),d.directive("onErrorSrc",function(){return{link:function(a,b,c){b.bind("error",function(){a.pageUI.loadData.item.reviewerImgUrl!=a.dummyUrl&&(a.pageUI.loadData.item.reviewerImgUrl=a.dummyUrl)})}}}),d.directive("reportPop",["$window","$location","LotteCommon","$timeout","$parse","$http","LotteGA",function(a,b,c,d,e,f,g){return{scope:!0,link:function(b,d,e){b.sendReport=function(){if(d.find("input[type=radio]:checked").length)if(b.loginInfo.isLogin)f.get(c.commentReport,{params:{site_no:1,goods_no:b.pageUI.goodsNo,gdas_no:b.pageUI.gdasNo,dcl_accp_tp_cd:d.find("input[type=radio]:checked").val()}}).success(function(a){return a&&a.data?void(a.data.resultMsg&&(alert(a.data.resultMsg),b.hideReportPop())):void alert("다시 한번 시도해주시기 바랍니다.")}).error(function(){alert("다시 한번 시도해주시기 바랍니다.")});else{alert("로그인을 해주세요.");var e="&targetUrl="+encodeURIComponent(a.location.href,"UTF-8");a.location.href=c.loginUrl+"?"+b.baseParam+e}}}}}])}(window,window.angular);