!function(a,b,c){"use strict";var d=b.module("lotteVideo",[]);d.controller("LotteVideoCtrl",["$scope",function(a){}]),d.directive("lotteVideo",["$window","$timeout","LotteUtil",function(c,d,e){return{controller:"LotteVideoCtrl",link:function(c,f,g,h){function i(){n.src="",d(function(){n.src=j},300),q.appObj.isIOS||n.removeAttribute("controls"),c.movMode=0,c.$apply()}c.movMode=0,c.mute=!1;var j=g.lvSrc,k=g.lvDetailUrl,l=g.lvNoAlert,m=g.lvPoster,n=b.element(f).find("video")[0],o=g.lvTime||2e3;n.setAttribute("poster",m),n.addEventListener("ended",i,!1);var p={play:function(){a.videoStateModel.setPlay(!0,String(9999999*Math.random()))},pause:function(){a.videoStateModel.setPlay(!1)}};n.addEventListener("play",p.play,!1),n.addEventListener("pause",p.pause,!1);var q=e.getAbsScope(c);c.playVideo=function(){if(l||confirm("3G/LTE에서 재생시 데이터 요금이 부과할 수 있으니 유의하세요~")){var a=b.element(document.body).data("play_video")||"";if(a){var e=b.element("#"+a);if(e&&e.length>0){e[0].pause();var g=e.scope();g.movMode=0}}c.movMode=1,n.src||(n.src=j),n.play(),b.element(document.body).data("play_video",b.element(n).attr("id")),d(function(){1==c.movMode&&$(f).find(".btns").fadeOut(600,function(){c.movMode=2,$(this).attr("style",""),c.$apply()})},o)}},c.clickCover=function(){c.movMode=1,d(function(){1==c.movMode&&$(f).find(".btns").fadeOut(600,function(){c.movMode=2,$(this).attr("style",""),c.$apply()})},o)},c.stopVideo=function(){n.pause(),c.movMode=0},c.muteVideo=function(){n.muted?(c.mute=!1,n.muted=!1):(c.mute=!0,n.muted=!0)},c.fullVideo=function(){n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.webkitEnterFullscreen&&n.webkitEnterFullscreen(),q.appObj.isIOS||n.setAttribute("controls","controls")},c.goDetailPage=function(){location.href=k},b.element(f).find("video").bind("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(a){var b=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen,d=b?"FullscreenOn":"FullscreenOff";"FullscreenOff"==d&&(c.stopVideo(),q.appObj.isIOS||n.removeAttribute("controls"),c.$apply())})}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteSideMylotte","lotteCommFooter","lotteVideo"]);d.controller("ReviewerHomeCtrl",["$scope","LotteCommon",function(a,b){a.showWrap=!0,a.contVisible=!0,a.subTitle="리뷰어 홈",a.gaCtgName="MO_리뷰어홈",a.pageUI={gdasNo:null,goodsNo:null,loadData:null},a.dataLoaded=!1,a.reportList=[],a.objLink={reviewBest:b.reviewBest,critViewUrl:b.critViewUrl},a.dummyUrl="http://image.lotte.com/lotte/mo2018/reviews/default_profile.png"}]),d.filter("starScorePolicy",function(){return function(a,b){if(!a)return 0;var d=5,e=Math.ceil(2*a)/2;return b!=c&&(e=e/d*b),e}}),d.filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),d.directive("lotteContainer",["$timeout","$http","$window","LotteCommon","commInitData","LotteGA",function(a,c,d,e,f,g){return{templateUrl:"/lotte/resources_dev/product/m/reviewer_home_container.html",replace:!0,link:function(h,i,j){h.currentRows=0,h.pageNum=1,(h.loadData=function(){f.query.revr_mbr_no&&(h.jsonLoading=!0,c.get(e.reviewerHomeInfo,{params:{revr_mbr_no:f.query.revr_mbr_no,page:h.pageNum}}).success(function(a){a.data&&(1==h.pageNum?h.pageUI.loadData=a.data:h.pageUI.loadData.review_list.items=h.pageUI.loadData.review_list.items.concat(a.data.review_list.items),h.pageNum++,h.currentRows+=a.data.review_list.total_count)}).error(function(){console.log("Data Error : 리뷰어 홈 데이터 로드 실패")})["finally"](function(){h.jsonLoading=!1,h.dataLoaded=!0}))})(),h.addFav=function(){if(g.evtTag(h.gaCtgName,"프로필영역","즐겨찾기"),!h.loginInfo.isLogin){alert("로그인을 해주세요.");var a="&targetUrl="+encodeURIComponent(d.location.href,"UTF-8");return void(d.location.href=e.loginUrl+"?"+h.baseParam+a)}c.get(e.addFavReviewer,{params:{mbr_no:h.loginInfo.mbrNo,revr_mbr_no:f.query.revr_mbr_no}}).success(function(a){return a&&a.data?void("01"==a.data.resultCode?h.pageUI.loadData.profile.favoriteYn=!0:a.data.resultMsg&&alert(a.data.resultMsg)):void alert("다시 한번 시도해주시기 바랍니다.")}).error(function(){alert("다시 한번 시도해주시기 바랍니다.")})},h.delFav=function(){if(g.evtTag(h.gaCtgName,"프로필영역","즐겨찾기 취소"),!h.loginInfo.isLogin){alert("로그인을 해주세요.");var a="&targetUrl="+encodeURIComponent(d.location.href,"UTF-8");return void(d.location.href=e.loginUrl+"?"+h.baseParam+a)}c.get(e.delFavReviewer,{params:{mbr_no:h.loginInfo.mbrNo,revr_mbr_no_list:f.query.revr_mbr_no}}).success(function(a){return a&&a.data?void("01"==a.data.resultCode?h.pageUI.loadData.profile.favoriteYn=!1:a.data.resultMsg&&alert(a.data.resultMsg)):void alert("다시 한번 시도해주시기 바랍니다.")}).error(function(){alert("다시 한번 시도해주시기 바랍니다.")})},h.showReviewOne=function(b,c){g.evtTag(h.gaCtgName,"리뷰내용","해당 상품평 사진/영상 크게보기",c),h.dimmedOpen({callback:h.hideReviewOne,scrollEventFlag:!0}),a(function(){h.sb_review_index=1,h.arrReviewOne=b,$("#lotteDimm").css("z-index","115")},200)},h.hideReviewOne=function(){h.arrReviewOne=[]},h.reviewSwipeCurIdx=0,h.sb_review_index=1,h.swipeReviewEnd=function(a){a!=h.reviewSwipeCurIdx&&(h.swipeReviewVideoStop(),h.sb_review_index=a+1,h.reviewSwipeCurIdx=a)},h.swipeReviewVideoStop=function(){$(".lv_wrap video").each(function(b,c){$(c).siblings(".stop_cover:visible, .click_cover:visible").length>=1&&a(function(){$(c).siblings(".btn_stop").trigger("click")},10)})},h.getReviewSwipeControl=function(a){h.swipeReviewControl=a,h.reviewSwipeCurIdx=h.swipeReviewControl.getIndex()},h.swipeBeforeReview=function(){0===h.reviewSwipeCurIdx?h.reviewSwipeCurIdx=h.arrReviewOne.length:h.reviewSwipeCurIdx--,h.swipeReviewControl.moveIndex(h.reviewSwipeCurIdx),1==h.sb_review_index?h.sb_review_index=h.arrReviewOne.length:h.sb_review_index--},h.swipeNextReview=function(){h.reviewSwipeCurIdx===h.arrReviewOne.length-1?h.reviewSwipeCurIdx=0:h.reviewSwipeCurIdx++,h.swipeReviewControl.moveIndex(h.reviewSwipeCurIdx),h.sb_review_index==h.arrReviewOne.length?h.sb_review_index=1:h.sb_review_index++},h.showReportPop=function(f){if(g.evtTag(h.gaCtgName,"리뷰내용","상품평 신고",f.gdasNo),h.loginInfo.isLogin){if(!h.pageUI.loadData.badList||!h.pageUI.loadData.badList.items)return;h.pageUI.goodsNo=f.goodsNo,h.pageUI.gdasNo=f.gdasNo,c.get(e.checkCommentReport,{params:{goods_no:f.goodsNo,gdas_no:f.gdasNo}}).success(function(c){return c&&c.data?void("02"==c.data.resultCode||"03"==c.data.resultCode?c.data.resultMsg&&alert(c.data.resultMsg):"01"==c.data.resultCode&&(h.dimmedOpen({callback:h.hideReportPop}),h.LotteDimm.dimmedOpacity="0.6",a(function(){b.element("#lotteDimm").css("z-index","210")}),h.pageUI.gdasItem=f,h.badList=h.pageUI.loadData.badList.items,a(function(){b.element("#reportPop").css({"margin-top":-1*b.element("#reportPop").height()/2+"px"})},500))):void alert("다시 한번 시도해주시기 바랍니다.")}).error(function(){alert("다시 한번 시도해주시기 바랍니다.")})}else{alert("로그인을 해주세요.");var i="&targetUrl="+encodeURIComponent(d.location.href,"UTF-8");d.location.href=e.loginUrl+"?"+h.baseParam+i}},h.showReportHomePop=function(c){if(g.evtTag(h.gaCtgName,"프로필영역","프로필 신고"),h.loginInfo.isLogin){if(!h.pageUI.loadData.reportList||!h.pageUI.loadData.reportList.items)return;if(h.pageUI.loadData.profile.badYn)return void alert("동일 리뷰어는 일주일에 한 번 신고 가능합니다.");h.dimmedOpen({callback:h.hideReportHomePop}),h.LotteDimm.dimmedOpacity="0.6",a(function(){b.element("#lotteDimm").css("z-index","210")}),h.pageUI.gdasItem=c,h.reportList=h.pageUI.loadData.reportList.items,h.inputData="",a(function(){b.element("#reportHomePop").css({"margin-top":-1*b.element("#reportHomePop").height()/2+"px"})},500)}else{alert("로그인을 해주세요.");var f="&targetUrl="+encodeURIComponent(d.location.href,"UTF-8");d.location.href=e.loginUrl+"?"+h.baseParam+f}},h.hideReportPop=function(){h.badList=[],h.dimmedClose(),b.element("#lotteDimm").css("z-index","100")},h.hideReportHomePop=function(){h.reportList=[],h.dimmedClose(),b.element("#lotteDimm").css("z-index","100")},h.recommClick=function(a){if(g.evtTag(h.gaCtgName,"리뷰내용","상품평 추천",a.gdasNo),h.loginInfo.isLogin)a.regRecommUrl&&(a.myRecomm=!0,c.get(e.isTestFlag?e.regRecomUrl:a.regRecommUrl).success(function(b){if(b.data){if(alert(b.data.resultMsg),b.data.resultCode)switch(b.data.resultCode){case"01":case"02":a.recommCnt=a.recommCnt+1;case"03":a.recommYn=!0;break;case"04":case"05":case"06":a.recommYn=!1}}else alert("다시 한번 시도해주시기 바랍니다."),a.recommYn=!1}));else{alert("로그인을 해주세요.");var b="&targetUrl="+encodeURIComponent(d.location.href,"UTF-8");d.location.href=e.loginUrl+"?"+h.baseParam+b}},h.goProduct=function(b){g.evtTag(h.gaCtgName,"리뷰내용","상품 상세 가기",b.goodsNo),a(function(){location.href="/product/product_view.do?"+h.baseParam+"&goods_no="+b.goodsNo},300)},h.commentDetail=function(b,c){g.evtTag(h.gaCtgName,"리뷰내용","상품평 상세보기",b),a(function(){location.href=e.productSubCommentEach+"?"+h.baseParam+"&goods_no="+c+"&gdas_no="+b},300)},h.goBestReview=function(){g.evtTag(h.gaCtgName,"이동구좌","베스트 상품평 가기"),a(function(){location.href=h.objLink.reviewBest+"?"+h.baseParam},300)},h.goMyReview=function(){g.evtTag(h.gaCtgName,"이동구좌","내 상품평 가기"),a(function(){location.href=h.objLink.critViewUrl+"?"+h.baseParam},300)},h.getFlagStyle=function(a){return a?1==parseInt(a)?{"background-color":"#e6899C"}:parseInt(a)<=10?{"background-color":"#7691c6"}:{}:{}};var k=b.element("body")[0];h.$on("winScroll",function(a,b){!h.pageUI.loadData||!h.pageUI.loadData.totalCnt||h.currentRows>=h.pageUI.loadData.totalCnt||h.badList&&h.badList.length||!h.jsonLoading&&k.scrollHeight-2*b.winHeight<=b.scrollPos+b.winHeight&&h.loadData()})}}}]),d.directive("onErrorSrc",function(){return{link:function(a,b,c){b.bind("error",function(){a.pageUI.loadData.profile.imgUrl!=a.dummyUrl&&(a.pageUI.loadData.profile.imgUrl=a.dummyUrl)})}}}),d.directive("reportPop",["$window","$location","LotteCommon","commInitData","$timeout","$http",function(a,b,c,d,e,f){return{link:function(b,d,e){b.sendReport=function(){if(!d.find("input[type=radio]:checked").length)return void alert("신고사유를 선택해주세요.");if(b.loginInfo.isLogin)f.get(c.commentReport,{params:{mbr_no:b.loginInfo.mbrNo,site_no:1,goods_no:b.pageUI.goodsNo,gdas_no:b.pageUI.gdasNo,dcl_accp_tp_cd:d.find("input[type=radio]:checked").val()}}).success(function(a){return a&&a.data?void(a.data.resultMsg&&(alert(a.data.resultMsg),b.hideReportPop())):void alert("다시 한번 시도해주시기 바랍니다.")}).error(function(){alert("다시 한번 시도해주시기 바랍니다.")});else{alert("로그인을 해주세요.");var e="&targetUrl="+encodeURIComponent(a.location.href,"UTF-8");a.location.href=c.loginUrl+"?"+b.baseParam+e}}}}}]),d.directive("reportHomePop",["$window","$location","LotteCommon","commInitData","$timeout","$http",function(a,c,d,e,f,g){return{link:function(c,f,h){function i(a){var b=/[`~!@#$%^&*|\\\'\";:\/?]/gi;return b.test(a)?!0:!1}c.sendReportHome=function(){if(!f.find("input[type=radio]:checked").length)return void alert("신고사유를 선택해주세요.");if(i(c.inputData))return alert("특수문자는 입력할수 없습니다."),void $("#inputReportPop").focus();if(c.loginInfo.isLogin)g.get(d.reportBadReviewer,{params:{mbr_no:c.loginInfo.mbrNo,revr_mbr_no:e.query.revr_mbr_no,dcl_accp_tp_cd:f.find("input[type=radio]:checked").val(),note_cont:f.find("#inputReportPop").val()}}).success(function(a){return a&&a.data?(a.data.resultCode&&"01"==a.data.resultCode&&(c.pageUI.loadData.profile.badYn=!0),void(a.data.resultMsg&&(alert(a.data.resultMsg),c.hideReportPop()))):void alert("다시 한번 시도해주시기 바랍니다.")}).error(function(){alert("다시 한번 시도해주시기 바랍니다.")});else{alert("로그인을 해주세요.");var b="&targetUrl="+encodeURIComponent(a.location.href,"UTF-8");a.location.href=d.loginUrl+"?"+c.baseParam+b}},c.calcByte=function(){var a,d=b.element("#inputReportPop"),e=b.element("#curbyte"),f=0,g=0,h="",i=50;if(d.val().length)for(var j=0;j<d.val().length;j++){if(a=d.val().charAt(j),g=f,escape(a).length>4?f+=2:f++,f>i){alert("50바이트를 초과할 수 없습니다."),d.val(h),e.text(g);break}h+=a,e.text(f)}else e.text(f);c.inputData=h},c.changeRadio=function(){c.selectedR=b.element("#reportHomePop").find("input[type=radio]:checked").val()}}}}])}(window,window.angular);