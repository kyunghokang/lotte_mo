function searchMartClose(){$("#searchMartPop").hide()}function searchMartResult(a){crosspickParams={crspk_yn:"Y",crspk_corp_cd:a.crspk_corp_cd,crspk_corp_str_sct_cd:a.crspk_corp_str_sct_cd,crspk_str_no:a.crspk_str_no},$("#crspk_corp_cd_"+martIndex).trigger("click")}function getSmpLocationInfo(a,b,c,d,e,f){var g="http://image.lotte.com/lotte/mobile/mobile_new/common/new_"+b+"_deli_loc_map.jpg",h={smp_title:"",smp_shop_working_time:"",smp_deli_loc_nm:"",smp_deli_loc_desc:"",sketch_img_url:"",sketch_img_link:"",page_top_location:0};return h.sketch_img_url=g,h.sketch_img_link=g,h.smp_shop_working_time=c,h.smp_deli_loc_nm=d,h.smp_deli_loc_desc=e,h.page_top_location=f,"2"==a?h.smp_title="스마트픽 픽업 데스크 위치":"3"==a?h.smp_title="스마트픽 픽업 라커 위치":h.smp_title="스마트픽 픽업 데스크 위치",h}var ST_STD_CD_GOODS_TP_CD_E_COUPON="20",GOODS_SMP_EXCHANGE_DEP="0101DEP",GOODS_SMP_EXCHANGE_ETC="0101ETC",GOODS_SMP_STATUS_EXCHANGE_EXP="02",CART_UPDATE_FLAG_SMP="update_smp",CART_UPDATE_FLAG_SMP_LOC="update_smp_loc",GOODS_SMP_NORMAL_ETC="0102ETC",martIndex=0,crosspickParams={},holiday=!1,quick_dlv_msg=!1;!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","lotteUtil"]);d.controller("cartCtrl",["$scope","LotteCommon","$http","LotteCookie","$filter","LotteUtil","$timeout","$window","LotteUserService","LotteStorage",function(d,e,f,g,h,i,j,k,l,m){function n(a,b,c,d,e,f,g){var h="https:"==location.protocol?"https:":"http:",i=new Image,j="19",k=h+"//tracking.icomas.co.kr";k+="/Script/action3.php?aid="+j+"&rn="+encodeURI(a),k+="&amt="+b+"&pc="+encodeURI(c)+"&pa="+d+"&pp="+e+"&pg="+encodeURI(f)+"&etc="+encodeURI(g),i.src=k}function o(a){if(a&&a.length>0){var b=0;for(b=0;b<a.length;b++)n(a[b].seq+"_"+(d.loginInfo.mbrNo?d.loginInfo.mbrNo:"")+"_MO",a[b].salePr*a[b].qty,a[b].goodsNo+"_"+a[b].goodsNm,a[b].qty,a[b].salePr,"장바구니",b)}}function p(a,c){pnutAdCart.goods={},pnutAdCart.goodsInfo="";var e=[];b.forEach(d.loadedProductList,function(a,b){for(var d=0;d<c.length;d++)if(a.seq===c[d]){e.push([a.goodsNo,a.qty,a.speSaleAmt]);break}}),pnutAdCart.setGoods(e),pnutAdCart.setAct(a),pnutAdCart.collect()}function q(){if(d.appObj.isApp&&(d.appObj.isIOS&&d.appObj.verNumber>=4050||d.appObj.isAndroid&&d.appObj.verNumber>=408)){var b={},c=0;for(b.prodList=[],c=0;c<d.getNormalGroupInfo().products.length&&10>c;c++)b.prodList.push({productId:d.getNormalGroupInfo().products[c].goodsNo,productName:d.getFormattedGoodsNm(d.getNormalGroupInfo().products[c]),price:parseInt(d.getNormalGroupInfo().products[c].basic_price),quantity:parseInt(d.getNormalGroupInfo().products[c].qty)});for(c=0;c<d.getHomeshoppingGroupInfo().products.length&&5>c;c++)b.prodList.push({productId:d.getHomeshoppingGroupInfo().products[c].goodsNo,productName:d.getFormattedGoodsNm(d.getHomeshoppingGroupInfo().products[c]),price:parseInt(d.getHomeshoppingGroupInfo().products[c].basic_price),quantity:parseInt(d.getHomeshoppingGroupInfo().products[c].qty)});b.prodList.length>0&&(console.log("callAdbrix://cart?"+JSON.stringify(b)),a.location.href="callAdbrix://cart?"+JSON.stringify(b))}}d.useTestData=!1,d.showWrap=!0,d.contVisible=!0,d.subTitle="장바구니",d.itemCountPerPage=10,d.loadedProductList=[],d.groupInfos={},d.GROUP_KEY_NORMAL="normal",d.GROUP_KEY_BOOK="book",d.GROUP_KEY_MANGGO="manggo",d.GROUP_KEY_SMARTPIC="smartpic",d.GROUP_KEY_HOMESHOPPING="homeshopping",d.GROUP_KEY_SOLDOUT="soldout",d.initLoadingProductList=!1,d.cartItemTotalCount=0,d.wishTotalCount=0,d.recentViewTotalCount=0,d.selectedProductCount=0,d.selectedProductFinalPriceSum=0,d.selectedDeliveryFinalPriceSum=0,d.isOpenedSoldoutSection=!1,d.isOpenedShopping=!1,d.isOpenedSmartpicLocation=!1,d.smpLocationInfo={},d.instantDelay=2e3,d.commonAlramInfo={is_block:!1,is_show:!1,message:""},d.couponPopupInfo={isShow:!1,couponNo:0,cookieName:""},d.burberryOpenPop=!1,d.burberryOrder=!1,d.requestedSelectGoodsNos=[],d.wScroll=0,d.isQuick=!1,d.openHopePop=!1,d.idneYnChkArray=[],d.idneObj={allChk:!1,idneChkY:!0},d.getTclickCode=function(a,b,c,e,f){var g="cart",h=d.tClickBase+g+"_Clk";return h+=a?"_Prd":"",h+=b?"_Btn":"",h+=c?"_Lnk":"",h+=e?"_"+e:"",h+=f?"_idx"+f:""},d.getTclickParam=function(a,b,c,e,f){return"&tclick="+d.getTclickCode(a,b,c,e,f)},d.isAdultUser=function(){return"Y"==g.getCookie("ADULTYN")},d.getUrlParam=function(a){var c="",d=k.location.search.replace(/^\?/,"").split("&");return b.forEach(d,function(b){if(b){var d=b.split("=");d.length>0&&a==d[0]&&(c=d[1])}}),c},d.getUrlGoodsNosParam=function(){return d.getUrlParam("goods_nos").split(",")},d.hasRequestSelectGoodsNo=function(a){for(var b=!1,c=0;c<d.requestedSelectGoodsNos.length;c++)if(a==d.requestedSelectGoodsNos[c]){b=!0;break}return b},d.showInstantMessage=function(a){d.commonAlramInfo.is_block||(d.commonAlramInfo.is_block=!0,d.commonAlramInfo.message=a,d.commonAlramInfo.is_show=!0,j(function(){d.commonAlramInfo.is_show=!1,d.commonAlramInfo.is_block=!1},d.instantDelay))},d.closeCouponPopup=function(){d.dimmedClose(),d.couponPopupInfo.isShow=!1},d.stopShowingCouponPopup=function(a){var b=a||1,c="no";g.setCookie(d.couponPopupInfo.cookieName,c,b),d.closeCouponPopup()},d.downloadCoupon=function(){return d.loginInfo.isLogin?void f({method:"POST",url:e.cartRegCouponData+"?"+d.baseParam,data:{cpn_issu_no:d.couponPopupInfo.couponNo,dup_cpn_yn:"Y"},transformRequest:transformJsonToParam,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){console.log(a);var b=a.data_set.is_issued,c=a.data_set.result;alert(c.replace("\\n","\n")),b&&d.stopShowingCouponPopup(),d.closeCouponPopup()}).error(function(a){if(a.error){var b=a.error.response_code,c=a.error.response_msg;if(alert(c),"9003"==b){var f="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href=e.loginForm+"?"+f}}else alert("처리중 오류가 발생하였습니다.");d.closeCouponPopup()}):void d.loginProc("N")},d.getProductSortNo=function(a){var c=0,e=1;return b.forEach(d.groupInfos,function(f,g){d.GROUP_KEY_SOLDOUT!==f.key&&b.forEach(f.products,function(b,d){b.goodsNo==a.goodsNo&&b.itemNo==a.itemNo?c=e:++e})}),c},d.isNotPrintGroup=function(){return d.isEllotteWeb()},d.isEllotteWeb=function(){return i.isEllotte()},d.initGroupInfos=function(){d.addGroupInfo(d.GROUP_KEY_NORMAL,"일반"),d.addGroupInfo(d.GROUP_KEY_BOOK,"도서"),d.addGroupInfo(d.GROUP_KEY_MANGGO,"망고"),d.addGroupInfo(d.GROUP_KEY_SMARTPIC,"스마트픽"),d.addGroupInfo(d.GROUP_KEY_HOMESHOPPING,"홈쇼핑"),d.addGroupInfo(d.GROUP_KEY_SOLDOUT,"품절/판매종료")},d.addGroupInfo=function(a,b){d.groupInfos[a]={key:a,name:b,isSmpartpic:a==d.GROUP_KEY_SMARTPIC,isHomeShopping:a==d.GROUP_KEY_HOMESHOPPING,products:[],isSelectedAll:!1,checkedProductCount:0,checkedProductQtySum:0,productFinalPriceTotal:0,deliveryFinalPriceTotal:0,lpointFinalPriceTotal:0,isQuick:!1}},d.getGroupInfo=function(a){return d.groupInfos[a]},d.getNormalGroupInfo=function(){return d.getGroupInfo(d.GROUP_KEY_NORMAL)},d.getBookGroupInfo=function(){return d.getGroupInfo(d.GROUP_KEY_BOOK)},d.getManggoGroupInfo=function(){return d.getGroupInfo(d.GROUP_KEY_MANGGO)},d.getSmartpicGroupInfo=function(){return d.getGroupInfo(d.GROUP_KEY_SMARTPIC)},d.getHomeshoppingGroupInfo=function(){return d.getGroupInfo(d.GROUP_KEY_HOMESHOPPING)},d.getSoldoutGroupInfo=function(){return d.getGroupInfo(d.GROUP_KEY_SOLDOUT)},d.getGroupProducts=function(a){return d.getGroupInfo(a).products},d.addProductInGroup=function(a,b){return d.getGroupProducts(a).push(b)},d.getGroupName=function(a){return d.getGroupInfo(a).name},d.notExistCartItem=function(){return d.initLoadingProductList&&0==d.cartItemTotalCount},d.notExistSoldoutCartItem=function(){return 0==d.getSoldoutTotalCount()},d.getSoldoutTotalCount=function(){var a=d.getSoldoutGroupInfo().products;return a?a.length:0},d.notExistAnyCartItem=function(){return d.notExistCartItem()},d.getFormattedGoodsNm=function(a){var b="";return a.brand&&(b+="["+a.brand+"] "),b+a.goodsNm},d.getResultEmptyMessage=function(){var a="";return d.notExistAnyCartItem()&&!d.notExistSoldoutCartItem()?a="판매중인 상품이 없습니다.":d.notExistAnyCartItem()&&d.notExistSoldoutCartItem()&&(a="장바구니에 저장된 상품이 없습니다."),a},d.toggleCheckAllItems=function(a,c){a.isSelectedAll=c?!1:!a.isSelectedAll,b.forEach(a.products,function(b,c){!b.has_smartpic_stock||b.is_not_sell_for_tworld||b.is_not_sell_on_mobile||(b.is_checked=a.isSelectedAll,"Y"==b.crspk_yn&&"Y"!=b.crspk_psb_yn&&(b.is_checked=!1))}),d.calcGroupSummary(a)},d.changeEachCheckbox=function(a,c,e){if(a.is_checked){var f=!0,g="",h=a.quick_deli_yn;if(b.forEach(c.products,function(a,b){a.is_checked?g+=a.quick_deli_yn==h?"":"N":!a.has_smartpic_stock||a.is_not_sell_for_tworld||a.is_not_sell_on_mobile||(f=!1)}),g.indexOf("N")>-1)return alert("택배 배송 상품과 퀵 배송 상품은\n함께 주문하실 수 없습니다."),a.is_checked=!1,!1;c.isSelectedAll=f}else c.isSelectedAll=!1;e||d.calcGroupSummary(c)},d.calcGroupSummary=function(a){var c=0,e=[],f=!1;a.productFinalPriceTotal=0,a.deliveryFinalPriceTotal=0,a.lpointFinalPriceTotal=0,b.forEach(a.products,function(b,g){if(b.is_checked){if("Y"!=b.quick_deli_yn||f||(f=!0),a.productFinalPriceTotal+=b.basic_price*b.qty,a.key==d.GROUP_KEY_SMARTPIC)a.deliveryFinalPriceTotal+=b.deli;else{var h=b.deli_div_polc_no;-1==e.indexOf(h)&&(a.deliveryFinalPriceTotal+=b.deli,e.push(h))}a.lpointFinalPriceTotal+=b.lotte_point*b.qty,a.checkedProductQtySum+=b.qty,++c}}),f?(a.deliveryFinalPriceTotal=a.productFinalPriceTotal>=1e5?5e3:1e4,d.getGroupInfo(d.GROUP_KEY_NORMAL).isQuick=!0):d.getGroupInfo(d.GROUP_KEY_NORMAL).isQuick=!1,a.checkedProductCount=c,d.calcTotalSummary()},d.calcTotalSummary=function(){d.isQuickTotal=!1,d.selectedProductCount=0,d.selectedProductFinalPriceSum=0,d.selectedDeliveryFinalPriceSum=0,b.forEach(d.groupInfos,function(a,b){d.GROUP_KEY_SOLDOUT!==a.key&&(d.selectedProductCount+=a.checkedProductCount,d.selectedProductFinalPriceSum+=a.productFinalPriceTotal,d.selectedDeliveryFinalPriceSum+=a.deliveryFinalPriceTotal,d.getGroupInfo(d.GROUP_KEY_NORMAL).isQuick&&(d.isQuickTotal=!0))})},d.reCalcGroupSummary=function(){b.forEach(d.groupInfos,function(a,b){d.GROUP_KEY_SOLDOUT!==a.key&&d.calcGroupSummary(a)})},d.google_map_url=e.pickMapUrl,d.toggleGoodsOption=function(a){var b=!a.is_opened_option;if(a.is_loaded_select_option)a.is_opened_option=b;else{a.select_options;d.requestGetGoodsOptions(a,function(a,c){!c||c&&c.length<2?a.is_opened_option=b:d.requestLastOptionItemListAndReplace(a,null,function(a,c){a.is_opened_option=b,a.is_loaded_select_option=!0,c.selected_item_no=a.itemNo})})}},d.requestGetGoodsOptions=function(a,b,c){f.get(e.cartOptionData+"?"+d.baseParam+d.getTclickParam(!0,!0,null,3,null),{params:{cart_sn:a.seq,curDispNo:a.infwDispNoSctCd,goods_no:a.goodsNo,item_no:a.itemNo,qs_yn:a.quick_deli_yn}}).success(function(c){if(c.productItemDtl){var d=c.productItemDtl.items;a.select_options=d}c.productItemOpt&&(a.input_options=c.productItemOpt.items),b&&b(a,a.select_options)}).error(function(b){if(b.error){var d=b.error.response_code,f=b.error.response_msg;if(alert(f),"9003"==d){var g="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href=e.loginForm+"?"+g}}else alert("처리중 오류가 발생하였습니다.");c&&c(a,a.select_options)})},d.changeSelectOptionItem=function(a,c){var e=a.select_options,f=e[c],g=c+1;if(a.changedSelectOptionItemNo="",a.inv_qty="",b.forEach(e,function(a,b){b>c&&(a.selected_item_no="")}),g==e.length){var h=f.selected_item_no;a.changedSelectOptionItemNo=h,b.forEach(f.item.items,function(b,c){h==b.item_no&&(a.inv_qty=b.opt_cnt)}),Number(a.qty)>Number(a.inv_qty)&&(a.qty=Number(a.inv_qty))}else g==e.length-1&&d.requestLastOptionItemListAndReplace(a,g)},d.requestLastOptionItemListAndReplace=function(a,c,g,h){var i=a.select_options,j=i[i.length-1],k=[];c||(j.selected_item_no="",c=c||i.length-1),b.forEach(i,function(a,b){var c=a.selected_item_no;c&&k.push(c)}),f({method:"POST",url:e.cartLastOptionData+"?"+d.baseParam,data:{goods_no:a.goodsNo,opt_val_cd:k.join(" x "),optcnt:i.length,optnum:c,qs_yn:a.quick_deli_yn},transformRequest:transformJsonToParam,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b){j.item.items=b.item,g&&g(a,j)}).error(function(a){if(a.error){var b=a.error.response_code,c=a.error.response_msg;if(alert(c),"9003"==b){var d="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href=e.loginForm+"?"+d}}else alert("처리중 오류가 발생하였습니다.");h&&h()})},d.toggleSoldoutSection=function(){d.isOpenedSoldoutSection=!d.isOpenedSoldoutSection,d.sendTclick(d.getTclickCode(!0,!0,!1,6,null))},d.isShowCartHeaderSectionForUser=function(){return d.loginInfo.isLogin&&d.initLoadingProductList},d.isShowCartHeaderSectionForGuest=function(){return!d.loginInfo.isLogin&&d.initLoadingProductList},d.isShowLoadingWrapSection=function(){return!d.initLoadingProductList},d.isShowResultEmptySection=function(){return d.notExistAnyCartItem()||d.notExistAnyCartItem()&&d.notExistSoldoutCartItem()},d.isShowCartInfoSection=function(){return d.initLoadingProductList&&(!d.notExistCartItem()||!d.notExistSoldoutCartItem())},d.addWish=function(a){if(!d.loginInfo.isLogin)return void d.loginProc("N");var b=d.getCheckedProductGoodsNos(a);return 0==b.length?void d.showInstantMessage("상품을 선택해 주세요."):void f({method:"POST",url:e.wishAddData+"?"+ +d.baseParam+d.getTclickParam(null,!0,null,1,null),data:{goods_nos:b.join(":^:")},transformRequest:transformJsonToParam,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){d.openCireleSystemAlert({type:"wishPop"})}).error(function(a){if(a.error){var b=a.error.response_code,c=a.error.response_msg;if(alert(c),"9003"==b){var d="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href=e.loginForm+"?"+d}}else alert("처리중 오류가 발생하였습니다.")})},d.goGoodsDetail=function(a,b){var c="",e="";if(!a.is_interpark_ticket){if("-23"==a.resultCd);else{if("30"==a.saleStatCd)return void alert("상품 판매가 종료되었습니다.");c=a.seq,e=a.itemNo}if("Y"==a.minority_limit_yn)return d.isAdultUser()?void d.goAdultSci():void alert("이 상품은 법률규정에 의하여 만 19세 이상 성인만 조회 및 구매가 가능합니다.");var f=[];f.push("curDispNo="+a.infwDispNo),f.push("curDispNoSctCd="+a.infwDispNoSctCd),f.push("goods_no="+a.goodsNo),f.push("cart_sn="+a.seq),f.push("item_no="+e);var g="";b||(g=d.getTclickParam(!0,null,null,null,d.getProductSortNo(a))),location.href="/product/m/product_view.do?"+d.baseParam+"&"+f.join("&")+g}},d.isValidOrderInfo=function(a){var c={result:!0,is_show_confirm:!0},e={result:!1,is_show_confirm:!0},f=d.getGroupInfo(a[0].group_nm),g=!1,h=!1,i=!1,j=[],k=0;d.idneYnChkArray=[];for(var l in a){var m=a[l];if(f.key==d.GROUP_KEY_SMARTPIC?((105095077==m.goodsNo||105095654==m.goodsNo||105095772==m.goodsNo||105095898==m.goodsNo)&&(g=!0),m.gift_card&&"Y"==m.gift_card&&(h=!0),m.is_interpark_ticket&&(i=!0),m.is_overed_date_smartpic&&j.push(m)):f.key==d.GROUP_KEY_NORMAL&&m.gift_card&&"Y"==m.gift_card&&(h=!0,k+=1),f.key!=d.GROUP_KEY_HOMESHOPPING&&"Y"==m.lgf_tgt_yn){var n=d.requestCheckLgFashionStockMng(m);if(!n.isOk)return alert(n.message),e}d.idneYnChkArray.push(m.idne_yn)}if(f.key==d.GROUP_KEY_SMARTPIC){if(g&&a.length>1)return alert("죄송합니다. 모바일 롯데상품권 카드는 다른 상품과 동시구매가 어렵습니다. 해당 상품 개별적으로 선택하신 후 구매해 주시기 바랍니다."),e;if(h&&a.length>1)return alert("죄송합니다.\n상품권과 일반상품은 함께 주문하실 수 없습니다."),e;if(i)return alert("죄송합니다.\n인터파크 티켓 상품은 모바일에서 주문하실 수 없습니다."),e;if(f.checkedProductQtySum>50)return alert("스마트픽은 주문시 수량 합계 50개까지 주문가능합니다. 확인후 다시 시도해주세요."),e;if(j.length>0){if(1==a.length)return b.forEach(j,function(a,b){d.changeEachCheckbox(a,d.getGroupInfo(a.group_nm))}),alert("방문예정일이 지난 상품은 제외되었습니다.\n주문하실 상품을 선택해 주세요."),e;if(!confirm("방문예정일이 지난 상품이 있습니다.\n해당 상품을 제외하고 주문하시겠습니까?"))return e;b.forEach(j,function(a,b){d.changeEachCheckbox(a,d.getGroupInfo(a.group_nm))}),c.is_show_confirm=!1}}else if(f.key==d.GROUP_KEY_NORMAL&&h&&a.length>1&&k!=a.length)return alert("죄송합니다.\n상품권과 일반상품은 함께 주문하실 수 없습니다."),e;if(f.key==d.GROUP_KEY_MANGGO){if(f.checkedProductCount>30||f.productFinalPriceTotal>15e5)return alert("망고 상품의 경우 구매수량이 30개 이상 혹은 판매금액이 150만원 이상인 경우 구매가 제한되오니 구매를 원하시면 나눠서 구매해주세요!"),e;if(!d.requestCheckMangoStockMng(a))return e.is_show_confirm=!1,e}if(d.idneObj.allChk&&d.idneObj.idneChkY){var o=d.idneYnChk(c);return o}return c},d.idneYnChk=function(a){var b=d.idneYnChkArray.toString(),c=b.match(/Y/g),e=b.match(/N/g),f={result:!0,is_show_confirm:!0,idneChk:!0};if(a.is_show_confirm||(f.is_show_confirm=!1),c&&e&&e.length>0&&c.length>0){var g=confirm("도서∙공연비 소득 공제 적용은 대상상품 주문시에만 적용 가능합니다.\n도서∙공연비 소득공제 적용 없이 선택하신 전체 상품을 주문하시겠습니까?");1==g?(f.is_show_confirm=!1,f.idneChk=!1):d.idneYnChkEvent()}else f.idneChk=!1;return f},d.idneYnChkEvent=function(){b.forEach(d.groupInfos,function(a,c){d.GROUP_KEY_SOLDOUT!==a.key&&b.forEach(a.products,function(a,e){if("N"==a.idne_yn&&a.is_checked){a.is_checked=!1;var f=b.element("."+c).find(".check01").eq(e).data("prdChk");d.$broadcast("idneChgEvt",f)}})})},d.invQtyCheak=function(b,c){$.ajax({type:"POST",dataType:"json",url:"/json/mylotte/cart/searchInvQtyCheckAjax.json",data:{arr_cart_sn:b},async:!1,success:function(b){"S"==b.resultCd?c():("P"==b.resultCd?alert("선택하신 상품 중 일부 상품이 품절되었습니다.\n상품상세 페이지에서 재입고\n알람을 이용해주세요."):alert("선택하신 상품이 모두 품절되어 주문이\n불가합니다. 상품상세 페이지에서 재입고\n알람을 이용해주세요."),a.location.reload())},error:function(a,b){alert("죄송합니다. 잠시 후 다시 이용해 주세요.")}})},d.goOrder=function(a,b){if(d.idneObj.allChk=!1,d.isValidOrderInfo([a]).result){var c="Y"==a.minority_limit_yn;if(!d.loginInfo.isLogin)return void d.invQtyCheak(a.seq,function(){d.goLoginFormForOrder([a.seq],b,c)});d.checkMinorityLimit(c);var f=[];d.invQtyCheak(a.seq,function(){f.push("cartSn="+a.seq),f.push("smartOrd="+(d.GROUP_KEY_SMARTPIC==b.key?"Y":"N")),f.push("imallYN="+(d.GROUP_KEY_HOMESHOPPING==b.key?"Y":"N")),location.href=e.orderFormUrl+"?"+d.baseParam+"&"+f.join("&")+d.getTclickParam(!0,!0,null,4,null)})}},d.checkMinorityLimit=function(a){return a?d.isAdultUser()?void d.goAdultSci("N"):void alert("이 상품은 법률규정에 의하여 만 19세 이상 성인만 조회 및 구매가 가능합니다."):void 0},d.goLoginFormForOrder=function(b,c,f){var g=[],h="N",i="";d.GROUP_KEY_HOMESHOPPING==c.key?(i=5,h="Y"):i=2,f&&g.push("adultChk=Y"),g.push("fromPg="+i),g.push("imallYN="+h),g.push("cartSn="+b.join(":^:"));var j=[],k="",l=0;if(c&&c.products&&c.products.length>0){for(l;l<c.products.length;l++)j.push(c.products[l].goodsNo);k=j.join(":^:")}g.push("goods_no="+k),g.push("minority_yn="+(f?"Y":"N")),g.push("smp_buy_yn=N"),g.push("smartOrd="+(d.GROUP_KEY_SMARTPIC==c.key?"Y":"N")),g.push("targetUrl="+encodeURIComponent(a.location.href,"UTF-8")),location.href=e.loginForm+"?"+d.baseParam+"&"+g.join("&")},d.goOrderAllChk=function(){var a=[],c=[],e=[],f=[];d.selectedNotOnlyProducts=[],d.selectedBurberryProducts=[],b.forEach(d.groupInfos,function(g,h){d.GROUP_KEY_SOLDOUT!==g.key&&b.forEach(g.products,function(b,g){b.is_checked&&(a.push(b),"19"==b.pnt_only_pay?e.push(b):"21"==b.pnt_only_pay?f.push(b):b.is_gucci?c.push(b):b.is_burberry?d.selectedBurberryProducts.push(b):d.selectedNotOnlyProducts.push(b))})});var g=a.length;e.length>0&&e.length!=g||f.length>0&&f.length!=g||c.length>0&&c.length!=g?d.goOrderAll():d.selectedBurberryProducts.length>0&&d.selectedBurberryProducts.length!=g?(d.burberryOpenPop=!0,d.dimmedOpen({target:"BurberryPopup",callback:d.burberryPopClose})):d.goOrderAll()},d.burberryOrderFnc=function(a){switch(a){case"normal":b.forEach(d.selectedBurberryProducts,function(a,b){a.is_checked=!1,d.changeEachCheckbox(a,d.getGroupInfo(a.group_nm))}),d.selectedBurberryProducts=[];break;case"burberry":b.forEach(d.selectedNotOnlyProducts,function(a,b){a.is_checked=!1,d.changeEachCheckbox(a,d.getGroupInfo(a.group_nm))}),d.selectedNotOnlyProducts=[]}d.dimmedClose(),d.burberryOpenPop=!1,d.burberryOrder=!0,j(function(){d.goOrderAll()},50)},d.burberryPopClose=function(){d.dimmedClose(),d.burberryOpenPop=!1},d.goOrderAll=function(){var a=!1,c=[],e=[],f=[],g=[],h=[],i=[],j=[],k="",l=!1,m=!0,n=!1,o="",p=!0;d.idneObj.allChk=!0,b.forEach(d.groupInfos,function(h,m){d.GROUP_KEY_SOLDOUT!==h.key&&b.forEach(h.products,function(b,d){b.is_checked&&(p?(o=b.goodsNo,p=!1):o=o+":"+b.goodsNo,c.push(b),e.push(b.seq),"19"==b.pnt_only_pay?i.push(b):"21"==b.pnt_only_pay?j.push(b):b.is_gucci?g.push(b):f.push(b),a||(k?k!=h.key&&(a=!0):k=h.key),"Y"==b.minority_limit_yn&&(l=!0),"Y"!=b.quick_deli_yn||n||(n=!0))})});var q,r=c.length;if(0==r)return void alert("상품을 선택하세요.");if(a)return void alert("고객님께서 선택하신 상품은\n한꺼번에 주문하실 수 없습니다.");if(i.length>0&&i.length!=r?(q=confirm("L.POINT 전용 상품은 일반상품과 함께 주문서작성/결제를 하실 수 없습니다.\nL.POINT 상품만 주문하시겠습니까?"),f=f.concat(j),f=f.concat(g),f=f.concat(h)):j.length>0&&j.length!=r?(q=confirm("L-money 전용 상품은 일반상품과 함께 주문서작성/결제를 하실 수 없습니다.\nL-money 상품만 주문하시겠습니까?"),f=f.concat(i),f=f.concat(g),f=f.concat(h)):g.length>0&&g.length!=r&&(q=confirm("GUCCI 전문관 상품은  일반상품과 함께 주문서작성/결제를 하실 수 없습니다.\nGUCCI 상품만 주문하시겠습니까?"),f=f.concat(i),f=f.concat(j),f=f.concat(h)),q)b.forEach(f,function(a,b){a.is_checked=!1,d.changeEachCheckbox(a,d.getGroupInfo(a.group_nm))}),e=[],b.forEach(g,function(a,b){e.push(a.seq)}),m=!1,d.idneObj.idneChkY=!1;else if(0==q)return void(d.idneObj.idneChkY=!0);var s=d.isValidOrderInfo(c);return s.result&&(s.is_show_confirm||(m=!1),!s.idneChk)?(e=[],b.forEach(d.groupInfos,function(a,c){d.GROUP_KEY_SOLDOUT!==a.key&&b.forEach(a.products,function(a,b){a.is_checked&&e.push(a.seq)})}),0==e.length?void alert("상품을 선택하세요."):(d.burberryOrder&&(m=d.burberryOrder=!1),n&&!checkQuick(c)?!1:void pticketCheck(0,o,function(a){a||d.goOrderAllIfValid(d.getGroupInfo(c[0].group_nm),e,l,m)}))):void 0},d.goOrderAllIfValid=function(a,b,c,f){if(!d.loginInfo.isLogin)return void d.invQtyCheak(b.join(":^:"),function(){d.goLoginFormForOrder(b,a,c)});d.checkMinorityLimit(c);var g=[],h="N";d.GROUP_KEY_HOMESHOPPING==a.key&&(h="Y"),(!f||confirm("선택된 상품을 주문하시겠습니까?"))&&d.invQtyCheak(b.join(":^:"),function(){g.push("imallYN="+h),g.push("cartSn="+b.join(":^:")),location.href=e.orderFormUrl+"?"+d.baseParam+"&"+g.join("&")+d.getTclickParam(!0,!0,null,5,null)})},d.registRestockAlram=function(a){f({method:"POST",url:e.systemRestockAlramData+"?"+d.baseParam+d.getTclickParam(!0,!0,null,8,null),data:{mbr_no:d.loginInfo.mbrNo,spdp_goods_no:"",goods_no:a.goodsNo,item_no:a.itemNo,channel:"2"},transformRequest:transformJsonToParam,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){var b=a.RESPONSE_CODE,c=a.RESPONSE_MSG,e=a.APP_PUSH_YN,f=a.PHONE;"0000"==b?d.openCireleSystemAlert({type:"alarmPop",app_push_yn:e,phone:f}):alert(c)}).error(function(a){alert("처리중 오류가 발생하였습니다.")})},d.openSmartpicLocation=function(a,c,e){var f=b.element("#smartpicLocationPopupLayer").outerHeight();if(a)d.$broadcast("showNaverStoreMap",{goods_no:c.goodsNo,entr_no:c.pmg_entr_no,entr_contr_no:c.entr_contr_no,smp_ecoupon_yn:GOODS_SMP_NORMAL_ETC==c.smp_goods_type?"Y":"N"});else if(c.smp_goods_type==GOODS_SMP_EXCHANGE_DEP?a="2"==c.smp_tp_cd||"3"==c.smp_tp_cd?!1:!0:c.smp_goods_type==GOODS_SMP_EXCHANGE_ETC&&(a=!0),a)d.$broadcast("showNaverStoreMap",{goods_no:c.goodsNo,entr_no:c.pmg_entr_no,entr_contr_no:c.entr_contr_no,smp_ecoupon_yn:GOODS_SMP_NORMAL_ETC==c.smp_goods_type?"Y":"N"});else{var g=c.smp_deli_loc_info.split(":^:");d.smpLocationInfo=getSmpLocationInfo(c.smp_tp_cd,c.smp_deli_loc_sn,c.smp_working_time,c.smp_deli_loc_nm,g[6],e.pageY-f/2),d.showSmartpicLocation(e,f)}},d.showSmartpicLocation=function(a,b){d.isOpenedSmartpicLocation=!d.isOpenedSmartpicLocation,d.dimmedOpen({target:"SmartpicLocation",callback:this.hideSmartpicLocation})},d.hideSmartpicLocation=function(){d.dimmedClose(),d.isOpenedSmartpicLocation=!1},d.goWishList=function(){location.href="/mylotte/wish/m/wish_list.do?"+d.baseParam+d.getTclickParam(null,null,!0,1,null)},d.goLateViewList=function(){location.href="/product/m/late_view_product_list.do?"+d.baseParam+d.getTclickParam(null,null,!0,2,null)},d.requestCheckLgFashionStockMng=function(a){var b={isOk:!1,message:""};return $.ajax({type:"post",async:!1,url:"/popup/lg_fashion_stock_mng.do?"+d.baseParam,data:"goods_no="+a.goodsNo+"&item_no="+a.itemNo+"&entr_no="+a.entr_no+"&ord_qty="+a.qty,success:function(a){b.message=a,b.isOk=""==a?!0:!1}}),b},d.requestCheckMangoStockMng=function(a){for(var c=!0,e="",f="",g="",h={},i=0;i<a.length;i++){var j="";0!=i&&(j="[!AND!]"),e+=j+a[i].goodsNo,f+=j+a[i].itemNo,g+=j+a[i].qty,h[a[i].goodsNo+a[i].itemNo]=a[i].seq}return $.ajax({async:!1,type:"POST",dataType:"json",url:"/product/searchMangoRealtimeCheck.do?"+d.baseParam,data:{goods_no_list:e,item_no_list:f,real_qty_list:g},success:function(e){if(e.count>0){if(e.count==a.length)alert("선택하신 상품이 모두 품절되어 주문이\n불가합니다."),b.forEach(a,function(a,b){a.is_checked&&(a.is_checked=!1,d.changeEachCheckbox(a,d.getGroupInfo(a.group_nm)))});else{alert("선택하신 상품 중 일부 상품이 품절되었습니다.\n품절 상품을 제외하고 선택됩니다.");for(var f=e.list,g=[],i=0;i<f.length;i++)for(var j in h)f[i]==j&&g.push(h[j]);b.forEach(a,function(a,b){for(var c=0;null!=f&&c<g.length;c++)"undefined"!=typeof g[c]&&a.seq==g[c]&&a.is_checked&&(a.is_checked=!1,d.changeEachCheckbox(a,d.getGroupInfo(a.group_nm)))})}c=!1}},error:function(a,b){}}),c},d.getCheckedProducts=function(a){return h("filter")(a.products,{is_checked:!0})},d.getCheckedProductSeqs=function(a){var c=[];return b.forEach(d.getCheckedProducts(a),function(a,b){c.push(a.seq)}),c},d.getCheckedProductGoodsNos=function(a){var c=[];return b.forEach(d.getCheckedProducts(a),function(a,b){c.push(a.goodsNo)}),c},d.deleteMultiProduct=function(a){var b=d.getCheckedProductSeqs(a);d.deleteProduct(b,!1,"multi")},d.deleteOneProduct=function(a){d.deleteProduct([a],!1,"one")},d.deleteOneSoldoutProduct=function(a){d.deleteProduct([a],!0,"soldout-one")},d.deleteProduct=function(a,c,e){if(0==a.length)return d.showInstantMessage("상품을 선택해 주세요."),!1;var f=confirm("상품을 삭제하시겠습니까?");return f?void d.requestDeleteProductBySeqs(a,e,function(a){b.forEach(d.groupInfos,function(b,c){for(var d=b.products,e=0;e<d.length;e++)for(var f=d[e],g=0;g<a.length;g++)if(f.seq===a[g]){d.splice(e,1),e--;break}}),c||(d.cartItemTotalCount-=a.length,d.reCalcGroupSummary()),p("remove",a)}):!1},d.deleteAllSoldoutProduct=function(){var a=confirm("상품을 전체 삭제하시겠습니까?");if(!a)return!1;var c=[];b.forEach(d.getSoldoutGroupInfo().products,function(a,b){c.push(a.seq)}),d.requestDeleteProductBySeqs(c,"soldout-all",function(){d.getSoldoutGroupInfo().products=[]})},d.requestDeleteProductBySeqs=function(a,c,g,h){var i="";"multi"==c?i=d.getTclickParam(null,!0,null,2,null):"soldout-all"==c&&(i=d.getTclickParam(!0,!0,null,7,null)),f({method:"POST",url:e.cartDeleteData+"?"+d.baseParam+i,data:{seqs:a.join(":^:")},transformRequest:transformJsonToParam,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(c){d.showInstantMessage("삭제 되었습니다."),g&&g(a);try{b.element(k).trigger("refreshCartCount")}catch(e){}}).error(function(b){if(b.error){var c=b.error.response_code,d=b.error.response_msg;if(alert(d),"9003"==c){var f="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href=e.loginForm+"?"+f}}else alert("처리중 오류가 발생하였습니다.");h&&h(a)})},d.dispBanner=!1,d.productListLoading=!0,d.swipeList=!1,d.makeProductListUrl=function(){++d.currentPageNo;var a=[];a.push("viewGoods="+m.getLocalStorage("latelyGoods")),a.push("amlist="+m.getLocalStorage("amlist"));var b="";return b=d.useTestData?"/lotte/resources_dev/data/mylotte/cart/m/cart_data.json":e.cartListData+"?"+d.baseParam+"&"+a.join("&")},d.loadMoreProduct=function(){f.get(d.makeProductListUrl()).success(function(e){function f(){if(a.adbayCartClass!=c){if(console.log("loadedProductList %o",d.loadedProductList),d.loadedProductList.length>0){var e=new adbayCartClass("lottecom");b.forEach(d.loadedProductList,function(a,b){e.setGoods(a.goodsNo,a.qty,a.speSaleAmt)}),e.setMethod("add"),e.send()}}else j(f,1e3)}function h(){if(0==$("#aceRetargetingCart").length){var c=[];b.forEach(d.loadedProductList,function(a,b){c.push({id:a.goodsNo,price:a.speSaleAmt,quantity:a.qty,category:"",imgUrl:a.imgUrl,name:a.goodsNm,desc:"",link:"http://m.lotte.com/product/m/product_view.do?goods_no="+a.goodsNo})});var e=document.getElementsByTagName("body")[0],f=document.createElement("script");f.type="text/javascript",f.id="aceRetargetingCart",f.src="//static.tagmanager.toast.com/tag/view/830",f.onload=function(){a.ne_tgm_q=a.ne_tgm_q||[],a.ne_tgm_q.push({tagType:"cart",device:"mobile",uniqValue:"",pageEncoding:"utf-8",items:c})},e.appendChild(f)}}function i(){var a=document.getElementsByTagName("body")[0],c=document.createElement("script");c.type="text/javascript",c.id="adPnut",c.src="//img.adpnut.com/script/pnut_cart_collector.js",c.onload=function(){pnutAdCart=new pnutAdCart("lotte17");var a=[];b.forEach(d.loadedProductList,function(b,c){a.push([b.goodsNo,b.qty,b.speSaleAmt])}),pnutAdCart.setGoods(a),pnutAdCart.collect()},a.appendChild(c),$("body").append('<div id="pnut_cart_collector_div" style="display:none"></div>')}d.wishTotalCount=e.wish_total_count,d.recentViewTotalCount=e.recent_view_total_count,quick_dlv_msg=e.quick_dlv_msg,holiday=e.quick_dlv_holiday,e.result&&(Array.prototype.push.apply(d.loadedProductList,e.result),b.forEach(d.loadedProductList,function(a,b){var c=!1;d.hasRequestSelectGoodsNo(a.goodsNo)&&(c=!0),d.GROUP_KEY_NORMAL==a.group_nm?(d.addProductInGroup(d.GROUP_KEY_NORMAL,a),c&&d.changeEachCheckbox(a,d.getGroupInfo(d.GROUP_KEY_NORMAL),!0)):d.GROUP_KEY_BOOK==a.group_nm?(d.addProductInGroup(d.GROUP_KEY_BOOK,a),c&&d.changeEachCheckbox(a,d.getGroupInfo(d.GROUP_KEY_BOOK),!0)):d.GROUP_KEY_MANGGO==a.group_nm?(d.addProductInGroup(d.GROUP_KEY_MANGGO,a),c&&d.changeEachCheckbox(a,d.getGroupInfo(d.GROUP_KEY_MANGGO),!0)):d.GROUP_KEY_SMARTPIC==a.group_nm?(d.addProductInGroup(d.GROUP_KEY_SMARTPIC,a),c&&d.changeEachCheckbox(a,d.getGroupInfo(d.GROUP_KEY_SMARTPIC),!0)):d.GROUP_KEY_HOMESHOPPING==a.group_nm?(d.addProductInGroup(d.GROUP_KEY_HOMESHOPPING,a),c&&d.changeEachCheckbox(a,d.getGroupInfo(d.GROUP_KEY_HOMESHOPPING),!0)):d.GROUP_KEY_SOLDOUT==a.group_nm&&d.addProductInGroup(d.GROUP_KEY_SOLDOUT,a),d.GROUP_KEY_SOLDOUT!=a.group_nm&&++d.cartItemTotalCount}),d.requestedSelectGoodsNos.length>0&&d.reCalcGroupSummary(),d.couponPopupInfo.isShow="Y"==e.popup_view_yn,d.couponPopupInfo.couponNo=e.cpn_issu_no?e.cpn_issu_no:"",d.couponPopupInfo.cookieName=e.cookie_name?e.cookie_name.toUpperCase():"",d.couponPopupInfo.isShow&&d.dimmedOpen({target:"CouponPopup",callback:d.closeCouponPopup}),q()),d.initLoadingProductList=!0;try{var k=[],l=0;if(e.result&&e.result.length>0)for(l=0;l<e.result.length;l++)k.push({id:e.result[l].goodsNo,price:e.result[l].salePr,quantity:e.result[l].qty});a.criteo_q.push({event:"setAccount",account:d.isEllotteWeb()?"8586":"2975"},{event:"setSiteType",type:"m"},{event:"viewBasket",item:k})}catch(m){}var n=["155032","155033","155034","106832","155430","150827","150828","150829","150924","150925","150926","151327","162524","116924"],p=g.getCookie("CHLNO");e.result&&e.result.length>0&&p&&n.indexOf(p)>-1&&j(function(){o(e.result)},10),j(function(){var a=[];b.forEach(d.loadedProductList,function(b,c){a.push({i:b.goodsNo,t:b.goodsNm})}),d.addWiderPlanetLog("Cart",a);var c=document.getElementsByTagName("body")[0],e=document.createElement("script");e.type="text/javascript",e.src="//script.about.co.kr/templates/script/cm/adbay.cart.controller.js",c.appendChild(e),$("body").append('<div id="adbay_cart" style="display:none"></div>'),f()},3e3);for(var r=[],l=0;l<d.loadedProductList.length&&r.length<3;l++)r.push(d.loadedProductList[l].goodsNo+""||"");d.sendBuzzni&&!a.buzzni_rt_cart&&(d.sendBuzzni("cart",r),a.buzzni_rt_cart=!0),h(),i()}).error(function(a){if(a.error){var b=a.error.response_code,c=a.error.response_msg;if(alert(c),"9003"==b){var d="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href=e.loginForm+"?"+d}}else alert("처리중 오류가 발생하였습니다.")})},d.initGroupInfos(),d.loadMoreProduct(),d.requestedSelectGoodsNos=d.getUrlGoodsNosParam(),d.reloadProduct=function(){d.initLoadingProductList=!1,d.loadedProductList=[],d.groupInfos={},d.cartItemTotalCount=0,d.wishTotalCount=0,d.recentViewTotalCount=0,d.selectedProductCount=0,d.selectedProductFinalPriceSum=0,d.selectedDeliveryFinalPriceSum=0,d.isOpenedSoldoutSection=!1,d.isOpenedSmartpicLocation=!1,d.smpLocationInfo={},d.initGroupInfos(),d.loadMoreProduct(),d.requestedSelectGoodsNos=d.getUrlGoodsNosParam();
},d.superCartListInfo={totalCnt:0,goodsNm:"",goodsImgUrl:"",sumPrice:0,cartGoodsList:[]},d.viewShoppingSection=function(){d.isOpenedShopping=!d.isOpenedShopping,d.getSuperCartList()},d.getSuperCartList=function(){console.log("슈퍼 장바구니 리스트 가져오기");var c={};d.getDeferLotteSuperPostParam(c).then(function(c){var f=e.SuperCartListData,g="post";a.location.host.indexOf("localhost")>-1&&(f="/json/lottesuper/cart_list.json",g="get"),$.ajax({url:f,method:g,data:c}).success(function(a){"string"==typeof a&&(a=JSON.parse(a)),"1"==a.resultCode&&a.cartGoodsList?(d.superCartListInfo.cartGoodsList=[],b.forEach(a.cartGoodsList,function(a,b){"N"==a.ADULT_GOODS_YN&&a.STOCK_QTY>0&&(d.superCartListInfo.cartGoodsList.push(a),d.superCartListInfo.goodsNm||(d.superCartListInfo.goodsNm=(decodeURIComponent(a.GOODS_NM)+"").replace(/\+/gi," "),d.superCartListInfo.goodsImgUrl=decodeURIComponent(a.PRODIMG_PATH)),d.superCartListInfo.sumPrice+=a.SALE_PRC*a.ORD_QTY)}),d.superCartListInfo.totalCnt=d.superCartListInfo.cartGoodsList.length):"-999"==a.dotComAcceptCode&&alert("현재 오늘 장보기 서비스가 시스템 점검 중입니다. 이용에 불편을 드려 죄송합니다.")})})},d.superCartUrlLink=function(){var a=d.appObj.isSuperApp?"M389209":"M389189";d.appObj.isApp||(a="M389473"),d.gotoLotteSuperUrl(e.SuperCartUrl,a)}}]),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/mylotte/cart/m/cart_container_2018.html",replace:!0,link:function(a,b,c){}}}),d.directive("cartList",function(){return{restrict:"E",templateUrl:"/lotte/resources_dev/mylotte/cart/m/cart_list_container.html",replace:!0,link:function(a,b,c){a.close_quickPop=function(){$(".commonPop.quick_layer").removeClass("on")}}}}),d.directive("cartGroup",["$http","LotteCommon","LotteUtil","LotteCookie","LotteUserService","$window",function(a,c,d,e,f,g){return{templateUrl:"/lotte/resources_dev/mylotte/cart/m/cart_group_container.html",replace:!0,scope:{groupInfo:"=",toggleCheckAllItems:"&",changeEachCheckbox:"&",goGoodsDetail:"&",goOrder:"&",toggleGoodsOption:"&",deleteMultiProduct:"&",addWish:"&",changeSelectOptionItem:"&",openSmartpicLocation:"&",getFormattedGoodsNm:"&",isNotPrintGroup:"=",isSmartpic:"=",deleteOneProduct:"&",reloadFnc:"&",openHopePop:"=",isClass:"="},link:function(d,h,i){d.toggleGoodsPick=function(a,b){b>=0?(martIndex=b,d.google_map_url=c.pickMapUrl,$("#searchMartPop > iframe").attr("src",d.google_map_url),$("#searchMartPop").show()):d.changeToDeliev(a)},d.showPick=function(a){var b="crspk_yn=Y&crspk_corp_cd="+a.crspk_corp_cd+"&crspk_corp_str_sct_cd="+a.crspk_corp_str_sct_cd+"&crspk_str_no="+a.crspk_str_no;d.google_map_url=c.pickMapUrl+"?"+b,$("#searchMartPop > iframe").attr("src",d.google_map_url),$("#searchMartPop").show()};var j=c.pickCartUpdate;d.changeToSmp=function(b){crosspickParams.cart_sn=b.seq,a.get(j,{params:crosspickParams}).success(function(a){"0000"==a.result.response_code?d.reloadFnc():alert(a.result.response_msg)})},d.changeToDeliev=function(b){confirm("일반 택배 장바구니로 옮겨 담으시겠습니까?")&&(crosspickParams={cart_sn:b.seq,crspk_yn:"N",crspk_corp_cd:"",crspk_corp_str_sct_cd:"",crspk_str_no:""},a.get(j,{params:crosspickParams}).success(function(a){"0000"==a.result.response_code?d.reloadFnc():alert(a.result.response_msg)}))},d.hopePop=function(a){a?(b.element("body, html").css({height:"auto",overflow:"auto"}),b.element(g).scrollTop(d.wScroll)):(d.wScroll=b.element(g).scrollTop(),b.element("body, html").css({height:"100%",overflow:"hidden"})),d.openHopePop=a?!1:!0},f.promiseLoginInfo()["finally"](function(a){d.loginInfo=f.getLoginInfo()}),d.changeCartSave=function(b,e){if(null==d.loginInfo||!d.loginInfo.isLogin){var f="targetUrl="+encodeURIComponent(location.href,"UTF-8");return void(location.href=c.loginForm+"?"+f)}var g=c.cartSave;e&&(b.cart_save_flag="Y"),a.get(g,{params:{cartSn:b.seq}}).success(function(a){"Y"==a.message.response_code&&alert("결제하신 뒤에도 상품이 장바구니에 계속 보관됩니다")})},d.changeCartSaveCancel=function(b,d){var e=c.cartCancel;d&&(b.cart_save_flag="N"),a.get(e,{params:{cartSn:b.seq}}).success(function(a){"Y"==a.message.response_code&&alert("계속 보관하지 않도록 상태를 변경하였습니다. 30일 후 장바구니에서 삭제됩니다")})},d.showCartsave=!1,e.getCookie("CartsavePushDesc")||(d.showCartsaveDesc=!0),d.hideCartsavePushDesc=function(){d.showCartsaveDesc=!1,e.setCookie("CartsavePushDesc","hide",365)},d.quickPopClk=function(){$(".commonPop.quick_layer").addClass("on")},d.quick_dlv_msg=quick_dlv_msg},controller:"CartGroupCtrl"}}]),d.controller("CartGroupCtrl",["$scope","$http","LotteCommon",function(a,d,e){a.isCartDebug=!1,a.datePickerYn=!1,a.datePickerInputOption={},a.hasSmartpicStock=function(b){if("Y"==b.crspk_yn)return!0;if(!a.groupInfo.isSmpartpic)return!0;var c=!1;return b.goods_tp_cd==ST_STD_CD_GOODS_TP_CD_E_COUPON&&(c=!0),b.smp_inv_qty>0&&"Y"==b.smp_psb_yn&&(c=!0),c},a.isValidSmartpicOrder=function(b){var c=!0;return a.isSmartpic&&(b.is_overed_date_smartpic&&(c=!1),a.hasSmartpicStock(b)||(c=!1)),c},a.isNotSellForTworld=function(a){return"N"==a.tworld_sell_yn},a.isNotSellOnMobile=function(b){return!a.isNotSellForTworld(b)&&"Y"!=b.sale_possible_yn},a.isValidEachOrder=function(b,c){var d=!0;return a.isValidSmartpicOrder(b)||(d=!1),c&&"Y"==b.quick_deli_yn&&0==b.dept_main_inv_qty&&(d=!1),d},a.isNotECoupon=function(b){if(!a.groupInfo.isSmpartpic)return!1;var c=!1;return b.smp_goods_type==GOODS_SMP_EXCHANGE_DEP&&(c=!0),b.smp_goods_type==GOODS_SMP_EXCHANGE_ETC&&(c=!0),c},a.datePickerOpen=function(b){a.datePickerYn=!0,a.datePickerInputOption=b},a.datePickerClose=function(b){a.datePickerYn=!1},a.getFormattedGoodsNmFromGroup=function(b){return a.getFormattedGoodsNm({product:b})},a.invalidVisitDate=function(a,b){var c=!1,d=new Date,e=Number(d.toISOString().slice(0,10).replace(/-/g,"")),f=d.getHours(),g=d.getMinutes(),h=(10>f?"0"+f:f)+""+(10>g?"0"+g:g);Number(a);return Number(a)<Number(e)?c=!0:Number(a)==Number(e)&&Number(b)<=Number(h)&&(c=!0),c};a.toggleCheckAllItemsFromGroup=function(c){var d=!1,e=0;b.forEach(a.groupInfo.products,function(a,b){d||30!=a.ec_goods_artc_cd&&31!=a.ec_goods_artc_cd||(d=!0),"Y"==a.quick_deli_yn&&e++}),d?(alert("렌탈 상품은 상담상품으로 구매가능한 상품이 아닙니다.\n구매하시는 상품에 렌탈상품이 포함되어 있는지 확인해주세요."),c.target.checked=!1):e&&a.groupInfo.products.length!=e?(alert("택배 배송 상품과 퀵 배송 상품은\n함께 주문하실 수 없습니다."),c.target.checked=!1):a.toggleCheckAllItems({groupInfo:a.groupInfo,isDeselectAll:!1})},a.chkRentProduct=function(a,b){return 30==a.ec_goods_artc_cd||31==a.ec_goods_artc_cd?(alert("렌탈상품은 상담상품으로 구매 가능한 상품이 아닙니다.\n상세보기 클릭하여 상품상세페이지에서 상담신청해주세요."),a.is_checked=!1,b.preventDefault(),!1):void 0},a.changeEachCheckboxFromGroup=function(b){a.changeEachCheckbox({product:b,groupInfo:a.groupInfo})},a.deleteMultiProductFromGroup=function(){a.deleteMultiProduct({groupInfo:a.groupInfo})},a.$on("idneChgEvt",function(b,c){a.changeEachCheckbox({product:c,groupInfo:a.groupInfo})}),a.toggleGoodsOptionFromGroup=function(b){a.isValidEachOrder(b)&&a.toggleGoodsOption({product:b})},a.minusQuantity=function(b){a.validUserOrderQuantity(b.qty_user-1,b)&&b.qty_user>1&&(b.qty_user-=1)},a.plusQuantity=function(b){a.validUserOrderQuantity(b.qty_user+1,b)&&(b.qty_user+=1,a.pnutCollect("add",b))},a.validUserOrderQuantity=function(a,b){var c=b.inv_qty?Number(b.inv_qty):0,d=b.min_lmt_qty?Number(b.min_lmt_qty):0,e=b.max_lmt_qty?Number(b.max_lmt_qty):0,f="Y"==b.quick_deli_yn?!0:!1;return c=f?b.dept_main_inv_qty:c,c>0&&a>c?(b.qty_user=c,f?alert("퀵배송 가능한 최대 구매 수량은 "+c+"개입니다"):alert("재고가 부족합니다."),!1):e>0&&a>e?(b.qty_user=e,alert("1일 최대 "+e+"개 구매 가능한 상품입니다."),!1):d>0&&d>a?(b.qty_user=d,alert("최소 "+d+"개 구매 가능한 상품입니다."),!1):!0},a.isSoldOption=function(a,b){var c=0;return""!=a.opt_stk_yn&&(a.opt_cnt&&0==Number(a.opt_cnt)||"Y"==a.opt_stk_yn?c=1:"Y"==b&&0==a.cart_dept_main_inv_qty&&(c=2)),c},a.getSoldOptionText=function(b,c){var d=a.isSoldOption(b,c);return d=1==d?"(품절)":2==d?"(퀵불가)":""},a.changeSelectOptionItemFromGroup=function(b,c){a.changeSelectOptionItem({product:b,changedOptionIdx:c})},a.updateCartGoodsOption=function(b,f,g){var h=b.changedSelectOptionItemNo||b.itemNo,i=b.select_options,j=b.input_options,k=-1,l=!1,m=[],n=";;;;;";if(!a.validUserOrderQuantity(b.qty_user,b))return!1;for(var o in i){var p=i[o];if(!p.selected_item_no)return void alert(p.name+" 옵션을 선택해주세요.");p.item_no==h&&(k=p.opt_cnt)}for(var o in j){var p=j[o],q=[];if(!p.item_opt_value)return void alert(p.item_opt_name+" 옵션을 입력해주세요.");p.item_opt_value!=p.ori_item_opt_value&&(l=!0),q.push(p.item_opt_type),q.push(p.item_opt_name),q.push(p.item_opt_value),m.push(q.join(":"))}if(0==k)return void alert("선택하신 제품은 품절되었습니다.");a.groupInfo.isHomeShopping,b.changedSelectOptionItemNo&&b.itemNo!=b.changedSelectOptionItemNo&&(l=!0);var r={goods_no:b.goodsNo,item_no:b.changedSelectOptionItemNo||b.itemNo,goods_cmps_cd:b.goods_cmps_cd,goods_choc_desc:m.join(n),ord_qty:b.qty_user,master_goods_yn:"",cart_sn:b.seq,cmps_qty:"0",update_ck:l};b.crspk_yn!=c&&(r.crspk_yn=b.crspk_yn,r.crspk_corp_cd=b.crspk_corp_cd,r.crspk_corp_str_sct_cd=b.crspk_corp_str_sct_cd,r.crspk_str_no=b.crspk_str_no),d({method:"POST",url:e.cartUpdateOptionData+"?"+a.baseParam,data:r,transformRequest:transformJsonToParam,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(c){alert("변경 되었습니다."),a.modifyGoodsOptionsDescription(b),a.pnutCollect("update",b),f&&f()}).error(function(a){if(a.error){var b=a.error.response_code,c=a.error.response_msg;if(alert(c),"9003"==b){var d="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href=e.loginForm+"?"+d}}else alert("처리중 오류가 발생하였습니다.");g&&g()})},a.modifyGoodsOptionsDescription=function(c){var d=c.select_options,e=c.input_options,f=[],g=[];b.forEach(d,function(a,d){b.forEach(a.item.items,function(b,d){a.selected_item_no==b.item_no&&(f.push(a.name+" : "+b.opt_value),c.dept_main_inv_qty=b.cart_dept_main_inv_qty)})}),c.goodsOption=f.join(", "),b.forEach(e,function(a,b){g.push(a.item_opt_name+" : "+a.item_opt_value)}),c.goodsInputOption=g.join("<br/>"),c.qty=c.qty_user,a.changeEachCheckboxFromGroup(c),a.changeEachCheckboxFromGroup(c)},a.changeSmpDeliLoc=function(a){b.forEach(a.smp_loc_list,function(b,c){Number(a.smp_deli_loc_sn)==b.smp_deli_loc_sn&&(a.smp_tp_cd=b.smp_tp_cd)})},a.deleteOneProductFromGroup=function(b){a.deleteOneProduct({seq:b})},a.addWishFromGroup=function(){a.addWish({groupInfo:a.groupInfo})},a.updateSmartpicOption=function(b){return a.groupInfo.isSmpartpic?a.invalidVisitDate(b.smp_visit_date_changed,b.smp_tdy_edtime)?(alert("유효한 방문예정일을 선택하세요."),!1):void a.requestUpdateSmartpicOption(b):!1},a.requestUpdateSmartpicOption=function(b,c,f){d({method:"POST",url:e.cartUpdateSmartpickOptionData+"?"+a.baseParam,data:{cart_sn:b.seq,smp_tp_cd:b.smp_tp_cd,smp_deli_loc_sn:b.smp_deli_loc_sn,goods_no:b.goodsNo,item_no:b.itemNo,ord_qty:b.qty,smp_vst_shop_dt:b.smp_visit_date_changed},transformRequest:transformJsonToParam,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(d){alert("변경 되었습니다."),b.smp_visit_date=b.smp_visit_date_changed,a.invalidVisitDate(b.smp_visit_date,b.smp_tdy_edtime)||(b.is_overed_date_smartpic=!1),c&&c()}).error(function(a){if(a.error){var b=a.error.response_code,c=a.error.response_msg;if(alert(c),"9003"==b){var d="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href=e.loginForm+"?"+d}}else alert("처리중 오류가 발생하였습니다.");f&&f()})},a.goGoodsDetailFromGroup=function(b){a.goGoodsDetail({product:b,isSoldout:!1})},a.goOrderFromGroup=function(b){pticketCheck(0,b.goodsNo,function(c){return!c&&a.isValidEachOrder(b)?"Y"!=b.quick_deli_yn||checkQuick(b)?void a.goOrder({product:b,groupInfo:a.groupInfo}):!1:void 0})},a.openSmartpicLocationFromGroup=function(b,c,d){a.openSmartpicLocation({isNaverShow:b,product:c,event:d})},a.quickToDeli=function(b){if(confirm("일반 택배 장바구니로 옮겨 담으시겠습니까?")){var c={goods_no:b.goodsNo,item_no:b.itemNo,goods_cmps_cd:b.goods_cmps_cd,ord_qty:b.qty_user,cart_sn:b.seq,qs_yn:"N"};d.get(e.quickCartUpdate,{params:c}).success(function(b){"success"==b.result.response_msg?a.reloadFnc():alert(b.result.response_msg)})}},a.pnutCollect=function(a,b){pnutAdCart.goods={},pnutAdCart.goodsInfo="";var c=[],d="add"==a?b.qty_user:b.qty;c.push([b.goodsNo,d,b.speSaleAmt]),pnutAdCart.setGoods(c),pnutAdCart.setAct(a),pnutAdCart.collect()}}]),d.directive("datePicker",["$timeout","$window",function(a,b){return{replace:!0,link:function(a,b,c){a.getFirstDay=function(a,b){return new Date(a,b,1).getDay()},a.getLastDay=function(a,b){return new Date(a,b+1,0).getDate()},a.addZero=function(a){return 10>a?"0"+a:a},a.date=new Date,a.now=new Date,a.cdate=new Date,a.today=a.now.getDate(),a.month=a.now.getMonth(),a.firstDay=a.getFirstDay(a.date.getFullYear(),a.date.getMonth()),a.lastDay=a.getLastDay(a.date.getFullYear(),a.date.getMonth()),a.dateHead=["SUN","MON","TUE","WED","THU","FRI","SAT"],a.datePrev=function(b){a.date.setMonth(a.date.getMonth()-1),a.firstDay=a.getFirstDay(a.date.getFullYear(),a.date.getMonth()),a.lastDay=a.getLastDay(a.date.getFullYear(),a.date.getMonth()),a.makeDays()},a.dateNext=function(b){a.date.setMonth(a.date.getMonth()+1),a.firstDay=a.getFirstDay(a.date.getFullYear(),a.date.getMonth()),a.lastDay=a.getLastDay(a.date.getFullYear(),a.date.getMonth()),a.makeDays()},a.makeDays=function(){a.day=[];for(var b=0;b<a.firstDay;b++)a.day.push(0-b);for(var b=0;b<a.lastDay;b++)a.day.push(b+1)},a.isActiveDate=function(b){var c=!1,d=new Date(a.date.getFullYear()+"-"+a.addZero(a.date.getMonth()+1)+"-"+a.addZero(b)),e=new Date(a.datePickerInputOption.item_opt_formatted_value);return e&&(c=d.getFullYear()==e.getFullYear()&&d.getMonth()==e.getMonth()&&d.getDate()==e.getDate()),c},a.isPastDate=function(b){var c=new Date(a.date.getFullYear()+"-"+a.addZero(a.date.getMonth()+1)+"-"+a.addZero(b)),d=864e5;return Math.round(c.getTime()/d)<Math.round(a.now.getTime()/d)},a.pick=function(b){if(!a.isPastDate(b)){a.cdate.setDate(b);var c=a.date.getFullYear()+"-"+a.addZero(a.date.getMonth()+1)+"-"+a.addZero(b);a.datePickerInputOption.item_opt_value=c.split("-").join(""),a.datePickerInputOption.item_opt_formatted_value=c,a.datePickerClose()}},a.makeDays()}}}])}(window,window.angular);var transformJsonToParam=function(a){var b=[];for(var c in a)if(Array.isArray(a[c]))for(var d=0;d<a[c].length;d++)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c][d]));else b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},checkQuick=function(a){var b=new Date,c=b.getHours(),d=b.getMinutes(),e=b.getSeconds(),f="";b=""+(10>c?"0"+c:c)+(10>d?"0"+d:d)+(10>e?"0"+e:e),holiday?f="holi":(9e4>b||b>163e3)&&(f="time");var g=0;if(a.length){for(var h=0;h<a.length;h++)a[h].dept_main_inv_qty<a[h].qty&&g++;g&&(f="qty")}else a.dept_main_inv_qty<a.qty&&(f=a.dept_main_inv_qty+"");if(f.length){switch(f){case"holi":f="공휴일 및 롯데백화점 본점 휴무일,\n배송마감일에는\n퀵 배송 주문이 불가합니다.";break;case"time":f="퀵 배송 주문은 09:00 ~ 16:30에만 가능합니다.";break;case"qty":f="퀵 배송 가능한 최대 구매 수량을\n초과하였습니다.";break;default:f="퀵배송 가능한 최대 구매 수량은 "+f+"개입니다."}return alert(f),!1}return!0};