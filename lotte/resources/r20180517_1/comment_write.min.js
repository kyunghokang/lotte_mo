function calcBytes(a){var b=0;for(i=0;i<a.length;i++){var c=a.charAt(i);escape(c).length>4?b+=2:"\n"==c?"\r"!=a.charAt(i-1)&&(b+=1):b+="<"==c||">"==c?4:1}return b}function maxLengthCheck(a,b,c,d){var e,f,g=c.value.length,h=parseInt(a),i="",j=0;if(0==g)null!=document.getElementById("spn_input_char")&&(document.getElementById("spn_input_char").innerText=h);else for(k=0;k<g;k++){if(e=c.value.charAt(k),"\n"==e&&j++,escape(e).length>4?h-=2:h--,0>h){alert("총 한글 "+a/2+"자 영문 "+a+"자 까지 쓰실 수 있습니다."),c.value=i;break}if(null!=b&j>parseInt(b)){alert("라인수 "+b+"라인을 넘을 수 없습니다."),j=0,f=i.length-1,c.value=i.substring(0,f);break}null!=document.getElementById("spn_input_char")&&(document.getElementById("spn_input_char").innerText=h),i+=e}}!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","lotteSns"]);d.controller("commentWriteCtrl",["$scope","$timeout","LotteCommon","$http","$filter","$window","LotteUtil","LotteForm",function(a,b,c,d,e,f,g,h){a.showWrap=!0,a.contVisible=!0,a.subTitle="상품평 쓰기",a.input={},a.input.reviewTxt="",a.input.prc_stfd_val=5,a.input.qual_stfd_val=5,a.input.dsgn_stfd_val=5,a.input.dlv_stfd_val=5,a.input.size=1,a.input.color=1,a.input.evt_no=g.getParameter("evt_no"),a.input.evt_flag=g.getParameter("evt_flag"),a.isNewestApp=isNewestApp(),a.commentWrite={};try{d.get(c.commentWriteData+"?"+a.baseParam+"&goods_no="+g.getParameter("goods_no")).success(function(b){a.commentWrite=b.comment_write,a.subTitle="20"==a.commentWrite.goods_tp_cd||a.commentWrite.smp_psb_yn?"이용후기 쓰기":a.subTitle,a.input.frst_gdas_yn=a.commentWrite.frst_gdas&&"Y"||"N",a.input.wrtr_pur_yn=a.commentWrite.wrtr_pur&&"Y"||"N",a.input.goods_no=a.commentWrite.goods_no,a.input.usm_goods_no=a.commentWrite.usm_goods_no}).error(function(a){ajaxResponseErrorHandler(a)})}catch(i){console.error(i)}a.attachImage=function(){a.appObj.isApp?location.href="ghost://CommentWithPhoto":confirm("롯데닷컴 앱에서 이용 가능합니다. 지금 설치하시겠습니까?")&&(location.href=c.appDown+"?"+a.baseParam)},a.cancel=function(){confirm("상품평 작성을 취소하시겠습니까?")&&location.replace(c.mylotteCritViewUrl+"?"+a.baseParam)},a.save=function(){if(!a.commentWrite.wrtr_pur)return"Y"==a.commentWrite.rental_goods_yn?alert("상품평은 상담신청 후 설치 완료된 고객에 한해 작성이 가능합니다. 구매후 작성해주세요."):alert("상품평은 구매 고객에 한해 작성이 가능합니다. 구매후 작성해주세요."),!1;if(!a.commentWrite.healthfood){var d=a.input.reviewTxt,e=document.querySelector("#reviewTxt");if(0==d.trim().length)return alert("상품평을 작성해 주세요."),e.focus(),!1;if(calcBytes(d)<6)return alert("상품평을 한글 3자 이상 입력하세요."),e.focus(),!1;if(calcBytes(d)>4e3)return alert("상품평은 2000자[한글기준] 이내로 제한되어 있습니다."),e.focus(),!1}if(a.snsFlag&&(Kakao.cleanup(),1==a.appObj.isSktApp?Kakao.init("7a460fb5cdebe4589041db57d906ddda"):Kakao.init("574659987ca46095c123d71f72abac14"),a.subTitle="[상품평]",a.prdComment=a.input.reviewTxt,a.share_img=a.commentWrite.goods_img_url,a.share_url="/product/product_view.do?goods_no="+a.commentWrite.goods_no,a.goodsNm=a.commentWrite.goods_nm,1==a.appObj.isSktApp?a.noCdnUrl=location.protocol+"//"+location.hostname+a.share_url+"&cn=171127":a.noCdnUrl=location.protocol+"//"+location.hostname+a.share_url+"&cn=123624",1==a.appObj.isSktApp?(a.talkCdn="3093671",a.twitCdn="3093668",a.stotyCdn="3093670",a.smsCdn="3093672",a.mailCdn="3158697",a.faceCdn="3093669",a.urlCdn="3158696",a.appCdn="3158696"):(a.talkCdn="2929723",a.twitCdn="2929720",a.stotyCdn="2929722",a.smsCdn="2929725",a.mailCdn="2929724",a.faceCdn="2929721",a.urlCdn="2929719",a.appCdn="2929719")),a.appObj.isApp){if(a.snsFlag){if("sms"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_4"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.smsCdn),"kakaotalk"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_1"),a.appObj.isOldApp?a.kakaoType="[롯데닷컴 이거어때?]\n":a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.talkCdn),"kakaostory"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_3"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.stotyCdn),"facebook"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_6"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.faceCdn),"twitter"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_2"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.twitCdn),"url_copy"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_7"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.urlCdn),"moreapp"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_8"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.appCdn),"mail"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_5"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.mailCdn),a.share_img&&""!=a.share_img?a.share_img=a.share_img:a.share_img="http://image.lotte.com/lotte/mobile/common/share_img2016_v2.png",a.appObj.isAndroid&&a.appObj.verNumber<408||a.appObj.isIOS&&a.appObj.verNumber<4050)var g={url:a.cnShareUrl,title:a.kakaoType+a.prdComment.replace(/#/gi,""),imageUrl:a.share_img};else{var g={type:"default",title:a.subTitle+a.goodsNm,imageUrl:a.share_img,url:a.cnShareUrl,buttons:[{title:"바로가기",url:a.cnShareUrl}]};"kakaotalk"==type?g.desc=a.kakaoType+a.subTitle.replace(/#/gi,"")+a.prdComment.replace(/#/gi,""):g.desc=a.kakaoType+a.getDearPetShareTitle(a.subTitle).replace(/#/gi,"")+a.prdComment.replace(/#/gi,"")}a.appObj.isAndroid?f.lotteshare.callAndroid("lotteshare://"+a.snsFlag+"/query?"+JSON.stringify(g)):a.appObj.isIOS&&(f.location="lotteshare://"+a.snsFlag+"/query?"+JSON.stringify(g))}var i="ghost://SubmitPhotoComment/write";return i+="?frst_gdas_yn="+a.input.frst_gdas_yn,i+="&wrtr_pur_yn="+a.input.wrtr_pur_yn,i+="&goods_no="+a.input.goods_no,i+="&usm_goods_no="+a.input.usm_goods_no,i+="&evt_no="+a.input.evt_no,i+="&evt_flag="+a.input.evt_flag,i+="&reviewTxt="+a.input.reviewTxt,i+="&prc_stfd_val="+a.input.prc_stfd_val,i+="&qual_stfd_val="+a.input.qual_stfd_val,i+="&dsgn_stfd_val="+a.input.dsgn_stfd_val,i+="&dlv_stfd_val="+a.input.dlv_stfd_val,i+="&size="+a.input.size,i+="&color="+a.input.color,i+="&loginId="+a.commentWrite.login_id,i+="&mbrNo="+a.commentWrite.mbr_no,i+="&mbrNm="+a.commentWrite.mbr_nm,i+="&mbrEmail="+a.commentWrite.mbr_email,i+="&site_no="+a.commentWrite.site_no,a.isNewestApp||(i+="&radio1=",i+="&radio2="+a.input.color,i+="&radio2=",i+="&radio2="+a.input.color,i+="&radio3=",i+="&radio4=",i+="&radio5=",i+="&radio6=",i+="&check_cont=",i+="&img_no=",i+="&img_file_1=",i+="&img_file_2=",i+="&img_file_3=",i+="&img_file_4=",i+="&img_path_1=",i+="&img_path_2=",i+="&img_path_3=",i+="&img_path_4=",i+="&prdt_clor_eval_desc=",i+="&prdt_size_eval_desc=",i+="&use_flag=",i+="&wrtr_pur_dt=",i+="&div_stfd_val="+a.input.dlv_stfd_val),console.log(i),void b(function(){location.href=i},200)}var i=c.commentWriteSaveData+"?"+a.baseParam;return h.FormSubmitForAjax(i,a.input).success(function(d){a.snsFlag&&("sms"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.smsCdn,a.showSmsBox()):"kakaotalk"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.talkCdn,a.sendKakaoTalk()):"kakaostory"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.stotyCdn,a.sendKakaoStory()):"facebook"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.faceCdn,a.sendFacebook()):"twitter"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.twitCdn,a.sendTwitter()):"url_copy"==a.snsFlag&&(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.urlCdn,a.urlCopyClick())),b(function(){location.replace(c.mylotteCritViewUrl+"?"+a.baseParam)},200)}).error(function(a){ajaxResponseErrorHandler(a)}),!1}}]),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/product/m/comment_write_container.html",replace:!0,link:function(a,b,c){}}})}(window,window.angular);var ajaxResponseFailHandler=function(a){alert("처리중 오류가 발생하였습니다."),a&&a()},ajaxResponseErrorHandler=function(a,b){if(a.error){var c=a.error.response_code,d=a.error.response_msg;if("9004"==c){var e="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href="/login/m/loginForm.do?"+e}else alert("["+c+"] "+d)}else alert("처리중 오류가 발생하였습니다.");b&&b()};