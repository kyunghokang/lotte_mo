function searchOrdDeliveryListClose(){$("#ordSearchDeliPop").hide(),$("#ordSearchDeliPop").find("iframe").remove(),scrollYN("Y","DELI"),$("#ordSearchDeliInfo input").trigger("change"),$("#change_mode").trigger("click"),$(document).scrollTop($("#addressInfoCtrlContainer").offset().top-150)}function scrollYN(a,b){"N"==a?($("html, body").css({overflow:"hidden"}),"DELI"==b&&$("body").on("scroll touchmove mousewheel",function(a){return a.preventDefault(),a.stopPropagation(),!1}),"Safari"!=browserChk()&&history.pushState("history1","")):($("html, body").css({overflow:"visible"}),"DELI"==b&&$("body").off("scroll touchmove mousewheel"),"Safari"!=browserChk()&&null!=history.state&&history.back())}function searchOrdDeliveryListPop(a,b){var c='<iframe id="deliIframe" src=""></iframe>',d=$("input[name=indlvpsn]").val(),e="/popup/ord_search_delivery_list.do?deli_cnt="+a+"&selectedDlvpSn="+d+"&single="+b;$("#ordSearchDeliPop").show(),$("#ordSearchDeliPop").html(c),$("#ordSearchDeliPop").find("iframe").attr("src",e),scrollYN("N","DELI")}function browserChk(){var a="",b=window.navigator.userAgent;return b.indexOf("Safari")>0&&(a=b.indexOf("Chrome")>0?"Chrome":"Safari"),a}function sendTclick(a){}var PRESENT_COMMON={DELIVER_STAT:{10:"주문접수",11:"주문완료",12:"주문취소",13:"출고지시",14:"발송대기",15:"상품준비",16:"발송불가",17:"발송완료",18:"배송완료",19:"반품접수",20:"반품진행",21:"반품완료",22:"발송약정"},DELIVER_DTL_STAT:{10:"발송완료",20:"상품배송접수",30:"상품이동중",40:"영업소도착",50:"택배기사출발",60:"배송완료"},DELIVER_MSG:{10:"주문일로부터 2일간 미입금시 주문이 취소됩니다.",11:"선물을 수락하셨습니다!",12:"주문이 취소 되었습니다.",13:"고객님의 주문이 업체에 전달되었습니다.",14:"주문상태를 확인하는 중입니다.",15:"고객님께 발송할 상품을 준비하고 있습니다.",16:"상품 발송이 불가한 상태입니다. 주문취소 또는 상담원에게 문의해주세요.",17:"택배사로 상품이 전달되었습니다.",18:"고객님께 상품 배송이 완료되었습니다.",19:"반품 접수되었으며, 반품완료 후 결제금액이 환불됩니다.",20:"반품 접수되었으며, 반품완료 후 결제금액이 환불됩니다.",21:"반품이 완료 되었습니다.",22:"상품 발송이 늦어지고 있습니다. 빠르게 준비하도록 하겠습니다.",23:"선물을 수락하셨습니다!",24:"아직 선물을 수락하지 않으셨어요!",25:"주문취소가 완료되었습니다.",26:"선물거절로 주문 건이 취소되었습니다.",27:"선물거절로 취소처리 중입니다.",28:"선물 주소지 등록 전입니다. 고객센터에서 연락드릴 예정입니다."},CHANGEORDER_MSG:["받으신 선물을 반품 신청하시면, 롯데닷컴 고객센터에서 순차적으로 반품 처리를 진행합니다.","반품 관련 문의사항이 있으시면 롯데닷컴 고객센터 (1577-1110)로 연락주세요.","받으신 선물을 교환 신청하시면, 롯데닷컴 고객센터에서 순차적으로 교환 처리를 진행합니다.","교환 관련 문의사항이 있으시면 롯데닷컴 고객센터 (1577-1110)로 연락주세요.","신청하신 선물 반품 건을 고객센터에서 확인중입니다.","신청하신 선물 교환 건을 고객센터에서 확인중입니다."]};!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","lotteUtil","addressInfo"]);d.controller("presentDetailCtrl",["$scope","$http","$filter","LotteCommon","LotteCookie","LotteUtil","$timeout","$window","LotteStorage","commInitData",function(a,b,c,d,e,f,g,h,i,j){a.useTestData=!1,a.isWishDebug=!1,a.showWrap=!0,a.contVisible=!0,a.subTitle="받은 선물 상세",a.screenId="present_detail",a.itemCountPerPage=20,a.currentPageNo=0,a.UIData={},a.UIData.orderNo=""+j.query.orderNo,a.UIData.ordDtlSn=""+j.query.ordDtlSn,a.UIData.enableOptionList=[],a.UIStatus={isOptionChanging:!1,isAddressChanging:!1,isCouponSending:!1,isDataLoading:!1},a.LV={SESSION_ID:"PRESENT_DETAIL",HASH_STRING:"prsdtl"},a.LV.DELIVER_STAT=PRESENT_COMMON.DELIVER_STAT,a.LV.DELIVER_DTL_STAT=PRESENT_COMMON.DELIVER_DTL_STAT,a.LV.DELIVER_MSG=PRESENT_COMMON.DELIVER_MSG,a.URLs={PRESENT_DETAIL:d.presentDetailData,WRITE_COMMENT:d.presentWriteCommentUrl,PRODUCT_VIEW:d.prdviewUrl,PRESENT_OPTION:d.presentDetailOption,PRESENT_ADDRESS:d.presentDetailAddress,MAIN_URL:d.mainUrl},a.convertOrderNumber=function(a){return a.indexOf("-")>=0?a:a.substring(0,4)+"-"+a.substring(4,6)+"-"+a.substring(6,8)+"-"+a.substring(8,a.length)}}]),d.directive("lotteContainer",["LotteStorage","$timeout","$http","$window","LotteCommon",function(d,e,f,g,h){return{templateUrl:"/lotte/resources_dev/mylotte/present/present_detail_container.html",replace:!0,link:function(d,i,j){d.startOver=function(){return d.UIData.orderNo==c||""==d.UIData.orderNo||d.UIData.ordDtlSn==c||""==d.UIData.ordDtlSn?(console.warn("조회할 데이터가 없습니다."),!1):void d.loadDetailData()},d.loadDetailData=function(){d.UIStatus.isDataLoading=!0;var a=d.URLs.PRESENT_DETAIL,b={orderNo:d.UIData.orderNo,ordDtlSn:d.UIData.ordDtlSn,mbr_no:d.loginInfo.mbrNo};f.get(a,{params:b}).success(function(a){var b;if(a.gift_info!=c){a.gift_info.status!=c&&(b=parseInt(a.gift_info.status),isNaN(b)?a.gift_info.status_no=0:a.gift_info.status_no=b),a.gift_info.use_yn!=c&&(b=parseInt(a.gift_info.use_yn),isNaN(b)?a.gift_info.use_yn_no=0:a.gift_info.use_yn_no=b);var e=a.gift_info.status+"";switch(a.gift_info.canceled=!1,a.gift_info.commentable=!1,a.gift_info.optionable=!1,e){case"12":a.gift_info.canceled=!0;break;case"10":case"11":a.gift_info.optionable=!0;break;case"17":case"18":a.gift_info.commentable=!0}("01"!=a.gift_info.type||a.gift_prd_info.opt_list==c)&&(a.gift_info.optionable=!1)}a.gift_msg_info!=c&&a.gift_msg_info.msg!=c&&(a.gift_msg_info.msg=a.gift_msg_info.msg.replace(/\n/g,"<br />")),a.recom_prd_lst!=c&&a.recom_prd_lst.length>9&&(a.recom_prd_lst.length=9),d.UIData.detail_data=a,d.sortDisableOptionList(),d.UIStatus.isDataLoading=!1,d.giftData=d.UIData.detail_data,d.giftData.orderNo=d.UIData.orderNo,d.giftData.ordDtlSn=d.UIData.ordDtlSn}).error(function(){console.log("Data Error : 받은 선물함"),d.UIStatus.isDataLoading=!1})},d.showOptionChange=function(){d.UIStatus.isOptionChanging=!d.UIStatus.isOptionChanging,d.UIStatus.isOptionChanging&&e(function(){var a,b,c;$(".list_option dl:not(.opt_txt)").each(function(e,f){a=$(f),b=a.find("dt").text(),c=a.find("dd select"),c.val(d.getSelectedOption(b)),d.UIStatus.previousOption=d.getOptionItemNo().item_no}),d.checkSoldoutOption()},1)},d.hideOptionChange=function(){d.UIStatus.isOptionChanging&&d.showOptionChange()},d.sortDisableOptionList=function(){if(d.UIData.enableOptionList.length=0,d.UIData.detail_data.gift_prd_info!=c&&d.UIData.detail_data.gift_prd_info.opt_item_lst!=c)for(var a,b,e=d.UIData.detail_data.gift_prd_info.opt_item_lst,f=e.length,g=0;f>g;g++)a=e[g],b=parseInt(a.item_no,10),a.inv_qty>0&&(d.UIData.enableOptionList[b]=a.opt_tval)},d.checkSoldoutOption=function(){try{var a,b,c,e,f=[],g=[],h=[],i=[];for(b=d.UIData.detail_data.gift_prd_info.opt_list.length,a=0;b>a;a++){var j=$("#prod_option_"+a);g.push(j),h.push(j.val()),i.push(j.find("option").length)}var k,l,m;for(a=0;b>a;a++){for(j=g[a],f=j.find("option"),e=i[a],k=[].concat(h),c=0;e>c;c++)m=f.eq(c),k[a]=m.val(),l=k.join(" x "),d.UIData.enableOptionList.indexOf(l)>=0?m.removeClass("na"):m.addClass("na");f.eq(j.prop("selectedIndex")).hasClass("na")?j.addClass("na"):j.removeClass("na")}}catch(n){}},d.getSelectedOption=function(a){if(d.UIData.detail_data.gift_prd_info.selected_opt!=c)for(var b,e=d.UIData.detail_data.gift_prd_info.selected_opt.length,f=0;e>f;f++)if(b=d.UIData.detail_data.gift_prd_info.selected_opt[f],b.opt_name==a)return b.opt_value;return""},d.getOptionString=function(){try{for(var a,b=[],c=d.UIData.detail_data.gift_prd_info.opt_list.length,e=0;c>e;e++)a=$("#prod_option_"+e),b.push(a.val());return b.join(" x ")}catch(f){return""}},d.getOptionItemNo=function(){for(var a,b=d.getOptionString(),c=d.UIData.detail_data.gift_prd_info.opt_item_lst,e=c.length,f=0;e>f;f++)if(a=c[f],a.opt_tval==b)return a;return{item_no:-1,opt_val_cd:"",inv_qty:0}},d.changeOption=function(){if(d.UIData.detail_data.gift_prd_info.opt_item_lst!=c){var a=d.getOptionItemNo(),b=a.item_no,e=d.UIStatus.previousOption;if(0>b)return void alert("재고 수량이 부족합니다.");if(b==e)return void alert("동일한 옵션을 선택하셨습니다.");if(a.inv_qty!=c&&0==a.inv_qty)return void alert("재고 수량이 부족합니다.");var g=d.URLs.PRESENT_OPTION,h={ord_no:d.UIData.orderNo,ord_dtl_sn:d.UIData.ordDtlSn,goods_no:d.UIData.detail_data.gift_prd_info.goods_no,chg_item_no:b,rel_qty:d.UIData.detail_data.gift_prd_info.rel_qty,item_no:e};d.UIStatus.isDataLoading=!0,f.get(g,{params:h}).success(function(a){if(d.UIStatus.isDataLoading=!1,"0000"==a.result_code)d.UIData.ordDtlSn=a.ord_dtl_sn,d.updateSelectedOption();else{var b=a.error_msg;(b==c||""==b)&&(b="변경 사항을 저장하지 못했습니다."),alert(b)}}).error(function(){console.log("Data Error : 옵션 변경"),d.UIStatus.isDataLoading=!1})}},d.updateSelectedOption=function(){var a,b,c,e,f,g=d.UIData.detail_data.gift_prd_info.selected_opt,h=g.length;$(".list_option .opt_select").each(function(d,i){for(a=$(i),b=a.find("dt").text(),c=a.find("dd select").val(),e=0;h>e;e++)if(f=g[e],f.opt_name==b){f.opt_value=c;break}}),d.UIStatus.previousOption=d.getOptionItemNo().item_no},d.optionChangeListener=function(a){e(function(){d.checkSoldoutOption()},0)},g.optionChangeListener=d.optionChangeListener,d.showAddressChange=function(){d.UIStatus.isAddressChanging=!d.UIStatus.isAddressChanging},d.hideAddressChange=function(){d.UIStatus.isAddressChanging=!1},d.saveAddressChange=function(){var a=b.element("#addressInfoCtrlContainer").scope().getlastAddress();if(a.addr1!=c){a.dlvp_sn==c&&(a.dlvp_sn=""),a.message==c&&(a.message=""),a.post_no=a.addr_post;var e=d.URLs.PRESENT_ADDRESS;a.ord_no=d.UIData.orderNo,a.ordDtlSn=d.UIData.ordDtlSn,a.goods_no=d.UIData.detail_data.gift_prd_info.goods_no,d.UIStatus.isDataLoading=!0,f.get(e,{params:a}).success(function(b){if(d.UIStatus.isDataLoading=!1,b.result&&"0000"==b.result.result_code)d.UIData.detail_data.addr_info.addr_name=a.addr_name,d.UIData.detail_data.addr_info.r_name=a.r_name,d.UIData.detail_data.addr_info.addr_detail=a.addr1+" "+a.addr2,d.UIData.detail_data.addr_info.addr_tel=a.addr_tel,d.UIData.detail_data.addr_info.addr_phone="",d.UIData.detail_data.addr_info.addr_msg=a.message,d.hideAddressChange();else{var e=b.result.error_msg;(e==c||""==e)&&(e="배송지를 저장하지 못했습니다."),alert(e)}}).error(function(){console.log("Data Error : 배송지 변경"),d.UIStatus.isDataLoading=!1})}},d.showSendCouponLayer=function(){d.UIStatus.isCouponSending=!d.UIStatus.isCouponSending},d.sendCouponMsg=function(){alert("send coupon")},d.goCommentWrite=function(){var a=d.URLs.WRITE_COMMENT;a+="?goods_no="+d.UIData.detail_data.gift_prd_info.goods_no,a+="&order_no="+d.UIData.detail_data.gift_info.order_no,a+="&ord_dtl_sn="+d.UIData.detail_data.gift_info.ord_dtl_sn,a+="&"+baseParam,location.href=a},d.thankProductClick=function(b){var c=d.URLs.PRODUCT_VIEW+"?"+d.baseParam+"&goods_no="+b.goods_no;a.location.href=c},d.checkDeliveryState=function(){var b=d.UIData.detail_data.delivery_info,e=d.UIData.detail_data.gift_info,f=b.url;"17"==e.status&&e.detail_status!=c&&""!=e.detail_status?(f="/mylotte/purchase/m/smart_deli_info.do?"+d.baseParam+"&ord_no="+e.order_no+"&dlv_unit_sn="+e.dlv_unit_sn+"&inv_no="+b.invoice,location.href=f):d.appObj.isApp?openNativePopup("배송조회",f):a.open(f)},d.co_msg=PRESENT_COMMON.CHANGEORDER_MSG,d.er_psb_case=0,d.er_index=-1,d.open_er_psb=function(a,b){null==a.gift_info.ob_cd||""==a.gift_info.ob_cd?3==b?(d.selectOptList=null,d.er_psb_case=b):d.er_psb_case=b:"114"==a.gift_info.ob_cd&&3==b?alert("해당 선물은 반품 진행중입니다."):"115"==a.gift_info.ob_cd&&1==b?alert("해당 선물은 교환 진행중입니다."):d.er_psb_case=b+1},d.close_er_psb=function(){d.er_psb_case=0,d.er_index=-1},d.checkStatus=function(a){var b=d.LV.DELIVER_STAT[a.gift_info.status];return"14"==a.gift_info.sct||"16"==a.gift_info.sct?b="교환"+b:"15"==a.gift_info.sct?b="교환주문취소":"17"==a.gift_info.sct&&(b="교환반품취소"),"17"==a.gift_info.status&&a.gift_info.detail_status!=c&&""!=a.gift_info.detail_status&&(b=d.LV.DELIVER_DTL_STAT[a.gift_info.detail_status]),b},d.send_er_psb=function(a){var b="",e="",g="";if("114"==a){if(b=$("#rfg_select").val(),g="선물 반품이 신청되었습니다.","0"==b)return void alert("반품사유를 선택해 주세요.")}else{if(b=$("#exch_select").val(),e=$("#opt_select").val(),g="선물 교환이 신청되었습니다.","0"==e)return void alert("상품옵션을 선택해 주세요.");if("0"==b)return void alert("교환사유를 선택해 주세요.")}f({url:h.gift_change,method:"GET",async:!1,cache:!1,headers:{Accept:"application/json",Pragma:"no-cache"},params:{ordNo:d.UIData.detail_data.gift_info.order_no,ordDtlSn:d.UIData.detail_data.gift_info.ord_dtl_sn,ob_job_tp_cd:a,ob_rsn_cd:b,item_no:e}}).success(function(a){a.result_code!=c&&"ETC"==a.result_code?alert(a.error_msg):(alert(g),location.reload())})},e(function(){d.startOver()},0)}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("addressInfo",["lotteComm"]);d.controller("AddressInfoCtrl",["$scope","LotteCommon",function(a,b){}]),d.directive("addressInfo",["LotteCommon","$window","$timeout","$parse","$http",function(a,b,d,e,f){return{templateUrl:"/lotte/resources_dev/mylotte/address_info.html",replace:!0,link:function(a,b,d){a.has_address=!1,a.pageGubun=!1,"선물 확인"==a.subTitle&&(a.pageGubun=!0);var e=function(){if(a.giftData==c)setTimeout(function(){e()},500),console.log("load again");else{var b={};if(a.loginInfo.isLogin?(a.giftData.user_addr_info!=c&&a.giftData.user_addr_info.default_addr.addr1!=c&&(b=a.giftData.user_addr_info.default_addr,a.has_address=!0),a.giftData.ord_addr_info!=c&&a.giftData.ord_addr_info.addr1!=c&&(b=a.giftData.ord_addr_info,a.has_address=!0)):a.giftData.ord_addr_info!=c&&a.giftData.ord_addr_info.addr1!=c&&(b=a.giftData.ord_addr_info,a.has_address=!0),a.user_msg="배송메시지",a.has_address){var d=b.addr_tel.split("-");a.oinfo={indlvpsn:b.dlvp_sn,inpbasedlvpyn:"",inprmitnm:b.r_name,inpdlvpnm:b.addr_name,inpzip1:b.addr_post.substr(0,3),inpzip2:b.addr_post.substr(3,3),inpaddr1:b.addr1,inpaddr2:b.addr2,stnm_inp_zip1:"",stnm_inp_zip2:"",stnm_inp_addr1:"",stnm_inp_addr2:"",incellsctno:d[0],incelltxnono:d[1],incellendno:d[2]},null!=b.stnm_addr_post&&""!=b.stnm_addr_post&&(a.oinfo.stnm_inp_zip1=b.stnm_addr_post.substr(0,3),a.oinfo.stnm_inp_zip2=b.stnm_addr_post.substr(3,3),a.oinfo.stnm_inp_addr1=b.stnm_addr1,a.oinfo.stnm_inp_addr2=b.stnm_addr2)}else a.oinfo={indlvpsn:"",inpbasedlvpyn:"",inprmitnm:"",inpdlvpnm:"",inpzip1:"",inpzip2:"",inpaddr1:"",inpaddr2:"",stnm_inp_zip1:"",stnm_inp_zip2:"",stnm_inp_addr1:"",stnm_inp_addr2:"",incellsctno:"",incelltxnono:"",incellendno:""}}};setTimeout(function(){e()},5),a.getlastAddress=function(){var b={};if(""==a.oinfo.inpaddr1&&""==a.oinfo.stnm_inp_addr1)alert("주소찾기를 완료해주세요.");else{var c=$("#message").val();if(a.writeMessage&&(c=$("#message2").val(),c.length<1))return alert("배송메시지를 입력해주세요."),$("#message2").focus(),b;b={idx:0,is_default:a.oinfo.inpbasedlvpyn,dlvp_sn:a.oinfo.indlvpsn,r_name:a.oinfo.inprmitnm,addr_name:a.oinfo.inpdlvpnm,addr_post:a.oinfo.inpzip1+""+a.oinfo.inpzip2,addr1:a.oinfo.inpaddr1,addr2:a.oinfo.inpaddr2,addr_tel:a.oinfo.incellsctno+"-"+a.oinfo.incelltxnono+"-"+a.oinfo.incellendno,message:c,stnm_addr_post:a.oinfo.stnm_inp_zip1+""+a.oinfo.stnm_inp_zip2,stnm_addr1:a.oinfo.stnm_inp_addr1,stnm_addr2:a.oinfo.stnm_inp_addr2}}return b},a.writeMessage=!1,a.messageChange=function(){console.log("in",$("#message").val()),""==$("#message").val()&&(a.writeMessage=!0)},a.myAddrChange=function(b){b?(""!=a.oinfo.inpaddr1||""!=a.oinfo.stnm_inp_addr1)&&(a.has_address=!0):a.has_address=!1},a.checkField=function(a,b){var c=$(b).val();return""==c?(alert(a+" 입력해주세요."),$(b).focus(),!0):!1}}}}])}(window,window.angular);