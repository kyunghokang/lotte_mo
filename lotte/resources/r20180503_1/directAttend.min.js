!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter"]);d.controller("directAttendCtrl",["$scope","$http","$window","$interval","LotteCommon","commInitData",function(b,d,e,f,g,h){function i(a,b,c,d,e,f){var g=new Date(a,b,c,d,e,f);return a&&b&&c&&(g.setFullYear(a),g.setMonth(b-1),g.setDate(c),d&&g.setHours(d),e&&g.setMinutes(e),f&&g.setSeconds(f)),g.getTime()}if(b.showWrap=!0,b.contVisible=!0,b.subTitle="하루 한 번 롯데닷컴",b.wwd=$(a).width(),b.todayDate=new Date,b.isSimple=b.loginInfo.isSimple,b.simple_msg="고객님! 간편회원 고객님은 이벤트 참여가 제한됩니다.",h.query.testDate){var j=h.query.testDate,k=new Date(j.substring(0,4),parseInt(j.substring(4,6))-1,j.substring(6,8),j.substring(8,10),j.substring(10,12),j.substring(12,14));b.todayDate=k}b.getWeekToday=function(a){var b=k||new Date,c=new Date(b.getFullYear(),b.getMonth()+1,0),d=new Date(b.getFullYear(),b.getMonth(),1),e=c.getDate(),f=d.getDay();return Math.ceil((e+f)/7)};var l=b.todayDate.getFullYear(),m=b.todayDate.getMonth(),j=b.todayDate.getDate(),n=new Date(b.todayDate.getFullYear(),b.todayDate.getMonth(),1).getDay(),o=(b.todayDate.getDay(),new Date(l,m+1,0)),p=o.getDate();b.thisMonth=m+1,b.lastWeek=b.getWeekToday(),b.yoil=b.todayDate.getDay(),b.hour=b.todayDate.getHours(),b.attend_layer_flag=!1,b.hide_attend_layer=function(){b.attend_layer_flag=!1},d.get(g.directAttendData).success(function(a){function d(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}b.mbrGradeCd=a.direct_attend.mbrGradeCd,b.intClover=a.direct_attend.intClover,b.chilCouponCnt=a.direct_attend.chilCouponCnt,b.chilTotalCouponCnt=a.direct_attend.chilTotalCouponCnt,b.sibECouponCnt=a.direct_attend.sibECouponCnt,b.sibETotalCouponCnt=a.direct_attend.sibETotalCouponCnt,b.lPointCnt=a.direct_attend.lPointCnt,b.lPointTotalCnt=a.direct_attend.lPointTotalCnt,b.freeDelivCnt=a.direct_attend.freeDelivCnt,b.freeDelivTotalCnt=a.direct_attend.freeDelivTotalCnt,b.ilManCouponCnt=a.direct_attend.ilManCouponCnt,b.ilManTotalCouponCnt=a.direct_attend.ilManTotalCouponCnt,b.evtNo=a.direct_attend.evt_no,b.lpEntryDailCnt=a.direct_attend.lpEntryDailCnt,b.lpEntryWinCnt=a.direct_attend.lpEntryWinCnt,b.lpEntryWinCntDailyCnt=a.direct_attend.lpEntryWinCntDailyCnt,b.lpEntryAstCnt=-1,a.direct_attend.lpEntryAstCnt!=c&&(b.lpEntryAstCnt=a.direct_attend.lpEntryAstCnt),b.platinumMember=!1,b.chgImgCpn="0501",b.freeDelivCloverCnt="1000",b.cloverNewCount=200,b.cloverNewCount2=96,b.cloverNewCount3=200,b.freeDelivCpnNo=a.direct_attend.freeDelivCpnNo,b.lPointNo="",b.cpnNo1="",b.cpnNo2=a.direct_attend.cpnNo2,b.cpnNo3="",b.luckyboxNo=!0,b.screen1101=!0;var e=b.todayDate.getTime();if(e>=i(2016,9,1)&&e<i(2016,10,1)?(b.freeDelivCpnNo="1169489",b.cpnNo2="1169488"):e>=i(2016,10,1)&&e<i(2016,11,1)?(b.freeDelivCpnNo="1170506",b.cpnNo2="1170505",b.screen1101=!1,b.subTitle="올 때마다 출석도짱"):e>=i(2018,4,28)&&-1==location.search.indexOf("dt_test")&&(b.luckyboxNo=!1),-1!=location.search.indexOf("dt_test")){var f=location.search.indexOf("dt_test");e>=i(Number(location.search.slice(f+8,f+12)),Number(location.search.slice(f+12,f+14)),Number(location.search.slice(f+14,f+16)))&&(b.luckyboxNo=!1)}b.bannerShow=function(a,b,c,d,f,g){var h=!1;return e>=i(a,b,c)&&e<i(d,f,g)&&(h=!0),h},b.totalClover=a.direct_attend.totalClover,"10"==b.mbrGradeCd&&(b.platinumMember=!0),null!=a.direct_attend.attend_tgtr_list?b.attendTgtrListData=a.direct_attend.attend_tgtr_list.items:b.attendTgtrListData=null,b.appPushFlag=!1,e>=i(2016,9,14)&&e<i(2016,9,19)&&(b.appPushFlag=!0),b.param_cn=d("cn"),b.goApppush_Event=function(a){if("pnhZkYs9a5U="==getCookie("MBRSCTCD"))alert("간편계정 회원의 경우 응모가 불가합니다.\nL.POINT 통합회원 가입 후 신청해주세요.");else if(b.loginInfo.isLogin)$.ajax({type:"post",async:!1,url:"/event/regEvent.do?"+b.baseParam,data:{evt_no:a},success:function(a){a.indexOf("0000")>-1?alert("L.money 10점 적립 응모 완료! 월~일 모두 적립시 보너스 30점 추가! (매주 화요일 일괄 지급)"):a.indexOf("dup.err")>-1&&alert("오늘은 이미 적립하셨네요. 내일 또 만나요^^")}});else if(confirm("로그인 후 적립하실 수 있습니다.")){var c="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href="/login/m/loginForm.do?"+c}},b.todayCheckFlag=!1;var g,h=new Array(42),k=1;setTimeout(function(){for(var a=0;42>a;a++)h[a]=0,a>=n&&p>=k&&(g=$(".calendar").find("li").eq(a),g.find("span").text(k),g.addClass("on"),k==j?g.addClass("today"):k>j&&(g.addClass("after"),a%7==0?g.addClass("sun"):a%7==6&&g.addClass("sat")),k++);if(null!=b.attendTgtrListData)for(a=0;a<b.attendTgtrListData.length;a++)k=parseInt(b.attendTgtrListData[a].sbscSgt_Dtime),$(".calendar").find("li.on").eq(k-1).addClass("check"),k==j&&(b.todayCheckFlag=!0);b.calendarArrInfo=h},200)}).error(function(a){console.log("Error Data :  directAttendData 출석도장 에러")}),b.goLogin=function(){e.location.href=g.loginUrl+"?"+b.baseParam+"&targetUrl="+encodeURIComponent(e.location.href,"UTF-8")},b.goLink=function(){e.location.href=g.prdlstUrl+"?"+b.baseParam+"&curDispNo=5400483&tclick=m_ck_08"},b.goLinkTwo=function(){e.location.href="/event/luckyBox.do?"+b.baseParam+"&tclick=m_luckybox_ck_20161022"},b.goLinkLatte=function(){e.location.href="/event/luckyBox.do?"+b.baseParam+"tclick=m_luckybox_ck_20161029"}}]),d.directive("lotteContainer",["$http","$location","$window","LotteCommon","commInitData","LotteForm","LotteUtil",function(b,c,d,e,f,g,h){return{templateUrl:"/lotte/resources_dev/event/direct_attend_container.html",replace:!0,link:function(h,i,j){function k(){var b="member.lpoint.com/door/user/mobile/",c=encodeURIComponent("http://m.lotte.com/main.do?c=mlotte&udid=&v=&cn=&cdn=","UTF-8"),d="change_user_info.jsp",e=a.location.href;e=encodeURIComponent(a.location.href,"UTF-8"),b+=d+"?sid=MDOTCOM&returnurl="+e+"&main_url="+c+"&custid=7JpRsqOLeP1eXVSnrtgK07//OTr4YCwpqusopHebRcA=&loginid=73s@naver.com",b+="&pageflag=I&opentype=P",b+="&sch=",a.open("https://"+b,"family")}var l=2,m=f.query.cn?f.query.cn:"1";("0"==m||"1"==m||"23"==m||"146"==m||"510"==m||"109329"==m||"117124"==m||"117125"==m||"120024"==m||"120724"==m||"125525"==m||"125526"==m||"126124"==m||"153527"==m||"156027"==m||"156025"==m||"132224"==m||"133025"==m||"140024"==m||"133224"==m||"141224"==m||"140924"==m||"146724"==m||"116824"==m||"145524"==m||"123624"==m||"126824"==m||"156624"==m||"156026"==m||"151224"==m||"171624"==m||"171625"==m||"171525"==m||"172324"==m||"188026"==m||"206525"==m||"206527"==m||"206529"==m)&&(l=1),h.evtEntryYn=l,h.regAttend=function(){if(h.loginInfo.isLogin)if(h.isSimple)alert(h.simple_msg),k();else if(1==h.evtEntryYn){var a=[];a.evt_no=h.evtNo,a.evt_type="at",g.FormSubmitForAjax(e.registAttendData,a).success(function(a){a.data_set.response_msg.indexOf("0000")>-1?(h.screen1101?alert("출석체크 완료!!"):alert("출석도짱이 발급되었습니다."),sessionStorage.clear(),0==h.yoil||6==h.yoil?h.totalClover=h.totalClover+200:h.totalClover=h.totalClover+100,location.reload()):alert(a.data_set.response_msg)}).error(function(a){a.error.response_code==LOGIN_EXCEPTION?(alert(a.error.response_msg),Fnproductview.goToLogin(d,h,e.loginUrl)):"M000200"==a.error.response_code?alert(a.error.response_msg):alert("프로그램 오류로 인해 처리되지 않았습니다.")})}else h.screen1101?h.attend_layer_flag=!0:alert("출석도짱은 바로방문on으로 접속하셔야만 찍을  수 있습니다.");else h.goLogin()};var n,o,p=!0;h.goExchangeClover=function(c){if(h.loginInfo.isLogin)if(h.isSimple)alert(h.simple_msg),k();else{if("freeDeliv"==c){if(h.platinumMember)return void alert("이미 플래티넘플러스 무료배송 혜택을 받고 계십니다.");if(h.freeDelivCnt<1&&h.hour<10)return void alert("지금은 교환시간이 아닙니다\n오전 10시에  교환해 주세요.");if(h.freeDelivCnt>=1)return void alert("이미 교환 지급 되었습니다. 일주일 후에 다시 교환 해 주세요.");if(h.intClover<h.freeDelivCloverCnt)return void alert("적립된 클로버가 부족합니다.\n나의 총 누적 클로버를 확인하세요.");if(h.freeDelivTotalCnt>=h.cloverNewCount)return void alert("선착순 마감되었습니다.\n내일 오전10시에 다시 도전하세요.");n=h.freeDelivCpnNo,o="U00002"}else if("LPoint"==c){if(h.lpEntryWinCnt>=1&&-1==h.lpEntryAstCnt)return void alert("이미 당첨, 교환 지급 되었습니다. 다음 이벤트에 다시 응모해 주세요.");if(h.lpEntryWinCnt>=1&&0==h.lpEntryAstCnt)return void alert("고객님의 소중한 L-money 1천점은 내일 자동지급 예정입니다!");if(h.lpEntryWinCnt>=1&&h.lpEntryAstCnt>=1)return void alert("이미 참여하셨습니다. \n다음 이벤트에 다시 응모해주세요!");if(h.lpEntryDailCnt>=1)return void alert("이미 응모했습니다. 내일 다시 응모해 주세요.");if(h.intClover<1e4)return void alert("적립된 클로버가 부족합니다.\n나의 총 누적 클로버를 확인하세요.");n=h.lPointNo,o="U00035"}else if("cloverLayer1000"==c){if(h.sibECouponCnt<1&&h.hour<10)return void alert("지금은 교환시간이 아닙니다\n오전 10시에  교환해 주세요.");if(h.sibECouponCnt>=1)return void alert("이미 교환 지급 되었습니다. 일주일 후에 다시 교환 해 주세요.");if(h.intClover<h.freeDelivCloverCnt)return void alert("적립된 클로버가 부족합니다.\n나의 총 누적 클로버를 확인하세요.");if(h.sibETotalCouponCnt>=100)return void alert("선착순 마감되었습니다.\n내일 오전10시에 다시 도전하세요.");n=h.cpnNo2,o="U00043"}else if("cloverLayer2000"==c){if(h.chilCouponCnt<1&&h.hour<10)return void alert("지금은 교환시간이 아닙니다\n오전 10시에  교환해 주세요.");if(h.chilCouponCnt>=1)return void alert("이미 교환 지급 되었습니다. 일주일 후에 다시 교환 해 주세요.");if(h.intClover<h.cloverNewCount3)return void alert("적립된 클로버가 부족합니다.\n나의 총 누적 클로버를 확인하세요.");if(h.chilTotalCouponCnt>=300)return void alert("선착순 마감되었습니다.\n내일 오전10시에 다시 도전하세요.");n=h.cpnNo1,o="U00042"}else if("cloverLayer3000"==c){if(h.sibECouponCnt<1&&h.hour<10)return void alert("지금은 교환시간이 아닙니다\n오전 10시에  교환해 주세요.");if(h.sibECouponCnt>=1)return void alert("이미 교환 지급 되었습니다. 일주일 후에 다시 교환 해 주세요.");if(h.intClover<h.freeDelivCloverCnt)return void alert("적립된 클로버가 부족합니다.\n나의 총 누적 클로버를 확인하세요.");if(h.sibETotalCouponCnt>=400)return void alert("선착순 마감되었습니다.\n내일 오전10시에 다시 도전하세요.");n=h.cpnNo2,o="U00041"}else{if(h.ilManCouponCnt<1&&h.hour<10)return void alert("지금은 교환시간이 아닙니다\n오전 10시에  교환해 주세요.");if(h.ilManCouponCnt>=1)return void alert("이미 교환 지급 되었습니다. \n일주일 후에 다시 교환 해 주세요.");if(h.intClover<3e3)return void alert("적립된 클로버가 부족합니다.\n나의 총 누적 클로버를 확인하세요.");if(h.ilManTotalCouponCnt>=h.cloverNewCount)return void alert("선착순 마감되었습니다.\n내일 오전10시에 다시 도전하세요.");n=h.cpnNo3,o="U00027"}if(p){p=!1;var d;if("LPoint"==c){var f=[],g=e.registAttendData;f.evt_no=h.evtNo,f.evt_type="lw",f.prom_no=n,f.clvr_tp_cd=o,g+="?evt_no="+h.evtNo,g+="&evt_type=lw",g+="&prom_no="+n,g+="&clvr_tp_cd="+o,b({url:g,data:$.param(f),method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b,c,d,e){b.data_set.response_msg.indexOf("8888")>-1?alert("축하합니다!\n고객님의 소중한 L-money 1천점은 내일 자동지급 예정입니다!"):b.data_set.response_msg.indexOf("0000")>-1?alert("오늘은 아쉽게도 꽝. 내일 다시 도전해 주세요!"):alert(b.data_set.response_msg),h.lpEntryDailCnt=1,a.location.reload()}).error(function(a,b,c,d){alert("error")})}else{d="cl";var f=[];f.evt_no=h.evtNo,f.evt_type="cl",f.prom_no=n,f.clvr_tp_cd=o;var i=e.registAttendData;i+="?evt_no="+h.evtNo,i+="&evt_type=cl",i+="&prom_no="+n,i+="&clvr_tp_cd="+o,b({url:i,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,b,d,e){h.screen1101?(alert("쿠폰이 발급 되었습니다."),location.reload()):q(c)}).error(function(a,b,c,d){alert("error")})}}}else h.goLogin()};var q=function(a){"freeDeliv"==a?$(".stamp_layer > .cont").addClass("typeb"):"cloverLayer3000"==a?$(".stamp_layer > .cont").addClass("typea"):"cloverLayer1000"==a&&$(".stamp_layer > .cont").addClass("typea"),$(".stamp_layer").show()};h.closePop=function(){$(".stamp_layer").hide()},h.closeInfoPop=function(){h.screen1101||$("#visitPop").hide(),$("#cpType").removeClass("btype"),$("#cpType").removeClass("ctype"),$("#cpType").removeClass("dtype")},h.goPointCoupon=function(){var a=c.protocol()+"://"+c.host();h.closeInfoPop(),d.location.href=a+"/mylotte/pointcoupon/point_info.do?"+h.baseParam+"&point_div=clover"}}}}])}(window,window.angular);