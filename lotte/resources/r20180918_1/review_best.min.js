!function(a,b,c){"use strict";var d=b.module("lotteVideo",[]);d.controller("LotteVideoCtrl",["$scope",function(a){}]),d.directive("lotteVideo",["$window","$timeout","LotteUtil",function(c,d,e){return{controller:"LotteVideoCtrl",link:function(c,f,g,h){function i(){n.src="",d(function(){n.src=j},300),q.appObj.isIOS||n.removeAttribute("controls"),c.movMode=0,c.$apply()}c.movMode=0,c.mute=!1;var j=g.lvSrc,k=g.lvDetailUrl,l=g.lvNoAlert,m=g.lvPoster,n=b.element(f).find("video")[0],o=g.lvTime||2e3;n.setAttribute("poster",m),n.addEventListener("ended",i,!1);var p={play:function(){a.videoStateModel.setPlay(!0,String(9999999*Math.random()))},pause:function(){a.videoStateModel.setPlay(!1)}};n.addEventListener("play",p.play,!1),n.addEventListener("pause",p.pause,!1);var q=e.getAbsScope(c);c.playVideo=function(){if(l||confirm("3G/LTE에서 재생시 데이터 요금이 부과할 수 있으니 유의하세요~")){var a=b.element(document.body).data("play_video")||"";if(a){var e=b.element("#"+a);if(e&&e.length>0){e[0].pause();var g=e.scope();g.movMode=0}}c.movMode=1,n.src||(n.src=j),n.play(),b.element(document.body).data("play_video",b.element(n).attr("id")),d(function(){1==c.movMode&&$(f).find(".btns").fadeOut(600,function(){c.movMode=2,$(this).attr("style",""),c.$apply()})},o)}},c.clickCover=function(){c.movMode=1,d(function(){1==c.movMode&&$(f).find(".btns").fadeOut(600,function(){c.movMode=2,$(this).attr("style",""),c.$apply()})},o)},c.stopVideo=function(){n.pause(),c.movMode=0},c.muteVideo=function(){n.muted?(c.mute=!1,n.muted=!1):(c.mute=!0,n.muted=!0)},c.fullVideo=function(){n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.webkitEnterFullscreen&&n.webkitEnterFullscreen(),q.appObj.isIOS||n.setAttribute("controls","controls")},c.goDetailPage=function(){location.href=k},b.element(f).find("video").bind("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(a){var b=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen,d=b?"FullscreenOn":"FullscreenOff";"FullscreenOff"==d&&(c.stopVideo(),q.appObj.isIOS||n.removeAttribute("controls"),c.$apply())})}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("lotteSlider",[]);d.controller("LotteSlideCtrl",["$scope",function(b){b.getTranslateXCssObj=function(a,b){var c={"-webkit-backface-visibility":"hidden","-moz-backface-visibility":"hidden","backface-visibility":"hidden","-webkit-transform":"translateX("+a+"px)","-ms-transform":"translateX("+a+"px)","-moz-transform":"translateX("+a+"px)",transform:"translateX("+a+"px)","-webkit-transition":"","-moz-transition":"","-o-transition":"",transition:""};return b&&b>0&&(c["-webkit-transition"]="-webkit-transform "+b+"ms",c["-moz-transition"]="-moz-transform "+b+"ms",c["-o-transition"]="-o-transform "+b+"ms",c.transition="transform "+b+"ms"),c},b.removeTranslateCSS=function(){return{"-webkit-backface-visibility":"","-moz-backface-visibility":"","backface-visibility":"","-webkit-transform":"","-ms-transform":"","-moz-transform":"",transform:""}},b.getCoordinates=function(a){var b=a.touches&&a.touches.length?a.touches:[a],c=a.changedTouches&&a.changedTouches[0]||a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]||b[0].originalEvent||b[0];return{x:c.clientX,y:c.clientY}},b.getTransXPos=function(b){var c=a.getComputedStyle(b.get(0)),d=new WebKitCSSMatrix(c.webkitTransform);return d.m41}}]),d.directive("lotteSlider",["$window","$timeout","$parse",function(a,c,d){return{controller:"LotteSlideCtrl",link:function(d,e,f,g){function h(){m=k.outerWidth(),l.css({display:"inline-block"}),n=l.outerWidth(),x=-(n-m);var a=d.getTransXPos;(a.x>0||a.x<x)&&i(0,500)}function i(a,b){l.css(d.getTranslateXCssObj(a,b)),k.trigger({type:"slide",posX:a,wrapWidth:m,contWidth:n})}function j(){k.on({"touchstart.lotteSlider":function(a){m=k.outerWidth(),n=l.outerWidth(),y=!1,z=!1,n>m&&(a.stopPropagation(),o=!0,q=d.getCoordinates(a),p=d.getTransXPos(l),t=Date.now())},"touchmove.lotteSlider":function(a){if(o){var b,c;if(r=d.getCoordinates(a),b=Math.abs(r.x-q.x),c=Math.abs(r.y-q.y),y||(z=b>c,y=!0),z){b>5&&a.preventDefault(),a.stopPropagation();var e=p+r.x-q.x;e>0?e/=3:x>e&&(e=x+(e-x)/3),i(e,0)}}},"touchend.lotteSlider":function(a){if(s=d.getCoordinates(a),o&&q.x!=s.x&&(Math.abs(q.x-s.x)>5&&a.preventDefault(),event.stopPropagation(),y=!1,z)){m=k.outerWidth();var b=d.getTransXPos(l);u=Date.now(),w=q.x>s.x?-1:1,v=u-t;var c=Math.abs(q.x-s.x),e=.4,f=c*e/v,g=b+m*f*w;g>0?g=0:x>g&&(g=x),(Math.abs(b-g)>30||0==g||g==x)&&i(g,500)}},"touchcancel.lotteSlider":function(a){}}),b.element(a).on("resize.lotteSlider orientationchange.lotteSlider",function(){h()})}var k=b.element(e),l=k.find(">").eq(0),m=k.width(),n=l.width(),o=!1,p=0,q=null,r=null,s=null,t=0,u=0,v=0,w=0,x=0;d.lotteSliderMoveXPos=function(a,b){m=k.width(),n=l.width(),a>0?a=0:Math.abs(a)>n-m&&(a=-(n-m)),b||(b=0),i(a,b)},d.reset=function(){o=!1,i(0,0),c(function(){h()})};var y=!1,z=!1;c(function(){h(),j()})}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteSlider","lotteCommFooter","lotteVideo"]);d.controller("ReviewBestCtrl",["$scope","$http","$window","$location","$timeout","LotteCommon","LotteStorage","LotteGA",function(a,c,d,e,f,g,h,i){function j(){f(function(){var a=$(".nav_slider_wrap nav ul li.on").offset().left+$(".nav_slider_wrap nav ul li.on").width(),b=$(document).width();a>b&&$(".ctg_nav ul").css("transform","translateX("+(b-a)+"px)")},300)}function k(a,b){return Math.floor(Math.random()*(b-a))+a}if(a.showWrap=!0,a.contVisible=!0,a.screenID="ReviewBest",a.subTitle="베스트 상품평",a.jsonLoading=!1,a.dummyUrl="http://image.lotte.com/lotte/mo2018/reviews/default_profile.png",a.gaCtgName="MO_베스트 상품평",a.pageUI={tabControl:"first",curCtg:-1,curCtgName:"",loadData:{bestReviewerList:null,bestCtgList:null,categoryList:null},reqParam:{},rekeyword:"",bestBannerInfo:null,bestReviewerBannerInfo:null,bestCtgListRows:0,completeCtgList:!1,bestReviewerPageNum:1,bestReviewerListRows:0,completeReviewerList:!1},a.loadCtgData=function(){a.jsonLoading=!0,c.get(g.reviewCategory).success(function(b){if(b.data&&b.data.categoryList&&b.data.categoryList.items){if(-1===a.pageUI.curCtg){var c=b.data.categoryList.items.length;a.pageUI.curCtg=k(0,c),a.pageUI.curCtgName=b.data.categoryList.items[a.pageUI.curCtg].rnk_sct_cd_nm,j()}a.pageUI.loadData.categoryList=b.data.categoryList,a.pageUI.reqParam.rnk_sct_cd=b.data.categoryList.items[a.pageUI.curCtg].rnk_sct_cd,a.pageUI.reqParam.page=1,a.loadCtgReviewData()}}).error(function(){console.log("Data Error : 카테고리 데이터 로드 실패")})["finally"](function(){})},a.loadCtgReviewData=function(d){a.jsonLoading=!0,c.get(g.reviewBestCtg,{params:a.pageUI.reqParam}).success(function(c){if(c.data){a.bgHeight||(a.bgHeight=parseInt(b.element(document).width()/(a.screenType+1)-15,10)+"px");var e=!1;a.pageUI.loadData.bestCtgList&&(e=!0),d?c.data.review_list&&(a.pageUI.loadData.bestCtgList.items=a.pageUI.loadData.bestCtgList.items.concat(c.data.review_list.items),a.ctgListControl.addCard()):(a.pageUI.bestCtgListRows=0,a.pageUI.loadData.bestCtgList=null,a.pageUI.loadData.totalCnt=c.data.totalCnt,a.pageUI.bestBannerInfo=null,c.data.review_list&&(a.pageUI.loadData.bestCtgList=c.data.review_list)),e&&!d&&a.ctgListControl.reset(),c.data.review_list&&(a.pageUI.bestCtgListRows+=c.data.review_list.total_count),a.pageUI.completeCtgList=!0,!a.pageUI.reqParam.query&&c.data.bestBannerInfo&&c.data.bestBannerInfo.items&&c.data.bestBannerInfo.items.length&&(a.pageUI.bestBannerInfo=c.data.bestBannerInfo)}}).error(function(){console.log("Data Error : 카테고리별 데이터 로드 실패")})["finally"](function(){a.jsonLoading=!1})},a.loadReviewerData=function(b){a.jsonLoading=!0,c.get(g.isTestFlag?"/json/comment/best_reviewer.json":g.reviewBestCtg,{params:{rnk_sct_cd:"R",page:a.pageUI.bestReviewerPageNum}}).success(function(c){c.data&&c.data.review_list&&(b?a.pageUI.loadData.bestReviewerList.items=a.pageUI.loadData.bestReviewerList.items.concat(c.data.review_list.items):(a.pageUI.loadData.bestReviewerList=c.data.review_list,a.pageUI.loadData.totalReviewerCnt=c.data.totalCnt,a.pageUI.bestReviewerBannerInfo=null),a.pageUI.bestReviewerListRows+=c.data.review_list.total_count,a.pageUI.completeReviewerList=!0,c.data.bestBannerInfo&&c.data.bestBannerInfo.items&&c.data.bestBannerInfo.items.length&&(a.pageUI.bestReviewerBannerInfo=c.data.bestBannerInfo))}).error(function(){console.log("Data Error : 리뷰어 데이터 로드 실패")})["finally"](function(){a.jsonLoading=!1})},a.menuClick=function(b,c,d){a.pageUI.rekeyword="",a.pageUI.reqParam.query="",a.pageUI.reqParam.rnk_sct_cd=b,a.pageUI.reqParam.page=1,a.pageUI.curCtg=c,a.pageUI.curCtgName=d,a.loadCtgReviewData(),i.evtTag(a.gaCtgName,"카테고리별_탭클릭",d)},a.searchClick=function(){a.pageUI.reqParam.query=a.pageUI.rekeyword,a.pageUI.reqParam.page=1,a.loadCtgReviewData(),i.evtTag(a.gaCtgName,"카테고리별_검색하기",a.pageUI.curCtgName,a.pageUI.rekeyword)},a.searchKeypress=function(b){13===b.which&&(a.searchClick(),b.preventDefault())},a.resetSearch=function(){a.pageUI.rekeyword="",a.pageUI.reqParam.query="",a.pageUI.reqParam.page=1,a.loadCtgReviewData()},a.addZero=function(a,b){for(var c=a+"",d=b||2;c.length<d;)c="0"+c;return c},null==history.state||"reviewbest"!=history.state.name)location.host.indexOf("localhost")>=0||history.replaceState({name:"reviewbest"},"reviewbest"),"second"==a.pageUI.tabControl?a.loadReviewerData():a.loadCtgData();else{var l=h.getSessionStorage(a.screenID+"Data","json")||"";l&&l.pageUI?(a.revisit=!0,a.bgHeight||(a.bgHeight=parseInt(b.element(document).width()/(a.screenType+1)-15,10)+"px"),f(function(){a.pageUI=l.pageUI;var c=h.getSessionStorage(a.screenID+"ScrollY");f(function(){b.element(d).scrollTop(c),a.revisit=!1},500),j()},800)):"second"==a.pageUI.tabControl?a.loadReviewerData():a.loadCtgData()}b.element(d).on("unload",function(c){var f={};f.pageUI=a.pageUI,h.setSessionStorage(a.screenID+"Loc",e.absUrl()),h.setSessionStorage(a.screenID+"Data",f,"json"),h.setSessionStorage(a.screenID+"ScrollY",b.element(d).scrollTop())})}]),d.directive("lotteContainer",["$window","$timeout","LotteCommon","LotteStorage","LotteGA",function(c,d,e,f,g){return{templateUrl:"/lotte/resources_dev/product/m/review_best_container.html",replace:!0,link:function(f,h,i){f.getCtgListControl=function(a){f.ctgListControl=a},f.tabClick=function(a){if(f.pageUI.tabControl=a,"first"==a){if(g.evtTag(f.gaCtgName,"탭 클릭","카테고리별"),!f.pageUI.reqParam.query&&f.pageUI.loadData.bestCtgList)return void f.ctgListControl.reset();f.pageUI.rekeyword="",f.pageUI.reqParam.query="",f.loadCtgData()}else{if(g.evtTag(f.gaCtgName,"탭 클릭","리뷰어랭킹별"),f.pageUI.loadData.bestReviewerList)return;f.loadReviewerData()}},f.goReviewerHome=function(a,b,c){"first"==f.pageUI.tabControl?g.evtTag(f.gaCtgName,"카테고리별_"+f.pageUI.curCtgName,"리뷰어 클릭_"+f.addZero(b,3),c):g.evtTag(f.gaCtgName,"리뷰어랭킹별","리뷰어 클릭",c),a&&d(function(){location.href=a.indexOf("?")>-1?a+"&"+f.baseParam:"?"+f.baseParam},300)},f.commentDetail=function(a,b,c){"first"==f.pageUI.tabControl?g.evtTag(f.gaCtgName,"카테고리별_"+f.pageUI.curCtgName,"상품평 클릭_"+f.addZero(c,3),a):g.evtTag(f.gaCtgName,"상품평정보","상품평 상세보기",a),d(function(){location.href=e.productSubCommentEach+"?goods_no="+b+"&gdas_no="+a+"&"+f.baseParam},300)},f.goBannerLink=function(a){a&&(c.location.href=a+(a.indexOf("?")>-1?"&":"?")+f.baseParam)},f.positionComplete=function(){console.log("positionComplete"),d(function(){$(".ctg_list .columns > ul > li .text_wrap").css("-webkit-line-clamp","4")},100),d(function(){$(".ctg_list .columns > ul > li .text_wrap").css("-webkit-line-clamp","5")},400)};b.element("body")[0];f.$on("winScroll",function(b,c){f.pageUI&&f.pageUI.loadData&&(f.revisit||("first"!=f.pageUI.tabControl||f.pageUI.loadData.bestCtgList&&!(f.pageUI.bestCtgListRows>=f.pageUI.loadData.totalCnt))&&("second"!=f.pageUI.tabControl||f.pageUI.loadData.bestReviewerList&&!(f.pageUI.bestReviewerListRows>=f.pageUI.loadData.totalReviewerCnt))&&!f.jsonLoading&&$(a).scrollTop()+$(a).height()>=$(document).height()-parseInt($("#footer").height()/2)&&("first"==f.pageUI.tabControl?(f.pageUI.reqParam.page++,f.loadCtgReviewData(!0)):"second"==f.pageUI.tabControl&&(f.pageUI.bestReviewerPageNum++,f.loadReviewerData(!0))))}),f.showReviewOne=function(a,b){g.evtTag(f.gaCtgName,"상품평정보","해당상품평 사진/영상 크게보기"),f.dimmedOpen({callback:f.hideReviewOne,scrollEventFlag:!0}),d(function(){f.sb_review_index=1,f.arrReviewOne=a,$("#lotteDimm").css("z-index","115")},200)},f.hideReviewOne=function(){f.arrReviewOne=[]},f.reviewSwipeCurIdx=0,f.sb_review_index=1,f.swipeReviewEnd=function(a){f.swipeReviewVideoStop(),a!=f.reviewSwipeCurIdx&&(f.sb_review_index=a+1,f.reviewSwipeCurIdx=a)},f.swipeReviewVideoStop=function(){$(".lv_wrap video").each(function(a,b){$(b).siblings(".stop_cover:visible, .click_cover:visible").length>=1&&d(function(){$(b).siblings(".btn_stop").trigger("click")},10)})},f.getReviewSwipeControl=function(a){f.swipeReviewControl=a,f.reviewSwipeCurIdx=f.swipeReviewControl.getIndex()},f.swipeBeforeReview=function(){0===f.reviewSwipeCurIdx?f.reviewSwipeCurIdx=f.arrReviewOne.length:f.reviewSwipeCurIdx--,f.swipeReviewControl.moveIndex(f.reviewSwipeCurIdx),1==f.sb_review_index?f.sb_review_index=f.arrReviewOne.length:f.sb_review_index--},f.swipeNextReview=function(){f.reviewSwipeCurIdx===f.arrReviewOne.length-1?f.reviewSwipeCurIdx=0:f.reviewSwipeCurIdx++,f.swipeReviewControl.moveIndex(f.reviewSwipeCurIdx),f.sb_review_index==f.arrReviewOne.length?f.sb_review_index=1:f.sb_review_index++},f.getFlagStyle=function(a){return a?1==parseInt(a)?{"background-color":"#e6899C"}:parseInt(a)<=10?{"background-color":"#7691c6"}:{}:{}}}}}]),d.filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),d.filter("starScorePolicy",function(){return function(a,b){if(!a)return 0;var d=5,e=Math.ceil(2*a)/2;return b!=c&&(e=e/d*b),e}}),d.directive("lotteMasonry",["$window","$timeout",function(a,d){return{scope:{controlfnc:"=getcontrol",screenType:"@",jsonLoading:"=",endfnc:"="},link:function(e,f,g){function h(a){p&&b.element(f).find(p).css("visibility","hidden"),d(function(){var a=b.element(f).find("img.h_auto").length;q=a?!1:!0,m=b.extend({selector:">ul>li"},g),r={col2:[{height:0,flag:"col1"},{height:0,flag:"col2"}],col3:[{height:0,flag:"col1"},{height:0,flag:"col2"},{height:0,flag:"col3"}],col4:[{height:0,flag:"col1"},{height:0,flag:"col2"},{height:0,flag:"col3"},{height:0,flag:"col4"}]},s=0,o=[],n=3==e.screenType?r.col4:2==e.screenType?r.col3:r.col2,p=m.selector;for(var h=0;h<f.find(p).length;h++)o.push({});b.element(f).find(p).each(function(a){b.element(this).css({height:""}),b.element(this).removeClass("col1").removeClass("col2").removeClass("col3").removeClass("col4");var c=this;q?d(function(){var d=b.element(c).height();l(a,d,c)},300):b.element(this).find("img.h_auto").on("load",function(){b.element(c).find("img.h_auto").off("load"),d(function(){var d=b.element(c).height();l(a,d,c)},300)}).each(function(){this.complete&&b.element(this).trigger("load")})}),e.controlfnc!=c&&e.controlfnc(t)},a)}function i(a){d(function(){for(var a=(b.element(f).find("img.h_auto").length,o.length),c=a;c<f.find(p).length;c++)o.push({});b.element(f).find(p).each(function(c){if(c>=a){var e=this;q?d(function(){var d=b.element(e).height();l(c,d,e,a)},300):b.element(this).find("img.h_auto").on("load",function(){b.element(e).find("img.h_auto").off("load"),d(function(){var d=b.element(e).height();l(c,d,e,a)},300)}).each(function(){this.complete&&b.element(this).trigger("load")})}})},a)}function j(){for(var a=n[0].height,b=n[0],c=1;c<n.length;c++)n[c].height<a&&(a=n[c].height,b=n[c]);return b}function k(){for(var a=n[0].height,b=n[0],c=1;c<n.length;c++)n[c].height>a&&(a=n[c].height,b=n[c]);return b}function l(a,c,d,g){o[a].height=c,o[a].card=d,s++;for(var h=g||0;h<o.length;h++)if(!o[h].finish){for(var i=!0,l=h;l>=0;l--)if(!o[l]||!o[l].height){i=!1;break}if(i){var m=j();b.element(o[h].card).addClass(m.flag),b.element(o[h].card).css({top:m.height+"px",visibility:"visible"}),m.height=m.height+o[h].height,o[h].finish=!0;var n=k();b.element(f).css({height:n.height+"px"})}}s==o.length&&(e.jsonLoading=!1,e.endfnc&&e.endfnc())}var m,n,o,p,q,r={},s=0;h(200),b.element(a).on("orientationchange.lottemasonry",function(a){h(700)});var t={reset:function(){h(0)},addCard:function(){i(300)}}}}}])}(window,window.angular);