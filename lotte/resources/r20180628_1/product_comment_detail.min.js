!function(a,b,c){"use strict";var d=b.module("lotteVideo",[]);d.controller("LotteVideoCtrl",["$scope",function(a){}]),d.directive("lotteVideo",["$window","$timeout","LotteUtil",function(c,d,e){return{controller:"LotteVideoCtrl",link:function(c,f,g,h){function i(){n.src="",d(function(){n.src=j},300),q.appObj.isIOS||n.removeAttribute("controls"),c.movMode=0,c.$apply()}c.movMode=0,c.mute=!1;var j=g.lvSrc,k=g.lvDetailUrl,l=g.lvNoAlert,m=g.lvPoster,n=b.element(f).find("video")[0],o=g.lvTime||2e3;n.setAttribute("poster",m),n.addEventListener("ended",i,!1);var p={play:function(){a.videoStateModel.setPlay(!0,String(9999999*Math.random()))},pause:function(){a.videoStateModel.setPlay(!1)}};n.addEventListener("play",p.play,!1),n.addEventListener("pause",p.pause,!1);var q=e.getAbsScope(c);c.playVideo=function(){if(l||confirm("3G/LTE에서 재생시 데이터 요금이 부과할 수 있으니 유의하세요~")){var a=b.element(document.body).data("play_video")||"";if(a){var e=b.element("#"+a);if(e&&e.length>0){e[0].pause();var g=e.scope();g.movMode=0}}c.movMode=1,n.src||(n.src=j),n.play(),b.element(document.body).data("play_video",b.element(n).attr("id")),d(function(){1==c.movMode&&$(f).find(".btns").fadeOut(600,function(){c.movMode=2,$(this).attr("style",""),c.$apply()})},o)}},c.clickCover=function(){c.movMode=1,d(function(){1==c.movMode&&$(f).find(".btns").fadeOut(600,function(){c.movMode=2,$(this).attr("style",""),c.$apply()})},o)},c.stopVideo=function(){n.pause(),c.movMode=0},c.muteVideo=function(){n.muted?(c.mute=!1,n.muted=!1):(c.mute=!0,n.muted=!0)},c.fullVideo=function(){n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.webkitEnterFullscreen&&n.webkitEnterFullscreen(),q.appObj.isIOS||n.setAttribute("controls","controls")},c.goDetailPage=function(){location.href=k},b.element(f).find("video").bind("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(a){var b=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen,d=b?"FullscreenOn":"FullscreenOff";"FullscreenOff"==d&&(c.stopVideo(),q.appObj.isIOS||n.removeAttribute("controls"),c.$apply())})}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("product-sub-header",[]);d.directive("productSubHeader",["$http","$timeout","$window","$location","LotteCommon","LotteCookie","LotteStorage","LotteUtil",function(a,b,c,d,e,f,g,h){return{templateUrl:"/lotte/resources_dev/product/m/sub/product_sub_header.html",replace:!0,link:function(a,b,c){a.gotoPrepage=function(){a.jsonLoading=!0,a.sendTclick("m_RDC_header_new_pre"),a.appObj.isNativeHeader?appSendBack():history.go(-1)}}}}]),"undefined"!=typeof module&&module.exports&&(module.exports=d.name)}(window,window.angular),angular.module("ngPinchZoom",[]).directive("ngPinchZoom",function(){function a(a,b,c){function d(a){var b=a.originalEvent?a.originalEvent.touches:a.touches;y=b[0].clientX,z=b[0].clientY,u=s,v=t,A=0,B=0}function e(a){var c=a.originalEvent?a.originalEvent.touches:a.touches;""===l&&(1===c.length&&o>1?l="swipe":2===c.length&&(l="pinch",q=o,n=g(c),w=c[0].clientX-parseInt((c[0].clientX-c[1].clientX)/2,10)-b[0].offsetLeft-u,x=c[0].clientY-parseInt((c[0].clientY-c[1].clientY)/2,10)-b[0].offsetTop-v)),"swipe"===l?E||(a.preventDefault(),A=c[0].clientX-y,B=c[0].clientY-z,s=u+A,t=v+B,h()):"pinch"===l&&(a.preventDefault(),m=g(c),p=m/n,o=p*q,s=w*(1-p)+u+A,t=x*(1-p)+v+B,h())}function f(a){var b=a.originalEvent?a.originalEvent.touches:a.touches;""===l||b.length>0||(E?(o=1,s=0,t=0):1>o?(o=1,s=0,t=0):o>r?(o=r,p=o/q,s=w*(1-p)+u+A,t=x*(1-p)+v+B):(s>0?s=0:j*(1-o)>s&&(s=j*(1-o)),t>0?t=0:k*(1-o)>t&&(t=k*(1-o))),h(.1),l="")}function g(a){var b=Math.sqrt(Math.pow(a[0].clientX-a[1].clientX,2)+Math.pow(a[0].clientY-a[1].clientY,2));return parseInt(b,10)}function h(a){var c=a?"all cubic-bezier(0,0,.5,1) "+a+"s":"",d=[o,0,0,o,s,t],e="matrix("+d.join(",")+")";b.css({"-webkit-transition":c,transition:c,"-webkit-transform":e+" translate3d(0,0,0)",transform:e})}function i(){o=1,s=0,t=0,h(.1),l=""}console.log("pinch zoom -----");var j,k,l="",m=0,n=0,o=1,p=1,q=1,r=parseInt(c.maxScale,10);(isNaN(r)||1>=r)&&(r=3);var s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=new Image;C.onload=function(){j=b[0].clientWidth,k=b[0].clientHeight,b.css({"-webkit-transform-origin":"0 0","transform-origin":"0 0"}),b.on("touchstart",d),b.on("touchmove",e),b.on("touchend",f),b.on("resetPinch",i)};var D=c.ngSrc?c.ngSrc:c.src;a.isValidString(D)&&(C.src=D);var E=c.isSwiper}var b={restrict:"A",scope:!1,link:a};return b}),function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","product-sub-header","ngPinchZoom","lotteVideo"]);d.controller("ProductCommentDetailCtrl",["$window","$http","$scope","$timeout","$compile","$rootScope","LotteCommon","commInitData",function(a,b,c,d,e,f,g,h){function i(a){var b={};b.photoItems=[];for(var d=0,e=0;e<a.critList.items.length;e++){var f=a.critList.items[e];if(f.photoList&&f.photoList.items.length>0)if(f.videoUrl){var g={};g.critTpCd=f.critTpCd,g.videoUrl=f.videoUrl,g.wrtrId=f.wrtrId,g.wrtrTpNm=f.wrtrTpNm,g.gdasTpNm=f.gdasTpNm,g.critPnt=f.critPnt,g.regDate=f.regDate,g.critCont=f.critCont,g.total=f.photoList.items.length,g.imgMain=f.photoList.items[0].imgUrl,g.gdasNo=f.gdasNo;var h=0;f.easnGdasList&&f.easnGdasList.items&&(g.reviewList=f.easnGdasList.items),b.photoItems.push(g),c.pageUI.gdasNo==g.gdasNo&&c.pageUI.imgIdx==h&&(j=d),h++,d++}else for(var h=0,i=0;i<f.photoList.items.length;i++){var k={};k.critTpCd=f.critTpCd,k.videoUrl=f.videoUrl,k.wrtrId=f.wrtrId,k.wrtrTpNm=f.wrtrTpNm,k.gdasTpNm=f.gdasTpNm,k.critPnt=f.critPnt,k.regDate=f.regDate,k.critCont=f.critCont,k.total=f.photoList.items.length,k.imgMain=f.photoList.items[0].imgUrl,k.gdasNo=f.gdasNo,f.easnGdasList&&f.easnGdasList.items&&(k.reviewList=f.easnGdasList.items),k.imgUrl=f.photoList.items[i].imgUrl,b.photoItems.push(k),c.pageUI.gdasNo==k.gdasNo&&c.pageUI.imgIdx==h&&(j=d),h++,d++}}return b}c.showWrap=!0,c.contVisible=!0,c.productSubTitle="사진/영상 크게보기",c.screenID="product_comment_detail",c.jsonLoading=!1,c.pageUI={gdasNo:null,baseParam:c.baseParam,curIdx:0,imgIdx:0,loadData:{photoItems:[]},reqParam:{}},c.pageUI.reqParam.goods_no=h.query.goods_no?h.query.goods_no:"",c.pageUI.reqParam.usm_goods_no=h.query.usm_goods_no?h.query.usm_goods_no:"",c.pageUI.reqParam.photoview="Y",c.pageUI.reqParam.tot_cnt=h.query.tot_cnt?h.query.tot_cnt:"1",c.pageUI.gdasNo=h.query.gdas_no?h.query.gdas_no:null,c.pageUI.imgIdx=h.query.id?h.query.id:null;var j=0;c.loadData=function(){c.jsonLoading=!0,b.get(g.prodSubCommentImageData,{params:c.pageUI.reqParam}).success(function(a){a.data&&(c.pageUI.loadData=i(a.data),d(function(){c.reviewSwipeCurIdx=parseInt(j,10),c.swipeReviewControl.moveIndex(c.reviewSwipeCurIdx)},500))}).error(function(){console.log("Data Error : 상품평 상세보기 데이터 로드 실패")})["finally"](function(){c.jsonLoading=!1})},c.loadData(),c.reviewSwipeCurIdx=0,c.sb_review_index=1,c.swipeReviewEnd=function(a){c.swipeReviewVideoStop(),c.sb_review_index=a+1},c.swipeReviewVideoStop=function(){$(".lv_wrap video").each(function(a,b){$(b).siblings(".stop_cover:visible, .click_cover:visible").length>=1&&d(function(){$(b).siblings(".btn_stop").trigger("click")},10)})},c.getReviewSwipeControl=function(a){c.swipeReviewControl=a,c.reviewSwipeCurIdx=c.swipeReviewControl.getIndex()},c.swipeBeforeReview=function(){0===c.reviewSwipeCurIdx?c.reviewSwipeCurIdx=c.pageUI.loadData.photoItems.length:c.reviewSwipeCurIdx--,c.swipeReviewControl.moveIndex(c.reviewSwipeCurIdx),1==c.sb_review_index?c.sb_review_index=c.pageUI.loadData.photoItems.length:c.sb_review_index--},c.swipeNextReview=function(){c.reviewSwipeCurIdx===c.pageUI.loadData.photoItems.length-1?c.reviewSwipeCurIdx=0:c.reviewSwipeCurIdx++,c.swipeReviewControl.moveIndex(c.reviewSwipeCurIdx),c.sb_review_index==c.pageUI.loadData.photoItems.length?c.sb_review_index=1:c.sb_review_index++},c.productCommentDetailOne=function(a){location.href="/product/m/sub/product_comment_each.do?"+c.baseParam+"&goods_no="+c.pageUI.reqParam.goods_no+"&gdas_no="+a}}]),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/product/m/sub/product_comment_detail_container.html",replace:!0,link:function(a,b,c){a.isShowBtnTalk=!1}}}),d.filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),d.filter("starScorePolicy",function(){return function(a,b){if(!a)return 0;var d=5,e=Math.ceil(2*a)/2;return b!=c&&(e=e/d*b),e}})}(window,window.angular);