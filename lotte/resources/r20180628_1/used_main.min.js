angular.module("ngPinchZoom",[]).directive("ngPinchZoom",function(){function a(a,b,c){function d(a){var b=a.originalEvent?a.originalEvent.touches:a.touches;y=b[0].clientX,z=b[0].clientY,u=s,v=t,A=0,B=0}function e(a){var c=a.originalEvent?a.originalEvent.touches:a.touches;""===l&&(1===c.length&&o>1?l="swipe":2===c.length&&(l="pinch",q=o,n=g(c),w=c[0].clientX-parseInt((c[0].clientX-c[1].clientX)/2,10)-b[0].offsetLeft-u,x=c[0].clientY-parseInt((c[0].clientY-c[1].clientY)/2,10)-b[0].offsetTop-v)),"swipe"===l?E||(a.preventDefault(),A=c[0].clientX-y,B=c[0].clientY-z,s=u+A,t=v+B,h()):"pinch"===l&&(a.preventDefault(),m=g(c),p=m/n,o=p*q,s=w*(1-p)+u+A,t=x*(1-p)+v+B,h())}function f(a){var b=a.originalEvent?a.originalEvent.touches:a.touches;""===l||b.length>0||(E?(o=1,s=0,t=0):1>o?(o=1,s=0,t=0):o>r?(o=r,p=o/q,s=w*(1-p)+u+A,t=x*(1-p)+v+B):(s>0?s=0:j*(1-o)>s&&(s=j*(1-o)),t>0?t=0:k*(1-o)>t&&(t=k*(1-o))),h(.1),l="")}function g(a){var b=Math.sqrt(Math.pow(a[0].clientX-a[1].clientX,2)+Math.pow(a[0].clientY-a[1].clientY,2));return parseInt(b,10)}function h(a){var c=a?"all cubic-bezier(0,0,.5,1) "+a+"s":"",d=[o,0,0,o,s,t],e="matrix("+d.join(",")+")";b.css({"-webkit-transition":c,transition:c,"-webkit-transform":e+" translate3d(0,0,0)",transform:e})}function i(){o=1,s=0,t=0,h(.1),l=""}console.log("pinch zoom -----");var j,k,l="",m=0,n=0,o=1,p=1,q=1,r=parseInt(c.maxScale,10);(isNaN(r)||1>=r)&&(r=3);var s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=new Image;C.onload=function(){j=b[0].clientWidth,k=b[0].clientHeight,b.css({"-webkit-transform-origin":"0 0","transform-origin":"0 0"}),b.on("touchstart",d),b.on("touchmove",e),b.on("touchend",f),b.on("resetPinch",i)};var D=c.ngSrc?c.ngSrc:c.src;a.isValidString(D)&&(C.src=D);var E=c.isSwiper}var b={restrict:"A",scope:!1,link:a};return b}),function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteSns","lotteCommFooter","ngPinchZoom"]);d.controller("UsedMainCtrl",["$http","$scope","LotteCommon","$window","LotteStorage","$timeout","commInitData","$location","LotteGA",function(d,e,f,g,h,i,j,k,l){function m(){n>=768?e.screenData.isTab=!0:e.screenData.isTab=!1,e.photo_con_width=(n-32)/2-8,1024>n?e.photo_width=290:e.photo_width=400}e.showWrap=!0,e.contVisible=!0,e.subTitle="#중고라운지",e.screenID="중고라운지",e.pageLoading=!0,e.photo_width=290,(e.screenDataReset=function(){e.screenData={isTab:!1,dispNo:j.query.dispNo,subCateName:"전체",page:0,pageSize:20,pageEnd:!1,data:null,storedLoc:null,storedScrollY:0,myList:"N",keyword:"",ctgDispNo:j.query.ctgDispNo}})(),e.screenData.dispNo==c&&(e.screenData.dispNo="5618795"),e.screenData.ctgDispNo==c&&(e.screenData.ctgDispNo=""),e.popOption={open:!1,data:"",cnt:0,close:function(){e.popOption.open=!1},show:function(){e.popOption.open=!0},next:function(){e.popOption.cnt++,e.popOption.cnt>e.popOption.length-1&&(e.popOption.cnt=0)},prev:function(){e.popOption.cnt--,e.popOption.cnt<0&&(e.popOption.cnt=e.popOption.length-1)}},e.use_pop_show=!1,e.showInfoPop=function(){e.gatag(0,"책임 고지 안내"),e.use_pop_show=!0};var n=b.element(g).width();e.log="v.0.002",b.element(g).on("resize.used",function(a){n!=b.element(g).width()&&(n=b.element(g).width(),m())}),m(),e.selectCate=function(a,b,c){e.screenDataReset(),m(),e.screenData.ctgDispNo=a,e.screenData.subCateName=b,e.gatag(1,"",c),e.loadData()},e.selectSearch=function(a){if("search"==a&&(""==e.screenData.keyword||e.screenData.keyword==c||e.screenData.keyword.length<=1))return void alert("검색어를 입력하세요");var b=e.screenData.keyword;e.screenData.page=0,e.screenData.keyword=b,"Y"==e.screenData.data.mbrCertYn&&($("#my_csh")[0].checked?e.screenData.myList="Y":e.screenData.myList="N"),e.loadData()},e.loadData=function(){e.screenData.pageEnd&&0!=e.screenData.page||(e.pageLoading=!0,e.screenData.page++,$.ajax({type:"POST",url:f.used_main,dataType:"json",data:{dispNo:e.screenData.dispNo,ctgDispNo:e.screenData.ctgDispNo,page:e.screenData.page,myBoard:e.screenData.myList,sort:e.screenData.keyword,mbrNo:e.loginInfo.mbrNo},success:function(a){1==e.screenData.page?e.screenData.data=a.board_main:null==a.board_main.boardListInfo?e.screenData.pageEnd=!0:e.screenData.data.boardListInfo.boardList.items=e.screenData.data.boardListInfo.boardList.items.concat(a.board_main.boardListInfo.boardList.items),null!=a.board_main.boardListInfo&&e.screenData.data.boardListInfo.boardList.items.length==e.screenData.data.boardListInfo.maxCount&&(e.screenData.pageEnd=!0),e.pageLoading=!1}}))},i(function(){e.loadData()},100);var o=b.element(g),p=(b.element("body"),o.height());b.element(g).on("scroll",function(a){e.screenData.data&&"Y"==e.screenData.data.mbrCertYn&&$(".cate_box")&&(o.scrollTop()>=$(".cate_box").offset().top-155?($(".addbtn_box").addClass("fix"),$(".cate_box").addClass("fix")):($(".addbtn_box").removeClass("fix"),$(".cate_box").removeClass("fix"))),e.screenData.pageEnd||e.pageLoading||$("#footer").offset().top<o.scrollTop()+p&&e.loadData()}),e.viewPhoto=function(a,b){e.gatag(2,"이미지_",b+1),e.popOption.cnt=b,e.popOption.data=a,e.popOption.show()},e.loadReply=function(a){var b={method:"get",url:f.used_reply_list,params:{bbcNo:a.bbcNo}};d(b).success(function(b){a.reply_list=[],setTimeout(function(){a.reply_list=b.reply_info.items,a.rplCnt=b.reponse_cnt,a.more=!0},100)}).error(function(a){console.log(a)})},e.reply_write=function(a,b,d){if(e.used_logincheck()){var g="",h="",i=null,j=null;if(null==b?(g=a.insstr,h=a.inscheck?"Y":"N"):"edit"==d?(g=b.rplCont,i=b.rplNo,j=b.uprRplNo):(g=b.insstr,j=b.rplNo),g==c||""==g)return void alert("내용을 입력하세요");$.ajax({type:"POST",url:f.used_reply_write,dataType:"json",data:{bbcNo:a.bbcNo,uprRplNo:j,rplNo:i,scrtRplUseYn:h,rplCont:g,mod_flag:d},success:function(c){alert(c.reply_write.response_msg),"0000"==c.reply_write.response_code&&(e.loadReply(a),a.insstr="",b&&(b.insstr=""),a.inscheck=!1)}})}},e.reply_delete=function(a,b,c){console.log("delete :",a),confirm("해당 글을 삭제하시겠습니까?")&&$.ajax({type:"POST",url:f.used_reply_delete,dataType:"json",data:{bbcNo:b.bbcNo,rplNo:a,dpthNo:c},success:function(a){alert(a.reply_delete.response_msg),"0000"==a.reply_delete.response_code&&e.loadReply(b)}})},e.board_delete=function(a,b){confirm("해당 판매 글을 삭제하시겠습니까?")&&$.ajax({type:"POST",url:f.used_delete,dataType:"json",data:{mbrNo:e.loginInfo.mbrNo,bbcNo:a.bbcNo},success:function(a){a=a.board_delete,a.response_msg&&alert(a.response_msg),"0000"==a.response_code&&e.screenData.data.boardListInfo.boardList.items.splice(b,1)}})},e.board_edit=function(a){var b="";if(null!=a){b="mode=edit&",a.cellNo=e.base64Decode(a.cellNo);var c=a.bbcCont;c=c.replace(/(<br>)/gi,"\r\n"),c=c.replace(/(<br\/>)/gi,""),a.bbcCont=c}var d={ctgList:e.screenData.data.ctgList.items,item:a};h.setSessionStorage("used_mall_edit_item",d,"json"),e.gatag(0,"판매글 등록하기"),i(function(){location.href=f.used_write_link+"?"+b+e.baseParam},100)},e.recommend=function(a){if(e.used_logincheck()){if("Y"==a.modYn)return void alert("본인이 작성한 글은 추천 할 수 없습니다");$.ajax({type:"POST",url:f.used_recommend,dataType:"json",data:{tgtNo:a.bbcNo,tgtTpCd:"10"},success:function(b){b=b.data,"0000"==b.response_code?(a.recommCnt=b.response_cnt,a.recommYn="Y"):alert(b.response_msg)}})}},e.dcl=function(a){if(e.used_logincheck()){if("Y"==a.modYn)return void alert("본인이 작성한 글은 신고 할 수 없습니다");confirm("해당 판매글을 신고하시겠습니까?")&&$.ajax({type:"POST",url:f.used_declare,dataType:"json",data:{tgtNo:a.bbcNo,tgtTpCd:"10"},success:function(b){b=b.data,alert(b.response_msg),"0000"==b.response_code&&(a.dclCnt=b.response_cnt,a.dclYn="Y")}})}},e.used_logincheck=function(){var a=!0;if(!e.loginInfo.isLogin){alert("로그인 후 참여하실 수 있습니다.");var b="&targetUrl="+encodeURIComponent(g.location.href,"UTF-8");g.location.href=f.loginUrl+"?"+e.baseParam+b,a=!1}return a},e.scroll_reply=function(b){$(a).scrollTop($("#unit_"+b).offset().top)},e.gatag=function(a,b,c){var d=["타이틀 영역",e.screenData.subCateName,e.screenData.subCateName+"_상품"];c&&(b=10>c?b+"0"+c:b+""+c),l.evtTag("MO_중고라운지",d[a],b,"","")},e.base64Decode=function(a){var b,c;b=new Array,c=new Array;var d;for(d=0;26>d;d++)b[b.length]=String.fromCharCode(65+d);for(d=0;26>d;d++)b[b.length]=String.fromCharCode(97+d);for(d=0;10>d;d++)b[b.length]=String.fromCharCode(48+d);for(b[b.length]="+",b[b.length]="/",d=0;128>d;d++)c[c.length]=-1;for(d=0;64>d;d++)c[b[d].charCodeAt(0)]=d;var e=0,f=0,g=0,h=0,d=0,i=0,j=a.split(""),k="",l=0;do h=j[l++].charCodeAt(0),d=c[h],h>=0&&128>h&&-1!=d&&(i%4==0?e=d<<2:i%4==1?(e|=d>>4,f=(15&d)<<4):i%4==2?(f|=d>>2,g=(3&d)<<6):g|=d,i++,i%4==0&&(k+=String.fromCharCode(e)+String.fromCharCode(f)+String.fromCharCode(g)));while("undefined"!=typeof j[l]);return k+=i%4==3?String.fromCharCode(e)+String.fromCharCode(f):i%4==2?String.fromCharCode(e):""}}]),d.filter("base64Decode",[function(){return function(a){return getScope().base64Decode(a)}}]),d.directive("orientable",function(){return{link:function(a,b,c){b.bind("load",function(b){a.imageSize={width:this.width,height:this.height}})}}}),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/mall/used_main_container.html",replace:!0,link:function(a,b,c){}}})}(window,window.angular);