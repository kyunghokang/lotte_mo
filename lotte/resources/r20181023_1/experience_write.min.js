function calcBytes(a){var b=0;for(i=0;i<a.length;i++){var c=a.charAt(i);escape(c).length>4?b+=2:"\n"==c?"\r"!=a.charAt(i-1)&&(b+=1):b+="<"==c||">"==c?4:1}return b}function maxLengthCheck(a,b,c,d){var e,f,g=c.value.length,h=parseInt(a),i="",j=0;if(0==g)null!=document.getElementById("spn_input_char")&&(document.getElementById("spn_input_char").innerText=h);else for(k=0;k<g;k++){if(e=c.value.charAt(k),"\n"==e&&j++,escape(e).length>4?h-=2:h--,0>h){alert("총 한글 "+a/2+"자 영문 "+a+"자 까지 쓰실 수 있습니다."),c.value=i;break}if(null!=b&j>parseInt(b)){alert("라인수 "+b+"라인을 넘을 수 없습니다."),j=0,f=i.length-1,c.value=i.substring(0,f);break}null!=document.getElementById("spn_input_char")&&(document.getElementById("spn_input_char").innerText=h),i+=e}}!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter"]);d.controller("ExperienceWriteCtrl",["$http","$scope","LotteCommon","LotteCookie","LotteUtil","commInitData","$timeout","LotteForm","$window",function(d,e,f,g,h,i,j,k,l){function m(){return!0}function n(){d.get(f.kidsExperienceReviewData+"?evt_no="+e.evtNo).success(function(a){e.evtData=a.tester_evt,e.addressDefaultData=a.user_addr_info.default_addr,e.addressList=a.user_addr_info.addr_list,e.select_addr=a.user_addr_info.addr_list[0],e.dlvp_sn=a.user_addr_info.addr_list[0].dlvp_sn,e.input.login_id=a.tester_evt.login_id,e.input.login_id=a.tester_evt.login_id,e.input.mbr_email=a.tester_evt.mbr_email,e.input.mbr_nm=a.tester_evt.mbr_nm,e.input.mbr_no=a.tester_evt.mbr_no,e.input.site_no="1",r=f.changeMyInfoUrl+"?sid="+p+"&returnurl="+q+"&custid="+e.evtData.seedCustId+"&loginid="+g.getCookie("LOGINID")+"&pageflag=I&opentype=P&sch="+e.schema}).error(function(a){ajaxResponseErrorHandler(a)})}e.showWrap=!0,e.contVisible=!0,e.subTitle="체험단 신청서",e.selectAddressIndex=0,e.PopAgreeFlag=!1,e.PopApplyFlag=!1,e.isNewestApp=m(),e.isKidsApp=!1;var o=g.getCookie("SIMPLESIGNYN"),p=h.getLoginSeed().toUpperCase(),q="";q=""==e.schema?encodeURIComponent(a.location.href,"UTF-8"):a.location.href.replace(/^http(s)?/,e.schema);var r;i.query.evt_no!=c&&(e.evtNo=i.query.evt_no),i.query.isKidsApp&&(e.isKidsApp="Y"==i.query.isKidsApp?!0:!1),e.isKidsApp&&b.element(document).ready(function(){j(function(){if(e.appObj.isApp){var a=b.element(".appPhotoArea");if(e.appObj.isAndroid)try{l.lottepetswag.callAndroid("swag://position?top="+a.offset().top)}catch(c){}else location.href="swag://position?top="+a.offset().top,console.log("SEND APP TOP POSI",a.offset().top)}},200)}),e.attachImage=function(){e.appObj.isApp?location.href="ghost://CommentWithPhoto":confirm("롯데닷컴 앱에서 이용 가능합니다. 지금 설치하시겠습니까?")&&(location.href=f.appDown+"?"+e.baseParam)},e.input={},e.input.kids_tit="",e.input.writeTxt="",e.cancel=function(){confirm("체험단 신청서 작성을 취소하시겠습니까?")&&location.replace(f.kidsExperienceMainUrl+"?"+e.baseParam)},e.agreeSave=function(){if(null==e.loginInfo||!e.loginInfo.isLogin){var a="targetUrl="+encodeURIComponent(location.href,"UTF-8");return void(location.href="/login/m/loginForm.do?"+a)}if(e.loginInfo.isSimple)return void alert("응모 가능 회원구분이 아닙니다.\nL.POINT 통합 회원으로 가입해주세요.");if(!e.addressDefaultData||e.addressDefaultData.addr1.indexOf("입력해주세요")>0)return void alert("기본배송지를 먼저 설정해주세요.\n(PC 마이롯데 > '배송지/회원정보 관리' 에서 설정 가능)");var b=e.input.kids_tit,c=document.querySelector("#kidsTitle"),d=e.input.writeTxt,f=document.querySelector("#writeTxt");return 0==b.trim().length?(alert("제목을 작성해주세요."),c.focus(),!1):calcBytes(b)<6?(alert("제목을 한글 3자 이상 입력하세요."),c.focus(),!1):0==d.trim().length?(alert("사연 내용을 작성해 주세요."),f.focus(),!1):calcBytes(d)<20?(alert("사연 내용을 한글 10자 이상 입력하세요."),f.focus(),!1):calcBytes(d)>2e3?(alert("사연 내용은 1000자 [한글기준] 이내로 제한되어 있습니다."),f.focus(),!1):void(e.appObj.isApp&&e.isKidsApp?e.save():e.popupAgree())},e.kidsAgreeOk=function(){e.save()},a.kidsAgreeOk=e.kidsAgreeOk,e.kidsMainGo=function(){j(function(){location.replace(f.kidsExperienceMainUrl+"?"+e.baseParam)},200)},a.kidsMainGo=e.kidsMainGo,e.save=function(){if(e.appObj.isApp&&e.isKidsApp){var a="kids://writeKids";return a+="?bbc_tit_nm="+encodeURIComponent(e.input.kids_tit),a+="&bbc_fcont="+encodeURIComponent(e.input.writeTxt),a+="&dlvp_sn="+encodeURIComponent(e.dlvp_sn),a+="&evt_no="+e.evtNo,a+="&loginId="+e.input.login_id,a+="&mbrNo="+e.input.mbr_no,a+="&mbrNm="+e.input.mbr_nm,a+="&mbrEmail="+e.input.mbr_email,a+="&site_no="+e.input.site_no,a+="&imageServerURL=/mobile/evtTesterImgParamReq.lotte",e.isNewestApp||(a+="&radio1=",a+="&radio2=",a+="&radio3=",a+="&radio4=",a+="&radio5=",a+="&radio6=",a+="&check_cont=",a+="&img_no=",a+="&img_file_1=",a+="&img_file_2=",a+="&img_file_3=",a+="&img_file_4=",a+="&img_path_1=",a+="&img_path_2=",a+="&img_path_3=",a+="&img_path_4=",a+="&prdt_clor_eval_desc=",a+="&prdt_size_eval_desc=",a+="&use_flag=",a+="&wrtr_pur_dt="),void j(function(){location.href=a,e.oldIOSAppChk()},200)}return!1},e.oldIOSAppChk=function(){e.appObj.isIOS&&(!e.appObj.isSuperApp&&e.appObj.verNumber<4180||e.appObj.isSuperApp&&e.appObj.verNumber<4170)&&j(function(){alert("응모 완료 되셨습니다."),l.location.href=f.kidsExperienceMainUrl+"?"+e.baseParam},500)},e.popupClose=function(){e.dimmedClose()},e.popupAgree=function(){var a={evt_no:e.evtNo,bbc_tit_nm:e.input.kids_tit,bbc_fcont:e.input.writeTxt,dlvp_sn:e.dlvp_sn};$.ajax({type:"post",async:!1,url:f.kidsExperienceApplySave,data:a,success:function(a){a.indexOf("0000")>-1?(e.PopApplyFlag=!0,e.dimmedOpen({target:"kids_pop",callback:this.popupClose}),b.element(".write").removeClass("on")):a.indexOf("dup.err")>-1&&(alert("이미 신청하셨습니다."),e.PopApplyFlag=!1)}})},e.popupClose2=function(){location.replace(f.kidsExperienceMainUrl+"?"+e.baseParam)},n(),e.memeberChange=function(){if(e.loginInfo.isLogin){if("Y"==o)return alert("간편회원의 정보변경은 PC에서만 가능합니다."),!1;outLink(r),e.PopApplyFlag=!1,e.kidsMainGo()}else alert("로그인 후 이용 가능합니다.")},a.memeberChange=e.memeberChange}]),d.directive("lotteContainer",["$timeout","LotteCommon","$window",function(a,b,c){return{templateUrl:"/lotte/resources_dev/event/m/kids/experience_write_container.html",replace:!0,link:function(a,d,e){a.AddrinfoDefault=!0,a.AddrList=!1,a.selectAddress=function(){a.selectAddressIndex>=0&&(a.add_name=a.addressList[a.selectAddressIndex].addr_name,a.r_name=a.addressList[a.selectAddressIndex].r_name,a.addr1=a.addressList[a.selectAddressIndex].addr1,a.addr2=a.addressList[a.selectAddressIndex].addr2,a.addr_tel=a.addressList[a.selectAddressIndex].addr_tel,a.dlvp_sn=a.addressList[a.selectAddressIndex].dlvp_sn,a.AddrinfoDefault=!1,a.AddrList=!0)},a.goEvtMainClick=function(){c.location.href=b.kidsExperienceMainUrl+"?"+a.baseParam}}}}])}(window,window.angular);var ajaxResponseErrorHandler=function(a,b){if(a.error){var c=a.error.response_code,d=a.error.response_msg;if("9004"==c){var e="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href="/login/m/loginForm.do?"+e}else alert("["+c+"] "+d)}else alert("처리중 오류가 발생하였습니다.");b&&b()};