!function(a,b,c){"use strict";var d=b.module("lotteVideo",[]);d.controller("LotteVideoCtrl",["$scope",function(a){}]),d.directive("lotteVideo",["$window","$timeout","LotteUtil",function(c,d,e){return{controller:"LotteVideoCtrl",link:function(c,f,g,h){function i(){n.src="",d(function(){n.src=j},300),q.appObj.isIOS||n.removeAttribute("controls"),c.movMode=0,c.$apply()}c.movMode=0,c.mute=!1;var j=g.lvSrc,k=g.lvDetailUrl,l=g.lvNoAlert,m=g.lvPoster,n=b.element(f).find("video")[0],o=g.lvTime||2e3;n.setAttribute("poster",m),n.addEventListener("ended",i,!1);var p={play:function(){a.videoStateModel.setPlay(!0,String(9999999*Math.random()))},pause:function(){a.videoStateModel.setPlay(!1)}};n.addEventListener("play",p.play,!1),n.addEventListener("pause",p.pause,!1);var q=e.getAbsScope(c);c.playVideo=function(){if(l||confirm("3G/LTE에서 재생시 데이터 요금이 부과할 수 있으니 유의하세요~")){var a=b.element(document.body).data("play_video")||"";if(a){var e=b.element("#"+a);if(e&&e.length>0){e[0].pause();var g=e.scope();g.movMode=0}}c.movMode=1,n.src||(n.src=j),n.play(),b.element(document.body).data("play_video",b.element(n).attr("id")),d(function(){1==c.movMode&&$(f).find(".btns").fadeOut(600,function(){c.movMode=2,$(this).attr("style",""),c.$apply()})},o)}},c.clickCover=function(){c.movMode=1,d(function(){1==c.movMode&&$(f).find(".btns").fadeOut(600,function(){c.movMode=2,$(this).attr("style",""),c.$apply()})},o)},c.stopVideo=function(){n.pause(),c.movMode=0},c.muteVideo=function(){n.muted?(c.mute=!1,n.muted=!1):(c.mute=!0,n.muted=!0)},c.fullVideo=function(){n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.webkitEnterFullscreen&&n.webkitEnterFullscreen(),q.appObj.isIOS||n.setAttribute("controls","controls")},c.goDetailPage=function(){location.href=k},b.element(f).find("video").bind("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(a){var b=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen,d=b?"FullscreenOn":"FullscreenOff";"FullscreenOff"==d&&(c.stopVideo(),q.appObj.isIOS||n.removeAttribute("controls"),c.$apply())})}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("product-sub-header",[]);d.directive("productSubHeader",["$http","$timeout","$window","$location","LotteCommon","LotteCookie","LotteStorage","LotteUtil",function(a,b,c,d,e,f,g,h){return{templateUrl:"/lotte/resources_dev/product/m/sub/product_sub_header.html",replace:!0,link:function(a,b,c){a.gotoPrepage=function(){a.jsonLoading=!0,a.sendTclick("m_RDC_header_new_pre"),a.appObj.isNativeHeader?appSendBack():history.go(-1)}}}}]),"undefined"!=typeof module&&module.exports&&(module.exports=d.name)}(window,window.angular),function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","product-sub-header","lotteVideo"]);d.controller("ProductCommentCtrl",["$http","$window","$scope","$timeout","$compile","LotteCommon","orderByFilter","commInitData","LotteUtil","LotteGA",function(a,d,e,f,g,h,i,j,k,l){function m(a,b,d){return a!=c&&null!=a&&""!=a&&(a=a.split(b).join(d)),a}function n(a){return 10>a?"0"+a:a}e.showWrap=!0,e.contVisible=!0,e.productSubTitle="전체 상품평보기",e.screenID="product_comment",e.goodsNo=j.query.goods_no,e.jsonLoading=!1,e.gaCtgName="MO_상품상세_전체상품평보기",e.alert=function(a){d.alert(a)},e.consolelog=function(a){console.log(a)},e.rScope=getScope(),e.pageUI={page:1,isLastPage:!1,starScoreOpen:!1,customerSatisOpen:!0,filterOption:{sliderOpen:!1,filter1Open:!0,filter1SelVal:0,filter1Names:["고객추천순","리뷰어랭킹순","최근상품평순","높은평점순","낮은평점순"],filter2Open:!0,filter2SelVal:6,filter2Names:["전체","5점","4점","3점","2점","1점"],media_yn:"N"},reqParam:{},loadData:null,filteredItems:[]},e.dummyUrl="http://image.lotte.com/lotte/mo2018/reviews/default_profile.png",e.pageUI.reqParam.goods_no=j.query.goods_no?j.query.goods_no:"",e.pageUI.reqParam.usm_goods_no=j.query.usm_goods_no?j.query.usm_goods_no:"",e.pageUI.reqParam.page=j.query.page?j.query.page:1,e.pageUI.reqParam.all_view_yn="Y",e.pageUI.reqParam.sort="R",e.pageUI.reqParam.star="",e.loadData=function(){e.pageUI.reqParam.page=e.pageUI.page;var b=h.isTestFlag?"/json/product/comment_all_"+e.pageUI.reqParam.goods_no+".json":h.productCommentDataNew;e.ajaxLoadFlag=!0,e.jsonLoading=!0,a.get(b,{params:e.pageUI.reqParam}).success(function(a){if(a.data){if(e.pageUI.reqParam.page>1)if(a.data.critList.total_count>0)for(var b=0;b<a.data.critList.items.length;b++)a.data.critList.items[b].critCont&&(a.data.critList.items[b].critContHtml=m(a.data.critList.items[b].critCont,"\r\n","<br />")),e.pageUI.loadData.critList.items.push(a.data.critList.items[b]);else e.pageUI.isLastPage=!0;else{if(a.data.critList&&a.data.critList.items&&a.data.critList.items.length)for(var b=0;b<a.data.critList.items.length;b++)a.data.critList.items[b].critCont&&(a.data.critList.items[b].critContHtml=m(a.data.critList.items[b].critCont,"\r\n","<br />"));if(e.pageUI.loadData=a.data,a.data.easnGdasSummaryList&&a.data.easnGdasSummaryList.items&&a.data.easnGdasSummaryList.items.length){e.pageUI.loadData.reviewDetail={},e.pageUI.loadData.reviewList=[];for(var b=0;b<a.data.easnGdasSummaryList.items.length;b++){var c=a.data.easnGdasSummaryList.items[b];e.pageUI.loadData.reviewDetail[c.gdas_item_no]?e.pageUI.loadData.reviewDetail[c.gdas_item_no].list.push(c):(e.pageUI.loadData.reviewDetail[c.gdas_item_no]={},e.pageUI.loadData.reviewDetail[c.gdas_item_no].title=c.gdas_item_nm,e.pageUI.loadData.reviewDetail[c.gdas_item_no].list=[],e.pageUI.loadData.reviewDetail[c.gdas_item_no].list.push(c),e.pageUI.loadData.reviewList.push(c))}}}e.pageUI.healthfoodYn=a.data.healthfoodYn||!1}}).error(function(){console.log("Data Error : 전체 상품평보기 데이터 로드 실패"),e.ajaxLoadFlag=!1})["finally"](function(){e.ajaxLoadFlag=!1,e.jsonLoading=!1})},e.loadData(),e.linkThumbClick=function(a,b,c,g){c?l.evtTag(e.gaCtgName,"고객등록 사진/영상 더보기","더보기"):l.evtTag(e.gaCtgName,"고객등록 사진/영상",n(g+1)),f(function(){return c?void(d.location.href=h.productSubCommentImage+"?goods_no="+e.goodsNo+"&usm_goods_no="+(e.pageUI.reqParam.usm_goods_no||"")+"&"+e.baseParam+"&tclick="+b):void(d.location.href=k.setUrlAddBaseParam(a,e.baseParam+"&tclick="+b))},300)},e.sortBy=function(a){switch(e.sendTclick(a),e.pageUI.filterOption.filter1SelVal){case 0:e.pageUI.reqParam.sort="R";break;case 1:e.pageUI.reqParam.sort="RK";break;case 2:e.pageUI.reqParam.sort="L";break;case 3:e.pageUI.reqParam.sort="G";break;case 4:e.pageUI.reqParam.sort="B"}e.pageUI.page=1,e.pageUI.isLastPage=!1,e.loadData()},e.sortByOpen=function(a){e.sendTclick(a),e.pageUI.filterOption.filter1Open=!e.pageUI.filterOption.filter1Open},e.mediaOnly=function(){e.pageUI.reqParam.media_yn=e.pageUI.filterOption.media_yn,e.pageUI.page=1,e.pageUI.isLastPage=!1,e.loadData()},e.filterBy=function(a){e.sendTclick(a),e.pageUI.reqParam.star=e.pageUI.filterOption.filter2SelVal,e.pageUI.reqParam.star>5&&(e.pageUI.reqParam.star=""),e.pageUI.page=1,e.pageUI.isLastPage=!1,e.loadData()},e.filterByOpen=function(a){e.pageUI.filterOption.filter2Open=!e.pageUI.filterOption.filter2Open},e.showHideFilterSlider=function(a){l.evtTag(e.gaCtgName,"필터","필터"),e.pageUI.filterOption.sliderOpen=!e.pageUI.filterOption.sliderOpen,e.pageUI.filterOption.sliderOpen?e.dimmedOpen({callback:this.showHideFilterSlider}):e.dimmedClose()},e.hideFilterSlider=function(a){e.dimmedClose()};var o=b.element("body")[0];e.$on("winScroll",function(a,b){e.pageUI.isLastPage!==!0&&!e.ajaxLoadFlag&&o.scrollHeight-2*b.winHeight<=b.scrollPos+b.winHeight&&(e.pageUI.page++,e.loadData())}),e.recommClick=function(b){if(l.evtTag(e.gaCtgName,"리뷰내용","추천하기"),e.loginInfo.isLogin)b.regRecommUrl&&(b.myRecomm=!0,a.get(b.regRecommUrl).success(function(a){if(a.data){if(alert(a.data.resultMsg),a.data.resultCode)switch(a.data.resultCode){case"01":case"02":b.recommCnt=b.recommCnt+1;case"03":b.recommYn=!0;case"04":break;case"05":break;case"06":b.recommYn=!1}}else alert("다시 한번 시도해주시기 바랍니다."),b.recommYn=!1}));else{alert("로그인을 해주세요.");var c="&targetUrl="+encodeURIComponent(d.location.href,"UTF-8");d.location.href=h.loginUrl+"?"+e.baseParam+c}},e.showReportPop=function(c){if(l.evtTag(e.gaCtgName,"리뷰내용","신고하기"),e.loginInfo.isLogin){if(!e.pageUI.loadData.badList.items)return;a.get(h.checkCommentReport,{params:{goods_no:e.goodsNo,gdas_no:c.gdasNo}}).success(function(a){return a&&a.data?void("02"==a.data.resultCode||"03"==a.data.resultCode?a.data.resultMsg&&alert(a.data.resultMsg):"01"==a.data.resultCode&&(e.dimmedOpen({target:"pop_report",callback:e.hideReportPop}),e.LotteDimm.dimmedOpacity="0.6",f(function(){b.element("#lotteDimm").css("z-index","210")}),e.pageUI.gdasItem=c,e.pageUI.loadData.reportList=e.pageUI.loadData.badList.items)):void alert("다시 한번 시도해주시기 바랍니다.")}).error(function(){alert("다시 한번 시도해주시기 바랍니다.")})}else{alert("로그인을 해주세요.");var g="&targetUrl="+encodeURIComponent(d.location.href,"UTF-8");d.location.href=h.loginUrl+"?"+e.baseParam+g}},e.hideReportPop=function(){e.pageUI.loadData.reportList=null,e.dimmedClose({target:"pop_report"}),b.element("#lotteDimm").css("z-index","100")},e.showReviewOne=function(a){e.dimmedOpen({callback:e.hideReviewOne,scrollEventFlag:!0}),f(function(){e.sb_review_index=1,e.arrReviewOne=a,$("#lotteDimm").css("z-index","115")},200),l.evtTag(e.gaCtgName,"리뷰내용","상품평 사진/영상 크게보기")},e.hideReviewOne=function(){e.arrReviewOne=[]},e.reviewSwipeCurIdx=0,e.sb_review_index=1,e.swipeReviewEnd=function(a){e.swipeReviewVideoStop(),a!=e.reviewSwipeCurIdx&&(e.sb_review_index=a+1,e.reviewSwipeCurIdx=a)},e.swipeReviewVideoStop=function(){$(".lv_wrap video").each(function(a,b){$(b).siblings(".stop_cover:visible, .click_cover:visible").length>=1&&f(function(){$(b).siblings(".btn_stop").trigger("click")},10)})},e.getReviewSwipeControl=function(a){e.swipeReviewControl=a,e.reviewSwipeCurIdx=e.swipeReviewControl.getIndex()},e.swipeBeforeReview=function(){0===e.reviewSwipeCurIdx?e.reviewSwipeCurIdx=e.arrReviewOne.length:e.reviewSwipeCurIdx--,e.swipeReviewControl.moveIndex(e.reviewSwipeCurIdx),1==e.sb_review_index?e.sb_review_index=e.arrReviewOne.length:e.sb_review_index--},e.swipeNextReview=function(){e.reviewSwipeCurIdx===e.arrReviewOne.length-1?e.reviewSwipeCurIdx=0:e.reviewSwipeCurIdx++,e.swipeReviewControl.moveIndex(e.reviewSwipeCurIdx),e.sb_review_index==e.arrReviewOne.length?e.sb_review_index=1:e.sb_review_index++}}]),d.directive("lotteContainer",["$window","$timeout","LotteCommon","LotteGA","commInitData",function(a,b,c,d,e){return{templateUrl:"/lotte/resources_dev/product/m/sub/product_comment_container.html",replace:!0,link:function(f,g,h){f.isShowBtnTalk=!1,f.productCommentDetailView=function(b){a.location.href=c.productSubCommentImageDetail+"?"+f.baseParam+"&goods_no="+e.query.goods_no+"&idx="+b+"&tclick="},f.goReviewerHome=function(a){if(a.reviewerHomeUrl){if(a.reviewerHomeUrl.indexOf("revr_mbr_no=")>-1){var c=a.reviewerHomeUrl.split("revr_mbr_no=");try{d.evtTag(f.gaCtgName,"리뷰어","리뷰어홈가기",c[1].split("&")[0])}catch(e){}}else a.reviewerHomeUrl.indexOf("/mylotte_crit_view.do")>-1&&d.evtTag(f.gaCtgName,"리뷰어","리뷰어홈가기",f.loginInfo.mbrNo);b(function(){location.href=a.reviewerHomeUrl.indexOf("?")>-1?a.reviewerHomeUrl+"&"+f.baseParam:a.reviewerHomeUrl+"?"+f.baseParam},300)}},f.toggleDetail=function(){f.pageUI.starScoreOpen?d.evtTag(f.gaCtgName,"Summary 자세히보기","접기"):d.evtTag(f.gaCtgName,"Summary 자세히보기","펼치기"),f.pageUI.starScoreOpen=!f.pageUI.starScoreOpen},f.getFlagStyle=function(a){return a?1==parseInt(a)?{"background-color":"#e6899C"}:parseInt(a)<=10?{"background-color":"#7691c6"}:{}:{}}}}}]),d.directive("integer",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.unshift(function(a){return parseInt(a,10)})}}}),d.filter("starScorePolicy",function(){return function(a,b){if(!a)return 0;var d=5,e=Math.ceil(2*a)/2;return b!=c&&(e=e/d*b),e}}),d.filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),d.directive("onErrorSrc2",function(){return{link:function(a,b,c){b.bind("error",function(){c.curIndex&&a.pageUI.loadData.critList.items[c.curIndex-1].reviewerImgUrl!=a.dummyUrl&&(a.pageUI.loadData.critList.items[c.curIndex-1].reviewerImgUrl=a.dummyUrl)})}}}),d.directive("reportPop",["$window","$location","LotteCommon","$timeout","$parse","$http","LotteGA",function(a,b,c,d,e,f,g){return{link:function(b,d,e){b.sendReport=function(){if(d.find("input[type=radio]:checked").length)if(b.loginInfo.isLogin)f.get(c.commentReport,{params:{mbr_no:b.loginInfo.mbrNo,site_no:1,goods_no:b.pageUI.reqParam.goods_no,gdas_no:b.pageUI.gdasItem.gdasNo,dcl_accp_tp_cd:d.find("input[type=radio]:checked").val()}}).success(function(a){return a&&a.data?void(a.data.resultMsg&&(alert(a.data.resultMsg),b.hideReportPop())):void alert("다시 한번 시도해주시기 바랍니다.")}).error(function(){alert("다시 한번 시도해주시기 바랍니다.")});else{alert("로그인을 해주세요.");var e="&targetUrl="+encodeURIComponent(a.location.href,"UTF-8");a.location.href=c.loginUrl+"?"+b.baseParam+e}}}}}])}(window,window.angular);