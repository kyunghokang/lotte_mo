function getByteLength(a,b,c,d){for(b=c=0;d=a.charCodeAt(c++);b+=d>>11?2:1);return b}function inputBlur(){angular.element("#accp_cont").blur()}function locationReplace(a){location.replace(a)}!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","lotteUtil"]);d.controller("questionCtrl",["$scope","$http","$window","LotteCommon","LotteCookie","LotteUtil",function(d,e,f,g,h,i){d.showWrap=!0,d.contVisible=!0,d.subTitle="1:1 문의하기",d.actionBar=!0,g.cscenterOrderData,g.questionSave;var j=new Date;if(d.now=j,d.fail=!1,d.write_box=!1,d.order_pop=!1,d.order_list_no=!1,d.order_list_wrap=!1,d.order_list_img=!1,d.order_submit_end=!1,d.ord_no="",d.order_select_end=!1,d.orderListData,d.orderDisable=!1,d.listSelect=function(c,e,f){var g=b.element("div.product.on");if(g.length>0&&d.ord_no!=e){if(!confirm("상품 선택은 단 한 개의 주문번호 선택에서만 가능합니다. 선택하신 상품이 모두 해제됩니다. 계속 하시겠습니까?"))return;b.element("[data-ordno="+d.ord_no+"]").removeClass("on")}d.view_ord_no=c,d.ord_no=e,d.depth1=[].indexOf.call(b.element("div.scroll").find("section"),a.event.currentTarget.parentNode),b.element("[data-ordno="+e+"][data-idx="+f+"]").toggleClass("on")},d.select_obj=[],d.listSelectEnd=function(){d.select_obj=[];var a=b.element("div.product.on");return 0==a.length?void alert("문의하실 상품을 선택해주세요."):(a.each(function(){d.select_obj.push(d.orderListData[d.depth1].goods_list.items[$(this).index()-1])}),0==a.length?d.order_select_end=!1:d.order_select_end=!0,$(".order_pop").removeClass("dimmedOpen"),d.order_pop=!1,d.dimmedClose({target:"order_pop"}),void(d.depth1=c))},d.orderPopClose=function(){d.order_pop=!1,d.dimmedClose({target:"order_pop"}),d.order_list_no&&d.selectFs(1),d.depth1=c,d.appObj.isApp&&d.appObj.isAndroid?a.lottebridge.question("show"):d.appObj.isApp&&d.appObj.isIOS&&(location.href="lottebridge://question/show")},d.selectFs=function(c){b.element(f).scrollTop(1500),d.selectCs=c,1==c?(d.write_box=!0,d.order_pop=!1,d.order_select_end=!1,d.ord_no_yn="Y",$(".order_pop,#cover,body").removeClass("dimmedOpen")):(d.write_box=!1,d.order_pop=!0,d.order_select_end=!1,d.ord_no_yn="N",$(".order_pop,#cover,body").addClass("dimmedOpen"),d.dimmedOpen({target:"order_pop",callback:this.orderPopClose}),d.appObj.isApp&&d.appObj.isAndroid?a.lottebridge.question("hide"):d.appObj.isApp&&d.appObj.isIOS&&(location.href="lottebridge://question/hide")),document.querySelector("#accp_cont")&&document.querySelector("#accp_cont").focus()},i.getParameter("ord_no").length>0){d.ord_no=i.getParameter("ord_no");var k="ord_no="+d.ord_no,l=i.getParametersByName("ord_dtl_sn");l.forEach(function(a,b,c){k+="&ord_dtl_sn=",k+=a});try{e.get(g.cscenterOrderDetailData+"?"+d.baseParam+"&"+k).success(function(a){d.order_select_end=!0,d.view_ord_no=a.inquiry_order.view_ord_no,a.inquiry_order.goods_list.items.forEach(function(a){d.select_obj.push(a)}),d.selectCs=0,d.orderDisable=!0}).error(function(a){ajaxResponseErrorHandler(a)})}catch(m){console.error(m)}}d.goLogin=function(){var a="&targetUrl="+encodeURIComponent(f.location.href,"UTF-8");f.location.href=g.loginUrl+"?"+d.baseParam+a},d.linkToPuchaseView=function(){var a=(d.view_ord_no+"").replace(/-/g,"");location.href=g.purchaseViewUrl+"?"+d.baseParam+"&orderNo="+a}}]),d.directive("lotteContainer",[function(){return{templateUrl:"/lotte/resources_dev/custcenter/m/question_container.html",replace:!0,link:function(a,b,c){}}}]),d.directive("writeBox",["$http","$window","LotteCommon","LotteUtil",function(a,b,c,d){return{templateUrl:"/lotte/resources_dev/custcenter/m/write_box.html",replace:!0,link:function(d,e,f){document.querySelector("#accp_cont").focus(),d.byteCheck=function(){var a=d.accp_cont||(d.accp_cont="");if(d.bytes=getByteLength(a),d.bytes>=4001){alert("최대 4000byte까지 작성하실 수 있습니다.");for(var b=0;;)if(b=getByteLength(a=a.substring(0,a.length-1)),4001>b){d.accp_cont=a,d.bytes=b;break}}},d.save=function(e,f,g){if("undefined"==typeof d.accp_cont||""==d.accp_cont)return alert("문의 내용을 입력해주세요"),!1;if(!confirm("1:1 문의를 등록 하시겠습니까?"))return!1;if(d.ord_dtl_sn="",d.goods_no="",d.select_obj.forEach(function(a){d.ord_dtl_sn+=a.ord_dtl_sn,d.ord_dtl_sn+="^"}),d.ord_dtl_sn=d.ord_dtl_sn.substring(0,d.ord_dtl_sn.lastIndexOf("^")),d.select_obj.forEach(function(a){d.goods_no+=a.goods_no,d.goods_no+="^"}),d.goods_no=d.goods_no.substring(0,d.goods_no.lastIndexOf("^")),d.appObj.isApp&&isNewestApp()){var h="ghost://SubmitPhotoQuestion/write?";return h+="&ord_no_yn="+d.ord_no_yn,h+="&accp_cont="+encodeURI(d.accp_cont),h+="&ord_no="+d.ord_no,h+="&ord_dtl_sn="+d.ord_dtl_sn,h+="&goods_no="+d.goods_no,h+="&mbr_no="+d.loginInfo.mbrNo,h+="&mbr_nm="+d.loginInfo.name,h+="&site_no=1",void(location.href=h)}var i={ord_no_yn:d.ord_no_yn,accp_cont:d.accp_cont,ord_no:d.ord_no,ord_dtl_sn:d.ord_dtl_sn,goods_no:d.goods_no};a({url:c.questionSave+"?"+d.baseParam,data:$.param(i),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,e,f,g){b.location.replace(c.cscenterAnswerDetaileUrl+"?"+d.baseParam+"&ccn_no="+a.inquiry_save.ccn_no)}).error(function(a){ajaxResponseErrorHandler(a)})},d.attachImage=function(){d.appObj.isApp&&isNewestApp()?location.href="ghost://QuestionWithPhoto":d.appObj.isApp&&!isNewestApp()?alert("사진 첨부기능은 앱 최신버전에서 이용 가능합니다."):confirm("롯데닷컴 앱에서 이용 가능합니다. 지금 설치하시겠습니까?")&&(location.href=c.appDown+"?"+d.baseParam)}}}}]),d.directive("orderPop",["$http","LotteCommon",function(a,b){return{templateUrl:"/lotte/resources_dev/custcenter/m/order_pop.html",replace:!0,link:function(c,d,e){console.log("#",b.cscenterOrderData),a.get(b.cscenterOrderData).success(function(a){c.$parent.orderListData=a.inquiry_order_list.items,0==c.$parent.orderListData.length?c.$parent.order_list_no=!0:c.order_list_wrap=!0}).error(function(a){ajaxResponseErrorHandler(a)})}}}])}(window,window.angular);var ajaxResponseFailHandler=function(a){alert("처리중 오류가 발생하였습니다."),a&&a()},ajaxResponseErrorHandler=function(a,b){if(a.error){var c=a.error.response_code,d=a.error.response_msg;if("9004"==c){var e="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href="/login/m/loginForm.do?"+e}else alert("["+c+"] "+d)}else alert("처리중 오류가 발생하였습니다.");b&&b()};