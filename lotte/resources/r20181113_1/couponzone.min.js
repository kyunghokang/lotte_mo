!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter"]);d.filter("htmlRemove",[function(){return function(a){return a.substr(0,4)+"."+a.substr(8,2)+"."+a.substr(11,2)}}]),d.controller("couponzoneCtrl",["$scope","$window","$http","LotteCommon","commInitData","LotteUtil","LotteGA",function(c,d,e,f,g,h,i){function j(a){return 10>a?"0"+a:a+""}function k(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}if(c.showWrap=!0,c.contVisible=!0,c.subTitle="쿠폰존",c.gaCtgName="MO_쿠폰존",c.screenID="couponzone",c.pageLoading=!0,c.schema=null!=g.query.schema?g.query.schema:"",c.currTime,c.currMonth,c.todayDate=new Date,c.data_param="",c.showWrap=!0,c.contVisible=!0,c.depositView=!1,c.delCloverListViewFlag=!1,c.isShowLoadingImage=!0,c.couponZoneTab=!1,c.tabControl="first",g.query.toDate){var l=g.query.toDate,m=new Date(l.substring(0,4),parseInt(l.substring(4,6))-1,l.substring(6,8),l.substring(8,10),l.substring(10,12),l.substring(12,14));c.data_param="toDate="+l,c.todayDate=m}(c.screenDataReset=function(){c.pageOptions={},c.screenData={page:0,pageSize:20,pageEnd:!1}})(),c.pop_close=function(){c.gpop_type=0},c.pop_open=function(a,b){c.gpop_type=a,b&&(c.gpop_item=b)};var n=new Date,o=n.getFullYear()+j(n.getMonth()+1)+j(n.getDate())+j(n.getHours()),p=g.query.testDate||"";p&&(o=p),parseInt(o,10)>=parseInt("2018081710",10)&&(c.validDate=!0);var q=f.newCouponzoneData+"?"+c.data_param,r="/main_json_contents.do?dispNo=5570119&age=20&dispNo=5570119&gender=F";e.get(r).success(function(a){c.linkInfo=a.moduleData[0].linkInfo}),c.cpLinks=function(a){switch(a){case"1":c.linkInfo?d.location.href=c.linkInfo.attendUrl+"?"+c.baseParam:d.location.href=f.directAttendUrl+"?"+c.baseParam;break;case"2":c.linkInfo?d.location.href=c.linkInfo.benefitUrl+"?"+c.baseParam:d.location.href=f.gdBenefitUrl+"?"+c.baseParam;break;case"3":c.linkInfo?d.location.href=c.linkInfo.rewordUrl+"?"+c.baseParam:d.location.href=f.eventSaunUrl+"?"+c.baseParam;break;case"4":c.linkInfo?d.location.href=c.linkInfo.eventUrl+"?"+c.baseParam:d.location.href=f.eventGumeUrl+"?"+c.baseParam}},c.cpLinks2=function(){i.evtTag(c.gaCtgName,"탭02_멤버십혜택배너"),c.linkInfo?d.location.href=c.linkInfo.benefitUrl+"?"+c.baseParam:d.location.href=f.gdBenefitUrl+"?"+c.baseParam},e.get(q).success(function(a){switch(c.newVer&&a.goodBenefit.attributes&&(a.goodBenefit.attributes.banner_top.items.length>8&&(a.goodBenefit.attributes.banner_top.items=a.goodBenefit.attributes.banner_top.items.slice(0,8)),a.goodBenefit.attributes.banner_bottom.items.length>8&&(a.goodBenefit.attributes.banner_bottom.items=a.goodBenefit.attributes.banner_bottom.items.slice(0,8)),a.goodBenefit.attributes.couponList.items.length>15&&(a.goodBenefit.attributes.couponList.items=a.goodBenefit.attributes.couponList.items.slice(0,15))),c.goodBenefit=a.goodBenefit,c.couponData=a.goodBenefit.couponInfo,c.couponYnCnt=a.goodBenefit.attributes.couponList.coupon_yn_cnt,null!=a.goodBenefit.banner.banner&&(c.bannerData=a.goodBenefit.banner.banner.items),c.cpbestlink=function(a){d.location.href=a+"?"+c.baseParam},c.cpGA=function(a,b,d){i.evtTag(c.gaCtgName,"탭0"+a+"_"+b,d)},c.webSchema=a.goodBenefit.webSchema,c.gradeYear="2015년",c.gradeMonth="9월",c.gradehalf="하반기",c.gradeNm,c.nextGradeNm,a.goodBenefit.mbrGradeCd){case"10":c.gradeNm="플래티넘+",c.nextGradeNm="플래티넘+";break;case"20":c.gradeNm="플래티넘",c.nextGradeNm="플래티넘+";break;case"30":c.gradeNm="플래티넘#",c.nextGradeNm="플래티넘";break;case"40":c.gradeNm="골드",c.nextGradeNm="플래티넘#";break;case"50":c.gradeNm="실버",c.nextGradeNm="골드";break;case"70":c.gradeNm="프렌드",c.nextGradeNm="실버";break;case"80":c.gradeNm="웰컴",c.nextGradeNm="실버"}"10"==c.mbrGradeCd&&(c.couponDownYn=!1,1==Number(c.day)&&Number(c.hour)<9&&(c.couponDownYn=!0)),c.pageLoading=!1}).error(function(a,b,d,e){c.pageLoading=!1}),c.goLogin=function(){d.location.href=f.loginUrl+"?"+c.baseParam+"&targetUrl="+encodeURIComponent(d.location.href,"UTF-8")},c.getCoupon=function(a){c.loginInfo.isLogin?(c.sendTclick("m_DC_MemCouponZone_Clk_Btn_2"),e.get("/json/coupon/regCoupon2.json?cpn_issu_no="+a+"&"+c.data_param).success(function(a){"0"==a.result?location.reload():a.message&&alert(a.message)}).error(function(a,b,c,d){console.log(b)})):c.goLogin()},c.noti_msg=function(a){1==a?alert("이미 쿠폰을 다운받으셨습니다."):2==a&&alert("쿠폰 발급 대상이 아닙니다.")},c.changeTab=function(a){c.tabControl=a,"first"==a?c.couponZoneTab=!1:c.couponZoneTab=!0},c.pointDivParam=k("point_div"),c.pointListData=[],c.pointDelData=[],c.pointSaveData=[],c.bankListData=[],c.cloverListData=[],c.delCloverListData=[],c.couponListData=[],c.pointList_tot_cnt=0,c.tobeDelLPointList_tot_cnt=0,c.saveLtPointList_tot_cnt=0,c.cloverPointList_tot_cnt=0,c.tobeDelCloverList_tot_cnt=0,c.couponList_tot_cnt=0,c.getPointDataLoad=function(){c.thisPage++,c.page_end<c.thisPage&&0!=c.page_end||e.get(f.pointInfoData+"?"+c.baseParam+"&point_div="+c.pointDivParam+"&page_num="+c.thisPage+"&tclick=m_mylayer_"+c.pointDivParam).success(function(a){c.thisPage>1?(b.forEach(a.max.couponList.items,function(a,b){c.couponListData.push(a)}),b.forEach(a.max.cloverPointList.items,function(a,b){c.cloverListData.push(a)}),b.forEach(a.max.pointList.items,function(a,b){c.pointListData.push(a)})):(c.maxData=a.max,c.page_end=parseInt(a.max.page_end),console.log("page end ; "+c.page_end),b.forEach(a.max.tobeDelLPointList.items,function(a,b){c.pointDelData.push(a)}),b.forEach(a.max.saveLtPointList.items,function(a,b){c.pointSaveData.push(a)}),b.forEach(a.max.bankList.items,function(a,b){c.bankListData.push(a)}),b.forEach(a.max.tobeDelCloverList.items,function(a,b){c.delCloverListData.push(a)}),b.forEach(a.max.couponList.items,function(a,b){c.couponListData.push(a)}),b.forEach(a.max.cloverPointList.items,function(a,b){c.cloverListData.push(a)}),b.forEach(a.max.pointList.items,function(a,b){c.pointListData.push(a)}),c.isShowLoadingImage=!1),c.bankHasYn=a.max.refund_acct_yn,c.pointList_tot_cnt=a.max.pointList_tot_cnt,c.tobeDelLPointList_tot_cnt=a.max.tobeDelLPointList_tot_cnt,c.saveLtPointList_tot_cnt=a.max.saveLtPointList.total_count,c.cloverPointList_tot_cnt=a.max.cloverPointList_tot_cnt,c.tobeDelCloverList_tot_cnt=a.max.tobeDelCloverList_tot_cnt,c.couponList_tot_cnt=a.max.couponList_tot_cnt}).error(function(a,b,d,e){c.isShowLoadingImage=!1,console.log("Error Data : ",b,d,e)})},c.page_end=0,c.thisPage=0,c.getPointDataLoad(),c.lPointClick=function(){d.location.href=f.pointInfoUrl+"?"+c.baseParam+"&point_div=lt_point&tclick=m_mylayer_ltmoney"},c.ltPointClick=function(){d.location.href=f.pointInfoUrl+"?"+c.baseParam+"&point_div=l_point&tclick=m_mylayer_lmoney"},c.depositClick=function(){d.location.href=f.pointInfoUrl+"?"+c.baseParam+"&point_div=deposit&tclick=m_mylayer_deposit"},c.delCloverView=function(){c.delCloverListViewFlag=!c.delCloverListViewFlag},c.paperCouponRegi=function(a){d.location.href=f.paperCouponUrl+"?"+c.baseParam+"&paper_no="+a+"&point_div=coupon&tclick=m_mylayer_coupon"},c.pointSaveClick=function(a){c.saveOrdNo=String(a).replace(/-/gi,""),console.log(c.saveOrdNo),e({method:"POST",url:"/json/mylotte/pointcoupon/point_save.json",data:{ord_no:c.saveOrdNo},transformRequest:transformJsonToParam,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){console.log(a.resultMsg),alert(a.resultMsg),d.location.href=f.pointInfoUrl+"?"+c.baseParam+"&point_div=lt_point&tclick=m_mylayer_ltmoney"}).error(function(a){console.log("적립하기 오류")})},c.cloverLink=function(){d.location.href=f.cloverUrl+"?"+c.baseParam+"&tclick=m_DC_clover_Clk_Btn_01"},c.depositViewClick=function(){c.depositView=!c.depositView},c.depositViewClick1=function(){c.depositView1=!c.depositView1},c.depositViewClick2=function(){c.depositView2=!c.depositView2},c.goRefundDetail=function(){if(!c.loginInfo.isLogin){alert("로그인 후 이용가능합니다.");var a="&targetUrl="+encodeURIComponent(d.location.href,"UTF-8");d.location.href=f.loginUrl+"?"+c.baseParam+a}return 0==c.maxData.deposit?void alert("환불금액이 없습니다."):void(d.location.href=f.depositDetailUrl+"?"+c.baseParam+"&point_div=coupon&tclick=m_mylayer_deposit")},c.checkBank=function(){},c.refundDeposit=function(a,b,c){},c.moreListClick=function(){c.getPointDataLoad()},c.lPointGoLink=function(){c.appObj.isApp?openNativePopup("엘포인트","http://www.lpoint.com"):a.open("http://www.lpoint.com")}}]),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/mylotte/sub/couponzone_container.html",replace:!0,link:function(a,b,c){}}}),d.filter("dayinfo",[function(){return function(a){return a.substr(0,10)}}])}(window,window.angular);