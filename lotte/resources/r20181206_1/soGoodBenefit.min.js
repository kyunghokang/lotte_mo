!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter"]);d.controller("soGoodBenefitCtrl",["$scope","$window","$http","LotteCommon","commInitData",function(b,c,d,e,f){function g(a){return 10>a?"0"+a:a+""}if(b.showWrap=!0,b.contVisible=!0,b.subTitle="멤버십",b.pageLoading=!0,b.schema=null!=f.query.schema?f.query.schema:"",b.currTime,b.currMonth,b.todayDate=new Date,b.data_param="",f.query.toDate){var h=f.query.toDate,i=new Date(h.substring(0,4),parseInt(h.substring(4,6))-1,h.substring(6,8),h.substring(8,10),h.substring(10,12),h.substring(12,14));b.data_param="toDate="+h,b.todayDate=i}b.gradView=!1,b.gpop_type=0,b.gpop_item=null,b.pop_close=function(){b.gpop_type=0},b.pop_open=function(a,c){b.gpop_type=a,c&&(b.gpop_item=c)};var j=new Date,k=j.getFullYear()+g(j.getMonth()+1)+g(j.getDate())+g(j.getHours()),l=f.query.testDate||"";l&&(k=l),parseInt(k,10)>=parseInt("2018081710",10)&&(b.validDate=!0),b.everyday_link=function(c){var d=b.baseParam+"&tclick=m_DC_MemCouponZone_Clk_Btn_",e="/event/m/directAttend.do?"+d+"3";2==c?e=0==b.luckyboxNo?"/event/appPush.do?"+d+"4":"/event/luckyBox.do?"+d+"4":3==c?e="/event/clover.do?"+d+"5":4==c?e="/event/shoppingMail.do?"+d+"6":5==c?e="/event/shoppingMail.do?"+d+"6":6==c&&(e="/product/m/product_list.do?curDispNo=5443685&"+d+"7"),a.location.href=e},b.luckyboxNo=!0,b.eventSubTxt="금요일의 대박찬스",b.eventSubTxt2="럭키박스";var m=b.todayDate.getFullYear(),n=b.todayDate.getMonth(),h=b.todayDate.getDate(),o=(new Date(b.todayDate.getFullYear(),b.todayDate.getMonth(),1).getDay(),b.todayDate.getDay(),new Date(m,n+1,0)),p=o.getDate();b.eventTimes=function(a,b,c,d,e,f){var g=new Date(a,b,c,d,e,f);return a&&b&&c&&(g.setFullYear(a),g.setMonth(b-1),g.setDate(c),d&&g.setHours(d),e&&g.setMinutes(e),f&&g.setSeconds(f)),g.getTime()};var q=b.todayDate.getTime();if(-1!=location.search.indexOf("dt_test")){var r=location.search.indexOf("dt_test");q>=b.eventTimes(Number(location.search.slice(r+8,r+12)),Number(location.search.slice(r+12,r+14)),Number(location.search.slice(r+14,r+16)))&&(b.luckyboxNo=!1,b.eventSubTxt="매일 앱푸시 오픈",b.eventSubTxt2="깜짝알림")}q>=b.eventTimes(2018,4,28)&&-1==location.search.indexOf("dt_test")&&(b.luckyboxNo=!1,b.eventSubTxt="매일 앱푸시 오픈",b.eventSubTxt2="깜짝알림"),b.getCoupon=function(a){b.loginInfo.isLogin?(b.sendTclick("m_DC_MemCouponZone_Clk_Btn_2"),d.get("/json/coupon/regCoupon2.json?cpn_issu_no="+a+"&"+b.data_param).success(function(a){"0"==a.result?location.reload():a.message&&alert(a.message)}).error(function(a,b,c,d){console.log(b)})):b.goLogin()},b.noti_msg=function(a){1==a?alert("이미 쿠폰을 다운받으셨습니다."):2==a&&alert("쿠폰 발급 대상이 아닙니다.")},b.todayDate.getTime()>=new Date(2016,0,1).getTime()&&b.todayDate.getTime()<new Date(2016,0,7,13).getTime()&&(alert("죄송합니다. 일시적으로 참좋은 혜택 모바일 사용이 원활하지 않습니다.PC에서 확인 부탁드립니다.\n(1월 7일 이후 모바일 확인 가능)"),c.location.href=e.mainUrl+"?"+b.baseParam);var s=b.todayDate,t=s.getFullYear(),u=s.getMonth()+1,v=s.getDate(),w=(s.getDay(),s.getHours()),x=s.getMinutes(),p=new Date(t,u,0),y=(p.getDate(),s.getMonth()+4);b.lastDayOfMonInt=new Date(t,u,0).getDate(),b.currYear=t,b.currMonth=u,b.day=v,b.hour=w,10>u&&(u="0"+u),10>v&&(v="0"+v),10>w&&(w="0"+w),10>x&&(x="0"+x),b.currTime=""+t+u+v+w,b.remainDate=t+"."+y+".01",b.shutDownTime=!1,b.todayDate.getTime()>=new Date(2017,11,1).getTime()&&b.todayDate.getTime()<new Date(2017,11,1,10).getTime()&&(b.shutDownTime=!0),b.newVer=!0;var z=e.gdBenefitData+"?"+b.data_param;d.get(z).success(function(a){switch(b.newVer&&a.goodBenefit.attributes&&(a.goodBenefit.attributes.banner_top.items.length>8&&(a.goodBenefit.attributes.banner_top.items=a.goodBenefit.attributes.banner_top.items.slice(0,8)),a.goodBenefit.attributes.banner_bottom.items.length>8&&(a.goodBenefit.attributes.banner_bottom.items=a.goodBenefit.attributes.banner_bottom.items.slice(0,8)),a.goodBenefit.attributes.couponList.items.length>15&&(a.goodBenefit.attributes.couponList.items=a.goodBenefit.attributes.couponList.items.slice(0,15))),b.goodBenefit=a.goodBenefit,b.couponData=a.goodBenefit.couponInfo,null!=a.goodBenefit.banner.banner&&(b.bannerData=a.goodBenefit.banner.banner.items),b.webSchema=a.goodBenefit.webSchema,b.gradeYear="2015년",b.gradeMonth="9월",b.gradehalf="하반기",b.gradeNm,b.nextGradeNm,a.goodBenefit.mbrGradeCd){case"10":b.gradeNm="플래티넘+",b.nextGradeNm="플래티넘+";break;case"20":b.gradeNm="플래티넘",b.nextGradeNm="플래티넘+";break;case"30":b.gradeNm="플래티넘#",b.nextGradeNm="플래티넘";break;case"40":b.gradeNm="골드",b.nextGradeNm="플래티넘#";break;case"50":b.gradeNm="실버",b.nextGradeNm="골드";break;case"70":b.gradeNm="프렌드",b.nextGradeNm="실버";break;case"80":b.gradeNm="웰컴",b.nextGradeNm="실버"}"10"==b.mbrGradeCd&&(b.couponDownYn=!1,1==Number(b.day)&&Number(b.hour)<9&&(b.couponDownYn=!0)),b.pageLoading=!1}).error(function(a,c,d,e){b.pageLoading=!1}),b.goLogin=function(){c.location.href=e.loginUrl+"?"+b.baseParam+"&targetUrl="+encodeURIComponent(c.location.href,"UTF-8")}}]),d.filter("dayinfo",[function(){return function(a){return a.substr(0,10)}}]),d.directive("lotteContainer",["$http","$location","$window","LotteCommon","LotteUtil",function(c,d,e,f,g){return{templateUrl:"/lotte/resources_dev/mylotte/sub/so_good_benefit_container.html",replace:!0,link:function(f,h,i){var j=f.todayDate,k="";f.cpn_cnt=0,f.issue_cnt=0,f.regGradeCoupon=function(a,e){var g=b.extend({coupon_type:a},f.baseParam);c({url:"/json/mylotte/reg_grade_coupon.json?"+f.data_param,data:$.param(g),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,b,c,g){"CS"==a.data_set.response_msg?(alert(e+"이 발급되었습니다."),f.goPointCoupon()):"CD"==a.data_set.response_msg?(e.indexOf("모바일APP")>-1?alert("이미 발급된 쿠폰입니다."):alert("이미 발급된 쿠폰입니다. 다음달에 또 발급받으세요^^"),f.goPointCoupon()):"CF"==a.data_set.response_msg?alert("쿠폰 발급이 실패했습니다."):"CX"==a.data_set.response_msg?alert("쿠폰 발급이 실패했습니다."):alert("로그인 해 주세요."),f.issue_cnt++,f.cpn_cnt==f.issue_cnt&&d.path("/this")}).error(function(a,b,c,d){alert("error")})},f.regPlatinumCoupon=function(a){var d=f.goodBenefit.lastMonthOrderCnt;if(""==d&&(d="0"),Number(d)>0){var e=b.extend({coupon_type:a},f.baseParam);c({url:"/json/mylotte/reg_grade_coupon.json?"+f.data_param,data:$.param(e),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,b,c,d){"CS"==a.data_set.response_msg?alert("구매감사 추가 혜택 쿠폰이 발급되었습니다."):"CD"==a.data_set.response_msg&&alert("이미 발급된 쿠폰입니다."),f.goPointCoupon()}).error(function(a,b,c,d){alert("error")})}else alert("해당 쿠폰은 전월 구매해주신 고객님만 받으실 수 있습니다. 이번달에 구매하시고 다음 달에 발급받으세요^^")},f.regCoupon=function(a,b){f.goodBenefit.couponInfo.mbl_down_yn="Y";var d={coupon_type:a,member_grade:b};c({url:"/json/mylotte/reg_grade_coupon.json?"+f.baseParam+"&"+f.data_param,data:$.param(d),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b,c,d,e){if("CS"==b.data_set.response_msg){var g="이달의 참좋은 쿠폰이 발급되었습니다. 쿠폰내역을 확인하시겠습니까?";confirm(g)&&f.goPointCoupon(),"memberCpn"==a?f.goodBenefit.couponInfo.mbr_down_yn="Y":f.goodBenefit.couponInfo.mbl_down_yn="Y"}else"CD"==b.data_set.response_msg?(alert("이미 발급된 쿠폰입니다."),f.goPointCoupon()):"CF"==b.data_set.response_msg?alert("쿠폰 발급이 실패했습니다."):"CX"==b.data_set.response_msg?alert("쿠폰 발급이 실패했습니다."):alert("로그인 해 주세요.")}).error(function(a,b,c,d){alert("error")})},f.goPointCoupon=function(){var a=d.protocol()+"://"+d.host();e.location.href=a+"/mylotte/pointcoupon/point_info.do?"+f.baseParam+"&point_div=coupon"},f.goLotteSuper=function(){var b="m.lottesuper.co.kr/handler/event/Event-EventViewDetail?evt_no=00000000889225&CHL_no=M385068&AFCR_NO=110682",c=f.appObj.isApp,d=f.appObj.isIOS,e=f.appObj.isAndroid;c?d?a.location="lecsplatform://"+encodeURIComponent(b):e&&a.lecsplatform.callAndroid("http://"+encodeURIComponent(b)):a.open("http://"+b)},f.goFamilySite=function(){var b="member.lpoint.com/door/user/mobile/",c=encodeURIComponent((""==f.schema?LOTTE_CONSTANTS.M_HOST_MOBILE:f.schema+LOTTE_CONSTANTS.M_HOST_MOBILE.replace("http",""))+"/"+(g.isSmp()?"main_smp.do":"main.do")+f.baseParam,"UTF-8"),d="login_common.jsp",e="",h=f.appObj.isApp,i=f.appObj.isIOS,j=f.appObj.isAndroid;e=""==f.schema?encodeURIComponent(a.location.href,"UTF-8"):a.location.href.replace(/^http(s)?/,f.schema),b+=d+"?sid="+g.getLoginSeed()+"&returnurl="+e+"&main_url="+c,b+="&sch="+f.schema,h?i?a.location="family://"+b:j&&a.myJs.callAndroid("https://"+b):a.open("https://"+b,"family")},f.closeChk=function(a){a=j.getDay(),k=j.getHours(),0==a?f.close():6==a?f.timeChk("Y"):f.timeChk("N")},f.timeChk=function(a){var b;b=c?"1899-2500":"1577-1110";var c=f.appObj.isEllotteApp;"Y"==a?parseInt(k)>=9&&parseInt(k)<=13?location.href="tel:"+b:close():parseInt(k)>=9&&parseInt(k)<=20?location.href="tel:"+b:close()},f.close=function(){alert("죄송합니다. 고객님,\n전화 문의는 평일(월~금) : 9:00~20:00\n토요일 : 9:00~13:00 까지 입니다.")},f.goBanner=function(a){var a=f.bannerData[0].img_link,b=d.protocol()+"://"+d.host();-1!=a.indexOf("?")?e.location.href=b+a+"&"+f.baseParam:e.location.href=b+a+"?"+f.baseParam},f.showBenefit=function(){$(".benefit").toggleClass("on"),$(".bnelist").toggle();var a=$(".grade_guide").height();$(".benefit").hasClass("on")?$(".benefit").css({height:a+50}):$(".benefit").css({height:"auto"})},f.closeGuide=function(){$(".bnelist").hide(),$(".benefit").removeClass("on").css({height:"auto"})},f.getRolling1=function(a){f.controlIdx1=a.getIndex()+1},f.setInfo1=function(a){f.controlIdx1=a+1,f.sendTclick("m_DC_MemCouponZone_Swf_Ban_1")},f.getRolling2=function(a){f.controlIdx2=a.getIndex()+1},f.setInfo2=function(a){f.controlIdx2=a+1,f.sendTclick("m_DC_MemCouponZone_Swf_Ban_2")},f.getRolling3=function(a){f.controlIdx3=a.getIndex()+1},f.setInfo3=function(a){f.controlIdx3=a+1,f.sendTclick("m_DC_MemCouponZone_Swf_Ban_3")}}}}])}(window,window.angular);