!function(a){"use strict";function b(a,c,d){var e,f=document.createElement("img");return f.onerror=function(e){return b.onerror(f,e,a,c,d)},f.onload=function(e){return b.onload(f,e,a,c,d)},"string"==typeof a?(b.fetchBlob(a,function(c){c?(a=c,e=b.createObjectURL(a)):(e=a,d&&d.crossOrigin&&(f.crossOrigin=d.crossOrigin)),f.src=e},d),f):b.isInstanceOf("Blob",a)||b.isInstanceOf("File",a)?(e=f._objectURL=b.createObjectURL(a),e?(f.src=e,f):b.readFile(a,function(a){var b=a.target;b&&b.result?f.src=b.result:c&&c(a)})):void 0}function c(a,c){!a._objectURL||c&&c.noRevoke||(b.revokeObjectURL(a._objectURL),delete a._objectURL)}var d=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;b.fetchBlob=function(a,b,c){b()},b.isInstanceOf=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},b.transform=function(a,b,c,d,e){c(a,e)},b.onerror=function(a,b,d,e,f){c(a,f),e&&e.call(a,b)},b.onload=function(a,d,e,f,g){c(a,g),f&&b.transform(a,g,f,e,{})},b.createObjectURL=function(a){return!!d&&d.createObjectURL(a)},b.revokeObjectURL=function(a){return!!d&&d.revokeObjectURL(a)},b.readFile=function(a,b,c){if(window.FileReader){var d=new FileReader;if(d.onload=d.onerror=b,c=c||"readAsDataURL",d[c])return d[c](a),d}return!1},"function"==typeof define&&define.amd?define(function(){return b}):"object"==typeof module&&module.exports?module.exports=b:a.loadImage=b}(window),function(a){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],a):a("object"==typeof module&&module.exports?require("./load-image"):window.loadImage)}(function(a){"use strict";var b=a.transform;a.transform=function(c,d,e,f,g){b.call(a,a.scale(c,d,g),d,e,f,g)},a.transformCoordinates=function(){},a.getTransformedOptions=function(a,b){var c,d,e,f,g=b.aspectRatio;if(!g)return b;c={};for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c.crop=!0,e=a.naturalWidth||a.width,f=a.naturalHeight||a.height,e/f>g?(c.maxWidth=f*g,c.maxHeight=f):(c.maxWidth=e,c.maxHeight=e/g),c},a.renderImageToCanvas=function(a,b,c,d,e,f,g,h,i,j){return a.getContext("2d").drawImage(b,c,d,e,f,g,h,i,j),a},a.hasCanvasOption=function(a){return a.canvas||a.crop||!!a.aspectRatio},a.scale=function(b,c,d){function e(){var a=Math.max((i||v)/v,(j||w)/w);a>1&&(v*=a,w*=a)}function f(){var a=Math.min((g||v)/v,(h||w)/w);1>a&&(v*=a,w*=a)}c=c||{};var g,h,i,j,k,l,m,n,o,p,q,r=document.createElement("canvas"),s=b.getContext||a.hasCanvasOption(c)&&r.getContext,t=b.naturalWidth||b.width,u=b.naturalHeight||b.height,v=t,w=u;if(s&&(c=a.getTransformedOptions(b,c,d),m=c.left||0,n=c.top||0,c.sourceWidth?(k=c.sourceWidth,void 0!==c.right&&void 0===c.left&&(m=t-k-c.right)):k=t-m-(c.right||0),c.sourceHeight?(l=c.sourceHeight,void 0!==c.bottom&&void 0===c.top&&(n=u-l-c.bottom)):l=u-n-(c.bottom||0),v=k,w=l),g=c.maxWidth,h=c.maxHeight,i=c.minWidth,j=c.minHeight,s&&g&&h&&c.crop?(v=g,w=h,q=k/l-g/h,0>q?(l=h*k/g,void 0===c.top&&void 0===c.bottom&&(n=(u-l)/2)):q>0&&(k=g*l/h,void 0===c.left&&void 0===c.right&&(m=(t-k)/2))):((c.contain||c.cover)&&(i=g=g||i,j=h=h||j),c.cover?(f(),e()):(e(),f())),s){if(o=c.pixelRatio,o>1&&(r.style.width=v+"px",r.style.height=w+"px",v*=o,w*=o,r.getContext("2d").scale(o,o)),p=c.downsamplingRatio,p>0&&1>p&&k>v&&l>w)for(;k*p>v;)r.width=k*p,r.height=l*p,a.renderImageToCanvas(r,b,m,n,k,l,0,0,r.width,r.height),m=0,n=0,k=r.width,l=r.height,b=document.createElement("canvas"),b.width=k,b.height=l,a.renderImageToCanvas(b,r,0,0,k,l,0,0,k,l);return r.width=v,r.height=w,a.transformCoordinates(r,c),a.renderImageToCanvas(r,b,m,n,k,l,0,0,v,w)}return b.width=v,b.height=w,b}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],a):a("object"==typeof module&&module.exports?require("./load-image"):window.loadImage)}(function(a){"use strict";var b=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);a.blobSlice=b&&function(){var a=this.slice||this.webkitSlice||this.mozSlice;return a.apply(this,arguments)},a.metaDataParsers={jpeg:{65505:[]}},a.parseMetaData=function(b,c,d,e){d=d||{},e=e||{};var f=this,g=d.maxMetaDataSize||262144,h=!(window.DataView&&b&&b.size>=12&&"image/jpeg"===b.type&&a.blobSlice);!h&&a.readFile(a.blobSlice.call(b,0,g),function(b){if(b.target.error)return console.log(b.target.error),void c(e);var g,h,i,j,k=b.target.result,l=new DataView(k),m=2,n=l.byteLength-4,o=m;if(65496===l.getUint16(0)){for(;n>m&&(g=l.getUint16(m),g>=65504&&65519>=g||65534===g);){if(h=l.getUint16(m+2)+2,m+h>l.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(i=a.metaDataParsers.jpeg[g])for(j=0;j<i.length;j+=1)i[j].call(f,l,m,h,e,d);m+=h,o=m}!d.disableImageHead&&o>6&&(k.slice?e.imageHead=k.slice(0,o):e.imageHead=new Uint8Array(k).subarray(0,o))}else console.log("Invalid JPEG file: Missing JPEG marker.");c(e)},"readAsArrayBuffer")||c(e)},a.hasMetaOption=function(a){return a&&a.meta};var c=a.transform;a.transform=function(b,d,e,f,g){a.hasMetaOption(d)?a.parseMetaData(f,function(g){c.call(a,b,d,e,f,g)},d,g):c.apply(a,arguments)}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],a):"object"==typeof module&&module.exports?a(require("./load-image"),require("./load-image-meta")):a(window.loadImage)}(function(a){"use strict";"fetch"in window&&"Request"in window&&(a.fetchBlob=function(b,c,d){return a.hasMetaOption(d)?fetch(new Request(b,d)).then(function(a){return a.blob()}).then(c)["catch"](function(a){console.log(a),c()}):void c()})}),function(a){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],a):"object"==typeof module&&module.exports?a(require("./load-image"),require("./load-image-meta")):a(window.loadImage)}(function(a){"use strict";a.ExifMap=function(){return this},a.ExifMap.prototype.map={Orientation:274},a.ExifMap.prototype.get=function(a){return this[a]||this[this.map[a]]},a.getExifThumbnail=function(a,b,c){var d,e,f;if(!c||b+c>a.byteLength)return void console.log("Invalid Exif data: Invalid thumbnail data.");for(d=[],e=0;c>e;e+=1)f=a.getUint8(b+e),d.push((16>f?"0":"")+f.toString(16));return"data:image/jpeg,%"+d.join("%")},a.exifTagTypes={1:{getValue:function(a,b){return a.getUint8(b)},size:1},2:{getValue:function(a,b){return String.fromCharCode(a.getUint8(b))},size:1,ascii:!0},3:{getValue:function(a,b,c){return a.getUint16(b,c)},size:2},4:{getValue:function(a,b,c){return a.getUint32(b,c)},size:4},5:{getValue:function(a,b,c){return a.getUint32(b,c)/a.getUint32(b+4,c)},size:8},9:{getValue:function(a,b,c){return a.getInt32(b,c)},size:4},10:{getValue:function(a,b,c){return a.getInt32(b,c)/a.getInt32(b+4,c)},size:8}},a.exifTagTypes[7]=a.exifTagTypes[1],a.getExifValue=function(b,c,d,e,f,g){var h,i,j,k,l,m,n=a.exifTagTypes[e];if(!n)return void console.log("Invalid Exif data: Invalid tag type.");if(h=n.size*f,i=h>4?c+b.getUint32(d+8,g):d+8,i+h>b.byteLength)return void console.log("Invalid Exif data: Invalid data offset.");if(1===f)return n.getValue(b,i,g);for(j=[],k=0;f>k;k+=1)j[k]=n.getValue(b,i+k*n.size,g);if(n.ascii){for(l="",k=0;k<j.length&&(m=j[k],"\x00"!==m);k+=1)l+=m;return l}return j},a.parseExifTag=function(b,c,d,e,f){var g=b.getUint16(d,e);f.exif[g]=a.getExifValue(b,c,d,b.getUint16(d+2,e),b.getUint32(d+4,e),e)},a.parseExifTags=function(a,b,c,d,e){var f,g,h;if(c+6>a.byteLength)return void console.log("Invalid Exif data: Invalid directory offset.");if(f=a.getUint16(c,d),g=c+2+12*f,g+4>a.byteLength)return void console.log("Invalid Exif data: Invalid directory size.");for(h=0;f>h;h+=1)this.parseExifTag(a,b,c+2+12*h,d,e);return a.getUint32(g,d)},a.parseExifData=function(b,c,d,e,f){if(!f.disableExif){var g,h,i,j=c+10;if(1165519206===b.getUint32(c+4)){if(j+8>b.byteLength)return void console.log("Invalid Exif data: Invalid segment size.");if(0!==b.getUint16(c+8))return void console.log("Invalid Exif data: Missing byte alignment offset.");switch(b.getUint16(j)){case 18761:g=!0;break;case 19789:g=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==b.getUint16(j+2,g))return void console.log("Invalid Exif data: Missing TIFF marker.");h=b.getUint32(j+4,g),e.exif=new a.ExifMap,h=a.parseExifTags(b,j,j+h,g,e),h&&!f.disableExifThumbnail&&(i={exif:{}},h=a.parseExifTags(b,j,j+h,g,i),i.exif[513]&&(e.exif.Thumbnail=a.getExifThumbnail(b,j+i.exif[513],i.exif[514]))),e.exif[34665]&&!f.disableExifSub&&a.parseExifTags(b,j,j+e.exif[34665],g,e),e.exif[34853]&&!f.disableExifGps&&a.parseExifTags(b,j,j+e.exif[34853],g,e)}}},a.metaDataParsers.jpeg[65505].push(a.parseExifData)}),function(a){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-exif"],a):"object"==typeof module&&module.exports?a(require("./load-image"),require("./load-image-exif")):a(window.loadImage)}(function(a){"use strict";a.ExifMap.prototype.tags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright",36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",42240:"Gamma",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"PhotographicSensitivity",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},a.ExifMap.prototype.stringValues={ExposureProgram:{0:"Undefined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Undefined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},ComponentsConfiguration:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"},Orientation:{1:"top-left",2:"top-right",3:"bottom-right",4:"bottom-left",5:"left-top",6:"right-top",7:"right-bottom",8:"left-bottom"}},a.ExifMap.prototype.getText=function(a){var b=this.get(a);switch(a){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":case"Orientation":return this.stringValues[a][b];case"ExifVersion":case"FlashpixVersion":if(!b)return;return String.fromCharCode(b[0],b[1],b[2],b[3]);case"ComponentsConfiguration":if(!b)return;return this.stringValues[a][b[0]]+this.stringValues[a][b[1]]+this.stringValues[a][b[2]]+this.stringValues[a][b[3]];case"GPSVersionID":if(!b)return;return b[0]+"."+b[1]+"."+b[2]+"."+b[3]}return String(b)},function(a){var b,c=a.tags,d=a.map;for(b in c)c.hasOwnProperty(b)&&(d[c[b]]=b)}(a.ExifMap.prototype),a.ExifMap.prototype.getAll=function(){var a,b,c={};for(a in this)this.hasOwnProperty(a)&&(b=this.tags[a],b&&(c[b]=this.getText(b)));return c}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-scale","./load-image-meta"],a):"object"==typeof module&&module.exports?a(require("./load-image"),require("./load-image-scale"),require("./load-image-meta")):a(window.loadImage)}(function(a){"use strict";var b=a.hasCanvasOption,c=a.hasMetaOption,d=a.transformCoordinates,e=a.getTransformedOptions;a.hasCanvasOption=function(c){return!!c.orientation||b.call(a,c)},a.hasMetaOption=function(b){return b&&b.orientation===!0||c.call(a,b)},a.transformCoordinates=function(b,c){d.call(a,b,c);var e=b.getContext("2d"),f=b.width,g=b.height,h=b.style.width,i=b.style.height,j=c.orientation;if(j&&!(j>8))switch(j>4&&(b.width=g,b.height=f,b.style.width=i,b.style.height=h),j){case 2:e.translate(f,0),e.scale(-1,1);break;case 3:e.translate(f,g),e.rotate(Math.PI);break;case 4:e.translate(0,g),e.scale(1,-1);break;case 5:e.rotate(.5*Math.PI),e.scale(1,-1);break;case 6:e.rotate(.5*Math.PI),e.translate(0,-g);break;case 7:e.rotate(.5*Math.PI),e.translate(f,-g),e.scale(-1,1);break;case 8:e.rotate(-.5*Math.PI),e.translate(-f,0)}},a.getTransformedOptions=function(b,c,d){var f,g,h=e.call(a,b,c),i=h.orientation;if(i===!0&&d&&d.exif&&(i=d.exif.get("Orientation")),!i||i>8||1===i)return h;f={};for(g in h)h.hasOwnProperty(g)&&(f[g]=h[g]);switch(f.orientation=i,i){case 2:f.left=h.right,f.right=h.left;break;case 3:f.left=h.right,f.top=h.bottom,f.right=h.left,f.bottom=h.top;break;case 4:f.top=h.bottom,f.bottom=h.top;break;case 5:f.left=h.top,f.top=h.left,f.right=h.bottom,f.bottom=h.right;break;case 6:f.left=h.top,f.top=h.right,f.right=h.bottom,f.bottom=h.left;break;case 7:f.left=h.bottom,f.top=h.right,f.right=h.top,f.bottom=h.left;break;case 8:f.left=h.bottom,f.top=h.left,f.right=h.top,f.bottom=h.right}return f.orientation>4&&(f.maxWidth=h.maxHeight,f.maxHeight=h.maxWidth,f.minWidth=h.minHeight,f.minHeight=h.minWidth,f.sourceWidth=h.sourceHeight,f.sourceHeight=h.sourceWidth),f}}),angular.module("ngPinchZoom",[]).directive("ngPinchZoom",function(){function a(a,b,c){function d(a){var b=a.originalEvent?a.originalEvent.touches:a.touches;y=b[0].clientX,z=b[0].clientY,u=s,v=t,A=0,B=0}function e(a){var c=a.originalEvent?a.originalEvent.touches:a.touches;""===l&&(1===c.length&&o>1?l="swipe":2===c.length&&(l="pinch",q=o,n=g(c),w=c[0].clientX-parseInt((c[0].clientX-c[1].clientX)/2,10)-b[0].offsetLeft-u,x=c[0].clientY-parseInt((c[0].clientY-c[1].clientY)/2,10)-b[0].offsetTop-v)),"swipe"===l?(a.preventDefault(),A=c[0].clientX-y,B=c[0].clientY-z,s=u+A,t=v+B,h()):"pinch"===l&&(a.preventDefault(),m=g(c),p=m/n,o=p*q,s=w*(1-p)+u+A,t=x*(1-p)+v+B,h())}function f(a){var b=a.originalEvent?a.originalEvent.touches:a.touches;""===l||b.length>0||(1>o?(o=1,s=0,t=0):o>r?(o=r,p=o/q,s=w*(1-p)+u+A,t=x*(1-p)+v+B):(s>0?s=0:j*(1-o)>s&&(s=j*(1-o)),t>0?t=0:k*(1-o)>t&&(t=k*(1-o))),h(.1),l="")}function g(a){var b=Math.sqrt(Math.pow(a[0].clientX-a[1].clientX,2)+Math.pow(a[0].clientY-a[1].clientY,2));return parseInt(b,10)}function h(a){var c=a?"all cubic-bezier(0,0,.5,1) "+a+"s":"",d=[o,0,0,o,s,t],e="matrix("+d.join(",")+")";b.css({"-webkit-transition":c,transition:c,"-webkit-transform":e+" translate3d(0,0,0)",transform:e})}function i(){o=1,s=0,t=0,h(.1),l=""}console.log("pinch zoom -----");var j,k,l="",m=0,n=0,o=1,p=1,q=1,r=parseInt(c.maxScale,10);(isNaN(r)||1>=r)&&(r=3);var s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=new Image;C.onload=function(){j=b[0].clientWidth,k=b[0].clientHeight,b.css({"-webkit-transform-origin":"0 0","transform-origin":"0 0"}),b.on("touchstart",d),b.on("touchmove",e),b.on("touchend",f),b.on("resetPinch",i)};var D=c.ngSrc?c.ngSrc:c.src;a.isValidString(D)&&(C.src=D)}var b={restrict:"A",scope:!1,link:a};return b}),function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","ngPinchZoom"]);d.controller("UsedWriteCtrl",["$http","$scope","LotteCommon","commInitData","$location","LotteStorage","$timeout","LotteGA",function(d,e,f,g,h,i,j,k){function l(a){return"image/jpeg"==a||"image/png"==a?!0:!1}e.showWrap=!0,e.contVisible=!0,e.subTitle="판매 글 등록하기",e.screenID="판매 등록하기",e.AccessUpload=!0,e.used_data=i.getSessionStorage("used_mall_edit_item","json"),e.show_term=!1,e.photoCount=0,e.no_write="",e.FILE_NUM=5,null==e.used_data&&(location.href=f.mainUrl+"?"+e.baseParam),e.check_list=[!1,!1,!1,!1],e.phoneArr=["","",""],e.rotateCode=new Array(e.FILE_NUM),e.orgImgFileList=new Array(e.FILE_NUM),e.scrmode=!0,e.pageLoading=!1,e.base64Decode=function(a){var b,c;b=new Array,c=new Array;var d;for(d=0;26>d;d++)b[b.length]=String.fromCharCode(65+d);for(d=0;26>d;d++)b[b.length]=String.fromCharCode(97+d);for(d=0;10>d;d++)b[b.length]=String.fromCharCode(48+d);for(b[b.length]="+",b[b.length]="/",d=0;128>d;d++)c[c.length]=-1;for(d=0;64>d;d++)c[b[d].charCodeAt(0)]=d;var e=0,f=0,g=0,h=0,d=0,i=0,j=a.split(""),k="",l=0;do h=j[l++].charCodeAt(0),d=c[h],h>=0&&128>h&&-1!=d&&(i%4==0?e=d<<2:i%4==1?(e|=d>>4,f=(15&d)<<4):i%4==2?(f|=d>>2,g=(3&d)<<6):g|=d,i++,i%4==0&&(k+=String.fromCharCode(e)+String.fromCharCode(f)+String.fromCharCode(g)));while("undefined"!=typeof j[l]);return k+=i%4==3?String.fromCharCode(e)+String.fromCharCode(f):i%4==2?String.fromCharCode(e):""};var m=f.used_write;if(null==e.used_data.item)e.used_data.item={bbcNo:"",loginId:"",regDate:"",dispNo:"",bbcTitNm:"",salePrc:"",dlexInclusYn:"",cellNo:"",shaGoodsStatCd:"",saleStatCd:"10",dirTradePsbYn:"",dirTradeRgnNm:"",bbcCont:"",rplCnt:0,recommCnt:0,dclCnt:0,modifyYn:"Y",imgInfo:[]},e.used_data.user_cellNo&&(e.used_data.item.cellNo=e.base64Decode(e.used_data.user_cellNo),e.phoneArr=e.used_data.item.cellNo.split("-")),e.check_list[1]=!0;else{e.subTitle="판매 글 수정하기",e.check_list[1]=!0,e.check_list[0]="Y"==e.used_data.item.dlexInclusYn?!0:!1,e.check_list[2]="Y"==e.used_data.item.dirTradePsbYn?!0:!1,e.phoneArr=e.base64Decode(e.used_data.user_cellNo).split("-"),m=f.used_rewrite;var n=[];if(null!=e.used_data.item.imgList){var o=e.used_data.item.imgList.items.length;o>e.FILE_NUM&&(o=e.FILE_NUM);for(var p=0;o>p;p++)n.push(e.used_data.item.imgList.items[p].imgUrl),e.orgImgFileList[p]=e.used_data.item.imgList.items[p].imgUrl}e.used_data.item.imgInfo=n,e.scrmode=!1}e.popOption={open:!1,data:"",target:null,index:0,close:function(){e.popOption.open=!1},show:function(a,b,c){""!=a&&(e.popOption.data=a,e.popOption.open=!0,e.popOption.target=b,e.popOption.index=c)}};for(var p=e.used_data.item.imgInfo.length;p<e.FILE_NUM;p++)e.used_data.item.imgInfo.push(""),e.orgImgFileList[p]="";var q=!1;e.dataForm={},e.submit_edit=function(){confirm("수정한 내용을 저장하시겠습니까?")&&e.submit()},e.submit=function(){e.check_word(function(){if(!q){if(0==e.photoCount)return alert("사진을 등록해주세요"),void b.element(a).scrollTop($("#pd1").position().top);if(""==e.used_data.item.bbcTitNm)return alert("상품명을 입력해주세요"),void b.element(a).scrollTop($("#pd2").position().top);if(""==e.used_data.item.dispNo)return alert("카테고리를 입력해주세요."),void b.element(a).scrollTop($("#pd3").position().top);if(""==e.used_data.item.salePrc)return alert("판매 금액을 입력해주세요"),void b.element(a).scrollTop($("#pd4").position().top);if(!e.check_list[1])return alert("중고라운지 서비스 제공을 위해서 필요한 최소한의 개인정보 이므로 동의를 해 주셔야만 서비스를 이용하실 수 있습니다."),void b.element(a).scrollTop($("#pd5").position().top);if(""==e.used_data.item.shaGoodsStatCd)return alert("상품 상태를 입력해주세요"),void b.element(a).scrollTop($("#pd6").position().top);if(e.scrmode&&!e.check_list[3])return void alert("판매등록 전 안내 내용을 확인하시고 동의해주세요");q=!0,e.pageLoading=!0,e.onePhotoUpload(0)}})},e.dataUpload=function(){e.dataForm={bbcNo:e.used_data.item.bbcNo,dispNo:e.used_data.item.dispNo,bbcTitNm:e.used_data.item.bbcTitNm,salePrc:e.used_data.item.salePrc,dlexInclusYn:e.check_list[0]?"Y":"N",cellNo:e.phoneArr[0]+"-"+e.phoneArr[1]+"-"+e.phoneArr[2],shaGoodsStatCd:e.used_data.item.shaGoodsStatCd,cellNoOppbAgrYn:e.check_list[1]?"Y":"N",dirTradePsbYn:e.check_list[2]?"Y":"N",shaBbcRegAgrYn:e.check_list[3]?"Y":"N",dirTradeRgnNm:e.used_data.item.dirTradeRgnNm,bbcCont:e.used_data.item.bbcCont,imgInfo:e.used_data.item.imgInfo,saleStatCd:e.used_data.item.saleStatCd},b.element("#board_write").bind("submit",function(a){var c=new FormData;c.append("mbrNo",e.loginInfo.mbrNo),c.append("userId",e.loginInfo.loginId),c.append("bbcNo",e.dataForm.bbcNo),c.append("dispNo",e.dataForm.dispNo),c.append("bbcTitNm",e.dataForm.bbcTitNm),c.append("salePrc",e.dataForm.salePrc),c.append("dlexInclusYn",e.dataForm.dlexInclusYn),c.append("cellNo",e.dataForm.cellNo),c.append("shaGoodsStatCd",e.dataForm.shaGoodsStatCd),c.append("cellNoOppbAgrYn",e.dataForm.cellNoOppbAgrYn),c.append("dirTradePsbYn",e.dataForm.dirTradePsbYn),c.append("shaBbcRegAgrYn",e.dataForm.shaBbcRegAgrYn),c.append("dirTradeRgnNm",e.dataForm.dirTradeRgnNm),c.append("bbcCont",e.dataForm.bbcCont),c.append("saleStatCd",e.dataForm.saleStatCd),$.ajax({url:m,type:"post",data:c,enctype:"multipart/form-data",async:!0,cache:!1,contentType:!1,processData:!1,success:function(a){e.pageLoading=!1,q=!1,b.element("#board_write").unbind("submit"),alert("상품 등록이 완료되었습니다."),location.href=f.used_main_link+"?"+e.baseParam},error:function(a){alert("판매글이 등록되지 않았습니다. 다시 등록해주세요"),e.pageLoading=!1,q=!1,console.log("error:글 등록 오류 ",a.statusText),b.element("#board_write").unbind("submit")}}),a.preventDefault()}),j(function(){b.element("#board_write").submit()},100)},e.onePhotoUpload=function(a){document.getElementById("pli_"+a).files[0]!=c?(b.element("#photo_write").bind("submit",function(c){var d=new FormData;""!=e.used_data.item.bbcNo&&d.append("bbcNo",e.used_data.item.bbcNo),d.append("userId",e.loginInfo.loginId),d.append("imgFileList",document.getElementById("pli_"+a).files[0]),d.append("rotateCd",e.rotateCode[a]),$.ajax({url:"http://www.lotte.com/display/boardImgInsert.lotte",type:"post",data:d,enctype:"multipart/form-data",async:!0,cache:!1,contentType:!1,processData:!1,success:function(c){console.log("one image upload :",c),b.element("#photo_write").unbind("submit"),""==e.used_data.item.bbcNo&&"0"!=c&&(e.used_data.item.bbcNo=c),e.next_step(a)},error:function(a){alert("판매글이 등록되지 않았습니다. 다시 등록해주세요"),console.log("error:이미지 업로드 오류 ",a.statusText),b.element("#photo_write").unbind("submit"),e.pageLoading=!1,q=!1}}),c.preventDefault()}),j(function(){b.element("#photo_write").submit()},100)):e.next_step(a)},e.next_step=function(a){a+=1,a<e.FILE_NUM?e.onePhotoUpload(a):e.dataUpload()};var r=5,s=292,t=217;e.appObj.isApp&&e.appObj.isAndroid&&(!e.appObj.isSktApp&&e.appObj.verNumber<s||e.appObj.isSktApp&&e.appObj.verNumber<t)&&(e.AccessUpload=!1),e.userVersionCheck=function(){if(confirm("롯데닷컴 앱 업데이트 후 이용 가능합니다. 지금 업데이트 하시겠습니까?")){var a="market://details?id=com.lotte";e.appObj.isSktApp&&(a="https://www.onestore.co.kr/userpoc/apps/view?pid=0000677011"),location.href=a}},e.getOrientation=function(a,b){var c=new FileReader;c.onload=function(a){var c=new DataView(a.target.result);if(65496!=c.getUint16(0,!1))return b(-2);for(var d=c.byteLength,e=2;d>e;){var f=c.getUint16(e,!1);if(e+=2,65505==f){if(1165519206!=c.getUint32(e+=2,!1))return b(-1);var g=18761==c.getUint16(e+=6,!1);e+=c.getUint32(e+4,g);var h=c.getUint16(e,g);e+=2;for(var i=0;h>i;i++)if(274==c.getUint16(e+12*i,g))return b(c.getUint16(e+12*i+8,g))}else{if(65280!=(65280&f))break;e+=c.getUint16(e,!1)}}return b(-1)},c.readAsArrayBuffer(a)},e.photoPreview=function(a){if(e.AccessUpload){var d=a.files[0],f=b.element(a).attr("index"),g=(new FileReader,1e3*r*1e3),h=b.element(a).parent().find("figure");h.children().remove(),e.rotateCode[f]=null;try{e.$apply()}catch(i){}if(d&&d!=c){if(!l(d.type))return void alert("jpg/png 파일만 업로드 가능합니다.");if(d.size>g)return void alert("사진 용량이 "+r+"MB 초과하였습니다.");e.click_photo?e.click_photo=!1:e.gatag("사진등록","이미지_",parseInt(f)+1),f>=4&&$(".photo_con").scrollLeft(70*f),loadImage(d,function(a){try{e.used_data.item.imgInfo[f]=a.toDataURL(),e.check_photoCount()}catch(b){h.append(a)}try{e.$apply()}catch(b){}},{maxWidth:800,minWidth:216,minHeight:216,cover:!0,canvas:!0}),e.getOrientation(d,function(a){e.rotateCode[f]=a;try{e.$apply()}catch(b){}})}}},e.click_photo=!1,e.addPhoto=function(){if(e.photoCount<e.FILE_NUM){e.click_photo=!0,e.gatag("사진등록","사진첨부");for(var a=0,b=0;b<e.FILE_NUM;b++)""==e.used_data.item.imgInfo[b]&&(a=b,b=e.FILE_NUM);$("#pli_"+a).trigger("click")}},e.deletePhoto2=function(){e.deletePhoto(e.popOption.target,e.popOption.index),e.popOption.close()},e.deletePhoto=function(a,c){var d=!0;if(e.used_data.item.imgInfo[c].indexOf("http://")>-1){e.pageLoading=!0;var g=e.used_data.item.imgInfo[c].split("/");$.ajax({type:"POST",url:f.used_img_del,dataType:"json",async:!0,data:{mbrNo:e.loginInfo.mbrNo,bbcNo:e.used_data.item.bbcNo,delFile:g[g.length-1]},success:function(a){"0000"==a.board_img_delete.response_code?console.log("삭제 완료"):(d=!1,alert(a.board_img_delete.response_msg)),e.pageLoading=!1},error:function(a){a.error.response_msg&&alert(a.error.response_msg),d=!1,console.log(a.responseText),e.pageLoading=!1},complete:function(f){d&&(e.used_data.item.imgInfo[c]="",e.rotateCode[c]="",e.orgImgFileList[c]="",b.element(a).parent().find("input[type=file]").val(""),e.check_photoCount())}})}else e.used_data.item.imgInfo[c]="",e.rotateCode[c]="",b.element(a).parent().find("input[type=file]").val(""),e.check_photoCount()},e.check_photoCount=function(){e.photoCount=0;for(var a=0;a<e.FILE_NUM;a++)""!=e.used_data.item.imgInfo[a]&&e.photoCount++},e.check_word=function(a,b){""!=e.used_data.item.bbcCont?$.ajax({type:"POST",url:f.board_chk,dataType:"json",data:{bbcCont:e.used_data.item.bbcCont},success:function(c){"0000"==c.board_chk_cont.response_code?(e.no_write="",null!=a&&a()):(e.no_write=c.board_chk_cont.response_msg,alert(c.board_chk_cont.response_msg),null!=b&&b())}}):null!=a&&a()},e.check_meetarea=function(){e.check_list[2]?$("#meet_input").removeAttr("disabled"):$("#meet_input").attr("disabled",!0)},e.gatag=function(a,b,c){var d="MO_중고라운지_등록하기";e.scrmode||(d="MO_중고라운지_수정하기"),c&&(b=10>c?b+"0"+c:b+""+c),k.evtTag(d,a,b,"","")},e.check_photoCount(),j(function(){e.check_byte(),e.check_meetarea()},500)}]),d.directive("orientable",function(){return{link:function(a,b,c){b.bind("load",function(b){a.imageSize={width:this.width,height:this.height}})}}}),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/mall/used_write_container.html",replace:!0,link:function(c,d,e){function f(a){var b=0;for(i=0;i<a.length;i++){var c=a.charAt(i);escape(c).length>4?b+=2:"\n"==c?"\r"!=a.charAt(i-1)&&(b+=1):b+="<"==c||">"==c?4:1}return b}c.go_back=function(){confirm("입력한 내용을 모두 취소하시겠습니까?")&&history.back()},c.selectCate=function(a){c.used_data.item.dispNo=a},c.selectGoodStat=function(a){c.gatag("상품상태",a),c.used_data.item.shaGoodsStatCd=a},$("#input_title").focusin(function(){b.element(a).scrollTop($("#pd2").position().top)}),$("#g_price").focusin(function(){b.element(a).scrollTop($("#pd4").position().top)}),$("#phone1").focusin(function(){b.element(a).scrollTop($("#pd5").position().top)}),$("#input_cont").focusin(function(){b.element(a).scrollTop($("#pd8").position().top)}),c.check_title=function(a){var b=c.used_data.item.bbcTitNm;""!=b&&b.length>a&&(alert(a+"자 이내로 입력해 주세요"),c.used_data.item.bbcTitNm=b.substr(0,a))},c.nowbyte=0;var g="",h=0;c.check_byte=function(){c.nowbyte=f(c.used_data.item.bbcCont),c.nowbyte>=300?(alert("최대 300바이트 입력 가능합니다."),c.used_data.item.bbcCont=g,c.nowbyte=h):(g=c.used_data.item.bbcCont,h=c.nowbyte)}}}})}(window,window.angular);