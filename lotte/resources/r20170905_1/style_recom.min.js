!function(a,b,c){"use strict";var d=b.module("lotteUtil");d.service("StyleRecom",["$window","$http","LotteCommon","commInitData",function(a,b,d,e){function f(a){if(a==c)return[];if(a.status===!1)return console.warn(a.message),j(),[];if(a.list==c)return[];var b,d,e,f,h=a.list,i=[];for(var k in h)for(e=h[k],d=e.length,b=0;d>b;b++)f=e[b],f.category=parseInt(k,10),f.score=Math.round(100*f.score),f.rx1=Math.round(1e4*f.rx1)/100,f.rx2=Math.round(1e4*f.rx2)/100,f.ry1=Math.round(1e4*f.ry1)/100,f.ry2=Math.round(1e4*f.ry2)/100,i.push(f);return i=i.sort(g)}function g(a,b){var c=a.score,d=b.score;return c>d?-1:d>c?1:0}function h(a,e){var f=[];for(var g in a)if(a[g]!=c){f=a[g];break}if(f==c||0==f.length)return void e([]);for(var h,i=[],k=f.length,l=0;k>l;l++)h=f[l],i.push(h.product_code);if(0==i.length)return void e([]);m=d.isTestFlag?d.stylePushPrdData+"?":m,m=(m+"").indexOf("?")>=0?m:m+"?";var n=m+"&goods_no="+i.splice(0,400).join();"localhost:8082"==location.host&&(n="http://mo.lotte.com/"+n),b({url:n,method:"GET"}).success(function(a){if(a.prdList!=c){for(var b,f=[],g=a.prdList.length,h=d.isTestFlag?d.styleRecomUrl:a.styleShopUrl,i=0;g>i;i++)b=a.prdList[i],b.imgUrl2||(b.imgUrl2=b.imgUrl.replace(/_280/g,"_550")),b!=c&&0!=b.price2&&f.push(b);e(f,h)}else e([])}).error(function(a){j(),e([])})}function i(a,b){try{for(var d=b.length,e=0,f=0;d>f;f++)o[a+b[f]]!=c&&(e|=o[a+b[f]]);return e}catch(g){}return""}function j(){var a=getScope(),b=new Date,c=b.getHours(),d=10>c?"0"+c:""+c,e=a.tClickBase;""!=n&&(e=n),a.sendTclick(e+"ProdDetail_DataError_"+d)}var k="LOTT2ed4a4b9022e8805e25baa2eba02f7598babe414a6e0d13a61e3f8e4",l=d.oddConceptAPI,m=d.stylePushPrdData,n="";this.setDotAPIUrl=function(a){m=a},this.setTclickBase=function(a){n=a};var o={F1:536870913,F2:536870914,F4:536870916,F8:536870920,F16:536870928,F32:536870944,M2:1073741826,M4:1073741828,M16:1073741840,M32:1073741856,A1:1,A2:2,A4:4,A8:8,A16:16,A32:32};this.gender={female:"F",male:"M",all:"A"},this.category={dresses:1,pants:2,shorts:4,skirts:8,tops:16,outers:32},this.detect=function(a,b){return a==c||""==a?(console.warn("NO IMAGE"),!1):b==c||"function"!=typeof b?(console.warn("NO CALLBACK FUNCTION"),!1):void $.ajax({url:l+"detect?url="+encodeURIComponent(a),type:"get",dataType:"json",async:!0,beforeSend:function(a){a.setRequestHeader("apikey",k)},success:function(a){b(f(a))},error:function(a){j(),b([])}})},this.search=function(a,b,e,f,g){if(a==c||""==a)return console.warn("NO ID"),!1;if(b==c||""==b)return console.warn("NO SEX"),!1;if(e==c||0==e.length)return console.warn("NO CATEGORY"),!1;if("object"!=typeof e&&(e=[e]),g==c||"function"!=typeof g)return console.warn("NO CALLBACK FUNCTION"),!1;var m=i(b,e);if(""==m)return console.warn("INCORRECT CATEGORY"),!1;var n={category:m,count:300},o=l+"search/"+a+"?"+$.param(n);if(n={recommcgcd:1},f!=c||""!=f){var p=parseInt(f,10);isNaN(p)||(n.recommcgcd=p)}$.ajax({url:o,type:d.isTestFlag?"GET":"POST",data:JSON.stringify(n),async:!0,method:d.isTestFlag?"GET":"POST",beforeSend:function(a){a.setRequestHeader("apikey",k),a.setRequestHeader("Content-Type","application/json")},success:function(a){h(a,g)},error:function(a){j(),g([])}})}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("lotteSlider",[]);d.controller("LotteSlideCtrl",["$scope",function(b){b.getTranslateXCssObj=function(a,b){var c={"-webkit-backface-visibility":"hidden","-moz-backface-visibility":"hidden","backface-visibility":"hidden","-webkit-transform":"translateX("+a+"px)","-ms-transform":"translateX("+a+"px)","-moz-transform":"translateX("+a+"px)",transform:"translateX("+a+"px)","-webkit-transition":"","-moz-transition":"","-o-transition":"",transition:""};return b&&b>0&&(c["-webkit-transition"]="-webkit-transform "+b+"ms",c["-moz-transition"]="-moz-transform "+b+"ms",c["-o-transition"]="-o-transform "+b+"ms",c.transition="transform "+b+"ms"),c},b.removeTranslateCSS=function(){return{"-webkit-backface-visibility":"","-moz-backface-visibility":"","backface-visibility":"","-webkit-transform":"","-ms-transform":"","-moz-transform":"",transform:""}},b.getCoordinates=function(a){var b=a.touches&&a.touches.length?a.touches:[a],c=a.changedTouches&&a.changedTouches[0]||a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]||b[0].originalEvent||b[0];return{x:c.clientX,y:c.clientY}},b.getTransXPos=function(b){var c=a.getComputedStyle(b.get(0)),d=new WebKitCSSMatrix(c.webkitTransform);return d.m41}}]),d.directive("lotteSlider",["$window","$timeout","$parse",function(a,c,d){return{controller:"LotteSlideCtrl",link:function(d,e,f,g){function h(){m=k.outerWidth(),l.css({display:"inline-block"}),n=l.outerWidth(),x=-(n-m);var a=d.getTransXPos;(a.x>0||a.x<x)&&i(0,500)}function i(a,b){l.css(d.getTranslateXCssObj(a,b)),k.trigger({type:"slide",posX:a,wrapWidth:m,contWidth:n})}function j(){k.on({"touchstart.lotteSlider":function(a){m=k.outerWidth(),n=l.outerWidth(),y=!1,z=!1,n>m&&(a.stopPropagation(),o=!0,q=d.getCoordinates(a),p=d.getTransXPos(l),t=Date.now())},"touchmove.lotteSlider":function(a){if(o){var b,c;if(r=d.getCoordinates(a),b=Math.abs(r.x-q.x),c=Math.abs(r.y-q.y),y||(z=b>c,y=!0),z){b>5&&a.preventDefault(),a.stopPropagation();var e=p+r.x-q.x;e>0?e/=3:x>e&&(e=x+(e-x)/3),i(e,0)}}},"touchend.lotteSlider":function(a){if(s=d.getCoordinates(a),o&&q.x!=s.x&&(Math.abs(q.x-s.x)>5&&a.preventDefault(),event.stopPropagation(),y=!1,z)){m=k.outerWidth();var b=d.getTransXPos(l);u=Date.now(),w=q.x>s.x?-1:1,v=u-t;var c=Math.abs(q.x-s.x),e=.4,f=c*e/v,g=b+m*f*w;g>0?g=0:x>g&&(g=x),(Math.abs(b-g)>30||0==g||g==x)&&i(g,500)}},"touchcancel.lotteSlider":function(a){}}),b.element(a).on("resize.lotteSlider orientationchange.lotteSlider",function(){h()})}var k=b.element(e),l=k.find(">").eq(0),m=k.width(),n=l.width(),o=!1,p=0,q=null,r=null,s=null,t=0,u=0,v=0,w=0,x=0;d.lotteSliderMoveXPos=function(a,b){m=k.width(),n=l.width(),a>0?a=0:Math.abs(a)>n-m&&(a=-(n-m)),b||(b=0),i(a,b)},d.reset=function(){o=!1,i(0,0),c(function(){h()})};var y=!1,z=!1;c(function(){h(),j()})}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteSideMylotte","lotteCommFooter","lotteSlider","lotteSns"]);d.controller("StyleRecomCtrl",["$scope","LotteCommon","commInitData",function(a,b,c){function d(a){return 10>a?"0"+a:a+""}function e(a,b,c,d,e,f){var g=new Date(a,b,c,d,e,f);return a&&b&&c&&(g.setFullYear(a),g.setMonth(b-1),g.setDate(c),d&&g.setHours(d),e&&g.setMinutes(e),f&&g.setSeconds(f)),g.getTime()}a.showWrap=!0,a.contVisible=!0,a.subTitle="스타일추천",a.isShowThisSns=!0,a.planShopSns=!0,a.share_img=c.query.img,a.SR_IMG="",a.DETECT_LIST=[],a.PROD_LIST=[],a.PROD_ORIGIN_LIST=[],a.CATE_NO=c.query.cate,a.SEX=[{label:"여성",data:"F"},{label:"남성",data:"M"},{label:"전체",data:"A"}],a.childSex=[{label:"여아",data:"F"},{label:"남아",data:"M"},{label:"전체",data:"A"}],a.CATE=[{label:"상의",data:16,tclick:1,selected:!1},{label:"아우터",data:32,tclick:6,selected:!1},{label:"긴바지",data:2,tclick:2,selected:!1},{label:"반바지",data:4,tclick:3,selected:!1},{label:"스커트",data:8,tclick:5,selected:!1},{label:"원피스",data:1,tclick:4,selected:!1}],a.selectedID="",a.selectedSex="";var f=new Date,g=f.getFullYear()+d(f.getMonth()+1)+d(f.getDate()),h=f.getTime();if(c.query.testDate){c.query.testDate;g=c.query.testDate,h=e(g.substring(0,4),g.substring(4,6),g.substring(6,8),g.substring(8,10),g.substring(10,12),g.substring(12,14))}a.styRecomBnr=!1,h<e(2017,6,30,17,0)&&(a.styRecomBnr=!0)}]),d.directive("styleRecomImageLoad",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){function e(){b.detectStyleRecom()}function f(){b.$parent.SR_IMG="",a(function(){b.alert_2016("유효하지 않은 이미지입니다.")},1)}c.bind("load",e),c.bind("error",f)}}}]),d.directive("lotteContainer",["LotteCommon","commInitData","StyleRecom","$timeout","$window","LotteStorage",function(d,e,f,g,h,i){return{templateUrl:"/lotte/resources_dev/search/style_recom_container.html",replace:!0,link:function(j,k,l){function m(){if(e.query.img==c||""==e.query.img)return void j.alert_2016("이미지가 없습니다.");j.SR_IMG=e.query.img;var a=b.element(h);a.on("scroll orientationchange",D),a.on("unload",n)}function n(){var a={scrollY:b.element(h).scrollTop(),page_no:I,prod_list:j.PROD_ORIGIN_LIST,detect_list:j.DETECT_LIST,cate:j.CATE,selected_id:j.selectedID,gender:j.selectedSex};i.setSessionStorage("styleRecomStorage",a,"json")}function o(a){j.DETECT_LIST=a,(a==c||0==a.length)&&j.alert_2016("추천 결과가 없습니다.<br/>다른 이미지를 사용하세요."),g(p,1),g(function(){b.element(".style_clip_list li:first-child .style_clip").trigger("click")},50),g(function(){j.isShowLoading=!1},0)}function p(){g(function(){var a=j.DETECT_LIST;b.element(".style_clip_list li span.style_img img").each(function(c,d){var e=b.element(d),f=a[c],g=f.rx1,h=f.rx2,i=f.ry1,j=f.ry2,k=Math.min(h-g,j-i),l=g+(h-g)/2,m=i+(j-i)/2;e.width(99/k*100);var n=e.width(),o=e.height(),p=Math.round(n/100*(l-k/2)),q=Math.round(o/100*(m-k/2));e.css({position:"absolute",left:-p,top:-q,opacity:1})})},10)}function q(a,b){var c=a.parent();if(!c.hasClass("on")){var d=c.siblings();d.find(".dummy").stop(!0),d.find(".style_ani").css("background-position","0 0"),d.removeClass("on");var e={duration:400,progress:s,easing:j.checkJQueryEasing("easeOutQuad")},f=a.find(".dummy"),g=b.score;f.css("left",0);try{f.animate({left:g},e)}catch(h){console.warn("animateStyleClip animate error"),f.css("left",g),s({ani:f})}c.addClass("on")}}function r(a){var b=$(".clipping_beauty .clip_box"),c=b.find("img"),d=c.width(),e=c.height(),f=Math.round(e/100*a.ry1),g=e-Math.round(e/100*a.ry2),h=Math.round(d/100*a.rx1),i=d-Math.round(d/100*a.rx2),k=b.find(".dummy");k.stop(!0);var l={left:h,right:i,top:f,bottom:g},m={duration:250,progress:t,easing:j.checkJQueryEasing("easeOutQuad")};try{k.animate(l,m)}catch(n){console.warn("setClippingArea animate error"),k.css(l),t({elem:k})}}function s(a,b,c){var d=$(a.elem),e=d.parent(),f=Math.round(parseInt(d.css("left"),10)),g=Math.round(f/2)-1;0>g&&(g=0);var h=g%10*110,i=110*(Math.floor(g/10)+1);e.css("background-position",-h+"px "+-i+"px"),e.find(".style_pct em").text(f)}function t(a,b,c){var d=$(a.elem),e=d.parent(),f=parseInt(d.css("left"),10),g=parseInt(d.css("right"),10),h=parseInt(d.css("top"),10),i=parseInt(d.css("bottom"),10);e.find(".clip_top").css({height:h}),e.find(".clip_btm").css({height:i}),e.find(".clip_lft").css({width:f,top:h,bottom:i}),e.find(".clip_rgt").css({width:g,top:h,bottom:i}),e.find(".clip_brd").css({left:f,right:g,top:h,bottom:i})}function u(a){switch(a.category){case 1:case 8:j.selectedSex="F";break;default:""==j.selectedSex&&("M"==j.loginInfo.genSctCd||"F"==j.loginInfo.genSctCd?j.selectedSex=j.loginInfo.genSctCd:j.selectedSex="A")}x(a.category),w(),y()}function v(){if(0==z().length)for(var a,b=j.CATE.length,c=0;b>c;c++)a=j.CATE[c],a.selected=0==c;w(),y()}function w(){g(function(){b.element(".slider_wrap > div").length>0&&b.element(".slider_wrap > div").scope().reset()},50)}function x(a){for(var b,c=j.CATE.length,d=0;c>d;d++)b=j.CATE[d],b.selected=b.data==a}function y(){j.isShowLoading=!0;var a=z(),b=f.search(j.selectedID,j.selectedSex,a,e.query.cate,A);b===!1&&(j.isShowLoading=!1,j.alert_2016("데이터를 불러올 수 없습니다.<br/>잠시 후에 다시 시도해 주세요."))}function z(){var a,b=j.CATE.length;"M"==j.selectedSex&&(b=4);for(var c=[],d=0;b>d;d++)a=j.CATE[d],a.selected&&c.push(a.data);return c}function A(a){j.PROD_ORIGIN_LIST=a,0==a.length&&(j.PROD_LIST.length=0),H=Math.ceil(a.length/G),I=0,B(),g(function(){j.isShowLoading=!1},0)}function B(){J||I>=H||(J=!0,g(C,100))}function C(){I++;var a=I*G;j.PROD_LIST=j.PROD_ORIGIN_LIST.slice(0,a),J=!1}function D(a){F();var b=K.scrollTop(),c=K.outerHeight(),d=O.outerHeight();0==L.length?0:L.offset().top,M.height();j.PROD_LIST.length>0&&b+3*c>=d&&B()}function E(b){if(b.offsetX!=c&&b.pageX!=c){F();var d=K.scrollTop();47>d&&$(a).scrollTop(47)}}function F(){(K==c||M==c||N==c||O==c)&&(K=b.element(h),M=b.element("#head_sub"),N=b.element(".clipping_beauty"),O=b.element("#wrapper")),(L==c||0==L.length)&&(L=b.element("#style_category"))}var G=j.appObj.isTablet?100:30,H=0,I=0,J=!1;j.detectStyleRecom=function(){if(j.isShowLoading=!0,null==history.state||"stylerecom"!=history.state.name){history.replaceState({name:"stylerecom"},"stylerecom");var d=f.detect(j.SR_IMG,o);d===!1&&(j.isShowLoading=!1,j.alert_2016("데이터를 불러올 수 없습니다.<br/>잠시 후에 다시 시도해 주세요."))}else{var e=i.getSessionStorage("styleRecomStorage","json");if("localhost:8082"==location.host&&(e=null),e==c||e.detect_list==c||e.selected_id==c||e.gender==c||e.cate==c||e.prod_list==c||0==e.detect_list.length||0==e.prod_list.length)f.detect(j.SR_IMG,o);else{j.DETECT_LIST=e.detect_list,g(p,1),j.CATE=e.cate,j.selectedSex=e.gender,j.selectedID=e.selected_id;for(var k,l=j.DETECT_LIST.length,m=-1,n=0;l>n;n++)if(k=j.DETECT_LIST[n],k.id==j.selectedID){m=n;break}m>=0&&k!=c&&g(function(){q(b.element(".style_clip_list li").eq(m).find(".style_clip"),k),r(k)},100),j.PROD_ORIGIN_LIST=e.prod_list,H=Math.ceil(j.PROD_ORIGIN_LIST.length/G),e.page_no!=c?(I=e.page_no-1,0>I&&(I=0)):I=0,B(),g(function(){var c=b.element(h).scrollTop();e.scrollY!=c&&$(a).scrollTop(e.scrollY)},200),i.delSessionStorage("styleRecomStorage"),j.isShowLoading=!1}}},j.selectStyleClip=function(a,b,c){j.selectedID=b.id,q($(a.currentTarget),b),r(b),u(b),E(a),j.sendTclick("m_DC_StyleReco_Swp_Rel_A"+(c+1))},j.selectGender=function(a,b,c){j.selectedSex!=a.data&&(j.selectedSex=a.data,g(v,1),E(c),j.sendTclick("m_DC_StyleReco_Clk_tap_"+(b+1)))},j.selectCategory=function(a,b){var c=z();if(c.join("")!=a.data){x(a.data),y(),E(b);var d=a.tclick,e="A";"M"==j.selectedSex?(e="B",6==d&&(d=4)):"A"==j.selectedSex&&(e="C"),j.sendTclick("m_DC_StyleReco_Swp_Cate_"+e+d)}},j.gotoProductDetail=function(a,b){a.curDispNoSctCd=14;var c=b+1;j.productView(a,null,null,"m_DC_StyleReco_Clk_Prd_idx"+(10>c?"0"+c:c))},j.getProductUrl=function(a,b){a.curDispNoSctCd=14;var c=b+1;return j.getProductViewUrl(a,"m_DC_StyleReco_Clk_Prd_idx"+(10>c?"0"+c:c),!0)};var K,L,M,N,O;m(),j.styRecomBnrUrl=function(){a.location.href=d.prdlstUrl+"?curDispNo=5407118&"+j.baseParam+"&tclick=m_DC_StyleReco_Clk_event"}}}}])}(window,window.angular);