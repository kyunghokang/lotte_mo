{"version":3,"file":"sslive.min.js","sources":["sslive.js"],"names":["window","angular","undefined","app","module","controller","$scope","LotteCommon","$http","commInitData","showWrap","contVisible","subTitle","isShowThisSns","remainTime","loading","previewDate","query","goods_info","price","previewstr","get","sslive_good","success","data","sslive","loadTalk","setTimeout","vod_useScroll","autoVideoPlay","setInterval","$","text","last_bbc_no","sslive_talk","params","start_dtime","spdpNo","spdp_no","bbcNo","talklist","result","items","length","concat","ms","height","scrollTop","reloadTalk","saveTalk","msg","val","trim","alert","focus","word_list","word_ar","i","indexOf","url","sslive_save","param","cont","method","headers","Content-Type","ss_login","location","href","loginUrl","baseParam","encodeURIComponent","directive","templateUrl","replace","link","el","attrs"],"mappings":"CAAA,SAAUA,EAAQC,EAASC,GACvB,YAEA,IAAIC,GAAMF,EAAQG,OAAO,OACrB,YACA,WACA,eAEA,kBACA,YAGJD,GAAIE,WAAW,cAAe,SAAU,cAAc,QAAQ,eAAgB,SAASC,EAAQC,EAAYC,EAAMC,GAC7GH,EAAOI,UAAW,EAClBJ,EAAOK,aAAc,EACrBL,EAAOM,SAAW,MAClBN,EAAOO,eAAgB,EACvBP,EAAOQ,WAAa,GACpBR,EAAOS,SAAU,EACjBT,EAAOU,YAAcP,EAAaQ,MAAe,QACjDX,EAAOY,YACHC,MAAQ,GASZb,EAAOc,WAAa,GACjBd,EAAOU,aAAed,IACrBI,EAAOc,WAAa,WAAad,EAAOU,aAG5CR,EAAMa,IAAId,EAAYe,YAAa,IAAKhB,EAAOc,YAC1CG,QAAQ,SAASC,GAEdlB,EAAOY,WAAaM,EAAKC,OACzBnB,EAAOoB,SAAS,MAChBC,WAAW,WACPC,eAAgB,EAChBC,cAAc,YAAa,eAI5B,MAGHC,YAAY,WACgB,GAArBxB,EAAOQ,YACNR,EAAOoB,SAAS,MAEhBpB,EAAOS,UACPT,EAAOQ,YAAc,EACrBiB,EAAE,YAAYC,KAAK1B,EAAOQ,cAE/B,MAGX,IAAImB,GAAc,GAClB3B,GAAOoB,SAAW,WACdpB,EAAOS,SAAU,EACjBP,EAAMa,IAAId,EAAY2B,aAAcC,QACxBC,YAAc9B,EAAOY,WAAWkB,YAChCC,OAAS/B,EAAOY,WAAWoB,QAC3BC,MAAQN,KAEfV,QAAQ,SAASC,GACI,GAAfS,GACC3B,EAAOkC,SAAWhB,EAAKiB,OAAOC,MAC3BlB,EAAKiB,OAAOC,MAAMC,OAAS,IAC1BV,EAAc3B,EAAOkC,SAASlC,EAAOkC,SAASG,OAAS,GAAGJ,QAG3Df,EAAKiB,OAAOC,MAAMC,OAAS,IAC1BrC,EAAOkC,SAAWlC,EAAOkC,SAASI,OAAOpB,EAAKiB,OAAOC,OACrDT,EAAc3B,EAAOkC,SAASlC,EAAOkC,SAASG,OAAS,GAAGJ,OAGlEZ,WAAW,WACPrB,EAAOQ,WAAa,GACpBiB,EAAE,YAAYC,KAAK1B,EAAOQ,WAC1B,IAAI+B,GAAKd,EAAE,iBAAiBe,QAC5Bf,GAAE,YAAYgB,UAAUF,GACxBvC,EAAOS,SAAU,GAClB,QAKfT,EAAO0C,WAAa,WAChB1C,EAAOoB,SAAS,OAIpBpB,EAAO2C,SAAW,WACd,GAAIC,GAAMnB,EAAE,SAASoB,MAAMC,MAC3B,IAAiB,GAAdF,EAAIP,OACHU,MAAM,eACNtB,EAAE,SAASuB,YACV,CAED,GAAGhD,EAAOY,WAAWqC,WAAarD,GAA4C,MAA/BI,EAAOY,WAAWqC,UAE7D,IAAI,GADAC,GAAUlD,EAAOY,WAAWqC,UAAUb,MAClCe,EAAE,EAAGA,EAAED,EAAQb,OAAQc,IAC3B,GAAGP,EAAIQ,QAAQF,EAAQC,KAAO,EAE1B,WADAJ,OAAM,uBAAyBG,EAAQC,GAAK,yBAKpDnD,GAAOS,UACPgB,EAAE,SAASoB,IAAI,IACf3C,GACImD,IAAKpD,EAAYqD,YAAc,WAAatD,EAAOY,WAAWoB,QAC9Dd,KAAMO,EAAE8B,OAAOC,KAAOZ,IACtBa,OAAQ,OACRC,SAAUC,eAAiB,uCAC5B1C,QAAQ,SAASC,GAChBlB,EAAOoB,gBAKvBpB,EAAO4D,SAAW,WACdC,SAASC,KAAO7D,EAAY8D,SAAW,IAAI/D,EAAOgE,UAAY,yBAA8BC,mBAAmBvE,EAAOmE,SAASC,KAAM,aAI7IjE,EAAIqE,UAAU,iBAAkB,WAC5B,OACIC,YAAc,kDACdC,SAAU,EACVC,KAAO,SAASrE,EAAQsE,EAAIC,SAOrC7E,OAAQA,OAAOC","sourceRoot":"/","sourcesContent":["(function(window, angular, undefined) {\n    'use strict';\n\n    var app = angular.module('app', [\n        'lotteComm',\n        'lotteSrh',\n        'lotteSideCtg',\n        // 'lotteSideMylotte',\n        'lotteCommFooter',\n        'lotteSns'\n    ]);\n        \n    app.controller('ssliveCtrl', ['$scope', 'LotteCommon','$http','commInitData', function($scope, LotteCommon,$http,commInitData) {\n        $scope.showWrap = true;\n        $scope.contVisible = true;\n        $scope.subTitle = \"생생#\"; //서브헤더 타이틀\n        $scope.isShowThisSns = true;\n        $scope.remainTime = 15; \n        $scope.loading = false;\n        $scope.previewDate = commInitData.query['preview'];\n        $scope.goods_info = {\n            price : 0\n        }\n        \n        //IOS 앱일때 액션바 제거\n        /*\n        if($scope.appObj.isApp && $scope.appObj.isIOS){\n            console.log(\"call app interface\");\n            location.href = \"lottebridge://lotteapps/hide\" ;\n        }*/\n        $scope.previewstr = \"\";\n        if($scope.previewDate != undefined){\n            $scope.previewstr = \"preview=\" + $scope.previewDate;\n        }                    \n        //상품정보 로드\n        $http.get(LotteCommon.sslive_good +\"?\"+ $scope.previewstr) \n            .success(function(data) {\n                //console.log(data);\n                $scope.goods_info = data.sslive;\n                $scope.loadTalk(null);\n                setTimeout(function(){\n                    vod_useScroll = false; //스크롤시 자동재생 못하게 설정\n                    autoVideoPlay('autoVideo', '#autoVideo');\n                    \n                    //풋터영역 확보 - 차후 제거\n                    //$(\"#footer\").after(\"<div style='height:auto;padding-bottom:50px;box-sizing:border-box;clear:both'></div>\");\n                }, 1500);            \n            \n                //1초 마다 갱신 후 15초에 한번씩 생생톡 로드 \n                setInterval(function(){\n                    if($scope.remainTime == 1){\n                        $scope.loadTalk(null);\n                    }\n                    if(!$scope.loading){\n                        $scope.remainTime -= 1;    \n                        $(\"#timebox\").text($scope.remainTime);\n                    }                                        \n                }, 1000);\n        });\n        //생생톡 로드 공통함수 \n        var last_bbc_no = \"0\";\n        $scope.loadTalk = function(){\n            $scope.loading = true;\n            $http.get(LotteCommon.sslive_talk, {params : {\n                        start_dtime : $scope.goods_info.start_dtime,//$scope.loginInfo.loginId,\n                        spdpNo : $scope.goods_info.spdp_no,\n                        bbcNo : last_bbc_no \n                    }}) \n                .success(function(data) {\n                    if(last_bbc_no == 0){\n                        $scope.talklist = data.result.items;\n                        if(data.result.items.length > 0){\n                            last_bbc_no = $scope.talklist[$scope.talklist.length - 1].bbcNo;\n                        }\n                    }else{\n                        if(data.result.items.length > 0){ //추가 목록이 있으면\n                            $scope.talklist = $scope.talklist.concat(data.result.items);\n                            last_bbc_no = $scope.talklist[$scope.talklist.length - 1].bbcNo;\n                        }\n                    }                    \n                    setTimeout(function(){\n                        $scope.remainTime = 15;\n                        $(\"#timebox\").text($scope.remainTime);                \n                        var ms = $(\".talkbox > ul\").height();\n                        $(\".talkbox\").scrollTop(ms);                        \n                        $scope.loading = false;\n                    }, 100);\n                    \n            });            \n        }\n        //생생톡 리로드\n        $scope.reloadTalk = function(){\n            $scope.loadTalk(null);\n        }\n\n        //생생톡 전송 \n        $scope.saveTalk = function(){\n            var msg = $(\"#talk\").val().trim();\n            if(msg.length == 0){\n                alert(\"내용을 입력해주세요.\"); \n                $(\"#talk\").focus();\n            }else{\n                //금칙어 체크 \n                if($scope.goods_info.word_list != undefined && $scope.goods_info.word_list != null){\n                    var word_ar = $scope.goods_info.word_list.items;                \n                    for(var i=0; i<word_ar.length; i++){\n                        if(msg.indexOf(word_ar[i]) >= 0){\n                            alert(\"고객님께서 입력하신 댓글에\\n금칙어(\" + word_ar[i] + \")가 포함되어,\\n전송하실 수 없습니다.\");\n                            return;\n                        }\n                    }                \n                }\n                if(!$scope.loading){\n                    $(\"#talk\").val(\"\");\n                    $http({\n                        url: LotteCommon.sslive_save + \"?spdpNo=\" + $scope.goods_info.spdp_no,\n                        data: $.param({cont : msg}),\n                        method: 'POST',\n                        headers: {'Content-Type' : 'application/x-www-form-urlencoded'}\n                    }).success(function(data) {\n                        $scope.loadTalk();                    \n                    });                      \n                }\n            }   \n        }\n        $scope.ss_login = function(){\n            location.href = LotteCommon.loginUrl + '?'+$scope.baseParam + '&adultChk=N'+\"&targetUrl=\" + encodeURIComponent(window.location.href, 'UTF-8');\n        }\n    }]);\n\n    app.directive('lotteContainer', function() {\n        return {\n            templateUrl : '/lotte/resources_dev/mall/sslive_container.html',\n            replace : true,\n            link : function($scope, el, attrs) {\n                \n                \n            }\n        };\n    });\n\n})(window, window.angular);"]}