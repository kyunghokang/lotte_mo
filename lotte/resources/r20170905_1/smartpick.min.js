!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","lotteProduct","lotteNgSwipe"]);d.controller("smartpickCtrl",["$scope","$http","$filter","$location","$window","$timeout","LotteCommon","LotteUtil","commInitData","LotteStorage","LotteUserService","$compile",function(d,e,f,g,h,i,j,k,l,m,n,o){d.showWrap=!0,d.contVisible=!0,d.ctgDispNo="5539740",d.curDispNo=d.ctgDispNo,d.curDispNoSctCd="64",d.subTitle="스마트픽",d.pageLoading=!0,d.productListLoading=!1,d.productMoreScroll=!0,d.winWidth=b.element(h).width(),d.productListItemKey=["prd_deal_list"],d.productOnlyNumberKey=["discounted_price","original_price","pmg_gdas_cnt","price","price1","price2","review_count","saleCnt","sale_cnt","sale_rate"],b.element(h).on("resize.main orientationchange.main",function(a){d.winWidth=b.element(h).width()}),d.screenDataReset=function(){d.productMoreScroll=!0,d.screenData={page:0,pageSize:15,listTotal:0,pageEnd:!1,reward_banner:{},deal_banners:[],mix_banner:!1,mixed_pos:0,bannerMixContents:[],ban_list:[],mrk_rnk:[],prd_deal_list:[]}},d.getThemaDataUrl=function(a){var b=j.smartpickData+"?";if(b+="&rowsPerPage="+d.screenData.pageSize,a.page&&(b+="&page="+a.page),j.isTestFlag){try{console.log("url ::::: "+b)}catch(c){}b=j.smartpickData}return b},d.resetLoading=function(){d.pageLoading=!1,d.productListLoading=!1,d.$parent.LotteSuperBlockStatus=!1},d.loadScreenData=function(a){if(d.$parent.LotteSuperBlockStatus=!0,a.page&&1!=a.page?d.productListLoading=!0:d.pageLoading=!0,d.screenData.pageEnd)return d.productMoreScroll=!1,d.resetLoading(),!0;var f={method:"get",url:d.getThemaDataUrl(a)};e(f).success(function(e){d.productMoreScroll=!0;var f=[];if(typeof e.main_contents==c)return!1;f=e.main_contents,d.loopData=b.copy(d.screenData),a.loadContents?d.productMoreScroll=!1:(a.page||(d.screenData.page=1),a.page>1&&(d.loopData={prd_deal_list:!0}),a.page&&1!=a.page||!d.firstLoopData||(d.loopData=b.extend(d.loopData,d.firstLoopData))),b.forEach(d.loopData,function(e,g){if(f[g]!=c)if(f[g].items!=c){if(d.productListItemKey.indexOf(g)>-1)for(var h=0;h<f[g].items.length;h++)b.forEach(f[g].items[h],function(a,c){d.productOnlyNumberKey.indexOf(c)>-1&&(f[g].items[h][c]=parseInt((a+"").replace(/\,/gi,""))),b.forEach(d.loopData,function(a,d){g==d&&b.forEach(a,function(a,b){c==b&&(f[g].items[h][a]=f[g].items[h][c])})})});a.page>1?(f[g].items&&0!=f[g].items.length||(d.productMoreScroll=!1),d.screenData[g]=d.screenData[g].concat(f[g].items)):d.screenData[g]=f[g].items}else d.screenData[g]=f[g]});var g=[];if(!f.prd_deal_list.items.length)return d.screenData.pageEnd=!0,void(d.productMoreScroll=!1);var h=(d.screenData.page-1)*d.screenData.pageSize,i=d.screenData.prd_deal_list,j=d.screenData.ban_list,k="mrk_rnk",l=i.length,m=null,n=0,o=0;if(!a.page||1==a.page)for(d.screenData.mixed_pos=0,d.screenData.deal_banners=[],n=0;n<j.length;n++)"rewardevent"==j[n].banner_nm?d.screenData.reward_banner=j[n]:d.screenData.deal_banners.push(b.extend({bannerIdx:o++},j[n]));for(n=h;l>n;n++)m=d.joinBannerContent(n+1,j,k),m&&g.push(m),i[n].isProduct=!0,i[n].pIdx=n,g.push(i[n]);a.page&&1!=a.page?d.screenData.bannerMixContents=d.screenData.bannerMixContents.concat(g):d.screenData.bannerMixContents=g,d.screenData=b.copy(d.screenData)}).error(function(a){console.log("MainContent Data 오류")})["finally"](function(a){d.resetLoading()})},d.joinBannerContent=function(a,c,e){var f=null;try{var g=0,h=[];for(g=d.screenData.mixed_pos;g<c.length;g++)(c[g][e]==a||0==c[g][e]&&1==a)&&(d.screenData.mixed_pos=g,h.push(b.extend({bannerIdx:g,bannerPrioriry:c[g][e]},c[g])));h.length>1?f={isSwipe:!0,items:h}:1==h.length&&(h[0].isBanner=!0,f=h[0])}catch(i){console.log("Error::checkBanner")}return f};var p=m.getSessionStorage("smartPickLoc"),q=m.getSessionStorage("smartPickData"),r=m.getSessionStorage("smartPickScrollY");if(p==a.location.href&&null!=q&&"true"!=l.query.localtest){var s=JSON.parse(q);d.screenData=s.screenData,d.pageLoading=!1,i(function(){b.element(h).scrollTop(r)},800)}else d.screenDataReset(),d.loadScreenData({page:++d.screenData.page});b.element(h).on("unload",function(a){var c={};c.screenData=d.screenData,!l.query.localtest&&d.leavePageStroage&&(m.setSessionStorage("smartPickLoc",g.absUrl()),m.setSessionStorage("smartPickData",c,"json"),m.setSessionStorage("smartPickScrollY",b.element(h).scrollTop()))})}]),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/mall/smartpick_container.html",link:function(c,d,e){function f(a){return a=(a+"").indexOf("?")>-1?a:a+"?","?"!=a.substring(a.length-1,a.length)&&(a+="&"),a+c.baseParam}c.getProductData=function(){c.loadScreenData({page:++c.screenData.page}),c.sendTclick("m_DC_Smartpick_"+c.ctgDispNo+"_load"+(c.screenData.page-1))},c.linkUrl=function(d,e,g,h){if(e)c.sendOutLink(d),g&&c.sendTclick(g);else{var d=f(d);h&&b.forEach(h,function(a,b){d+="&"+b+"="+a}),g&&(d+="&tclick="+g),a.location.href=d}}}}})}(window,window.angular);