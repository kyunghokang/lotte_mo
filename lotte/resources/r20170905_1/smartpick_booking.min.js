function searchMartClose(){$("#mart").show(),$("#searchMartPop").hide()}function searchMartResult(a){if("search"==mapMode&&($("#crspk_name_"+martIndex).val(a.name),$("#crspk_corp_cd_"+martIndex).val(a.crspk_corp_cd),$("#crspk_corp_str_sct_cd_"+martIndex).val(a.crspk_corp_str_sct_cd),$("#crspk_str_no_"+martIndex).val(a.crspk_str_no),$("#crspk_addr_"+martIndex).val(a.address),$("#crspk_phone_"+martIndex).val(a.tel),$("#crspk_str_no_"+martIndex).trigger("change"),$("#crspk_name_"+martIndex).trigger("change"),$("#crspk_corp_cd_"+martIndex).trigger("change"),$("#crspk_addr_"+martIndex).trigger("change"),$("#crspk_phone_"+martIndex).trigger("change"),$("#crspk_corp_str_sct_cd_"+martIndex).trigger("change"),0==$("#scr_a:checked").length&&0==martIndex))for(var b=getScope().sevenStore.length,c=1;b>c;c++)$("#crspk_name_"+c).val(a.name),$("#crspk_corp_cd_"+c).val(a.crspk_corp_cd),$("#crspk_corp_str_sct_cd_"+c).val(a.crspk_corp_str_sct_cd),$("#crspk_str_no_"+c).val(a.crspk_str_no),$("#crspk_addr_"+c).val(a.address),$("#crspk_phone_"+c).val(a.tel),$("#crspk_str_no_"+c).trigger("change"),$("#crspk_name_"+c).trigger("change"),$("#crspk_corp_cd_"+c).trigger("change"),$("#crspk_addr_"+c).trigger("change"),$("#crspk_phone_"+c).trigger("change"),$("#crspk_corp_str_sct_cd_"+c).trigger("change")}!function(a,b,c){"use strict";var d=b.module("lotteMap",[]);d.controller("MapInfoCtrl",["$scope","$http","LotteCommon",function(b,d,e){b.isOpenedMap=!1,b.$on("closeStoreMap",function(a,c){b.isOpenedMap=!1}),b.$on("showStoreMap",function(a,c){var d=!1;$("#googlemap").length>0&&(d=!0),b.store_map(c.goods_no,d,c.entr_no,c.entr_contr_no,c.smp_ecoupon_yn)}),b.store_map=function(a,c,g,h,i){return"boolean"!=typeof c||c===!1?void f("http://maps.googleapis.com/maps/api/js?",function(){b.store_map(a,!0,g,h,i)}):(console.log("google_map called!!"),void d.get(e.productMobileNaverMap,{params:{goods_no:a,smp_entr_no:g,smp_entr_contr_no:h,smp_ecoupon_yn:i}}).success(function(a){console.log("data Success!!"),b.naverStoreMapData=a.mobileNaverMap;var c=b.naverStoreMapData.smartpick_store_addr;if(c.total_count>0){var d=c.items[0].post_addr+" "+c.items[0].dtl_addr;setTimeout(function(){var a=new google.maps.LatLng("37.5675451","126.9773356"),c={center:a,disableDefaultUI:!0,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControl:!0},e=new google.maps.Map(document.getElementById("map-canvas"),c),f=new google.maps.Geocoder;f.geocode({address:d},function(a,c){if(c==google.maps.GeocoderStatus.OK){var d=new google.maps.Marker({map:e,icon:"http://static.naver.com/maps/ic_spot.png",title:b.naverStoreName,position:a[0].geometry.location});e.setCenter(d.position),e.setZoom(15)}else console.log("주소검색에 실패하였습니다.")})},10),b.naverStoreName=c.items[0].shop_nm,b.naverStoreAddr=c.items[0].post_addr+c.items[0].dtl_addr}b.isOpenedMap=!0}).error(function(){alert("매장위치 조회 중 오류가 발생하였습니다.\n잠시 후 조회해 주세요.")}))};var f=function(b,d,e,f,g){if("string"==typeof b&&b!=c){var h=!1,i=document.getElementsByTagName("head")[0],j=document.createElement("script"),e=e&&"string"==typeof e?e:"UTF-8";g&&"string"==typeof g&&""!=g&&(j.id=g),j.id="googlemap",j.src=b,j.charset=e,j.type="text/javascript",j.async=!0,j.defer="boolean"==typeof f?f:!0,"function"==typeof d&&(j.onreadystatechange=function(){if("loaded"==this.readyState||"complate"==this.readyState){if(h)return;a.setTimeout(d(),1),h=!0}},j.onload=function(){h||(a.setTimeout(d(),1),h=!0)}),i.appendChild(j)}}}]),d.directive("mapInfo",function(){return{templateUrl:"/lotte/resources_dev/common/templates/map_info.html",replace:!0,link:function(a,b,c){},controller:"MapInfoCtrl"}})}(window,window.angular);var martIndex=0,mapMode="search";!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","lotteMap"]);d.controller("SmpBookingCtrl",["$scope","$http","$timeout","LotteCommon","LotteForm","commInitData","LotteStorage",function(a,d,e,f,g,h,j){function k(a){return 10>a&&(a="0"+a),a}a.ver="20170515",a.resultData={list:[],seven:[]},a.check_param=!1,a.showWrap=!0,a.contVisible=!0,a.pageLoading=!0,a.split_str=":^:",a.frame=-1,a.history_back=-1,a.history_len=history.length,h.query.cur_pg!=c&&""!=h.query.cur_pg&&(a.frame=parseInt(h.query.cur_pg)),a.base_goods_no=h.query.gno,a.sevenStore=[],a.scr_a=!1,a.onemore=!1,a.smpLocation=[],a.TITLE=["스마트픽 매장 선택하기","스마트픽 지점 찾기","스마트픽 지점 찾기","스마트픽 예약정보 확인","스마트픽 예약정보 확인"],a.setFrame=function(b){a.frame=b,a.subTitle=a.TITLE[a.frame],$(document.body).scrollTop(0),2==b&&(a.last_pick.length>0?a.setSeven(a.last_pick[0]):a.showLocationGoogle(0,"search"))},a.gotoPage=function(c){var d=b.element("form[name=smp_frm]");5==c?d.attr("action",f.orderFormUrl+"?"+a.baseParam+"&goods_no="+a.postdata.goods_no+"&tclick=​m_RDC_ProdDetail_Clk_order"):d.attr("action","/smartpick/m/smartpick_booking.do?"+a.baseParam+"&cur_pg="+c+"&gno="+a.base_goods_no),d.attr("method","POST"),e(function(){d.submit()},300)};var l=new Date;a.today=l.getFullYear()+"-"+k(l.getMonth()+1)+"-"+k(l.getDate()),(a.screenDataReset=function(){a.pageOptions={orderCount:1,showLocation:!1,showComplite:!1}})(),a.getProductData=function(){a.productListLoading=!0,a.$parent.LotteSuperBlockStatus=!0;try{var b="&crspk_store="+a.postdata.crspk_store;b+="&crspk_psb_yn="+a.postdata.crspk_psb_yn,b+="&crspk_corp_cd="+a.postdata.crspk_corp_cd,b+="&crspk_corp_str_sct_cd="+a.postdata.crspk_corp_str_sct_cd,b+="&crspk_str_no="+a.postdata.crspk_str_no,b+="&goods_no="+a.postdata.goods_no+"&item_no="+a.postdata.item_no,b+="&smp_prod_yn="+a.postdata.smp_prod_yn,a.pageOptions.orderCount=a.postdata.ord_qty.split(a.split_str),d.get("/json/smartpick/smartpick_booking.json?"+b).success(function(b){var d=b.smartpick_booking.goods_list.items;if(a.smpb=b.smartpick_booking,d.length>1&&(a.onemore=!0),(a.base_goods_no==c||"direct"==a.base_goods_no)&&(a.base_goods_no="direct"),a.sevenStore=new Array(a.smpb.goods_list.items.length),a.last_pick=[],null!=a.smpb.last_cvs_pick_list&&null!=a.smpb.last_cvs_pick_list.items&&a.smpb.last_cvs_pick_list.total_count>0)for(i=0;i<4;i++)i<a.smpb.last_cvs_pick_list.items.length?a.last_pick.push(a.smpb.last_cvs_pick_list.items[i]):a.last_pick.push({crspk_corp_cd:"0"});a.frame<1?(j.setSessionStorage("book_resultData",{list:[],seven:[]},"json"),"N"==a.smpb.depts_pick_yn&&"N"==a.smpb.seven_pick_yn?(alert("해당 상품은 스마트픽으로 찾기 서비스 이용이 불가능한 상태입니다. \n다른 배송수단을 이용해주세요."),a.base_goods_no==c||"direct"==a.base_goods_no?history.go(a.history_back):location.href=f.productviewUrl+"?"+a.baseParam+"&goods_no="+a.base_goods_no):"Y"==a.smpb.depts_pick_yn&&"Y"==a.smpb.seven_pick_yn?a.setFrame(0):"Y"==a.smpb.depts_pick_yn?a.setFrame(1):"Y"==a.smpb.seven_pick_yn&&a.setFrame(2)):(a.frame>2?(a.resultData=j.getSessionStorage("book_resultData","json"),a.history_back-=2):a.history_back-=1,a.setFrame(a.frame)),a.checkPick(),a.productListLoading=!1,a.$parent.LotteSuperBlockStatus=!1,a.pageLoading=!1}).error(function(){a.productListLoading=!1,a.$parent.LotteSuperBlockStatus=!1,a.pageLoading=!1})}catch(e){console.log(e)}},a.checkPick=function(){for(var b,d=0;d<a.smpb.goods_list.items.length&&(b=a.smpb.goods_list.items[d],b.smp_brch_list!=c&&null!=b.smp_brch_list.items&&1==b.smp_brch_list.items.length);d++)b.select_brch=b.smp_brch_list.items[0],1==b.select_brch.dsk_lck_list.items.length&&(b.select_loc=b.select_brch.dsk_lck_list.items[0])},b.element(document).ready(function(){a.postdata!=c&&a.getProductData()})}]),d.filter("nullcheck",["$sce",function(a){return function(a){return a==c&&(a=""),a}}]),d.filter("datetype1",["$sce",function(a){return function(a){if(a!=c){var b=a.split("-");a=parseInt(b[1])+"/"+parseInt(b[2])}else a="";return a}}]),d.directive("lotteContainer",["$timeout","LotteCommon","LotteForm","LotteStorage",function(b,d,e,f){return{templateUrl:"/lotte/resources_dev/smartpick/m/smartpick_booking_container.html",replace:!0,link:function(b,g,h){function j(a){if(a==c)a="";else if(a.indexOf(b.split_str)>-1){var d=a.split(b.split_str);a=d[b.del_id]}return a}function k(a){if(a.indexOf(b.split_str)>-1){var c=a.split(b.split_str);c.splice(b.del_id,1),a=c.join(b.split_str)}return a}b.picktype={type:1},b.setSeven=function(a){for(var c=0;c<b.smpb.goods_list.items.length;c++)b.sevenStore[c]={crspk_corp_cd:a.crspk_corp_cd,crspk_str_str_nm:a.crspk_str_str_nm,crspk_str_phon:a.crspk_str_phon,crspk_str_addr:a.crspk_str_addr,crspk_str_no:a.crspk_str_no,crspk_corp_str_sct_cd:a.crspk_corp_str_sct_cd}},b.first_deptFlag=!0,b.select_brch=function(a,c){var d;if(b.first_deptFlag){var e,f,g;for(e=0;e<b.smpb.goods_list.items.length;e++)for(d=b.smpb.goods_list.items[e],f=0;f<d.smp_brch_list.items.length;f++)g=d.smp_brch_list.items[f],g.shop_no==c.shop_no&&(d.select_brch=g,1==d.select_brch.dsk_lck_list.items.length&&(d.select_loc=d.select_brch.dsk_lck_list.items[0]));b.first_deptFlag=!1}else d=b.smpb.goods_list.items[a],d.select_brch=c,d.select_loc=null,d.select_time=null,1==d.select_brch.dsk_lck_list.items.length&&(d.select_loc=d.select_brch.dsk_lck_list.items[0])},b.select_pickloc=function(a,b){a.select_loc=b},b.select_picktime=function(a,b){a.select_time=b},b.deletePop=!1,b.deletePop2=!1,b.del_id=-1,b.adddel_ok=function(){b.deletePop=!1,b.deletePop2=!1},b.deleteItem=function(a){b.del_item_nm=b.smpb.goods_list.items[a].goods_nm,b.deletePop=!0,b.del_id=a},b.add_cart=function(){var a={goods_no:j(b.postdata.goods_no),item_no:j(b.postdata.item_no),goods_cmps_cd:j(b.postdata.goods_cmps_cd),goods_choc_desc:j(b.postdata.goods_choc_desc),ord_qty:j(b.postdata.ord_qty),infw_disp_no:j(b.postdata.infw_disp_no),infw_disp_no_sct_cd:j(b.postdata.infw_disp_no_sct_cd),master_goods_yn:j(b.postdata.master_goods_yn),cart_sn:j(b.postdata.cart_sn),cmps_qty:j(b.postdata.cmps_qty),mast_disp_no:j(b.postdata.mast_disp_no),std_goods_no:j(b.postdata.std_goods_no)};e.FormSubmitForAjax(d.cartCartInsData,a).success(function(a){b.deletePop2=!0,b.delete_item()}).error(function(a){var b=a.error.response_msg;alert(b)})},b.close_delete_item=function(){b.adddel_ok(),b.delete_item()},b.delete_item=function(){b.smpb.goods_list.items.splice(b.del_id,1),b.sevenStore.splice(b.del_id,1);for(var a in b.postdata)b.postdata[a]=k(b.postdata[a]);1==b.smpb.goods_list.items.length&&(b.onemore=!1),b.checkPick()},b.smpLocationClose=function(){b.pageOptions.showLocation&&(b.pageOptions.showLocation=!1,b.dimmedClose())},b.showLocationClick=function(a,c){try{1!=a.smp_tp_cd?(b.smpLocation=a,b.pageOptions.showLocation=!0,b.dimmedOpen({target:"smpLocation_popup",callback:this.smpLocationClose})):b.$broadcast("showStoreMap",{goods_no:c.goods_no,entr_no:a.entr_no,entr_contr_no:a.entr_contr_no,smp_ecoupon_yn:"0102ETC"==c.smp_goods_type?"Y":"N"})}catch(d){console.log(d)}},b.showLocationGoogle=function(a,c){martIndex=a,mapMode=c;var e="store_div=1000:^:1;;;;;3000:^:1;;;;;1000:^:2";b.google_map_url=d.pickMapUrl+"?"+e+"&t="+Math.random(10),$("#searchMartPop").show(),$("#mart").hide()},b.showLocationGoogleView=function(a){mapMode="view",b.sevenStore=b.resultData.seven;var c="crspk_yn=Y&crspk_corp_cd="+b.sevenStore[a].crspk_corp_cd+"&crspk_corp_str_sct_cd="+b.sevenStore[a].crspk_corp_str_sct_cd+"&crspk_str_no="+b.sevenStore[a].crspk_str_no+"&t="+Math.random(10);b.google_map_url=d.pickMapUrl+"?"+c,$("#searchMartPop").show(),$("#mart").hide()},b.go_back=function(){confirm("[취소] 하시면 선택한 픽업 정보를 처음부터 다시 입력해야 합니다 진행하시겠습니까?")&&(b.base_goods_no==c||"direct"==b.base_goods_no?history.go(b.history_back-(history.length-b.history_len)):location.href=d.productviewUrl+"?"+b.baseParam+"&goods_no="+b.base_goods_no)},b.nextframe=function(){b.gotoPage(b.picktype.type)},b.ok_btn=function(){var a,d,e=!1;if(1==b.frame)for(a=0;a<b.smpb.goods_list.items.length;a++){if(d=b.smpb.goods_list.items[a],a>0&&(d.select_brch!=b.smpb.goods_list.items[a-1].select_brch&&(e=!0),d.select_loc!=b.smpb.goods_list.items[a-1].select_loc&&(e=!0)),d.select_brch==c)return void alert("지점을 선택해주세요.");if(d.select_loc==c)return void alert("픽업장소를 선택해주세요.");if(d.select_time==c)return void alert("방문예정일을 선택해주세요.")}else if(2==b.frame)for(a=0;a<b.sevenStore.length;a++)if(1==$("#scr_a:checked").length){if(b.sevenStore[a]==c)return void alert("픽업지점을 선택해주세요.");a>0&&b.sevenStore[a]!=c&&b.sevenStore[a].crspk_str_str_nm!=b.sevenStore[a-1].crspk_str_str_nm&&(e=!0)}else{if(b.sevenStore[0]==c)return void alert("픽업지점을 선택해주세요.");a>0&&(b.sevenStore[a]=b.sevenStore[0])}e?(b.resultData.list=b.smpb.goods_list.items,b.resultData.seven=b.sevenStore,f.setSessionStorage("book_resultData",b.resultData,"json"),b.gotoPage(parseInt(b.frame)+2)):b.ok_submit()},b.ok_last_btn=function(){b.ok_submit()},b.ok_submit=function(){var c,f="";if(1==b.frame||3==b.frame)for(b.postdata.smp_vst_shop_no="",b.postdata.smp_shop_no="",b.postdata.smp_vst_rsv_dtime="",b.postdata.smp_tp_cd="",b.postdata.smp_deli_loc_sn="",b.postdata.crspk_yn="",3==b.frame&&(b.smpb.goods_list.items=b.resultData.list),i=0;i<b.smpb.goods_list.items.length;i++)c=b.smpb.goods_list.items[i],i>0&&(f=b.split_str),b.postdata.smp_vst_shop_no+=f+c.select_loc.shop_no,b.postdata.smp_shop_no+=f+c.select_brch.shop_no,b.postdata.smp_vst_rsv_dtime+=f+c.select_time.target_date,b.postdata.smp_tp_cd+=f+c.select_loc.smp_tp_cd,b.postdata.smp_deli_loc_sn+=f+c.select_loc.smp_deli_loc_sn,b.postdata.crspk_yn+=f+"N";else if(2==b.frame||4==b.frame)for(b.postdata.crspk_yn="",b.postdata.crspk_store="",b.postdata.crspk_corp_cd="",b.postdata.crspk_corp_str_sct_cd="",b.postdata.crspk_str_no="",4==b.frame&&(b.sevenStore=b.resultData.seven),i=0;i<b.sevenStore.length;i++)c=b.sevenStore[i],i>0&&(f=b.split_str),b.postdata.crspk_yn+=f+"Y",b.postdata.crspk_store+=f+c.crspk_str_str_nm,b.postdata.crspk_corp_cd+=f+c.crspk_corp_cd,b.postdata.crspk_corp_str_sct_cd+=f+c.crspk_corp_str_sct_cd,b.postdata.crspk_str_no+=f+c.crspk_str_no;b.postdata.url_div?e.FormSubmitForAjax(d.cartCartInsData,b.postdata).success(function(c){alert("상품이 장바구니에 담겼습니다"),a.location.href=d.cateLstUrl+"?"+b.baseParam}).error(function(a){var b=a.error.response_msg;alert(b)}):b.gotoPage(5)}}}}])}(window,window.angular);