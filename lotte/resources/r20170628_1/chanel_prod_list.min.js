!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter"]);d.controller("ChanelProdListCtrl",["$http","$scope","$window","$location","LotteCommon","commInitData","LotteStorage","$timeout",function(c,d,e,f,g,h,i,j){d.showWrap=!0,d.contVisible=!0,d.subTitle="chanel_prod_list",d.pageLoading=!1,d.dispNo="",d.productListLoading=!0,d.productMoreScroll=!0,d.screenID="ChanelProdList",(d.screenDataReset=function(){d.screenData={page:0,disp_name:"",dispNo:"",curDispNo:"",cateNodeName:[],showAllCategory:!1,selectCate1:0,selectCate2:0,selectCate3:0,selectedCategory:0,cate_list:[],dispGoodsList:[],lastGoodsNo:0,sortQuery:""}})(),h.query.curDispNo&&(d.screenData.curDispNo=h.query.curDispNo),d.screenData.sortQuery=h.query.sortQuery||"",d.getCateNodeName=function(a,b){var c=[];switch(""!=a&&(c=a.split(",")),b){case 1:for(var e=0;e<d.screenData.cate_list.length;e++)null!=d.screenData.cate_list[e].sub_cate_list&&d.getCateNodeName(e+"",b+1);break;case 2:for(var e=0;e<d.screenData.cate_list[c[0]].sub_cate_list.length;e++)if(null!=d.screenData.cate_list[c].sub_cate_list[e].sub_cate_list)d.getCateNodeName(a+","+e,b+1);else if(d.screenData.cate_list[c[0]].sub_cate_list[e].disp_no==d.screenData.curDispNo)return d.screenData.cateNodeName[0]=d.screenData.cate_list[c[0]].disp_nm,d.screenData.cateNodeName[1]=d.screenData.cate_list[c[0]].sub_cate_list[e].disp_nm,void(d.screenData.cateNodeName[2]="");break;case 3:for(var e=0;e<d.screenData.cate_list[c[0]].sub_cate_list[c[1]].sub_cate_list.length;e++)if(d.screenData.cate_list[c[0]].sub_cate_list[c[1]].sub_cate_list[e].disp_no==d.screenData.curDispNo)return d.screenData.cateNodeName[0]=d.screenData.cate_list[c[0]].disp_nm,d.screenData.cateNodeName[1]=d.screenData.cate_list[c[0]].sub_cate_list[c[1]].disp_nm,void(d.screenData.cateNodeName[2]=d.screenData.cate_list[c[0]].sub_cate_list[c[1]].sub_cate_list[e].disp_nm)}},d.loadScreenData=function(){console.log("스크린 데이터 로드..."),d.screenData.page++,d.productListLoading=!0;var a=g.chanelMallSubData+"?dispNo="+d.screenData.curDispNo+"&page="+d.screenData.page+"&last_goods_no="+d.screenData.lastGoodsNo+(""!=d.screenData.sortQuery?"&sort="+d.screenData.sortQuery:"");c.get(a).success(function(a){d.screenData.page<=1?(d.screenData.cate_list=a.cate_list.items,d.getCateNodeName("",1),d.screenData.dispGoodsList=a.prd_list,d.screenData.dispGoodsList.length&&(d.screenData.lastGoodsNo=d.screenData.dispGoodsList[d.screenData.dispGoodsList.length-1].goods_no)):a.prd_list?d.screenData.dispGoodsList=d.screenData.dispGoodsList.concat(a.prd_list):d.productMoreScroll=!1,a.prd_list.length>5&&(d.productListLoading=!1)})};var k=i.getSessionStorage(d.screenID+"Loc"),l=i.getSessionStorage(d.screenID+"Data"),m=i.getSessionStorage(d.screenID+"ScrollY");if(k==a.location.href&&d.locationHistoryBack){var n=JSON.parse(l);d.pageLoading=!1,d.pageOptions=n.pageOptions,d.screenData=n.screenData,j(function(){b.element(e).scrollTop(m)},800)}else d.loadScreenData();b.element(e).on("unload",function(a){var c={};c.pageOptions=d.pageOptions,c.screenData=d.screenData,!h.query.localtest&&d.leavePageStroage&&(i.setSessionStorage(d.screenID+"Loc",f.absUrl()),i.setSessionStorage(d.screenID+"Data",c,"json"),i.setSessionStorage(d.screenID+"ScrollY",b.element(e).scrollTop()))})}]),d.directive("lotteContainer",["$window","LotteCommon",function(c,d){return{templateUrl:"/lotte/resources_dev/mall/chanel/chanel_prod_list_container.html",replace:!0,link:function(e,f,g){e.menuCategoryClick=function(a){e.menuCategory1Click(a)},e.menuCategory1Click=function(c,f){e.menuCategory1Index=0,""!=c.link_url?a.location.href=d.chanelMallSubUrl+"?"+e.baseParam+"&curDispNo="+c.disp_no+"&cateDepth="+c.cate_depth+"&title="+c.disp_nm+(c.sort?"&sortQuery="+c.sort:""):e.screenData.selectCate1==c.disp_no?(e.screenData.selectCate1=0,b.element(".navi_area").removeClass("on"),b.element("nav").removeClass("on")):(e.screenData.selectCate1=c.disp_no,b.element(".navi_area").addClass("on"),b.element("nav").addClass("on")),e.menuCategory1Index=f,e.sendTclick("m_DC_specialshop_Chanel_category_"+c.disp_no)},e.menuCategory2Click=function(a,b,f){if(e.menuCategory2Index=0,b||(b=""),""!=a.link_url){var g=d.chanelMallSubUrl+"?"+e.baseParam+"&curDispNo="+a.disp_no+"&beforeNo="+b.disp_no+"&cateDepth="+a.cate_depth+"&title="+a.disp_nm+(a.sort?"&sortQuery="+a.sort:"");g+="&tclick=m_DC_specialshop_Chanel_category_"+a.disp_no,c.location.href=g}else e.screenData.selectCate2==a.disp_no?e.screenData.selectCate2=0:(e.screenData.selectCate2=a.disp_no,e.menuCategory2Index=f,e.sendTclick("m_DC_specialshop_Chanel_category_"+a.disp_no))},e.menuCategory3Click=function(a,b,f){if(""!=a.link_url){var g=d.chanelMallSubUrl+"?"+e.baseParam+"&curDispNo="+a.disp_no+"&beforeNo="+b.disp_no+"&cateDepth="+a.cate_depth+"&title="+a.disp_nm+(a.sort?"&sortQuery="+a.sort:"");g+="&tclick=m_DC_specialshop_Chanel_category_"+a.disp_no,c.location.href=g}else e.screenData.selectCate3==a.disp_no?e.screenData.selectCate3=0:e.screenData.selectCate3=a.disp_no},e.productClick=function(b){var c=e.tClickBase+"m_DC_specialshop_Chanel_cateTpl_Clk_Prd_idx0"+(this.$index+1);a.location.href=d.prdviewUrl+"?"+e.$parent.baseParam+"&goods_no="+b.goods_no+"&tclick="+c};var h=b.element(c),i=b.element("body"),j=h.height(),k=i[0].scrollHeight,l=4;h.on("scroll",function(a){!e.productMoreScroll||e.productListLoading||e.pageLoading||(k=i[0].scrollHeight,l=h.width()>=640?2:4,k-j*l>j&&h.scrollTop()+j>=k-j*l&&e.loadScreenData())}),e.hideCate=function(){e.screenData.selectCate1=!1,b.element(".navi_area").removeClass("on"),b.element("nav").removeClass("on")}}}}]),d.directive("subHeaderEach",["$window",function(a){return{replace:!0,link:function(c,d,e){function f(){c.appObj.isNativeHeader&&(i=0),h.scrollTop()>=0?g.attr("style","z-index:100;position:fixed;top:"+i+"px;width:100%"):g.removeAttr("style")}c.gotoPrepage=function(){c.sendTclick("m_header_new_pre"),history.go(-1)};var g=b.element(d),h=b.element(a),i=c.subHeaderHeight;h=b.element(a),i=c.subHeaderHeight,h.on("scroll",function(a){f(),setTimeout(f,300)})}}}])}(window,window.angular);