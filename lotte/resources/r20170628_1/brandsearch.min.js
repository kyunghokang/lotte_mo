!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter"]);d.controller("BrandSearchCtrl",["$window","$http","$timeout","$scope","LotteCommon","LotteStorage","commInitData","$location",function(c,d,e,f,g,h,i,j){f.showWrap=!0,f.contVisible=!0,f.isShowBack=!0,f.pageLoading=!1,f.subTitle="브랜드 검색/추가",f.screenID="brandSearch",(f.screenDataReset=function(){f.pageOptions={searchTab:0,keyword:"",curKeyword:"",curKeyIdx:"",curEngKeyIdx:-1,curKorKeyIdx:-1,dataLoading:!1},f.screenData={page:0,pageSize:20,pageEnd:!1,searchList:null,myBrand:"",myBrandList:{}}})(),f.keys=[["ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"],["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]],f.loadData=function(a){if(!f.pageOptions.dataLoading){f.searchList=null;var b,c;switch(a){case"key":b=g.isTestFlag?"/json/brand/brandsearch.json":g.sideCtgBrandData,c={btnIndex:f.pageOptions.curKeyIdx,tabIndex:f.pageOptions.searchTab};break;case"keyword":b=g.isTestFlag?"/json/brand/brandsearch_keyword.json":g.sideCtgBrandSearch,c={sch_nm:f.pageOptions.keyword}}var e={method:"get",url:b,params:c};f.pageLoading=!0,d(e).success(function(a){if(a.brandList){f.screenData.searchList={},f.screenData.searchList.items=[];for(var b=0;b<a.brandList.items.length;b++)f.screenData.myBrand.indexOf("|"+a.brandList.items[b].brdNo+"|")>=0?a.brandList.items[b].isMyBrand=!0:a.brandList.items[b].isMyBrand=!1,f.screenData.searchList.items[b]=a.brandList.items[b]}})["finally"](function(){f.pageLoading=!1,f.pageOptions.dataLoading=!1})}},f.getMyBrandInfo=function(){var a=g.isTestFlag?"/json/brand/my_brnd_info.json":g.myBrandInfo,b={method:"get",url:a};f.pageOptions.dataLoading=!0,d(b).success(function(a){if(a.data){var b=a.data;if(!b.isBestBrand&&b.brndList)for(var c=0;c<b.brndList.items.length;c++)f.screenData.myBrand+="|"+b.brndList.items[c].brdNo+"|"}})["finally"](function(){f.pageOptions.dataLoading=!1,f.getBestBrandInfo()})},f.getBestBrandInfo=function(){var a=g.isTestFlag?"/json/brand/best_brnd_info.json":g.bestBrandInfo,b={method:"get",url:a};f.pageOptions.dataLoading=!0,d(b).success(function(a){if(a.data){var b=a.data;f.screenData.searchList={},f.screenData.searchList.items=[];for(var c=0;c<b.brndList.items.length;c++)f.screenData.myBrand.indexOf("|"+b.brndList.items[c].brdNo+"|")>=0?b.brndList.items[c].isMyBrand=!0:b.brndList.items[c].isMyBrand=!1,f.screenData.searchList.items[c]=b.brndList.items[c]}})["finally"](function(){f.pageOptions.dataLoading=!1})};var k=h.getSessionStorage(f.screenID+"Loc"),l=h.getSessionStorage(f.screenID+"Data"),m=h.getSessionStorage(f.screenID+"ScrollY");if(k==a.location.href&&f.locationHistoryBack){var n=JSON.parse(l);f.pageLoading=!1,f.pageOptions=n.pageOptions,f.screenData=n.screenData,e(function(){b.element(c).scrollTop(m)},800)}else f.getMyBrandInfo();b.element(c).on("unload",function(a){var d={};d.pageOptions=f.pageOptions,d.screenData=f.screenData,!i.query.localtest&&f.leavePageStroage&&(h.setSessionStorage(f.screenID+"Loc",j.absUrl()),h.setSessionStorage(f.screenID+"Data",d,"json"),h.setSessionStorage(f.screenID+"ScrollY",b.element(c).scrollTop()))})}]),d.directive("lotteContainer",["$timeout","$http","LotteCommon","LotteLink",function(a,c,d,e){return{templateUrl:"/lotte/resources_dev/brand/brandsearch_container.html",replace:!0,link:function(f,g,h){f.myBrandCntMax=50,f.numberFill=function(a,b){var c=""+a,d="00000000000000000";return d.substring(0,b-c.length)+c},f.keyClick=function(a,b){f.pageOptions.dataLoading||(f.sendTclick("m_RDC_side_brand_Clk_idx"+f.numberFill(this.$index+1,2)),f.screenData.searchList=null,"kor"==a?f.pageOptions.curKorKeyIdx=b:f.pageOptions.curEngKeyIdx=b,f.pageOptions.curKeyIdx=b,f.pageOptions.curKeyword=f.keys[f.pageOptions.searchTab][f.pageOptions.curKeyIdx],console.log("$scope.curKorKeyIdx, $scope.curEngKeyIdx, $scope.curKeyIdx",f.pageOptions.curKorKeyIdx,f.pageOptions.curEngKeyIdx,f.pageOptions.curKeyIdx),f.loadData("key"))},f.searchKeywordClick=function(){if(!f.pageOptions.dataLoading){if(""==f.pageOptions.keyword||!f.pageOptions.keyword)return void(f.pageOptions.keyword=null);f.sendTclick("m_RDC_side_brand_Clk_brandsearch"),f.screenData.searchList=null,f.pageOptions.curKeyword=f.pageOptions.keyword,f.loadData("keyword"),b.element("#srhBrdKeyword").blur()}},f.goBrandPage=function(a,b,c){var g="";g=""==f.pageOptions.keyword&&""==f.pageOptions.curKeyword?"m_RDC_side_brand_Recobrand_Clk_list"+f.numberFill(c+1,2):"m_RDC_side_brand_brandsearch_Clk_list"+f.numberFill(c+1,2);var h;h=a?a:b,e.goLink(d.brandShopSubUrl,f.baseParam,{upBrdNo:h,idx:1,tclick:g})},f.brandBookMark=function(){if(!f.loginInfo.isLogin)return alert("로그인 후 이용하실 수 있습니다."),f.loginProc(),!1;var a=d.myBrandInfo,b=this.item.brdNo,e=this.item.brdNm,g=this.$index,h="add";if(this.item.isMyBrand)h="del",a+="?flag=d&brnd_no="+b;else{var i=f.getMyBrandCnt();if(!(i<f.myBrandCntMax))return void f.showAlertPop("브랜드 즐겨찾기는 최대 50개까지 가능합니다.");a+="?flag=i&brnd_no="+b}var j={method:"get",url:a};c(j).success(function(a){"add"==h?(f.screenData.myBrand+="|"+b+"|",f.screenData.searchList.items[g].isMyBrand=!0,f.showAlertPop(e+" 브랜드가 즐겨찾기에 추가되었습니다.")):(f.screenData.myBrand=f.screenData.myBrand.replace("|"+b+"|",""),f.screenData.searchList.items[g].isMyBrand=!1,f.showAlertPop(e+" 브랜드가 즐겨찾기에서 삭제되었습니다."))})["finally"](function(){})},f.getMyBrandCnt=function(){var a=f.screenData.myBrand;return a.split("|").length-1},f.showAlertPop=function(c){var d=b.element(g).find(".header_alert_pop");d.find(".msg").text(c),d.fadeIn(500,function(){a(function(){d.fadeOut(500)},1e3)})}}}}])}(window,window.angular);