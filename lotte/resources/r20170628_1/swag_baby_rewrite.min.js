function calcBytes(a){var b=0;for(i=0;i<a.length;i++){var c=a.charAt(i);escape(c).length>4?b+=2:"\n"==c?"\r"!=a.charAt(i-1)&&(b+=1):b+="<"==c||">"==c?4:1}return b}function maxLengthCheck(a,b,c,d){var e,f,g=c.value.length,h=0,i="",j=0;if(0==g)null!=document.getElementById("spn_input_char")&&(document.getElementById("spn_input_char").innerText=h);else for(k=0;k<g;k++){if(e=c.value.charAt(k),"\n"==e&&j++,escape(e).length>4?h+=2:h++,h>1500){alert("총 한글 "+a/2+"자 영문 "+a+"자 까지 쓰실 수 있습니다."),c.value=i;break}if(null!=b&j>parseInt(b)){alert("라인수 "+b+"라인을 넘을 수 없습니다."),j=0,f=i.length-1,c.value=i.substring(0,f);break}null!=document.getElementById("spn_input_char")&&(document.getElementById("spn_input_char").innerText=h),i+=e}}!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter"]);d.controller("SwagBabyRewriteCtrl",["$http","$scope","LotteCommon","commInitData","LotteUtil","$timeout","LotteForm",function(a,b,c,d,e,f,g){function h(){var c={bbc_no:b.bbc_no};a.get("/json/mall/swag_rewrite.json",{params:c}).success(function(a){b.input=a.swag_rewrite,b.images.img_1=b.input.img_path_1_nm&&b.input.img_file_1_nm?e.getImagePath("")+b.input.img_path_1_nm+b.input.img_file_1_nm:i,b.images.img_2=b.input.img_path_2_nm&&b.input.img_file_2_nm?e.getImagePath("")+b.input.img_path_2_nm+b.input.img_file_2_nm:i,b.images.img_3=b.input.img_path_3_nm&&b.input.img_file_3_nm?e.getImagePath("")+b.input.img_path_3_nm+b.input.img_file_3_nm:i,b.hasImage=b.input.img_path_1_nm&&b.input.img_file_1_nm||b.input.img_path_2_nm&&b.input.img_file_2_nm||b.input.img_path_3_nm&&b.input.img_file_3_nm?!0:!1}).error(function(a){ajaxResponseErrorHandler(a)})}b.showWrap=!0,b.contVisible=!0,b.subTitle="육아 TIP 수정",b.dispNo=d.query.dispNo,b.bbc_no=d.query.bbcNo;var i=e.getImagePath()+"/mobile/mobile_new/mylotte/blank.png";b.input={},b.images={img_1:"",img_2:"",img_3:""},b.deleteAttachedImage=function(a){if(confirm("사진을 삭제하시겠습니까?")){switch(b.input.del_file="",b.input.del_path="",a){case 1:b.input.del_file=b.input.img_file_1,b.input.del_path=b.input.img_path_1,b.input.img_file_1="",b.input.img_path_1="";break;case 2:b.input.del_file=b.input.img_file_2,b.input.del_path=b.input.img_path_2,b.input.img_file_2="",b.input.img_path_2="";break;case 3:b.input.del_file=b.input.img_file_3,b.input.del_path=b.input.img_path_3,b.input.img_file_3="",b.input.img_path_3=""}g.FormSubmitForAjax(c.swagImageDeleteData+"?"+b.baseParam,b.input).success(function(b){document.querySelectorAll("#img_list img")[a-1].src=i,document.querySelectorAll("#img_list a")[a-1].style.display="none"}).error(function(a){ajaxResponseErrorHandler(a)})}},b.cancel=function(){confirm("육아TIP 작성을 취소하시겠습니까?")&&location.replace(c.infantMainUrl+"?"+b.baseParam+"&dispNo="+b.dispNo+"&dcate=2")},b.deleteComment=function(){a.get("/json/mall/swag_delete.json?bbcNo ="+b.bbc_no).success(function(a){f(function(){location.replace(c.infantMainUrl+"?"+b.baseParam+"&dispNo="+b.dispNo+"&dcate=2")},200)}).error(function(a){ajaxResponseErrorHandler(a)})},b.save=function(a){if(null==b.loginInfo||!b.loginInfo.isLogin){var d="targetUrl="+encodeURIComponent(location.href,"UTF-8");return void(location.href="/login/m/loginForm.do?"+d)}var e=b.input.bbc_cont,h=document.querySelector("#reviewTxt");if(0==e.trim().length)return alert("내용을 작성해 주세요."),h.focus(),!1;if(calcBytes(e)<6)return alert("내용을 한글 3자 이상 입력하세요."),h.focus(),!1;if(calcBytes(e)>1500)return alert("내용은 750자[한글기준] 이내로 제한되어 있습니다."),h.focus(),!1;var i=c.swagRewriteSaveData+"?"+b.baseParam;return g.FormSubmitForAjax(i,b.input).success(function(a){"0000"!=a.swag_rewrite_save.response_code?alert(a.swag_rewrite_save.response_msg):f(function(){location.replace(c.infantMainUrl+"?scrollback=y&"+b.baseParam+"&dispNo="+b.dispNo+"&dcate=2")},200)}).error(function(a){ajaxResponseErrorHandler(a)}),!1},h()}]),d.directive("lotteContainer",["$http","LotteUtil",function(a,b){return{templateUrl:"/lotte/resources_dev/mall/baby/swag_rewrite_container.html",replace:!0,link:function(a,b,c){}}}])}(window,window.angular);var ajaxResponseErrorHandler=function(a,b){if(a.error){var c=a.error.response_code,d=a.error.response_msg;if("9004"==c){var e="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href="/login/m/loginForm.do?"+e}else alert("["+c+"] "+d)}else alert("처리중 오류가 발생하였습니다.");b&&b()};