!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","lotteProduct"]);d.controller("StylePushCtrl",["$http","$window","$location","$scope","$timeout","LotteCommon","commInitData","LotteUtil","LotteStorage",function(a,c,d,e,f,g,h,i,j){function k(){a.get(g.stylePushCtgData).success(function(a){var b,c,d=0;if(g.isTestFlag)e.defaultParams.sel_cat1_name="여성",e.defaultParams.sel_cat2_name="티셔츠",e.defaultParams.caid1='"',e.defaultParams.caid2="",e.defaultParams.caid3="",e.defaultParams.caid4="",e.defaultParams.imgPath="http://image.lotte.com/goods/97/38/18/96/1/196183897_1_280.jpg",l();else{for(d=0;d<a.cate_l_list.length;d++)if(a.cate_l_list[d].name==e.defaultParams.cat1Name){b=a.cate_l_list[d];break}if(b){for(d=0;d<b.cate_m_list.length;d++)if(b.cate_m_list[d].name==e.defaultParams.cat2Name){c=b.cate_m_list[d];break}c?(e.defaultParams.sel_cat1_name=b.name,e.defaultParams.sel_cat2_name=c.name,e.defaultParams.caid1=c.caid1,e.defaultParams.caid2=c.caid2,e.defaultParams.caid3=c.caid3,e.defaultParams.caid4=c.caid4,l()):console.log("카테고리 정보 오류")}else console.log("카테고리 정보 오류")}})}function l(){e.productListLoadingFlag=!0,e.productMoreScroll=!1;var a=g.styleOddAPIData+"?uuid="+e.defaultParams.uuid+"&rid="+e.defaultParams.rid+"&caid1="+e.defaultParams.caid1+"&caid2="+e.defaultParams.caid2+"&caid3="+e.defaultParams.caid3+"&caid4="+e.defaultParams.caid4+"&page="+e.screenData.page;$.ajax({url:a,type:"POST",headers:{Authorization:"Bearer "+e.defaultParams.accessToken},dataType:"json",success:function(a){a.main_list&&m(a.main_list),e.goodsNoLstStr=e.goodsNoDataArray.join(),e.screenData.totalCount=a.total_count,e.screenData.totalPage=Math.ceil(e.screenData.totalCount/e.screenData.pageSize),n(e.goodsNoLstStr)},error:function(a){console.log(a)}})}function m(a){var b=0;for(b=0;b<a.length;b++)e.goodsNoDataArray.push(a[b].mapid)}function n(b){a({url:g.stylePushPrdData+"?goods_no="+b,method:"POST"}).success(function(a){o(a)}).error(function(a){})}function o(a){a.resultCode?(e.srhResultData.resultcode=a.resultcode,"0000"==a.resultCode&&a.prdList&&a.prdList.length>0?(e.productMoreScroll=!0,1==e.screenData.page?e.srhResultData.prdList=p(a.prdList):e.srhResultData.prdList=e.srhResultData.prdList.concat(p(a.prdList)),e.screenData.totalPage<=e.screenData.page&&(e.productMoreScroll=!1,e.screenData.pageEnd=!0),e.productListLoadingFlag=!1,++e.screenData.page):("1000"==a.resultCode||!a.prdList||a.prdList&&0==a.prdList.length)&&(e.screenData.totalPage>e.screenData.page?(++e.screenData.page,l()):(e.productMoreScroll=!1,e.screenData.pageEnd=!0,e.productListLoadingFlag=!1))):(e.productListLoadingFlag=!1,console.info("조회 중 에러가 발생하였습니다.")),e.prodcutFirstLoadFlag=!1}function p(a){var c={goods_no:"goodsNo",goods_nm:"goodsNm",brnd_nm:"brandNm",img_url:"imgUrl",original_price:"price1",discounted_price:"price2",sale_rate:"saleRate",flag:"flag",review_count:"reviewCnt",smartpick_yn:"smpick",limit_age_yn:"byrAgelmt",is_himart:"himart",is_dept:"dept",is_tvhome:"tvhome",is_youngplz:"young",is_sale_promotion:"goodsCmpsCd",curDispNo:"curDispNo",has_coupon:"useCpn"},d={goods_no:"",goods_nm:"",brnd_nm:"",img_url:"",img_url_550:"",original_price:"",discounted_price:"",sale_rate:"",flag:"",is_sold_out:!1,has_coupon:!1,has_wish:!1,is_sale_promotion:!1,review_count:0,bought_sum:0,md_tip:"",promotion_text:"",isdlex_free:!1,smartpick_yn:!1,sold_out_cd_yn:"N",limit_age_yn:"N",link_url:"",is_himart:"",is_dept:"",is_youngplz:"",outlnk:"",outlnkMall:"",curDispNo:""},e=[];return b.forEach(a,function(a,f){var g=b.copy(d);b.forEach(c,function(b,c){"has_coupon"==c?g[c]="coupon"==a[b]?!0:!1:"flag"==c?a.flag&&a.flag.indexOf("무료배송")>-1&&(g.isdlex_free=!0):"is_sale_promotion"==c?"30"==a.goodsCmpsCd&&(g[c]=!0):"sale_rate"==c?null==a[b]?g[c]=0:g[c]=parseInt(a[b]):"smartpick_yn"==c?g[c]=a[b]?"Y":"N":"limit_age_yn"==c?g[c]=19==a[b]?"Y":"N":"goods_nm"==c?(g[c]=i.replaceAll(a.goodsNm,"<!HS>","<STRONG>"),g[c]=i.replaceAll(g[c],"<!HE>","</STRONG>")):g[c]=a[b]}),e.push(g)}),e}e.showWrap=!0,e.contVisible=!0,e.subTitle="스타일추천",e.screenID="patternsearch",e.goodsNoDataArray=[],e.goodsNoLstStr="",e.productListLoadingFlag=!1,e.productMoreScroll=!0,e.prodcutFirstLoadFlag=!0,e.curDispNoSctCd=14,(e.screenDataReset=function(){e.defaultParams={uuid:h.query.uuid,rid:h.query.rid,accessToken:h.query.accessToken,cat1Name:decodeURIComponent(h.query.cat1Name+""),cat2Name:decodeURIComponent(h.query.cat2Name+""),sel_cat1_name:"",sel_cat2_name:"",caid1:"",caid2:"",caid3:"",caid4:"",imgPath:"https://c-lottedotcom-g.oddconcepts.kr"+decodeURIComponent(h.query.imgPath)},e.screenData={page:1,pageSize:20,totalCount:0,totalPage:0,pageEnd:!1},e.srhResultData={resultCode:"1000",prdList:[]}})(),e.loadMoreData=function(){l()};var q=j.getSessionStorage("stylePushLoc"),r=j.getSessionStorage("stylePushData"),s=j.getSessionStorage("stylePushScrollY");if(q==c.location.href&&null!=r&&"true"!=h.query.locatest){var t=JSON.parse(r);e.defaultParams=t.defaultParams,e.screenData=t.screenData,e.srhResultData=t.srhResultData,f(function(){b.element(c).scrollTop(s)},500)}else k();b.element(c).on("unload",function(a){var f={};f.defaultParams=e.defaultParams,f.screenData=e.screenData,f.srhResultData=e.srhResultData,h.query.localtest||(j.setSessionStorage("stylePushLoc",d.absUrl()),j.setSessionStorage("stylePushData",f,"json"),j.setSessionStorage("stylePushScrollY",b.element(c).scrollTop()))})}]),d.directive("lotteContainer",["$window","LotteCommon",function(a,b){return{templateUrl:"/lotte/resources_dev/search/style_push_container.html",replace:!0,link:function(c,d,e){c.stylePushLink=function(){a.location.href=b.stylePushIntroUrl+"?"+c.baseParam+"&tclick=m_patternsearch_retry"}}}}])}(window,window.angular);