!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter"]);d.controller("directAttendCtrl",["$scope","$http","$window","$interval","LotteCommon","commInitData",function(b,c,d,e,f,g){function h(a,b,c,d,e,f){var g=new Date(a,b,c,d,e,f);return a&&b&&c&&(g.setFullYear(a),g.setMonth(b-1),g.setDate(c),d&&g.setHours(d),e&&g.setMinutes(e),f&&g.setSeconds(f)),g.getTime()}if(b.showWrap=!0,b.contVisible=!0,b.subTitle="하루 한 번 롯데닷컴",b.wwd=$(a).width(),b.todayDate=new Date,g.query.testDate){var i=g.query.testDate,j=new Date(i.substring(0,4),parseInt(i.substring(4,6))-1,i.substring(6,8),i.substring(8,10),i.substring(10,12),i.substring(12,14));b.todayDate=j}b.getWeekToday=function(a){var b=j||new Date,c=new Date(b.getFullYear(),b.getMonth()+1,0),d=new Date(b.getFullYear(),b.getMonth(),1),e=c.getDate(),f=d.getDay();return Math.ceil((e+f)/7)};var k=b.todayDate.getFullYear(),l=b.todayDate.getMonth(),i=b.todayDate.getDate(),m=new Date(b.todayDate.getFullYear(),b.todayDate.getMonth(),1).getDay(),n=(b.todayDate.getDay(),new Date(k,l+1,0)),o=n.getDate();b.thisMonth=l+1,b.lastWeek=b.getWeekToday(),b.yoil=b.todayDate.getDay(),b.hour=b.todayDate.getHours(),b.attend_layer_flag=!1,b.hide_attend_layer=function(){b.attend_layer_flag=!1},c.get(f.directAttendData).success(function(a){function c(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}b.mbrGradeCd=a.direct_attend.mbrGradeCd,b.intClover=a.direct_attend.intClover,b.chilCouponCnt=a.direct_attend.chilCouponCnt,b.chilTotalCouponCnt=a.direct_attend.chilTotalCouponCnt,b.sibECouponCnt=a.direct_attend.sibECouponCnt,b.sibETotalCouponCnt=a.direct_attend.sibETotalCouponCnt,b.lPointCnt=a.direct_attend.lPointCnt,b.lPointTotalCnt=a.direct_attend.lPointTotalCnt,b.freeDelivCnt=a.direct_attend.freeDelivCnt,b.freeDelivTotalCnt=a.direct_attend.freeDelivTotalCnt,b.ilManCouponCnt=a.direct_attend.ilManCouponCnt,b.ilManTotalCouponCnt=a.direct_attend.ilManTotalCouponCnt,b.evtNo=a.direct_attend.evt_no,b.lpEntryDailCnt=a.direct_attend.lpEntryDailCnt,b.lpEntryWinCnt=a.direct_attend.lpEntryWinCnt,b.lpEntryWinCntDailyCnt=a.direct_attend.lpEntryWinCntDailyCnt,b.platinumMember=!1,b.chgImgCpn="0501",b.freeDelivCloverCnt="1000",b.cloverNewCount=200,b.cloverNewCount2=96,b.cloverNewCount3=200,b.freeDelivCpnNo=a.direct_attend.freeDelivCpnNo,b.lPointNo="",b.cpnNo1="",b.cpnNo2=a.direct_attend.cpnNo2,b.cpnNo3="",b.screen1101=!0;var d=b.todayDate.getTime();d>=h(2016,9,1)&&d<h(2016,10,1)?(b.freeDelivCpnNo="1169489",b.cpnNo2="1169488"):d>=h(2016,10,1)&&d<h(2016,11,1)&&(b.freeDelivCpnNo="1170506",b.cpnNo2="1170505",b.screen1101=!1,b.subTitle="올 때마다 출석도짱"),b.bannerShow=function(a,b,c,e,f,g){var i=!1;return d>=h(a,b,c)&&d<h(e,f,g)&&(i=!0),i},b.totalClover=a.direct_attend.totalClover,"10"==b.mbrGradeCd&&(b.platinumMember=!0),null!=a.direct_attend.attend_tgtr_list?b.attendTgtrListData=a.direct_attend.attend_tgtr_list.items:b.attendTgtrListData=null,b.appPushFlag=!1,d>=h(2016,9,14)&&d<h(2016,9,19)&&(b.appPushFlag=!0),b.param_cn=c("cn"),b.goApppush_Event=function(a){if("pnhZkYs9a5U="==getCookie("MBRSCTCD"))alert("간편계정 회원의 경우 응모가 불가합니다.\nL.POINT 통합회원 가입 후 신청해주세요.");else if(b.loginInfo.isLogin)$.ajax({type:"post",async:!1,url:"/event/regEvent.do?"+b.baseParam,data:{evt_no:a},success:function(a){a.indexOf("0000")>-1?alert("L.money 10점 적립 응모 완료! 월~일 모두 적립시 보너스 30점 추가! (매주 화요일 일괄 지급)"):a.indexOf("dup.err")>-1&&alert("오늘은 이미 적립하셨네요. 내일 또 만나요^^")}});else if(confirm("로그인 후 적립하실 수 있습니다.")){var c="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href="/login/m/loginForm.do?"+c}},b.todayCheckFlag=!1;var e,f=new Array(42),g=1;setTimeout(function(){for(var a=0;42>a;a++)f[a]=0,a>=m&&o>=g&&(e=$(".calendar").find("li").eq(a),e.find("span").text(g),e.addClass("on"),g==i?e.addClass("today"):g>i&&(e.addClass("after"),a%7==0?e.addClass("sun"):a%7==6&&e.addClass("sat")),g++);if(null!=b.attendTgtrListData)for(a=0;a<b.attendTgtrListData.length;a++)g=parseInt(b.attendTgtrListData[a].sbscSgt_Dtime),$(".calendar").find("li.on").eq(g-1).addClass("check"),g==i&&(b.todayCheckFlag=!0);b.calendarArrInfo=f},200)}).error(function(a){console.log("Error Data :  directAttendData 출석도장 에러")}),b.goLogin=function(){d.location.href=f.loginUrl+"?"+b.baseParam+"&targetUrl="+encodeURIComponent(d.location.href,"UTF-8")},b.goLink=function(){d.location.href=f.prdlstUrl+"?"+b.baseParam+"&curDispNo=5400483&tclick=m_ck_08"},b.goLinkTwo=function(){d.location.href="/event/luckyBox.do?"+b.baseParam+"&tclick=m_luckybox_ck_20161022"},b.goLinkLatte=function(){d.location.href="/event/luckyBox.do?"+b.baseParam+"tclick=m_luckybox_ck_20161029"}}]),d.directive("lotteContainer",["$http","$location","$window","LotteCommon","commInitData","LotteForm",function(b,c,d,e,f,g){return{templateUrl:"/lotte/resources_dev/event/direct_attend_container.html",replace:!0,link:function(h,i,j){var k=2,l=f.query.cn?f.query.cn:"1";("0"==l||"1"==l||"23"==l||"146"==l||"510"==l||"109329"==l||"117124"==l||"117125"==l||"120024"==l||"120724"==l||"125525"==l||"125526"==l||"126124"==l||"153527"==l||"156027"==l||"156025"==l||"132224"==l||"133025"==l||"140024"==l||"133224"==l||"141224"==l||"140924"==l||"146724"==l||"116824"==l||"145524"==l||"123624"==l||"126824"==l||"156624"==l||"156026"==l||"151224"==l||"171624"==l||"171625"==l||"171525"==l||"172324"==l||"188026"==l)&&(k=1);var m=new Date(2016,0,1);h.todayDate.getTime()>=m.getTime()&&("171624"==l||"171625"==l||"171525"==l||"172324"==l)&&(k=1),h.evtEntryYn=k,h.regAttend=function(){if(h.loginInfo.isLogin)if(1==h.evtEntryYn){var a=[];a.evt_no=h.evtNo,a.evt_type="at",g.FormSubmitForAjax(e.registAttendData,a).success(function(a){a.data_set.response_msg.indexOf("0000")>-1?(h.screen1101?alert("출석체크 완료!!"):alert("출석도짱이 발급되었습니다."),sessionStorage.clear(),0==h.yoil||6==h.yoil?h.totalClover=h.totalClover+200:h.totalClover=h.totalClover+100,location.reload()):alert(a.data_set.response_msg)}).error(function(a){a.error.response_code==LOGIN_EXCEPTION?(alert(a.error.response_msg),Fnproductview.goToLogin(d,h,e.loginUrl)):"M000200"==a.error.response_code?alert(a.error.response_msg):alert("프로그램 오류로 인해 처리되지 않았습니다.")})}else h.screen1101?h.attend_layer_flag=!0:alert("출석도짱은 바로방문on으로 접속하셔야만 찍을  수 있습니다.");else h.goLogin()};var n,o,p=!0;h.goExchangeClover=function(c){if(h.loginInfo.isLogin){if("freeDeliv"==c){if(h.platinumMember)return void alert("이미 플래티넘플러스 무료배송 혜택을 받고 계십니다.");if(h.freeDelivCnt<1&&h.hour<10)return void alert("지금은 교환시간이 아닙니다\n오전 10시에  교환해 주세요.");if(h.freeDelivCnt>=1)return void alert("이미 교환 지급 되었습니다. 일주일 후에 다시 교환 해 주세요.");if(h.intClover<h.freeDelivCloverCnt)return void alert("적립된 클로버가 부족합니다.\n나의 총 누적 클로버를 확인하세요.");if(h.freeDelivTotalCnt>=h.cloverNewCount)return void alert("선착순 마감되었습니다.\n내일 오전10시에 다시 도전하세요.");n=h.freeDelivCpnNo,o="U00002"}else if("LPoint"==c){if(h.lpEntryWinCnt>=1)return void alert("이미 당첨, 교환 지급 되었습니다. 다음 이벤트에 다시 응모해 주세요.");if(h.lpEntryDailCnt>=1)return void alert("이미 응모했습니다. 내일 다시 응모해 주세요.");if(h.intClover<1e4)return void alert("적립된 클로버가 부족합니다.\n나의 총 누적 클로버를 확인하세요.");n=h.lPointNo,o="U00035"}else if("cloverLayer1000"==c){if(h.sibECouponCnt<1&&h.hour<10)return void alert("지금은 교환시간이 아닙니다\n오전 10시에  교환해 주세요.");if(h.sibECouponCnt>=1)return void alert("이미 교환 지급 되었습니다. 일주일 후에 다시 교환 해 주세요.");if(h.intClover<h.freeDelivCloverCnt)return void alert("적립된 클로버가 부족합니다.\n나의 총 누적 클로버를 확인하세요.");if(h.sibETotalCouponCnt>=100)return void alert("선착순 마감되었습니다.\n내일 오전10시에 다시 도전하세요.");n=h.cpnNo2,o="U00043"}else if("cloverLayer2000"==c){if(h.chilCouponCnt<1&&h.hour<10)return void alert("지금은 교환시간이 아닙니다\n오전 10시에  교환해 주세요.");if(h.chilCouponCnt>=1)return void alert("이미 교환 지급 되었습니다. 일주일 후에 다시 교환 해 주세요.");if(h.intClover<h.cloverNewCount3)return void alert("적립된 클로버가 부족합니다.\n나의 총 누적 클로버를 확인하세요.");if(h.chilTotalCouponCnt>=300)return void alert("선착순 마감되었습니다.\n내일 오전10시에 다시 도전하세요.");n=h.cpnNo1,o="U00042"}else if("cloverLayer3000"==c){if(h.sibECouponCnt<1&&h.hour<10)return void alert("지금은 교환시간이 아닙니다\n오전 10시에  교환해 주세요.");if(h.sibECouponCnt>=1)return void alert("이미 교환 지급 되었습니다. 일주일 후에 다시 교환 해 주세요.");if(h.intClover<h.freeDelivCloverCnt)return void alert("적립된 클로버가 부족합니다.\n나의 총 누적 클로버를 확인하세요.");if(h.sibETotalCouponCnt>=400)return void alert("선착순 마감되었습니다.\n내일 오전10시에 다시 도전하세요.");n=h.cpnNo2,o="U00041"}else{if(h.ilManCouponCnt<1&&h.hour<10)return void alert("지금은 교환시간이 아닙니다\n오전 10시에  교환해 주세요.");if(h.ilManCouponCnt>=1)return void alert("이미 교환 지급 되었습니다. 일주일 후에 다시 교환 해 주세요.");if(h.intClover<3e3)return void alert("적립된 클로버가 부족합니다.\n나의 총 누적 클로버를 확인하세요.");if(h.ilManTotalCouponCnt>=h.cloverNewCount)return void alert("선착순 마감되었습니다.\n내일 오전10시에 다시 도전하세요.");n=h.cpnNo3,o="U00027"}if(p){p=!1;var d;if("LPoint"==c){var f=[],g=e.registAttendData;f.evt_no=h.evtNo,f.evt_type="lw",f.prom_no=n,f.clvr_tp_cd=o,g+="?evt_no="+h.evtNo,g+="&evt_type=lw",g+="&prom_no="+n,g+="&clvr_tp_cd="+o,b({url:g,data:$.param(f),method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b,c,d,e){b.data_set.response_msg.indexOf("8888")>-1?alert("축하합니다!\n고객님의 소중한 L-money 1천점은 내일 자동지급 예정입니다!"):b.data_set.response_msg.indexOf("0000")>-1?alert("오늘은 아쉽게도 꽝. 내일 다시 도전해 주세요!"):alert(b.data_set.response_msg),h.lpEntryDailCnt=1,a.location.reload()}).error(function(a,b,c,d){alert("error")})}else{d="cl";var f=[];f.evt_no=h.evtNo,f.evt_type="cl",f.prom_no=n,f.clvr_tp_cd=o;var i=e.registAttendData;i+="?evt_no="+h.evtNo,i+="&evt_type=cl",i+="&prom_no="+n,i+="&clvr_tp_cd="+o,b({url:i,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,b,d,e){h.screen1101?(alert("쿠폰이 발급 되었습니다."),location.reload()):q(c)}).error(function(a,b,c,d){alert("error")})}}}else h.goLogin()};var q=function(a){"freeDeliv"==a?$(".stamp_layer > .cont").addClass("typeb"):"cloverLayer3000"==a?$(".stamp_layer > .cont").addClass("typea"):"cloverLayer1000"==a&&$(".stamp_layer > .cont").addClass("typea"),$(".stamp_layer").show()};h.closePop=function(){$(".stamp_layer").hide()},h.closeInfoPop=function(){h.screen1101||$("#visitPop").hide(),$("#cpType").removeClass("btype"),$("#cpType").removeClass("ctype"),$("#cpType").removeClass("dtype")},h.goPointCoupon=function(){var a=c.protocol()+"://"+c.host();h.closeInfoPop(),d.location.href=a+"/mylotte/pointcoupon/point_info.do?"+h.baseParam+"&point_div=clover"}}}}])}(window,window.angular);