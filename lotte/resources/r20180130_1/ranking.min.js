!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","lotteProduct","lotteNgSwipe"]);d.controller("rankingCtrl",["$scope","$http","$filter","$location","$window","$timeout","LotteCommon","LotteUtil","commInitData","LotteStorage","LotteUserService","$compile",function(d,e,f,g,h,i,j,k,l,m,n,o){d.showWrap=!0,d.contVisible=!0,d.ctgDispNo="5537343",d.curDispNo=d.ctgDispNo,d.curDispNoSctCd="44",d.subTitle="랭킹존",d.pageLoading=!0,d.productListLoading=!1,d.productMoreScroll=!0,d.winWidth=b.element(h).width(),d.eventLinkObj={eventInfoUrl:j.eventGumeUrl,eventSaunUrl:j.eventSaunUrl,eventBenefitUrl:j.gdBenefitUrl,eventAttendUrl:j.directAttendUrl},d.productListItemKey=["prd_deal_list"],d.productOnlyNumberKey=["discounted_price","original_price","pmg_gdas_cnt","price","price1","price2","review_count","saleCnt","sale_cnt","sale_rate"],b.element(h).on("resize.main orientationchange.main",function(a){d.winWidth=b.element(h).width()}),d.selectbox_page=[0,0,0],d.screenDataReset=function(){d.productMoreScroll=!0,d.screenData={page:0,pageSize:15,listTotal:0,pageEnd:!1,ban_list:[],prd_deal_list:[],disp_grp_no:NaN,ranking_disp_no:"",lank_keyword:[],ranking_ctg_depth_idx:0,ranking_ctg_level:"MA",ranking_category:[],ranking_ctg_depth:[null,null,null],ranking_gender:"A",ranking_age:"A",ranking_ui:{setting_flag:!1,select_all:[{disp_grp_desc:"전체",disp_grp_no:NaN,disp_no:"",isAll:!0},{disp_grp_desc:"전체",disp_grp_no:NaN,disp_no:"",isAll:!0},{disp_grp_desc:"전체",disp_grp_no:NaN,disp_no:"",isAll:!0}],selectbox:[{disp_grp_desc:"카테고리 전체",disp_grp_no:NaN,disp_no:""},{disp_grp_desc:"전체",disp_grp_no:NaN,disp_no:""},{disp_grp_desc:"전체",disp_grp_no:NaN,disp_no:""}],selectbox_select_idx:0}}},d.getThemaDataUrl=function(a){var b=j.rankingData+"?";if(b+="&rowsPerPage="+d.screenData.pageSize,a.page&&(b+="&page="+a.page),!d.screenData.ranking_ui.setting_flag&&d.loginInfo.isLogin){if(d.loginInfo.gradeCd&&(d.screenData.ranking_gender=d.loginInfo.genSctCd),d.loginInfo.mbrAge){var c=parseInt(d.loginInfo.mbrAge);30>c?d.screenData.ranking_age=20:40>c?d.screenData.ranking_age=30:50>c?d.screenData.ranking_age=40:c>=50&&(d.screenData.ranking_age=50)}a.gender=d.screenData.ranking_gender,a.age=d.screenData.ranking_age}try{console.info("++++++++++++ selectDispNo ++++++++++++",selectDispNo)}catch(e){}if(a.dispGrpNo&&"5537343"!=a.selectDispNo&&"MA"!=a.ctgDepth&&(b+="&dispGrpNo="+a.dispGrpNo),a.selectDispNo&&"5537343"!=a.selectDispNo&&"MA"!=a.ctgDepth&&(b+="&selectDispNo="+(a.selectDispNo?a.selectDispNo:"5537343")),b+="&ctgDepth="+(a.ctgDepth?a.ctgDepth:"MA"),b+="&gender="+("M2"!=a.ctgDepth&&a.gender?a.gender:"A"),b+="&age="+("M2"!=a.ctgDepth&&a.age?a.age:"A"),j.isTestFlag){try{console.log("url ::::: "+b)}catch(e){}b=j.rankingData}return b},d.resetLoading=function(){d.pageLoading=!1,d.productListLoading=!1,d.$parent.LotteSuperBlockStatus=!1},d.loadScreenData=function(a){if(d.$parent.LotteSuperBlockStatus=!0,a.page&&1!=a.page?d.productListLoading=!0:d.pageLoading=!0,!a.page&&a.page>1&&d.screenData.prd_deal_list.length>100)return d.resetLoading(),!1;if(d.screenData.pageEnd)return d.productMoreScroll=!1,d.resetLoading(),!0;var f={method:"get",url:d.getThemaDataUrl(a)};e(f).success(function(e){d.productMoreScroll=!0;var f=[];return typeof e.main_contents==c?!1:(f=e.main_contents,d.loopData=b.copy(d.screenData),a.loadContents?d.productMoreScroll=!1:(a.page||(d.screenData.page=1),a.page>1&&(d.loopData={prd_deal_list:!0}),a.page&&1!=a.page||!d.firstLoopData||(d.loopData=b.extend(d.loopData,d.firstLoopData))),b.forEach(d.loopData,function(e,g){if(f[g]!=c)if(f[g].items!=c){if(d.productListItemKey.indexOf(g)>-1)for(var h=0;h<f[g].items.length;h++)b.forEach(f[g].items[h],function(a,c){d.productOnlyNumberKey.indexOf(c)>-1&&(f[g].items[h][c]=parseInt((a+"").replace(/\,/gi,""))),b.forEach(d.loopData,function(a,d){g==d&&b.forEach(a,function(a,b){c==b&&(f[g].items[h][a]=f[g].items[h][c])})})});a.page>1?(f[g].items&&0!=f[g].items.length||(d.productMoreScroll=!1),d.screenData[g]=d.screenData[g].concat(f[g].items)):d.screenData[g]=f[g].items}else d.screenData[g]=f[g]}),a.page&&1!=a.page||(0==d.screenData.ranking_ctg_depth_idx&&(d.screenData.ranking_ui.select_all[0]={disp_grp_desc:"전체",disp_grp_no:d.screenData.disp_grp_no,disp_no:"5537343",isAll:!0},d.screenData.ranking_ui.selectbox[0]={disp_grp_desc:"카테고리 전체",disp_grp_no:d.screenData.disp_grp_no,disp_no:d.screenData.ranking_disp_no,isAll:!0},d.screenData.ranking_ui.select_all[1]=null,d.screenData.ranking_ui.select_all[2]=null,d.screenData.ranking_ui.selectbox[1]=null,d.screenData.ranking_ui.selectbox[2]=null),"M2"!=a.ctgDepth&&(d.screenData.ranking_category.unshift(d.screenData.ranking_ui.select_all[d.screenData.ranking_ctg_depth_idx]),d.screenData.ranking_ctg_depth[d.screenData.ranking_ctg_depth_idx]=d.splitArrayItem(d.screenData.ranking_category,6,!0))),d.screenData.prd_deal_list.length>=100&&(d.productMoreScroll=!1,d.productListLoading=!1),void(d.screenData=b.copy(d.screenData)))}).error(function(a){console.log("MainContent Data 오류")})["finally"](function(a){d.resetLoading()})},d.splitArrayItem=function(a,b,c){var d=[],e=0,f=0;for(e;e<a.length;e++)f=Math.floor(e/b),d[f]||(d[f]=[]),d[f].push(a[e]);if(c&&d[f].length<b){var g=b-d[f].length;for(e=0;g>e;e++)d[f].push({})}return d};var p=m.getSessionStorage("rankingLoc"),q=m.getSessionStorage("rankingData"),r=m.getSessionStorage("rankingScrollY");if(p==a.location.href&&null!=q&&"true"!=l.query.localtest){var s=JSON.parse(q);d.loginInfo.isLogin!=s.isLoginData?(d.screenDataReset(),d.loadScreenData({page:++d.screenData.page})):(d.screenData=s.screenData,d.pageLoading=!1,i(function(){b.element(h).scrollTop(r)},800))}else d.screenDataReset(),d.loadScreenData({page:++d.screenData.page});b.element(h).on("unload",function(a){var c={};c.screenData=d.screenData,c.isLoginData=d.loginInfo.isLogin,!l.query.localtest&&d.leavePageStroage&&(m.setSessionStorage("rankingLoc",g.absUrl()),m.setSessionStorage("rankingData",c,"json"),m.setSessionStorage("rankingScrollY",b.element(h).scrollTop()))})}]),d.directive("lotteContainer",["$timeout",function(c){return{templateUrl:"/lotte/resources_dev/mall/ranking_container.html",link:function(d,e,f){function g(){var a="m_DC_Ranking_"+d.ctgDispNo+"_sort";a+="F"==d.screenData.ranking_gender?"F":"M"==d.screenData.ranking_gender?"M":"H",a+="_",a+="20"==d.screenData.ranking_age?"20":"30"==d.screenData.ranking_age?"30":"40"==d.screenData.ranking_age?"40":"50"==d.screenData.ranking_age?"50":"1",d.sendTclick(a)}function h(a){return a=(a+"").indexOf("?")>-1?a:a+"?","?"!=a.substring(a.length-1,a.length)&&(a+="&"),a+d.baseParam}d.rankingCtgOpenFlag=!1,d.toggleCtg=function(){d.rankingCtgOpenFlag=!d.rankingCtgOpenFlag},d.ctgSelectBoxClick=function(a){d.screenData.ranking_ui.selectbox_select_idx!=a?(d.screenData.ranking_ui.selectbox_select_idx=a,d.rankingCtgOpenFlag=!0):d.toggleCtg(),c(function(){var e=b.element("#rankSwipeCtg"+(a+1)).scope();e.goSlide(d.selectbox_page[a]||0),c(function(){d.$apply()})},10)},d.swipeEndHandler1=function(a){d.selectbox_page[0]=a.idx},d.swipeEndHandler2=function(a){d.selectbox_page[1]=a.idx},d.swipeEndHandler3=function(a){d.selectbox_page[2]=a.idx},d.ctgChange=function(a){if(a.disp_no==d.screenData.ranking_disp_no||a.disp_grp_no==d.screenData.disp_grp_no)return!1;if(a.isAll)switch(d.screenData.ranking_ui.selectbox_select_idx){case 0:d.screenData.ranking_ctg_level="MA",d.screenData.ranking_ctg_depth_idx=0;break;case 1:d.screenData.ranking_ctg_level="M0",d.screenData.ranking_ctg_depth_idx=1;break;case 2:d.screenData.ranking_ctg_level="M1",d.screenData.ranking_ctg_depth_idx=2}else switch(d.screenData.ranking_ui.selectbox_select_idx){case 0:d.screenData.ranking_ctg_level="M0",d.screenData.ranking_ctg_depth_idx=1,d.selectbox_page[1]=0,d.selectbox_page[2]=0;break;case 1:d.screenData.ranking_ctg_level="M1",d.screenData.ranking_ctg_depth_idx=2,d.selectbox_page[2]=0;break;case 2:d.screenData.ranking_ctg_level="M2"}d.screenData.ranking_ui.select_all[d.screenData.ranking_ctg_depth_idx]={disp_grp_desc:"전체",disp_grp_no:a.disp_grp_no,disp_no:a.disp_no,isAll:!0},d.screenData.ranking_ui.selectbox[d.screenData.ranking_ctg_depth_idx]={disp_grp_desc:"전체",disp_grp_no:a.disp_grp_no,disp_no:a.disp_no,isAll:!0},a.isAll||(d.screenData.ranking_ui.selectbox[d.screenData.ranking_ui.selectbox_select_idx]={disp_grp_desc:a.disp_grp_desc,disp_grp_no:a.disp_grp_no,disp_no:a.disp_no}),d.rankingCtgOpenFlag=!1,d.screenData.ranking_disp_no=a.disp_no,d.screenData.disp_grp_no=a.disp_grp_no,d.loadData(d.screenData.ranking_ctg_level,a.disp_no,a.disp_grp_no),d.sendTclick("m_DC_Ranking_"+a.disp_no+"_cate")},d.rankGenderChange=function(a){d.screenData.ranking_ui.setting_flag=!0,d.screenData.ranking_gender=a,d.loadData(),g()},d.rankAgeChange=function(){d.screenData.ranking_ui.setting_flag=!0,d.loadData(),g()},d.rankAgeLabelClick=function(){b.element(e).find("#rankTypeAge").trigger("click")},d.loadData=function(a,b,c,e){d.screenData.page=1,d.productMoreScroll=!0;var f={dispGrpNo:c?c:d.screenData.disp_grp_no,selectDispNo:b?b:d.screenData.ranking_disp_no,ctgDepth:a?a:d.screenData.ranking_ctg_level,gender:d.screenData.ranking_gender,age:d.screenData.ranking_age};d.loadScreenData(f)},d.linkUrl=function(c,e,f,g){if(e)d.sendOutLink(c),f&&d.sendTclick(f);else{var c=h(c);g&&b.forEach(g,function(a,b){c+="&"+b+"="+a}),f&&(c+="&tclick="+f),a.location.href=c}},d.getProductData=function(){d.loadScreenData({dispGrpNo:d.screenData.disp_grp_no,selectDispNo:d.screenData.ranking_disp_no,ctgDepth:d.screenData.ranking_ctg_level,gender:d.screenData.ranking_gender,age:d.screenData.ranking_age,page:++d.screenData.page}),d.sendTclick("m_DC_Ranking_"+d.ctgDispNo+"_load"+(d.screenData.page-1))}}}}])}(window,window.angular);