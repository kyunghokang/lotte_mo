function calcBytes(a){var b=0;for(i=0;i<a.length;i++){var c=a.charAt(i);escape(c).length>4?b+=2:"\n"==c?"\r"!=a.charAt(i-1)&&(b+=1):b+="<"==c||">"==c?4:1}return b}function maxLengthCheck(a,b,c,d){var e,f,g=c.value.length,h=parseInt(a),i="",j=0;if(0==g)null!=document.getElementById("spn_input_char")&&(document.getElementById("spn_input_char").innerText=h);else for(k=0;k<g;k++){if(e=c.value.charAt(k),"\n"==e&&j++,escape(e).length>4?h-=2:h--,0>h){alert("총 한글 "+a/2+"자 영문 "+a+"자 까지 쓰실 수 있습니다."),c.value=i;break}if(null!=b&j>parseInt(b)){alert("라인수 "+b+"라인을 넘을 수 없습니다."),j=0,f=i.length-1,c.value=i.substring(0,f);break}null!=document.getElementById("spn_input_char")&&(document.getElementById("spn_input_char").innerText=h),i+=e}}!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","lotteSns"]);d.controller("commentRewriteCtrl",["$scope","$timeout","LotteCommon","$http","$filter","$window","LotteUtil","LotteForm",function(a,b,c,d,e,f,g,h){a.showWrap=!0,a.contVisible=!0,a.subTitle="상품평 수정",a.input={},a.input.evt_no=g.getParameter("evt_no"),a.input.evt_flag=g.getParameter("evt_flag"),a.snsFlag="";var i=g.getImagePath()+"/mobile/mobile_new/mylotte/blank.png";a.commentRewrite={};try{d.get(c.commentRewriteData+"?"+a.baseParam+"&gdas_no="+g.getParameter("gdas_no")+"&goods_no="+g.getParameter("goods_no")).success(function(b){a.commentRewrite=b.comment_rewrite,a.subTitle="20"==a.commentRewrite.goods_tp_cd||a.commentRewrite.smp_psb_yn?"이용후기 쓰기":a.subTitle,a.input.gdas_no=a.commentRewrite.gdas_no,a.input.reviewTxt=a.commentRewrite.gdas_cont,a.input.prc_stfd_val=a.commentRewrite.prc_stfd_val,a.input.qual_stfd_val=a.commentRewrite.qual_stfd_val,a.input.dsgn_stfd_val=a.commentRewrite.dsgn_stfd_val,a.input.dlv_stfd_val=a.commentRewrite.dlv_stfd_val,a.input.size=a.commentRewrite.prdt_size_eval_desc,a.input.color=a.commentRewrite.prdt_clor_eval_desc,a.input.frst_gdas_yn=a.commentRewrite.frst_gdas&&"Y"||"N",a.input.wrtr_pur_yn=a.commentRewrite.wrtr_pur&&"Y"||"N",a.input.goods_no=a.commentRewrite.goods_no,a.input.usm_goods_no=a.commentRewrite.usm_goods_no,a.input.img_1=a.commentRewrite.img_path_1_nm&&a.commentRewrite.img_file_1_nm?g.getImagePath("")+a.commentRewrite.img_path_1_nm+a.commentRewrite.img_file_1_nm:i,a.input.img_2=a.commentRewrite.img_path_2_nm&&a.commentRewrite.img_file_2_nm?g.getImagePath("")+a.commentRewrite.img_path_2_nm+a.commentRewrite.img_file_2_nm:i,a.input.img_3=a.commentRewrite.img_path_3_nm&&a.commentRewrite.img_file_3_nm?g.getImagePath("")+a.commentRewrite.img_path_3_nm+a.commentRewrite.img_file_3_nm:i,a.hasImage=a.commentRewrite.img_path_1_nm&&a.commentRewrite.img_file_1_nm||a.commentRewrite.img_path_2_nm&&a.commentRewrite.img_file_2_nm||a.commentRewrite.img_path_3_nm&&a.commentRewrite.img_file_3_nm?!0:!1}).error(function(a){ajaxResponseErrorHandler(a)})}catch(j){console.error(j)}a.deleteAttachedImage=function(b){if(confirm("사진을 삭제하시겠습니까?")){switch(a.input.del_file="",a.input.del_path="",b){case 1:a.input.del_file=a.input.img_file_1,a.input.del_path=a.input.img_path_1,a.input.img_file_1="",a.input.img_path_1="";break;case 2:a.input.del_file=a.input.img_file_2,a.input.del_path=a.input.img_path_2,a.input.img_file_2="",a.input.img_path_2="";break;case 3:a.input.del_file=a.input.img_file_3,a.input.del_path=a.input.img_path_3,a.input.img_file_3="",a.input.img_path_3=""}h.FormSubmitForAjax(c.commentImageDeleteData+"?"+a.baseParam,a.input).success(function(a){document.querySelectorAll("#img_list img")[b-1].src=i,document.querySelectorAll("#img_list a")[b-1].style.display="none"}).error(function(a){ajaxResponseErrorHandler(a)})}},a.cancel=function(){confirm("상품평 수정을 취소하시겠습니까?")&&location.replace(c.mylotteCritViewUrl+"?"+a.baseParam+"&mode=second")},a.deleteComment=function(){d.get(c.commentCountDeletedData+"?"+a.baseParam+"&gdas_no="+a.commentRewrite.gdas_no).success(function(b){var d=b.comment_count_deleted.deleted_count;if(2==d){if(!confirm("고객님께서는 최근 1개월 동안 총 2회 상품평을 삭제하셨습니다.\n지금 삭제하시면 앞으로 3개월간 상품평 작성 권한이 제한됩니다.\n삭제하시겠습니까?"))return}else if(!confirm("해당 상품평을 삭제 하시겠습니까?"))return;h.FormSubmitForAjax(c.commentDeleteData+"?"+a.baseParam,{gdas_no:a.input.gdas_no}).success(function(b){location.replace(c.mylotteCritViewUrl+"?"+a.baseParam)}).error(function(a){ajaxResponseErrorHandler(a)})}).error(function(a){ajaxResponseErrorHandler(a)})},a.save=function(){if(!a.commentRewrite.healthfood){var d=a.input.reviewTxt,e=document.querySelector("#reviewTxt");if(0==d.trim().length)return alert("상품평을 작성해 주세요."),e.focus(),!1;if(calcBytes(d)<6)return alert("상품평을 한글 3자 이상 입력하세요."),e.focus(),!1;if(calcBytes(d)>4e3)return alert("상품평은 2000자[한글기준] 이내로 제한되어 있습니다."),e.focus(),!1}if(a.snsFlag&&(Kakao.cleanup(),1==a.appObj.isSktApp?Kakao.init("7a460fb5cdebe4589041db57d906ddda"):Kakao.init("574659987ca46095c123d71f72abac14"),a.prdComment="[상품평] "+a.input.reviewTxt,a.share_img=a.commentRewrite.goods_img_url,a.share_url="/product/product_view.do?goods_no="+a.commentRewrite.goods_no,1==a.appObj.isSktApp?a.noCdnUrl=location.protocol+"//"+location.hostname+a.share_url+"&cn=171127":a.noCdnUrl=location.protocol+"//"+location.hostname+a.share_url+"&cn=123624",1==a.appObj.isSktApp?(a.talkCdn="3093671",a.twitCdn="3093668",a.stotyCdn="3093670",a.smsCdn="3093672",a.mailCdn="3158697",a.faceCdn="3093669",a.urlCdn="3158696",a.appCdn="3158696"):(a.talkCdn="2929723",a.twitCdn="2929720",a.stotyCdn="2929722",a.smsCdn="2929725",a.mailCdn="2929724",a.faceCdn="2929721",a.urlCdn="2929719",a.appCdn="2929719")),a.appObj.isApp){var g=c.commentRewriteSaveData+"?"+a.baseParam;return void h.FormSubmitForAjax(g,a.input).success(function(d){if(a.snsFlag){"sms"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_4"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.smsCdn),"kakaotalk"==a.snsFlag&&(a.appObj.isOldApp?a.kakaoType="[롯데닷컴 이거어때?]\n":a.kakaoType="",a.sendTclick(a.tClickBase+"share_Clk_Pop_1"),a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.talkCdn),"kakaostory"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_3"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.stotyCdn),"facebook"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_6"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.faceCdn),"twitter"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_2"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.twitCdn),"url_copy"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_7"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.urlCdn),"moreapp"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_8"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.appCdn),"mail"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_5"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.mailCdn),a.share_img&&""!=a.share_img?a.share_img=a.share_img:a.share_img="http://image.lotte.com/lotte/mobile/common/share_img2016_v2.png";var e={url:a.cnShareUrl,title:a.kakaoType+a.prdComment.replace(/#/gi,""),imageUrl:a.share_img};a.appObj.isAndroid?f.lotteshare.callAndroid("lotteshare://"+a.snsFlag+"/query?"+JSON.stringify(e)):a.appObj.isIOS&&(f.location="lotteshare://"+a.snsFlag+"/query?"+JSON.stringify(e))}b(function(){location.replace(c.mylotteCritViewUrl+"?"+a.baseParam+"&mode=second")},200)}).error(function(a){ajaxResponseErrorHandler(a)})}var g=c.commentRewriteSaveData+"?"+a.baseParam;return h.FormSubmitForAjax(g,a.input).success(function(d){a.snsFlag&&("sms"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.smsCdn,a.showSmsBox()):"kakaotalk"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.talkCdn,a.sendKakaoTalk()):"kakaostory"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.stotyCdn,a.sendKakaoStory()):"facebook"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.faceCdn,a.sendFacebook()):"twitter"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.twitCdn,cc,a.sendTwitter()):"url_copy"==a.snsFlag&&(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.urlCdn,a.urlCopyClick())),b(function(){location.replace(c.mylotteCritViewUrl+"?"+a.baseParam+"&mode=second")},200)}).error(function(a){ajaxResponseErrorHandler(a)}),!1}}]),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/product/m/comment_rewrite_container.html",replace:!0,link:function(a,b,c){}}})}(window,window.angular);var ajaxResponseFailHandler=function(a){alert("처리중 오류가 발생하였습니다."),a&&a()},ajaxResponseErrorHandler=function(a,b){if(a.error){var c=a.error.response_code,d=a.error.response_msg;if("9004"==c){var e="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href="/login/m/loginForm.do?"+e}else alert("["+c+"] "+d)}else alert("처리중 오류가 발생하였습니다.");b&&b()};