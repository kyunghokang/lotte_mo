{"version":3,"file":"instagram_list.min.js","sources":["instagram_list.js"],"names":["window","angular","undefined","app","module","controller","$scope","$window","$http","LotteCommon","setBaseParameter","href","indexOf","substring","length","baseParam","ajaxLoadFlag","showWrap","contVisible","subTitle","screenID","pageLoading","productListLoading","screenDataReset","screenData","page","goodsPage","pageSize","pageEnd","tocken","cliientId","dispNoCode","instaData","goodsData","instaText","tclickIndex","nextURL","loadData","jsonp","success","response","data","concat","goodsSliceData","i","j","k","tmpArr","caption","text","replace","tags","push","join","meta","code","pagination","next_url","console","info","tmpIdx","loadItemCnt","goodsUrl","instagramGoodsData","method","url","goodsArr","max","items","tabIdx","error","linkUrl","outlinkFlag","tclick","addParams","sendOutLink","sendTclick","forEach","val","key","disp_no_start","header_menu_dispno","substr","headerMenuClick","location","directive","commInitData","templateUrl","link","el","attrs","$cont","element","instaCommentMore","idx","more_open","$on","event","args","scrollHeight","winHeight","scrollPos","gotoLinkM","tclick_b","index","infoFlag","item","prdviewUrl","goods_no","params"],"mappings":"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","sourceRoot":"/","sourcesContent":["(function(window, angular, undefined) {\r\n    'use strict';\r\n\r\n    var app = angular.module('app', [\r\n        'lotteComm',\r\n        'lotteSrh',\r\n        'lotteSideCtg',\r\n        // 'lotteSideMylotte',\r\n        'lotteCommFooter',\r\n        'angular-carousel'\r\n    ]);\r\n\r\n    app.controller('instagramListCtrl', ['$scope', '$window', '$http', 'LotteCommon', function ($scope, $window, $http, LotteCommon) {\r\n        $scope.ajaxLoadFlag = false;\r\n        $scope.showWrap = true;\r\n        $scope.contVisible = true;\r\n        $scope.subTitle = \"DearPetgram\"; // 서브헤더 타이틀\r\n        $scope.screenID = \"인스타그램 피드 컨텐츠 페이지\"; // 스크린 아이디\r\n        $scope.pageLoading = true; // 페이지 로딩중 여부 Flag\r\n        $scope.productListLoading = false; // 페이지 더 불러오기 로딩중 Flag\r\n        \r\n        /********************************************\r\n         * Util Func.\r\n         ********************************************/\r\n        // URL에 Base Parameter 추가\r\n        function setBaseParameter(href) {\r\n            href = (href + \"\").indexOf(\"?\") > -1 ? href : href + \"?\";\r\n\r\n            if (href.substring(href.length - 1, href.length) != \"?\") {\r\n                href += \"&\";\r\n            }\r\n\r\n            return href + $scope.baseParam;\r\n        }\r\n        \r\n        // 스크린 데이터\r\n        ($scope.screenDataReset = function() {\r\n        \t$scope.screenData = {\r\n        \t\tpage: 0, // 인스타그램 페이징\r\n                goodsPage: 0, // 상품정보 페이징\r\n        \t\tpageSize: 5,\r\n        \t\tpageEnd: false,\r\n                tocken: \"1168706956.360887b.6059697a811e486580628a071b04d523\", /* Access Tocken 입력 */\r\n                cliientId: \"360887b5534c4842a7f6c81353ad2ad1\",\r\n                dispNoCode: [],\r\n                instaData: {}, // 인스타그램 Data 초기화\r\n                goodsData: {}, // 상품정보 Data 초기화\r\n                instaText: [], // 인스타 엔터 변환 텍스트 초기화\r\n                tclickIndex: [] // 티클릭 index\r\n        \t}\r\n        })();\r\n\r\n        //해시태그 명으로 가져올 경우\r\n        var nextURL = \"https://api.instagram.com/v1/tags/dearpet/media/recent?count=\"+ $scope.screenData.pageSize + \"&access_token=\" + $scope.screenData.tocken + \"&callback=JSON_CALLBACK\";\r\n        //계정 명으로 가져올 경우\r\n        //var nextURL = \"https://api.instagram.com/v1/users/self/media/recent?count=\"+ $scope.screenData.pageSize + \"&access_token=\" + $scope.screenData.tocken + \"&callback=JSON_CALLBACK\";\r\n\r\n        var tclickIndex = 0;\r\n\r\n        $scope.loadData = function (page) {\r\n            if($scope.ajaxLoadFlag){ return false; }\r\n\r\n            $scope.ajaxLoadFlag = true;\r\n\r\n            if (nextURL.indexOf('undefined') == -1 ) { // 추가 로드가 있는지 판단\r\n                $http.jsonp(nextURL)\r\n                .success(function (response) {\r\n\r\n                    if ($scope.screenData.page == 0) { // 페이징 첫번째일 경우\r\n                        $scope.screenData.instaData = response.data;\r\n                    }else{\r\n                        $scope.productListLoading = true;\r\n                        $scope.screenData.instaData = $scope.screenData.instaData.concat(response.data);\r\n                    }\r\n\r\n                    var goodsSliceData = []; // 상품번호 배열 초기화\r\n\r\n\r\n                    if ( response.data.length > 0 ) {\r\n                        var i = 0,\r\n                            j = 0,\r\n                            k = 0;\r\n\r\n                        for(i; i < response.data.length; i++) {\r\n                            goodsSliceData[k] = []; // 각 순서에 상품번호 배열 초기화\r\n                            var tmpArr = [];\r\n\r\n                            $scope.screenData.instaText[i] = response.data[i].caption.text.replace(/\\n/gi,'<br/>');\r\n                            response.data[i].caption.text = $scope.screenData.instaText[i];\r\n\r\n\r\n                            for (j = 0; j < response.data[i].tags.length; j++) {\r\n\r\n                                if (response.data[i].tags[j].indexOf('상품번호') != -1) {\r\n                                    tmpArr.push(response.data[i].tags[j].replace(/상품번호/g,\"\"));\r\n                                }\r\n                            }\r\n\r\n                            if (tmpArr.length == 0) { // 상품번호 없을경우 인스타 피드 갯수와 매칭시키기 위해 빈값 추가\r\n                                tmpArr.push(\"0\");\r\n                            }\r\n                            goodsSliceData[k] = tmpArr.join(\",\");\r\n                            k++;\r\n                        }  \r\n                    }\r\n\r\n                    if (response.meta.code == \"200\") {\r\n                        $scope.screenData.page++;\r\n                        nextURL = response.pagination.next_url + \"&callback=JSON_CALLBACK\";\r\n                    }\r\n\r\n                    $scope.screenDataReset.dispNoCode = goodsSliceData;\r\n                })\r\n                .finally(function () {\r\n                   $scope.goodsData();\r\n                });\r\n            }else{\r\n                $scope.productListLoading = false;\r\n                $scope.screenData.pageEnd = true;\r\n                console.info('::::: 추가페이지 없음 :::::');\r\n            }\r\n        };\r\n        $scope.loadData();\r\n\r\n        var tmpIdx = 1;\r\n        var loadItemCnt = 0;\r\n\r\n        // 상품정보 불러오기\r\n        $scope.goodsData = function() {\r\n            $scope.productListLoading = true;\r\n\r\n            var goodsUrl = LotteCommon.instagramGoodsData;\r\n            $http({\r\n                method: 'POST',\r\n                url: goodsUrl,\r\n\r\n                //data: {goodsArr: [\"264860155,264525455\", \"0\", \"264525455,264860155\"]}\r\n                data: {goodsArr: $scope.screenDataReset.dispNoCode}\r\n            })\r\n            .success(function (response){\r\n                for (var i = 0; i < response.max.length; i++) {\r\n                    if ($scope.screenData.instaData[loadItemCnt]) {\r\n                        $scope.screenData.instaData[loadItemCnt].goodsData = response.max[i].items;\r\n\r\n                        if (response.max[i].items && response.max[i].items.length > 0) {\r\n                            $scope.screenData.instaData[loadItemCnt].tabIdx = tmpIdx;\r\n                            tmpIdx++;\r\n                        }\r\n                        loadItemCnt++;\r\n                    }\r\n                }\r\n\r\n                $scope.pageLoading = false;\r\n                $scope.productListLoading = false;\r\n            })\r\n            .error(function () {\r\n                console.info('상품 데이터 연동 오류');\r\n                $scope.pageLoading = false;\r\n                $scope.ajaxLoadFlag = false;\r\n            })\r\n            .finally(function () {\r\n                $scope.screenData.goodsPage++;\r\n                $scope.ajaxLoadFlag = false;\r\n            });\r\n        }\r\n\r\n        // 배너 일반/아웃 링크 처리\r\n        $scope.linkUrl = function (url, outlinkFlag, tclick, addParams) {\r\n           \r\n            if (outlinkFlag) {\r\n                $scope.sendOutLink(url); // 외부 링크 보내기 (새창)\r\n\r\n                if (tclick) { // tclick이 있다면\r\n                    $scope.sendTclick(tclick); // 외부링크일때 iframe으로 tclick 전송\r\n                }\r\n            } else {\r\n                var url = setBaseParameter(url) ; // 링크 url에 base parameter를 붙여준다.\r\n\r\n                if (addParams) { // 추가 파라메타가 있다면\r\n                    angular.forEach(addParams, function (val, key) {\r\n                        url += \"&\" + key + \"=\" + val;\r\n                    });\r\n                }\r\n\r\n                if (tclick) { // tclick 이 있다면 url 뒤에 parameter를 추가한다.\r\n                    url += \"&tclick=\" + tclick;\r\n                }\r\n\r\n                if ( (url + \"\").indexOf('main_phone.do?dispNo=') != -1 ) { // 링크 메인탭 이동시 url 변경이 한번 된 후 는 이동이 안되는 현상 예외처리\r\n                    if(tclick){\r\n                        $scope.sendTclick(tclick);\r\n                    }\r\n                    \r\n                    var disp_no_start = url.indexOf('dispNo=') + 7;\r\n                    var header_menu_dispno = url.substr(disp_no_start, 7);\r\n                    $scope.headerMenuClick(header_menu_dispno);\r\n                } else {\r\n                    window.location.href = url; // url 이동\r\n                }\r\n            }\r\n        };\r\n    }]);\r\n\r\n    app.directive('lotteContainer', ['LotteCommon', 'commInitData', function (LotteCommon, commInitData) {\r\n        return {\r\n            templateUrl : '/lotte/resources_dev/instagram/instagram_list_container.html',\r\n            replace : true,\r\n            link : function($scope, el, attrs) {\r\n                var $cont = angular.element(\"body\")[0];\r\n\r\n                $scope.instaCommentMore = function(idx) { // 더보기 버튼\r\n                   $scope.screenData.instaData[idx].more_open = $scope.screenData.instaData[idx].more_open ? false : true;\r\n                }\r\n\r\n                $scope.$on(\"winScroll\", function (event, args) { // args.scrollPos, args.winWidth, args.winHeight\r\n                    if($scope.screenData.pageEnd===true){ return; }\r\n                    if (!$scope.ajaxLoadFlag && $cont.scrollHeight - args.winHeight * 2 <= args.scrollPos + args.winHeight) {\r\n                        $scope.productListLoading = true;\r\n                        $scope.loadData();\r\n                    }\r\n                });\r\n\r\n                //링크 이동 : 티클릭조함\r\n                $scope.gotoLinkM = function(link, tclick_b, index, infoFlag, item){\r\n\r\n                    var tclick = \"m_DC_SpeDisp2_Clk_Prd_\" + tclick_b;\r\n                    if(index!=null){\r\n                        if(index < 10){\r\n                            tclick = tclick + \"0\" + index;\r\n                        }else{\r\n                            tclick = tclick + index;\r\n                        }\r\n                    }\r\n\r\n                    if(item != null){ //상세 \r\n                        link =  LotteCommon.prdviewUrl + \"?\" + $scope.baseParam + \"&goods_no=\" + item.goods_no;\r\n                    }\r\n                    // $window.location.href = link + \"&tclick=\" + tclick;\r\n                    var params = {};\r\n\r\n                    // LotteLink.goLink(link, $scope.baseParam, params);\r\n                    $scope.linkUrl(link, false, tclick, params);\r\n                };\r\n            }\r\n        };\r\n    }]);\r\n\r\n})(window, window.angular);"]}