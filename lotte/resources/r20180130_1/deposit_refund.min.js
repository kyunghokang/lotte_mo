!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter"]);d.controller("DepositRefundCtrl",["$scope","$http","$window","$timeout","LotteCommon",function(a,c,d,e,f){a.showWrap=!0,a.contVisible=!0,a.subTitle="보관금 환불 요청",a.isLoading=!0,a.changBankFlag=!1,a.disDouble=!0,a.disCheckDouble=!0;var g=f.pointInfoData+"?"+a.baseParam+"&point_div=deposit&tclick=m_mylayer_deposit";c.get(g).success(function(b){a.maxData=b,a.pointListData=b.max.pointList,a.pointDelData=b.max.tobeDelLPointList,a.pointSaveData=b.max.saveLtPointList,a.bankListData=b.max.bankList.items[0],a.bankSelectData=b.max.bankList,a.bankHasYn=b.max.refund_acct_yn,"Y"==b.max.refund_acct_yn?a.changBankFlag=!1:a.changBankFlag=!0,a.bankName=b.max.refund_acct_bank_cd,a.bankNo=b.max.refund_acct_no,a.bankOwner=b.max.refund_acct_holder,a.isLoading=!1}).error(function(a,b,c,d){console.log("Error Data : ",b,c,d)}),a.refundDeposit=function(g,h,i,j){if(console.log("refundDeposit",g,h,i,j),a.disDouble=!1,a.disCheckDouble=!1,a.refundType=j,a.bankName=g,a.bankNo=h,console.log(a.refundType),"CHANGE"==a.refundType)if("Y"==a.bankHasYn)a.refundType="U";else{if("N"!=a.bankHasYn)return alert("잘못된 신청입니다.(system)"),a.disDouble=!0,a.disCheckDouble=!0,!1;a.refundType="C",a.bankOwner=a.loginInfo.name,console.log("changed type : "+a.refundType)}else"R"!=a.refundType?a.refundType="D":a.refundType="R";e(function(){if(console.log("refundDeposit bank : "+a.bankName),console.log("refundDeposit no   : "+a.bankNo),console.log("refundDeposit name : "+a.bankOwner),console.log("refundDeposit type : "+a.refundType),console.log("refundDeposit posi : "+a.isPossibleCommit),console.log("refundDeposit mony : "+a.maxData.max.deposit),"R"==a.refundType){if(null==a.bankName||""==a.bankName||null==a.bankNo||""==a.bankNo)return alert("은행정보가 없습니다."),a.disDouble=!0,a.disCheckDouble=!0,!1;if(!b.isDefined(j)||""==a.refundType||null==a.refundType)return alert("신청정보 오류(system)"),a.disDouble=!0,a.disCheckDouble=!0,!1}else{if("D"==a.refundType)return e(function(){c({method:"POST",url:"/json/mylotte/pointcoupon/refund_acct_mng.json",data:{ooa_nm:a.bankOwner,proc_div:a.refundType,bnk_cd:a.bankName,actn:a.bankNo,occr_amt:a.maxData.max.deposit},transformRequest:transformJsonToParam,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b){return console.log(b.resultMsg),alert(b.resultMsg.RESPONSE_MSG),"0000"!=b.resultMsg.RESPONSE_CODE?(a.disDouble=!0,a.disCheckDouble=!0,!1):void(d.location.href=f.depositDetailUrl+"?"+a.baseParam+"&point_div=coupon&tclick=m_mylayer_deposit")}).error(function(b){a.disDouble=!0,a.disCheckDouble=!0,console.log("환불 신청 실패")}),a.disDouble=!0,a.disCheckDouble=!0},500),!1;if(!b.isDefined(a.bankName)||null==a.bankName||""==a.bankName)return alert("은행을 선택해 주세요."),a.disDouble=!0,a.disCheckDouble=!0,!1;if(!b.isDefined(a.bankNo)||null==a.bankNo||""==a.bankNo)return alert("계좌번호를 입력해주세요."),a.disDouble=!0,a.disCheckDouble=!0,!1;if(!b.isDefined(j)||""==a.refundType||null==a.refundType)return alert("신청정보 오류(system)"),a.disDouble=!0,a.disCheckDouble=!0,!1}e(function(){c({method:"POST",url:"/json/mylotte/pointcoupon/refund_acct_mng.json",data:{ooa_nm:a.bankOwner,proc_div:a.refundType,bnk_cd:a.bankName,actn:a.bankNo,occr_amt:a.maxData.max.deposit},transformRequest:transformJsonToParam,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b){return console.log(b.resultMsg),alert(b.resultMsg.RESPONSE_MSG),"0000"!=b.resultMsg.RESPONSE_CODE?!1:void(d.location.href=f.depositDetailUrl+"?"+a.baseParam+"&point_div=coupon&tclick=m_mylayer_deposit")}).error(function(a){console.log("환불 신청 실패")}),a.disDouble=!0,a.disCheckDouble=!0},500)},500)},a.depositClick=function(){d.location.href=f.pointInfoUrl+"?"+a.baseParam+"&point_div=deposit&tclick=m_mylayer_deposit"},a.changingClick=function(){a.disDouble=!1,a.disDouble=!0,a.disCheckDouble=!0,history.go(-1)},a.refunding=function(){alert("환불계좌를 등록해주세요.")},a.goChangbank=function(){a.bankName="",a.bankNo="",a.changBankFlag=!0,a.disDouble=!0,a.disCheckDouble=!0}}]),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/mylotte/pointcoupon/m/deposit_refund_container.html",replace:!0,link:function(a,b,c){}}}),d.directive("numericOnly",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){var b=a?a.replace(/[^\d.-]/g,""):null;return b!=a&&(d.$setViewValue(b),d.$render()),b})}}})}(window,window.angular);var transformJsonToParam=function(a){var b=[];for(var c in a)if(Array.isArray(a[c]))for(var d=0;d<a[c].length;d++)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c][d]));else b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")};