!function(a,b,c){"use strict";var d=b.module("lotteUtil");d.service("StyleRecom",["$window","$http","LotteCommon","commInitData",function(a,b,d,e){function f(a){if(a==c)return[];if(a.status===!1)return console.warn(a.message),j(),[];if(a.list==c)return[];var b,d,e,f,h=a.list,i=[];for(var k in h)for(e=h[k],d=e.length,b=0;d>b;b++)f=e[b],f.category=parseInt(k,10),f.score=Math.round(100*f.score),f.rx1=Math.round(1e4*f.rx1)/100,f.rx2=Math.round(1e4*f.rx2)/100,f.ry1=Math.round(1e4*f.ry1)/100,f.ry2=Math.round(1e4*f.ry2)/100,f.genCd=a.genCd,i.push(f);return i=i.sort(g)}function g(a,b){var c=a.score,d=b.score;return c>d?-1:d>c?1:0}function h(a,b){var d=[];for(var e in a)if(getScope().isValidArray(a[e])){d=a[e];break}if(d==c||0==d.length)return void b([]);for(var f,g=d.length,h=0;g>h;h++)f=d[h],f.imgUrl2=f.imgUrl.replace(/_280/g,"_550");b(d)}function i(a,b){try{for(var d=b.length,e=0,f=0;d>f;f++)o[a+b[f]]!=c&&(e|=o[a+b[f]]);return e}catch(g){}return""}function j(){var a=getScope(),b=new Date,c=b.getHours(),d=10>c?"0"+c:""+c,e=a.tClickBase;""!=m&&(e=m),a.sendTclick(e+"ProdDetail_DataError_"+d)}var k=d.stylePushPrdData,l="/json/search/m/styleRecommCateGrpList.json",m="",n=400;this.setDotAPIUrl=function(a){k=a},this.setTclickBase=function(a){m=a},this.setSearchItemLimit=function(a){n=a};var o={F1:536870913,F2:536870914,F4:536870916,F8:536870920,F16:536870928,F32:536870944,M2:1073741826,M4:1073741828,M16:1073741840,M32:1073741856,A1:1,A2:2,A4:4,A8:8,A16:16,A32:32};this.gender={female:"F",male:"M",all:"A"},this.category={dresses:1,pants:2,shorts:4,skirts:8,tops:16,outers:32},this.detect=function(a,b,e){return a==c||""==a?(console.warn("NO IMAGE"),!1):b==c||"function"!=typeof b?(console.warn("NO CALLBACK FUNCTION"),!1):(isNaN(e)&&(e=""),$.ajax({url:d.styleRecomDetect+"?url="+encodeURIComponent(a)+"&goods_no="+e,type:"get",dataType:"json",async:!0,success:function(a){b(f(a))},error:function(a){j(),b([])}}),void getScope().sendTclick("DC_StyleReco_Detect"))},this.search=function(a,b,e,f,g,k){if(a==c||""==a)return console.warn("NO ID"),!1;if(b==c||""==b)return console.warn("NO SEX"),!1;if(e==c||0==e.length)return console.warn("NO CATEGORY"),!1;if("object"!=typeof e&&(e=[e]),g==c||"function"!=typeof g)return console.warn("NO CALLBACK FUNCTION"),!1;isNaN(k)&&(k="");var l=i(b,e);if(""==l)return console.warn("INCORRECT CATEGORY"),!1;var m={id:a,category:l,goods_no:k,recommcgcd:1,count:300},n=d.styleRecomSearch;if(f!=c||""!=f){var o=parseInt(f,10);isNaN(o)||(m.recommcgcd=o)}$.ajax({url:n,type:"POST",data:m,dataType:"JSON",async:!0,method:"POST",success:function(a){h(a,g)},error:function(a){j(),g([])}}),getScope().sendTclick("DC_StyleReco_Search")},this.cateList=function(a){$.ajax({url:l,type:"get",dataType:"json",async:!0,success:function(b){a(b.cateGrpList||[])},error:function(b){a([])}})}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("lotteSlider",[]);d.controller("LotteSlideCtrl",["$scope",function(b){b.getTranslateXCssObj=function(a,b){var c={"-webkit-backface-visibility":"hidden","-moz-backface-visibility":"hidden","backface-visibility":"hidden","-webkit-transform":"translateX("+a+"px)","-ms-transform":"translateX("+a+"px)","-moz-transform":"translateX("+a+"px)",transform:"translateX("+a+"px)","-webkit-transition":"","-moz-transition":"","-o-transition":"",transition:""};return b&&b>0&&(c["-webkit-transition"]="-webkit-transform "+b+"ms",c["-moz-transition"]="-moz-transform "+b+"ms",c["-o-transition"]="-o-transform "+b+"ms",c.transition="transform "+b+"ms"),c},b.removeTranslateCSS=function(){return{"-webkit-backface-visibility":"","-moz-backface-visibility":"","backface-visibility":"","-webkit-transform":"","-ms-transform":"","-moz-transform":"",transform:""}},b.getCoordinates=function(a){var b=a.touches&&a.touches.length?a.touches:[a],c=a.changedTouches&&a.changedTouches[0]||a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]||b[0].originalEvent||b[0];return{x:c.clientX,y:c.clientY}},b.getTransXPos=function(b){var c=a.getComputedStyle(b.get(0)),d=new WebKitCSSMatrix(c.webkitTransform);return d.m41}}]),d.directive("lotteSlider",["$window","$timeout","$parse",function(a,c,d){return{controller:"LotteSlideCtrl",link:function(d,e,f,g){function h(){m=k.outerWidth(),l.css({display:"inline-block"}),n=l.outerWidth(),x=-(n-m);var a=d.getTransXPos;(a.x>0||a.x<x)&&i(0,500)}function i(a,b){l.css(d.getTranslateXCssObj(a,b)),k.trigger({type:"slide",posX:a,wrapWidth:m,contWidth:n})}function j(){k.on({"touchstart.lotteSlider":function(a){m=k.outerWidth(),n=l.outerWidth(),y=!1,z=!1,n>m&&(a.stopPropagation(),o=!0,q=d.getCoordinates(a),p=d.getTransXPos(l),t=Date.now())},"touchmove.lotteSlider":function(a){if(o){var b,c;if(r=d.getCoordinates(a),b=Math.abs(r.x-q.x),c=Math.abs(r.y-q.y),y||(z=b>c,y=!0),z){b>5&&a.preventDefault(),a.stopPropagation();var e=p+r.x-q.x;e>0?e/=3:x>e&&(e=x+(e-x)/3),i(e,0)}}},"touchend.lotteSlider":function(a){if(s=d.getCoordinates(a),o&&q.x!=s.x&&(Math.abs(q.x-s.x)>5&&a.preventDefault(),event.stopPropagation(),y=!1,z)){m=k.outerWidth();var b=d.getTransXPos(l);u=Date.now(),w=q.x>s.x?-1:1,v=u-t;var c=Math.abs(q.x-s.x),e=.4,f=c*e/v,g=b+m*f*w;g>0?g=0:x>g&&(g=x),(Math.abs(b-g)>30||0==g||g==x)&&i(g,500)}},"touchcancel.lotteSlider":function(a){}}),b.element(a).on("resize.lotteSlider orientationchange.lotteSlider",function(){h()})}var k=b.element(e),l=k.find(">").eq(0),m=k.width(),n=l.width(),o=!1,p=0,q=null,r=null,s=null,t=0,u=0,v=0,w=0,x=0;d.lotteSliderMoveXPos=function(a,b){m=k.width(),n=l.width(),a>0?a=0:Math.abs(a)>n-m&&(a=-(n-m)),b||(b=0),i(a,b)},d.reset=function(){o=!1,i(0,0),c(function(){h()})};var y=!1,z=!1;c(function(){h(),j()})}}}])}(window,window.angular),function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteSideMylotte","lotteCommFooter","lotteSlider","lotteSns"]);d.controller("StyleRecomCtrl",["$scope","$http","LotteCommon","LotteStorage","commInitData",function(b,c,d,e,f){function g(a){return 10>a?"0"+a:a+""}function h(a,b,c,d,e,f){var g=new Date(a,b,c,d,e,f);return a&&b&&c&&(g.setFullYear(a),g.setMonth(b-1),g.setDate(c),d&&g.setHours(d),e&&g.setMinutes(e),f&&g.setSeconds(f)),g.getTime()}if(b.showWrap=!0,b.contVisible=!0,b.subTitle="스타일추천",b.screenID="StyleReco",b.hasSharePreFunc=!0,b.isShowThisSns=!0,b.planShopSns=!0,b.share_img=f.query.img,b.SR_IMG="",b.DETECT_LIST=[],b.PROD_LIST=[],b.PROD_ORIGIN_LIST=[],b.CATE_NO=f.query.cate,b.isCamera=f.query.img_key,b.styleCateList=[],b.GOODS_NO=f.query.goods_no,!b.isValidString(b.GOODS_NO))try{var i=b.share_img.split("/"),j=i[i.length-1];b.GOODS_NO=j.substr(0,j.indexOf("_")),isNaN(b.GOODS_NO)&&(b.GOODS_NO="")}catch(k){}b.showHeaderCamera=!0,b.isShowLoading=!0;var l=e.getLocalStorage("styleCoachMark");l||(b.styleCoachMark=!0,e.setLocalStorage("styleCoachMark","1")),b.closeCoachMark=function(){b.styleCoachMark=!1},b.SEX=[{label:"여성",data:"F"},{label:"남성",data:"M"},{label:"전체",data:"A"}],b.childSex=[{label:"여아",data:"F"},{label:"남아",data:"M"},{label:"전체",data:"A"}],b.CATE=[{label:"상의",data:16,tclick:1,selected:!1},{label:"아우터",data:32,tclick:6,selected:!1},{label:"긴바지",data:2,tclick:2,selected:!1},{label:"반바지",data:4,tclick:3,selected:!1},{label:"스커트",data:8,tclick:5,selected:!1},{label:"원피스",data:1,tclick:4,selected:!1}],b.selectedID="",b.selectedSex="";var m=new Date,n=m.getFullYear()+g(m.getMonth()+1)+g(m.getDate()),o=m.getTime();if(f.query.testDate){f.query.testDate;n=f.query.testDate,o=h(n.substring(0,4),n.substring(4,6),n.substring(6,8),n.substring(8,10),n.substring(10,12),n.substring(12,14))}b.styRecomBnr=!1,o<h(2017,6,30,17,0)&&(b.styRecomBnr=!0),b.refreshStyle=function(c,e){var g=c.imgUrl2,h=g.replace("280.jpg","550.jpg");10>e&&(e="0"+parseInt(e,10));var i="m_DC_"+b.screenID+"_clk_RePrd_idx"+e;a.location.href=d.styleRecomUrl+"?img="+h+"&goods_no="+c.goodsNo+"&"+b.baseParam+"&cate="+f.query.cate+"&tclick="+i},b.goStyleRecom=function(c){if(c.img_url&&c.img_key){var e="m_DC_"+b.screenID+"_clk_camera";a.location.href=d.styleRecomUrl+"?img="+c.img_url+"&img_key="+c.img_key+"&"+b.baseParam+"&tclick="+e}},b.showSharePopPre=function(){var a={shareImg:b.share_img,tclick:"m_DC_"+b.screenID+"_clk_share"};b.showSharePop(a),f.query.img_key&&c.get("/json/search/m/updateStyleRecoShareState.json?img_key="+f.query.img_key).success(function(a){console.log("updateStyleRecoShareState 성공")}).error(function(a){console.log("Error Data :  updateStyleRecoShareState 실패")})}}]),d.directive("styleRecomImageLoad",["$timeout","commInitData",function(a,b){return{restrict:"A",link:function(c,d,e){function f(){c.detectStyleRecom(),b.query.img_key&&c.cateListStyleRecom()}function g(){c.$parent.SR_IMG="",a(function(){c.alert_2016("추천 상품을 준비중입니다.<br />다른 이미지로 검색해주세요.")},1)}d.bind("load",f),d.bind("error",g)}}}]),d.directive("lotteContainer",["LotteCommon","commInitData","StyleRecom","$timeout","$window","LotteStorage",function(d,e,f,g,h,i){return{templateUrl:"/lotte/resources_dev/search/style_recom_container.html",replace:!0,link:function(j,k,l){function m(){if(e.query.img==c||""==e.query.img)return void j.alert_2016("이미지가 없습니다.");j.SR_IMG=e.query.img;var a=b.element(h);a.on("scroll orientationchange",I),a.on("unload",n)}function n(){var a={scrollY:b.element(h).scrollTop(),page_no:N,prod_list:j.PROD_ORIGIN_LIST,detect_list:j.DETECT_LIST,cate:j.CATE,selected_id:j.selectedID,gender:j.selectedSex,genderCode:P};try{var c=i.getSessionStorage("styleRecomStorage_1","json");c[location.href]=a,i.setSessionStorage("styleRecomStorage_1",c,"json")}catch(d){}}function o(a){a&&a.length>0&&(j.styleCateList=a);var b=0;$("#cateListSlider li").each(function(a,c){b+=$(c).width()+6}),$("#cateListSlider ul").width(b)}function p(a){j.DETECT_LIST=a,a==c||0==a.length?j.alert_2016("추천 상품을 준비중입니다.<br/>다른 이미지로 검색해주세요."):P=a[0].genCd,g(q,1),g(function(){b.element(".style_clip_list li:first-child .style_clip").trigger("click")},50),g(function(){$("#loading").hide()},0)}function q(){g(function(){var a=j.DETECT_LIST;b.element(".style_clip_list li span.style_img img").each(function(c,d){var e=b.element(d),f=a[c],g=f.rx1,h=f.rx2,i=f.ry1,j=f.ry2,k=Math.min(h-g,j-i),l=g+(h-g)/2,m=i+(j-i)/2;e.width(99/k*100);var n=e.width(),o=e.height(),p=Math.round(n/100*(l-k/2)),q=Math.round(o/100*(m-k/2));e.css({position:"absolute",left:-p,top:-q,opacity:1})})},10)}function r(a){$("#loading").hide(),"string"==typeof a&&(a=JSON.parse(a)),a.styleUpImgInfo&&j.goStyleRecom(a.styleUpImgInfo)}function s(){$("#loading").hide(),$("body").fadeIn(),j.alert_2016("파일을 전송하지 못했습니다.<br/>잠시 후 다시 시도해 주세요."),$("input#file_input").prop("disabled",!1)}function t(a){return"image/jpeg"==a||"image/png"==a?!0:!1}function u(a,b){var c=new FileReader;c.onload=function(a){var c=new DataView(a.target.result);if(65496!=c.getUint16(0,!1))return b(-2);for(var d=c.byteLength,e=2;d>e;){var f=c.getUint16(e,!1);if(e+=2,65505==f){if(1165519206!=c.getUint32(e+=2,!1))return b(-1);var g=18761==c.getUint16(e+=6,!1);e+=c.getUint32(e+4,g);var h=c.getUint16(e,g);e+=2;for(var i=0;h>i;i++)if(274==c.getUint16(e+12*i,g))return b(c.getUint16(e+12*i+8,g))}else{if(65280!=(65280&f))break;e+=c.getUint16(e,!1)}}return b(-1)},c.readAsArrayBuffer(a)}function v(a,b){var c=a.parent();if(!c.hasClass("on")){var d=c.siblings();d.find(".dummy").stop(!0),d.find(".style_ani").css("background-position","0 0"),d.removeClass("on");var e={duration:400,progress:x,easing:j.checkJQueryEasing("easeOutQuad")},f=a.find(".dummy"),g=b.score;f.css("left",0);try{f.animate({left:g},e)}catch(h){console.warn("animateStyleClip animate error"),f.css("left",g),x({ani:f})}c.addClass("on")}}function w(a){var c=$(".clipping_beauty .clip_box"),d=c.find("img"),e=d.width(),f=d.height();b.element(".clipping_beauty").css("width",e+"px"),e>f&&b.element(".clipping_beauty").css("padding-top","20px");var g=Math.round(f/100*a.ry1),h=f-Math.round(f/100*a.ry2),i=Math.round(e/100*a.rx1),k=e-Math.round(e/100*a.rx2),l=c.find(".dummy");l.stop(!0);var m={left:i,right:k,top:g,bottom:h},n={duration:250,progress:y,easing:j.checkJQueryEasing("easeOutQuad")};try{l.animate(m,n)}catch(o){console.warn("setClippingArea animate error"),l.css(m),y({elem:l})}}function x(a,b,c){var d=$(a.elem),e=d.parent(),f=Math.round(parseInt(d.css("left"),10)),g=Math.round(f/2)-1;0>g&&(g=0);var h=g%10*110,i=110*(Math.floor(g/10)+1);e.css("background-position",-h+"px "+-i+"px"),e.find(".style_pct em").text(f)}function y(a,b,c){var d=$(a.elem),e=d.parent(),f=parseInt(d.css("left"),10),g=parseInt(d.css("right"),10),h=parseInt(d.css("top"),10),i=parseInt(d.css("bottom"),10);e.find(".clip_top").css({height:h}),e.find(".clip_btm").css({height:i}),e.find(".clip_lft").css({width:f,top:h,bottom:i}),e.find(".clip_rgt").css({width:g,top:h,bottom:i}),e.find(".clip_brd").css({left:f,right:g,top:h,bottom:i})}function z(a){switch(a.category){case 1:case 8:j.selectedSex="F";break;default:""==j.selectedSex&&("M"==P||"F"==P?j.selectedSex=P:"M"==j.loginInfo.genSctCd||"F"==j.loginInfo.genSctCd?j.selectedSex=j.loginInfo.genSctCd:j.selectedSex="A")}C(a.category),B(),D()}function A(){if(0==E().length)for(var a,b=j.CATE.length,c=0;b>c;c++)a=j.CATE[c],a.selected=0==c;B(),D()}function B(){g(function(){b.element(".slider_wrap > div").length>0&&b.element(".slider_wrap > div").scope().reset()},50)}function C(a){for(var b,c=j.CATE.length,d=0;c>d;d++)b=j.CATE[d],b.selected=b.data==a}function D(a){$("#loading").show();var b=E();b&&0!=b.length||(b=j.CATE[0].data,j.CATE[0].selected=!0);var c=f.search(j.selectedID,j.selectedSex,b,a||e.query.cate,F,j.GOODS_NO);c===!1&&($("#loading").hide(),j.alert_2016("2데이터를 불러올 수 없습니다.<br/>잠시 후에 다시 시도해 주세요."))}function E(){var a,b=j.CATE.length;"M"==j.selectedSex&&(b=4);for(var c=[],d=0;b>d;d++)a=j.CATE[d],a.selected&&c.push(a.data);return c}function F(a){j.PROD_ORIGIN_LIST=a,0==a.length&&(j.PROD_LIST.length=0),M=Math.ceil(a.length/L),N=0,G(),g(function(){$("#loading").hide()},0)}function G(){O||N>=M||(O=!0,g(H,100))}function H(){N++;var a=N*L;j.PROD_LIST=j.PROD_ORIGIN_LIST.slice(0,a),O=!1}function I(a){K();var b=R.scrollTop(),c=R.outerHeight(),d=V.outerHeight();0==S.length?0:S.offset().top,T.height();j.PROD_LIST.length>0&&b+3*c>=d&&G()}function J(b){if(b.offsetX!=c&&b.pageX!=c){K();var d=R.scrollTop();47>d&&$(a).scrollTop(47)}}function K(){(R==c||T==c||U==c||V==c)&&(R=b.element(h),T=b.element("#head_sub"),U=b.element(".clipping_beauty"),V=b.element("#wrapper")),(S==c||0==S.length)&&(S=b.element("#style_category"))}var L=j.appObj.isTablet?100:30,M=0,N=0,O=!1,P="";j.cateListStyleRecom=function(){f.cateList(o)},j.detectStyleRecom=function(){if($("#loading").show(),null==history.state||"stylerecom"!=history.state.name){history.replaceState({name:"stylerecom"},"stylerecom");var d=f.detect(j.SR_IMG,p,j.GOODS_NO);d===!1&&($("#loading").hide(),j.alert_2016("데이터를 불러올 수 없습니다.<br/>잠시 후에 다시 시도해 주세요."))}else{var e=i.getSessionStorage("styleRecomStorage_1","json"),k=c;if(e&&e[location.href]&&(k=e[location.href]),"localhost:8082"==location.host&&(k=null),k==c||k.detect_list==c||k.selected_id==c||k.gender==c||k.cate==c||k.prod_list==c||0==k.detect_list.length||0==k.prod_list.length)f.detect(j.SR_IMG,p,j.GOODS_NO);else{j.DETECT_LIST=k.detect_list,g(q,1),j.CATE=k.cate,j.selectedSex=k.gender,j.selectedID=k.selected_id,P=k.genderCode;for(var l,m=j.DETECT_LIST.length,n=-1,o=0;m>o;o++)if(l=j.DETECT_LIST[o],l.id==j.selectedID){n=o;break}n>=0&&l!=c&&g(function(){v(b.element(".style_clip_list li").eq(n).find(".style_clip"),l),w(l)},100),j.PROD_ORIGIN_LIST=k.prod_list,M=Math.ceil(j.PROD_ORIGIN_LIST.length/L),k.page_no!=c?(N=k.page_no-1,0>N&&(N=0)):N=0,G(),g(function(){var c=b.element(h).scrollTop();k.scrollY!=c&&$(a).scrollTop(k.scrollY)},200);try{var r=i.getSessionStorage("styleRecomStorage_1","json");r[location.href]="",i.setSessionStorage("styleRecomStorage_1",r,"json")}catch(s){}$("#loading").hide()}}};var Q="http://www.lotte.com/display/insertStyleRecoUploadImage.lotte";j.detectFile=function(){$("#loading").show(),$("body").fadeIn();var a=document.querySelector("#file_input"),b=a.files[0].type,c=8,d=a.files[0].size,e=1e3*c*1e3;return t(b)?d>e?(alert("사진 용량이 "+c+"MB 초과하였습니다."),$("#loading").hide(),void $("body").fadeIn()):void u(a.files[0],j.cbFileExif):(alert("지원하지 않는 확장자입니다."),$("#loading").hide(),void $("body").fadeIn())},j.uploadFile=function(a){$("input#file_input").prop("disabled",!0);var b=new FormData;b.append("file",document.getElementById("file_input").files[0]),b.append("rote_code",a),$.ajax({type:"post",data:b,async:!1,cache:!1,url:Q,success:r,error:s,contentType:!1,processData:!1})},j.cbFileExif=function(a){j.uploadFile(a)},j.selectStyleClip=function(a,b,c){j.selectedID=b.id,v($(a.currentTarget),b),w(b),z(b),J(a),j.sendTclick("m_DC_StyleReco_Swp_Rel_A"+(c+1))},j.selectGender=function(a,b,c){j.selectedSex!=a.data&&(j.selectedSex=a.data,g(A,1),J(c),j.sendTclick("m_DC_StyleReco_Clk_tap_"+(b+1)))},j.selectCategory=function(a,b){var c=E();if(c.join("")!=a.data){C(a.data),D(),J(b);var d=a.tclick,e="A";"M"==j.selectedSex?(e="B",6==d&&(d=4)):"A"==j.selectedSex&&(e="C"),j.sendTclick("m_DC_StyleReco_Swp_Cate_"+e+d)}},j.selectCateGrp=function(b,c){var f="m_DC_"+j.screenID+"_clk_cate_"+b.cate;a.location.href=d.styleRecomUrl+"?img="+e.query.img+"&"+j.getBaseParam(!0)+"&cate="+b.cate+"&tclick="+f},j.gotoProductDetail=function(a,b){a.curDispNoSctCd=14;var c=b+1;j.productView(a,null,null,"m_DC_StyleReco_Clk_Prd_idx"+(10>c?"0"+c:c))},j.getProductUrl=function(a,b){a.curDispNoSctCd=14;var c=b+1;return j.getProductViewUrl(a,"m_DC_StyleReco_Clk_Prd_idx"+(10>c?"0"+c:c),!0)};var R,S,T,U,V;m(),j.styRecomBnrUrl=function(){a.location.href=d.prdlstUrl+"?curDispNo=5407118&"+j.baseParam+"&tclick=m_DC_StyleReco_Clk_event"}}}}])}(window,window.angular);