!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","lotteUtil","lotteSlider"]);d.controller("OftenBuyCtrl",["$scope","LotteCommon","$http","LotteCookie","$filter","LotteUtil","LotteStorage","$timeout","$window","commInitData",function(a,b,c,d,e,f,g,h,i,j){a.showWrap=!0,a.contVisible=!0,a.subTitle="자주 구매",a.initLoadingProductList=!1,a.oftenBuyProductList=[],a.oftenItemTotalCount=0,a.testMode=!1,a.isOpenedSoldoutSection=!1,a.oftenSoldoutProductList=[],a.soldOutProductTotalCount=0,a.noListView=!1,a.pageLoad=!0,a.getTclickCode=function(b,c,d,e,f,g){var h="favorites",i=d?"_M2030":"",j=a.tClickBase+h+i+"_Clk";return j+=b?"_Prd":"",j+=c?"_Btn":"",j+=e?"_page"+e:"",j+=g&&f?"_idx"+g:"",j+=g&&d?g:""},a.makeProductListUrl=function(c){var d=[],e={};switch(c){case"prdList":e.testJson="/json/product_new/often_product_info.json";var d=[];d.push("viewGoods="+localStorage.getItem("latelyGoods")),d.push("amlist="+localStorage.getItem("amlist")),e.URL=b.oftenBuyList+"?"+a.baseParam+"&"+d.join("&");break;case"optBasic":e.testJson="/json/product_new/often_product_optionList.json",e.URL=b.oftenBuyOption+"?"+a.baseParam}var f=a.testMode?e.testJson:e.URL;return f},a.goProductDetail=function(b,c){if("30"==b.saleStatCd)return void alert("상품 판매가 종료되었습니다.");if("Y"==b.minority_limit_yn)return a.isAdultUser()?void a.goAdultSci():void alert("이 상품은 법률규정에 의하여 만 19세 이상 성인만 조회 및 구매가 가능합니다.");var d=[];b.infwDispNoSctCd&&d.push("curDispNoSctCd="+b.infwDispNoSctCd),b.goodsNo&&d.push("goods_no="+b.goodsNo),b.itemNo&&d.push("item_no="+b.itemNo);var e=c?c:"";location.href="/product/m/product_view.do?"+a.baseParam+"&"+d.join("&")+"&tclick="+e},a.goSoldOutDetail=function(b){if("30"==b.saleStatCd)return void alert("상품 판매가 종료되었습니다.");if("Y"==b.minority_limit_yn)return a.isAdultUser()?void a.goAdultSci():void alert("이 상품은 법률규정에 의하여 만 19세 이상 성인만 조회 및 구매가 가능합니다.");var c=[];b.infwDispNoSctCd&&c.push("curDispNoSctCd="+b.infwDispNoSctCd),b.goodsNo&&c.push("goods_no="+b.goodsNo),b.itemNo&&c.push("item_no="+b.itemNo),location.href="/product/m/product_view.do?"+a.baseParam+"&"+c.join("&")+"&tclick=m_DC_favorites_Clk_Btn_4"},a.getFormattedGoodsNm=function(a){var b=a.brand?"["+a.brand+"] "+a.goodsNm:a.goodsNm;return b},a.getOftenBuyProductList=function(){c.get(a.makeProductListUrl("prdList")).success(function(b){b.often_buy_count>0?(a.oftenBuyProductList=b.normal_result,a.oftenItemTotalCount=b.often_buy_count):a.noListView=!0,a.oftenSoldoutProductList=b.soldout_result,a.soldOutProductTotalCount=b.soldout_count,a.pageLoad=!1}).error(function(b){a.pageLoad=!1,a.noListView=!0,console.log("상품 리스트 조회 실패")})},a.getOftenBuyProductList()}]),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/mylotte/often_buy/often_buy_container.html",replace:!0,link:function(a,b,c){}}}),d.directive("oftenBuyList",["$http","LotteCommon","LotteCookie",function(c,d,e){return{templateUrl:"/lotte/resources_dev/mylotte/often_buy/often_list_container.html",replace:!0,link:function(f,g,h){f.currentCnt=10,f.datePickerYn=!1,f.datePickerInputOption={};var i=";;;;;";f.getOftenItemOpt=function(a){var b=!a.openOption;a.openStatus?a.openOption=b:f.getBasicOpt(a),a.openStatus=!0,console.log(f.getTclickCode(null,!0,null,null,null)+"_1")},f.getBasicOpt=function(a){c.get(f.makeProductListUrl("optBasic"),{params:{goods_no:a.goodsNo,item_no:a.itemNo,qs_yn:a.quick_deli_yn}}).success(function(b){if(b.productItemDtl&&(a.itemSelectOpt=b.productItemDtl.items,a.itemSelectOpt.length>=2)){var c=a.itemSelectOpt.length-1,d=a.itemSelectOpt[c];d.last_item_no=a.itemNo,f.lastOptionListInit(a,a.itemSelectOpt,c)}b.productItemOpt&&(a.itemInputOpt=b.productItemOpt.items)}).error(function(a){if(a.error){var b=a.error.response_code,c=a.error.response_msg;if(alert(c),"9003"==b){var e="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href=d.loginForm+"?"+e}}else alert("처리중 오류가 발생하였습니다.")})["finally"](function(){a.openOption=!0})},f.changeSelectOpt=function(a,c,d){var e=c,g=c[d],h=d+1;if(e.changedSelectOptionItemNo="",e.inv_qty="",b.forEach(e,function(a,b){b>d&&(a.selected_item_no="")}),h==e.length){var i=g.selected_item_no;e.changedSelectOptionItemNo=i,b.forEach(g.item.items,function(a,b){i==a.item_no&&(e.inv_qty=a.opt_cnt)}),Number(e.qty)>Number(e.inv_qty)&&(e.qty=Number(e.inv_qty))}else h==e.length-1&&f.lastOptionListInit(a,c,h)},f.lastOptionListInit=function(a,e,g){var h=e,i=h[h.length-1],j=[];g||(i.selected_item_no="",g=g||h.length-1),b.forEach(h,function(a,b){var c=a.selected_item_no;c&&j.push(c)}),c({method:"POST",url:d.cartLastOptionData+"?"+f.baseParam,data:{goods_no:a.goodsNo,opt_val_cd:j.join(" x "),optcnt:h.length,optnum:g,qs_yn:a.quick_deli_yn},transformRequest:transformJsonToParam,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){i.item.items=a.item}).error(function(a){if(a.error){var b=a.error.response_code,c=a.error.response_msg;if(alert(c),"9003"==b){var e="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href=d.loginForm+"?"+e}}else alert("처리중 오류가 발생하였습니다.")})["finally"](function(){i.selected_item_no=i.last_item_no,i.last_item_no=""})},f.buyOptionUpdate=function(a,b,c){var d=-1,e=[];if(b){var g=b.changedSelectOptionItemNo?b.changedSelectOptionItemNo:a.itemNo;if(!f.validUserOrderQuantity(a.qty_user,a))return!1;var h=b.length-1;for(var j in b){var k=b[j];if("object"==typeof k){if(!k.selected_item_no)return void alert(k.name+" 옵션을 선택해주세요.");k.item_no==g&&(d=k.opt_cnt),j==h&&(a.ori_itemNo=a.itemNo,a.itemNo=k.selected_item_no)}}}if(c)for(var j in c){var k=c[j],l=[];if(!k.item_opt_value)return void alert(k.item_opt_name+" 옵션을 입력해주세요.");l.push(k.item_opt_type),l.push(k.item_opt_name),l.push(k.item_opt_value),e.push(l.join(":"))}return 0==d?void alert("선택하신 제품은 품절되었습니다."):(a.goodsChocDesc=e.join(i),f.modifyGoodsOptionsDescription(a,b,c),void(a.openOption=!1))},f.orderBuy=function(b){if(f.isValidOrderInfo(b).result)if(f.loginInfo.isLogin){if("Y"==b.minority_limit_yn&&f.checkMinorityLimit(!0),b.goodsChocDesc)var c=b.goodsChocDesc;var e=[];e.push("goodsno="+b.goodsNo),e.push("itemno="+b.itemNo),e.push("qty="+b.qty),c&&e.push("goodsChocDesc="+c),e.push("goodsCmpsCd="+b.goods_cmps_cd),e.push("infwDispNoSctCd="+b.infwDispNoSctCd),e.push("mastDispNo="+b.dispNo),e.push("imallYN="+b.imall_yn),location.href=d.orderFormUrl+"?"+f.baseParam+"&"+e.join("&")+"&tclick="+f.getTclickCode(null,!0,null,null,null)+"_3"}else location.href=d.loginForm+"?"+f.baseParam+"&targetUrl="+encodeURIComponent(a.location.href,"UTF-8")},f.orderCart=function(a){c({method:"POST",url:d.cartAddFromWishData+"?"+f.baseParam+"&tcilck="+f.getTclickCode(null,!0,null,null,null)+"_2",data:{goods_no:a.goodsNo,item_no:a.itemNo,goods_choc_desc:a.goodsChocDesc,goods_cmps_cd:a.goods_cmps_cd,ord_qty:a.qty,infw_disp_no_sct_cd:a.infwDispNoSctCd,cart_sct_cd:10},transformRequest:transformJsonToParam,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){var c=a.result;c?f.openCireleSystemAlert({type:"cartPop"}):ajaxResponseFailHandler(function(){errorCallback&&errorCallback(index)}),console.log(f.getTclickCode(null,!0,null,null,null)+"_2");try{b.element($window).trigger("refreshCartCount")}catch(d){}}).error(function(b){ajaxResponseErrorHandler(b,a)})},f.isValidOrderInfo=function(a){var b={result:!0,is_show_confirm:!0},c={result:!1,is_show_confirm:!0},d=!1,e=!1,g=!1,h=0;if("Y"==a.smp_only_yn?((105095077==a.goodsNo||105095654==a.goodsNo||105095772==a.goodsNo||105095898==a.goodsNo)&&(d=!0),a.gift_card&&"Y"==a.gift_card&&(e=!0),a.is_interpark_ticket&&(g=!0)):a.gift_card&&"Y"==a.gift_card&&(e=!0,h=1),"Y"==a.lgf_tgt_yn){var i=f.requestCheckLgFashionStockMng(a);if(!i.isOk)return alert(i.message),c}if("Y"==a.smp_only_yn){if(g)return alert("죄송합니다.\n인터파크 티켓 상품은 모바일에서 주문하실 수 없습니다."),c;if(a.qty_user>50)return alert("스마트픽은 주문시 수량 합계 50개까지 주문가능합니다. 확인후 다시 시도해주세요."),c}if(a.brand.indexOf("망고")>-1){var j=a.basic_price*parseInt(a.qty_user);if(a.qty_user>30||j>15e5)return alert("망고 상품의 경우 구매수량이 30개 이상 혹은 판매금액이 150만원 이상인 경우 구매가 제한되오니 구매를 원하시면 나눠서 구매해주세요!"),c}return b},f.checkMinorityLimit=function(a){return a?f.isAdultUser()?void f.goAdultSci("N"):void alert("이 상품은 법률규정에 의하여 만 19세 이상 성인만 조회 및 구매가 가능합니다."):void 0},f.isAdultUser=function(){return"Y"==e.getCookie("ADULTYN")},f.requestCheckLgFashionStockMng=function(a){var b={isOk:!1,message:""};return $.ajax({type:"post",async:!1,url:"/popup/lg_fashion_stock_mng.do?"+f.baseParam,data:"goods_no="+a.goodsNo+"&item_no="+a.itemNo+"&entr_no="+a.entr_no+"&ord_qty="+a.qty,success:function(a){b.message=a,b.isOk=""==a?!0:!1}}),b},f.isSoldOption=function(a,b){var c=0;return""!=a.opt_stk_yn&&(a.opt_cnt&&0==Number(a.opt_cnt)||"Y"==a.opt_stk_yn?c=1:"Y"==b&&0==a.cart_dept_main_inv_qty&&(c=2)),c},f.modifyGoodsOptionsDescription=function(a,c,d){var e=[],f=[];b.forEach(c,function(a,c){b.forEach(a.item.items,function(b,c){a.selected_item_no==b.item_no&&e.push(a.name+" : "+b.opt_value)})}),a.goodsOption=e.join(", "),b.forEach(d,function(a,b){f.push(a.item_opt_name+" : "+a.item_opt_value)}),a.goodsInputOption=f.join("<br/>"),a.qty=a.qty_user},f.getSoldOptionText=function(a,b){var c=f.isSoldOption(a,b);return c=1==c?"(품절)":2==c?"(퀵불가)":""},f.datePickerOpen=function(a){f.datePickerYn=!0,f.datePickerInputOption=a},f.datePickerClose=function(a){f.datePickerYn=!1},f.minusQuantity=function(a){f.validUserOrderQuantity(a.qty_user-1,a)&&a.qty_user>1&&(a.qty_user-=1)},f.plusQuantity=function(a){f.validUserOrderQuantity(a.qty_user+1,a)&&(a.qty_user+=1)},f.validUserOrderQuantity=function(a,b){var c=b.inv_qty?Number(b.inv_qty):0,d=b.min_lmt_qty?Number(b.min_lmt_qty):0,e=b.max_lmt_qty?Number(b.max_lmt_qty):0,f="Y"==b.quick_deli_yn?!0:!1;return c=f?b.dept_main_inv_qty:c,c>0&&a>c?(b.qty_user=c,f?alert("퀵배송 가능한 최대 구매 수량은 "+c+"개입니다"):alert("재고가 부족합니다."),!1):e>0&&a>e?(b.qty_user=e,alert("1일 최대 "+e+"개 구매 가능한 상품입니다."),!1):d>0&&d>a?(b.qty_user=d,alert("최소 "+d+"개 구매 가능한 상품입니다."),!1):!0},f.moreShowOftenItem=function(){f.currentCnt=f.oftenItemTotalCount,console.log(f.getTclickCode(null,!0,null,"02",null))}}}}]),d.directive("soldOutList",["$http","LotteCommon",function(a,b){return{templateUrl:"/lotte/resources_dev/mylotte/often_buy/soldOut_list_container.html",replace:!0,link:function(c,d,e){c.soldOutshow=!1,c.showSoldOutList=function(){c.soldOutProductTotalCount<=0||(c.soldOutshow=c.soldOutshow?!1:!0,console.log(c.getTclickCode(null,!0,null,null,null)+"_4"))},c.registRestockAlram=function(d){a({method:"POST",url:b.systemRestockAlramData+"?"+c.baseParam+"&tclick="+c.getTclickCode(!0,!0,null,8,null),data:{mbr_no:c.loginInfo.mbrNo,spdp_goods_no:"",goods_no:d.goodsNo,item_no:d.itemNo,channel:"2"},transformRequest:transformJsonToParam,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){var b=a.RESPONSE_CODE,d=a.RESPONSE_MSG,e=a.APP_PUSH_YN,f=a.PHONE;"0000"==b?c.openCireleSystemAlert({type:"alarmPop",app_push_yn:e,phone:f}):alert(d)}).error(function(a){alert("처리중 오류가 발생하였습니다.")})}}}}]),d.directive("recommProduct",["$http","$timeout","$window","$location","LotteCommon","LotteCookie","LotteStorage","LotteUtil",function(a,b,d,e,f,g,h,i){return{templateUrl:"/lotte/resources_dev/mylotte/often_buy/recomm_product.html",replace:!0,link:function(b,d,e){b.rScope=i.getAbsScope(b),b.loginInfo=b.rScope.loginInfo,b.prdData={},b.loadRecommData=function(){if(f.isTestFlag){b.loginInfo.isLogin=f.isTestFlag?!0:b.loginInfo.isLogin,b.loginInfo.name=f.isTestFlag?"이가현":b.loginInfo.name;var d="/json/main/main_m2030.json",e={method:"GET",url:d};a(e).success(function(a){return a?void(b.prdData=a.data):void 0})}else{var g=h.getLocalStorage("latelyGoods");if(null==g||g==c)return;g=g.replace(/\|/gi,",");var i=g.split(",");i.reverse(),g=i.slice(0,6).toString();var d=f.salebestlist_url+"&iids="+g;$.ajax({type:"post",async:!0,url:d,dataType:"jsonp",jsonp:"callback",success:function(c){var d=[];if(null!=c.results&&($(c.results).each(function(a,b){d.push(b.itemId)}),d.length>0)){var e=f.isTestFlag?"/json/main/main_m2030.json":"/json/main_new/latest_product.json?dispNo=5570109&type=R&latest_prod="+d.join(","),g={method:"GET",url:e};a(g).success(function(a){b.prdData=a.data})}},error:function(a,b,c){console.log("Data Error : 실시간 맞춤 추천 Data로드 실패")}})}},b.loadRecommData()}}}]),d.directive("datePicker",["$timeout","$window",function(a,b){return{replace:!0,link:function(a,b,c){a.getFirstDay=function(a,b){return new Date(a,b,1).getDay()},a.getLastDay=function(a,b){return new Date(a,b+1,0).getDate()},a.addZero=function(a){return 10>a?"0"+a:a},a.date=new Date,a.now=new Date,a.cdate=new Date,a.today=a.now.getDate(),a.month=a.now.getMonth(),a.firstDay=a.getFirstDay(a.date.getFullYear(),a.date.getMonth()),a.lastDay=a.getLastDay(a.date.getFullYear(),a.date.getMonth()),a.dateHead=["SUN","MON","TUE","WED","THU","FRI","SAT"],a.datePrev=function(b){a.date.setMonth(a.date.getMonth()-1),a.firstDay=a.getFirstDay(a.date.getFullYear(),a.date.getMonth()),a.lastDay=a.getLastDay(a.date.getFullYear(),a.date.getMonth()),a.makeDays()},a.dateNext=function(b){a.date.setMonth(a.date.getMonth()+1),a.firstDay=a.getFirstDay(a.date.getFullYear(),a.date.getMonth()),a.lastDay=a.getLastDay(a.date.getFullYear(),a.date.getMonth()),a.makeDays()},a.makeDays=function(){a.day=[];for(var b=0;b<a.firstDay;b++)a.day.push(0-b);for(var b=0;b<a.lastDay;b++)a.day.push(b+1)},a.isActiveDate=function(b){var c=!1,d=new Date(a.date.getFullYear()+"-"+a.addZero(a.date.getMonth()+1)+"-"+a.addZero(b)),e=new Date(a.datePickerInputOption.item_opt_formatted_value);return e&&(c=d.getFullYear()==e.getFullYear()&&d.getMonth()==e.getMonth()&&d.getDate()==e.getDate()),c},a.isPastDate=function(b){var c=new Date(a.date.getFullYear()+"-"+a.addZero(a.date.getMonth()+1)+"-"+a.addZero(b)),d=864e5;return Math.round(c.getTime()/d)<Math.round(a.now.getTime()/d)},a.pick=function(b){if(!a.isPastDate(b)){a.cdate.setDate(b);var c=a.date.getFullYear()+"-"+a.addZero(a.date.getMonth()+1)+"-"+a.addZero(b);a.datePickerInputOption.item_opt_value=c.split("-").join(""),a.datePickerInputOption.item_opt_formatted_value=c,a.datePickerClose()}},a.makeDays()}}}])}(window,window.angular);var transformJsonToParam=function(a){var b=[];for(var c in a)if(Array.isArray(a[c]))for(var d=0;d<a[c].length;d++)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c][d]));else b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},ajaxResponseFailHandler=function(a){alert("처리중 오류가 발생하였습니다."),a&&a()},ajaxCount=0,ajaxResponseErrorHandler=function(a,b){if(a.error){var c=a.error.response_code,d=a.error.response_msg;if("5000"==c){var e="";return b.brand&&(e+="["+b.brand+"]"),e+=d,void alert(e)}if("9003"==c){0==ajaxCount&&(alert(d),++ajaxCount);var f="&targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href="/login/m/loginForm.do?"+f}}else alert("처리중 오류가 발생하였습니다.")};!function(a,b,c){"use strict";var d=b.module("lotteSlider",[]);d.controller("LotteSlideCtrl",["$scope",function(b){b.getTranslateXCssObj=function(a,b){var c={"-webkit-backface-visibility":"hidden","-moz-backface-visibility":"hidden","backface-visibility":"hidden","-webkit-transform":"translateX("+a+"px)","-ms-transform":"translateX("+a+"px)","-moz-transform":"translateX("+a+"px)",transform:"translateX("+a+"px)","-webkit-transition":"","-moz-transition":"","-o-transition":"",transition:""};return b&&b>0&&(c["-webkit-transition"]="-webkit-transform "+b+"ms",c["-moz-transition"]="-moz-transform "+b+"ms",c["-o-transition"]="-o-transform "+b+"ms",c.transition="transform "+b+"ms"),c},b.removeTranslateCSS=function(){return{"-webkit-backface-visibility":"","-moz-backface-visibility":"","backface-visibility":"","-webkit-transform":"","-ms-transform":"","-moz-transform":"",transform:""}},b.getCoordinates=function(a){var b=a.touches&&a.touches.length?a.touches:[a],c=a.changedTouches&&a.changedTouches[0]||a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]||b[0].originalEvent||b[0];return{x:c.clientX,y:c.clientY}},b.getTransXPos=function(b){var c=a.getComputedStyle(b.get(0)),d=new WebKitCSSMatrix(c.webkitTransform);return d.m41}}]),d.directive("lotteSlider",["$window","$timeout","$parse",function(a,c,d){return{controller:"LotteSlideCtrl",link:function(d,e,f,g){function h(){m=k.outerWidth(),l.css({display:"inline-block"}),n=l.outerWidth(),x=-(n-m);var a=d.getTransXPos;(a.x>0||a.x<x)&&i(0,500)}function i(a,b){l.css(d.getTranslateXCssObj(a,b)),k.trigger({type:"slide",posX:a,wrapWidth:m,contWidth:n})}function j(){k.on({"touchstart.lotteSlider":function(a){m=k.outerWidth(),n=l.outerWidth(),y=!1,z=!1,n>m&&(a.stopPropagation(),o=!0,q=d.getCoordinates(a),p=d.getTransXPos(l),t=Date.now())},"touchmove.lotteSlider":function(a){if(o){var b,c;if(r=d.getCoordinates(a),b=Math.abs(r.x-q.x),c=Math.abs(r.y-q.y),y||(z=b>c,y=!0),z){b>5&&a.preventDefault(),a.stopPropagation();var e=p+r.x-q.x;e>0?e/=3:x>e&&(e=x+(e-x)/3),i(e,0)}}},"touchend.lotteSlider":function(a){if(s=d.getCoordinates(a),o&&q.x!=s.x&&(Math.abs(q.x-s.x)>5&&a.preventDefault(),event.stopPropagation(),y=!1,z)){m=k.outerWidth();var b=d.getTransXPos(l);u=Date.now(),w=q.x>s.x?-1:1,v=u-t;var c=Math.abs(q.x-s.x),e=.4,f=c*e/v,g=b+m*f*w;g>0?g=0:x>g&&(g=x),(Math.abs(b-g)>30||0==g||g==x)&&i(g,500)}},"touchcancel.lotteSlider":function(a){}}),b.element(a).on("resize.lotteSlider orientationchange.lotteSlider",function(){h()})}var k=b.element(e),l=k.find(">").eq(0),m=k.width(),n=l.width(),o=!1,p=0,q=null,r=null,s=null,t=0,u=0,v=0,w=0,x=0;d.lotteSliderMoveXPos=function(a,b){m=k.width(),n=l.width(),a>0?a=0:Math.abs(a)>n-m&&(a=-(n-m)),b||(b=0),i(a,b)},d.reset=function(){o=!1,i(0,0),c(function(){h()})};var y=!1,z=!1;c(function(){h(),j()})}}}])}(window,window.angular);