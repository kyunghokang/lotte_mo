function calcBytes(a){var b=0;for(i=0;i<a.length;i++){var c=a.charAt(i);escape(c).length>4?b+=2:"\n"==c?"\r"!=a.charAt(i-1)&&(b+=1):b+="<"==c||">"==c?4:1}return b}function maxLengthCheck(a,b,c,d){var e,f,g=c.value.length,h=parseInt(a),i="",j=0;if(0==g)null!=document.getElementById("spn_input_char")&&(document.getElementById("spn_input_char").innerText=h);else for(k=0;k<g;k++){if(e=c.value.charAt(k),"\n"==e&&j++,escape(e).length>4?h-=2:h--,0>h){alert("총 한글 "+a/2+"자 영문 "+a+"자 까지 쓰실 수 있습니다."),c.value=i;break}if(null!=b&j>parseInt(b)){alert("라인수 "+b+"라인을 넘을 수 없습니다."),j=0,f=i.length-1,c.value=i.substring(0,f);break}null!=document.getElementById("spn_input_char")&&(document.getElementById("spn_input_char").innerText=h),i+=e}}!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","lotteSns"]);d.controller("KidscommentWriteCtrl",["$scope","$timeout","LotteCommon","$http","$filter","$window","LotteUtil","LotteForm",function(a,c,d,e,f,g,h,i){a.showWrap=!0,a.contVisible=!0,a.subTitle="상품평 쓰기",a.input={},a.input.reviewTxt="",a.input.prc_stfd_val=5,a.input.qual_stfd_val=5,a.input.dsgn_stfd_val=5,a.input.dlv_stfd_val=5,a.input.size=1,a.input.color=1,a.input.evt_no=h.getParameter("evt_no"),a.input.evt_flag=h.getParameter("evt_flag"),a.isNewestApp=isNewestApp(),a.isKids=!1,a.isKidsApp=!1,a.isKidsParam=h.getParameter("isKids"),a.isKidsAppParam=h.getParameter("isKidsApp"),"Y"==h.getParameter("isKids")&&(a.isKids=!0,a.subTitle="체험단 후기 작성"),"Y"==h.getParameter("isKidsApp")&&(a.isKidsApp=!0),b.element(document).ready(function(){c(function(){if(a.appObj.isApp)if(a.appObj.isAndroid)try{g.lottepetswag.callAndroid("swag://no_position")}catch(b){}else location.href="swag://no_position"},200)}),a.commentWrite={};try{e.get(d.commentWriteData+"?"+a.baseParam+"&evt_no="+h.getParameter("evt_no")+"&goods_no="+h.getParameter("goods_no")).success(function(b){a.commentWrite=b.comment_write,a.input.frst_gdas_yn="N",a.input.wrtr_pur_yn="T",a.input.goods_no=a.commentWrite.goods_no,a.input.usm_goods_no=a.commentWrite.usm_goods_no}).error(function(a){ajaxResponseErrorHandler(a)})}catch(j){console.error(j)}a.attachImage=function(){a.appObj.isApp?location.href="ghost://CommentWithPhoto":confirm("롯데닷컴 앱에서 이용 가능합니다. 지금 설치하시겠습니까?")&&(location.href=d.appDown+"?"+a.baseParam)},a.cancel=function(){"Y"==h.getParameter("isKids")?confirm("체험단 후기 작성을 취소하시겠습니까?")&&location.replace(d.kidsExperienceMainUrl+"?"+a.baseParam):confirm("상품평 작성을 취소하시겠습니까?")&&location.replace(d.mylotteCritViewUrl+"?"+a.baseParam)},a.save=function(){var b=a.input.reviewTxt,e=document.querySelector("#reviewTxt");if(0==b.trim().length)return alert("상품평을 작성해 주세요."),e.focus(),!1;if(calcBytes(b)<6)return alert("상품평을 한글 3자 이상 입력하세요."),e.focus(),!1;if(calcBytes(b)>4e3)return alert("상품평은 2000자[한글기준] 이내로 제한되어 있습니다."),e.focus(),!1;if(a.snsFlag&&(Kakao.cleanup(),1==a.appObj.isSktApp?Kakao.init("7a460fb5cdebe4589041db57d906ddda"):Kakao.init("574659987ca46095c123d71f72abac14"),a.prdComment="[상품평] "+a.input.reviewTxt,a.share_img=a.commentWrite.goods_img_url,a.share_url="/product/product_view.do?goods_no="+a.commentWrite.goods_no,1==a.appObj.isSktApp?a.noCdnUrl=location.protocol+"//"+location.hostname+a.share_url+"&cn=171127":a.noCdnUrl=location.protocol+"//"+location.hostname+a.share_url+"&cn=123624",1==a.appObj.isSktApp?(a.talkCdn="3093671",a.twitCdn="3093668",a.stotyCdn="3093670",a.smsCdn="3093672",a.mailCdn="3158697",a.faceCdn="3093669",a.urlCdn="3158696",a.appCdn="3158696"):(a.talkCdn="2929723",a.twitCdn="2929720",a.stotyCdn="2929722",a.smsCdn="2929725",a.mailCdn="2929724",a.faceCdn="2929721",a.urlCdn="2929719",a.appCdn="2929719")),a.appObj.isApp&&"Y"==h.getParameter("isKidsApp")){if(a.snsFlag){"sms"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_4"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.smsCdn),"kakaotalk"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_1"),a.appObj.isOldApp?a.kakaoType="[롯데닷컴 이거어때?]\n":a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.talkCdn),"kakaostory"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_3"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.stotyCdn),"facebook"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_6"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.faceCdn),"twitter"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_2"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.twitCdn),"url_copy"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_7"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.urlCdn),"moreapp"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_8"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.appCdn),"mail"==a.snsFlag&&(a.sendTclick(a.tClickBase+"share_Clk_Pop_5"),a.kakaoType="",a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.mailCdn),a.share_img&&""!=a.share_img?a.share_img=a.share_img:a.share_img="http://image.lotte.com/lotte/mobile/common/share_img2016_v2.png";var f={url:a.cnShareUrl,title:a.kakaoType+a.prdComment.replace(/#/gi,""),imageUrl:a.share_img};a.appObj.isAndroid?g.lotteshare.callAndroid("lotteshare://"+a.snsFlag+"/query?"+JSON.stringify(f)):a.appObj.isIOS&&(g.location="lotteshare://"+a.snsFlag+"/query?"+JSON.stringify(f))}var j="ghost://SubmitPhotoComment/write";return j+="?frst_gdas_yn="+a.input.frst_gdas_yn,j+="&wrtr_pur_yn="+a.input.wrtr_pur_yn,j+="&goods_no="+a.input.goods_no,j+="&usm_goods_no="+a.input.usm_goods_no,j+="&evt_no="+a.input.evt_no,j+="&evt_flag="+a.input.evt_flag,j+="&reviewTxt="+a.input.reviewTxt,j+="&prc_stfd_val="+a.input.prc_stfd_val,j+="&qual_stfd_val="+a.input.qual_stfd_val,j+="&dsgn_stfd_val="+a.input.dsgn_stfd_val,j+="&dlv_stfd_val="+a.input.dlv_stfd_val,j+="&size="+a.input.size,j+="&color="+a.input.color,j+="&loginId="+a.commentWrite.login_id,j+="&mbrNo="+a.commentWrite.mbr_no,j+="&mbrNm="+a.commentWrite.mbr_nm,j+="&mbrEmail="+a.commentWrite.mbr_email,j+="&site_no="+a.commentWrite.site_no,a.isNewestApp||(j+="&radio1=",j+="&radio2="+a.input.color,j+="&radio2=",j+="&radio2="+a.input.color,j+="&radio3=",j+="&radio4=",j+="&radio5=",j+="&radio6=",j+="&check_cont=",j+="&img_no=",j+="&img_file_1=",j+="&img_file_2=",j+="&img_file_3=",j+="&img_file_4=",j+="&img_path_1=",j+="&img_path_2=",j+="&img_path_3=",j+="&img_path_4=",j+="&prdt_clor_eval_desc=",j+="&prdt_size_eval_desc=",j+="&use_flag=",j+="&wrtr_pur_dt=",j+="&div_stfd_val="+a.input.dlv_stfd_val),console.log(j),void c(function(){location.href=j},200)}var j=d.commentWriteSaveData+"?"+a.baseParam;i.FormSubmitForAjax(j,a.input).success(function(b){console.log(b),a.snsFlag&&("sms"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.smsCdn,a.showSmsBox()):"kakaotalk"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.talkCdn,a.sendKakaoTalk()):"kakaostory"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.stotyCdn,a.sendKakaoStory()):"facebook"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.faceCdn,a.sendFacebook()):"twitter"==a.snsFlag?(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.twitCdn,a.sendTwitter()):"url_copy"==a.snsFlag&&(a.cnShareUrl="",a.cnShareUrl=a.noCdnUrl+"&cdn="+a.urlCdn,a.urlCopyClick())),"3101"==b.comment_write_save.response_code?alert("이미 체험단 후기 등록을 하셨습니다"):"3102"==b.comment_write_save.response_code?alert("후기 작성에 실패했습니다."):"3100"==b.comment_write_save.response_code?alert("후기 작성에 실패했습니다."):"3103"==b.comment_write_save.response_code?alert("내용에 [금지어] 해당 글자는 등록하실 수 없습니다. 삭제 후 다시 등록해 주시기 바랍니다."):c(function(){alert("후기 작성이 완료되셨습니다"),location.replace(d.kidsExperienceMainUrl+"?"+a.baseParam)},200)}).error(function(a){ajaxResponseErrorHandler(a)})}}]),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/product/m/kids_comment_write_container.html",replace:!0,link:function(a,b,c){}}})}(window,window.angular);var ajaxResponseFailHandler=function(a){alert("처리중 오류가 발생하였습니다."),a&&a()},ajaxResponseErrorHandler=function(a,b){if(a.error){var c=a.error.response_code,d=a.error.response_msg;if("9004"==c){var e="targetUrl="+encodeURIComponent(location.href,"UTF-8");location.href="/login/m/loginForm.do?"+e}else alert("["+c+"] "+d)}else alert("처리중 오류가 발생하였습니다.");b&&b()};