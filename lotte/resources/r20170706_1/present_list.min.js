var PRESENT_COMMON={DELIVER_STAT:{10:"주문접수",11:"주문완료",12:"주문취소",13:"출고지시",14:"발송대기",15:"상품준비",16:"발송불가",17:"발송완료",18:"배송완료",19:"반품접수",20:"반품진행",21:"반품완료",22:"발송약정"},DELIVER_DTL_STAT:{10:"발송완료",20:"상품배송접수",30:"상품이동중",40:"영업소도착",50:"택배기사출발",60:"배송완료"},DELIVER_MSG:{10:"주문일로부터 2일간 미입금시 주문이 취소됩니다.",11:"선물을 수락하셨습니다!",12:"주문이 취소 되었습니다.",13:"고객님의 주문이 업체에 전달되었습니다.",14:"주문상태를 확인하는 중입니다.",15:"고객님께 발송할 상품을 준비하고 있습니다.",16:"상품 발송이 불가한 상태입니다. 주문취소 또는 상담원에게 문의해주세요.",17:"택배사로 상품이 전달되었습니다.",18:"고객님께 상품 배송이 완료되었습니다.",19:"반품 접수되었으며, 반품완료 후 결제금액이 환불됩니다.",20:"반품 접수되었으며, 반품완료 후 결제금액이 환불됩니다.",21:"반품이 완료 되었습니다.",22:"상품 발송이 늦어지고 있습니다. 빠르게 준비하도록 하겠습니다.",23:"선물을 수락하셨습니다!",24:"아직 선물을 수락하지 않으셨어요!",25:"주문취소가 완료되었습니다.",26:"선물거절로 주문 건이 취소되었습니다.",27:"선물거절로 취소처리 중입니다.",28:"선물 주소지 등록 전입니다. 고객센터에서 연락드릴 예정입니다."},CHANGEORDER_MSG:["받으신 선물을 반품 신청하시면, 롯데닷컴 고객센터에서 순차적으로 반품 처리를 진행합니다.","반품 관련 문의사항이 있으시면 롯데닷컴 고객센터 (1577-1110)로 연락주세요.","받으신 선물을 교환 신청하시면, 롯데닷컴 고객센터에서 순차적으로 교환 처리를 진행합니다.","교환 관련 문의사항이 있으시면 롯데닷컴 고객센터 (1577-1110)로 연락주세요.","신청하신 선물 반품 건을 고객센터에서 확인중입니다.","신청하신 선물 교환 건을 고객센터에서 확인중입니다."]};!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","lotteUtil"]);d.controller("presentListCtrl",["$scope","$http","$filter","LotteCommon","LotteCookie","LotteUtil","$timeout","$window","LotteStorage","commInitData",function(b,c,d,e,f,g,h,i,j,k){b.useTestData=!1,b.isWishDebug=!1,b.showWrap=!0,b.contVisible=!0,b.subTitle="선물함",b.screenId="present_list",b.itemCountPerPage=20,b.currentPageNo=0,b.UIData={presentListTab:0},"Y"==k.query.sndr_yn&&(b.UIData.presentListTab=1,h(function(){if(!b.loginInfo.isLogin){var a="&targetUrl="+encodeURIComponent(i.location.href,"UTF-8");i.location.href=e.loginUrl+"?"+b.baseParam+a}},50));var l=j.getSessionStorage("presentTab");null!=l&&""!=l&&(b.UIData.presentListTab=l),b.sortType=0;var m=j.getSessionStorage("sortType");null!=m&&""!=m&&(b.sortType=m),b.UIStatus={isReceivedLoading:!1,isSentLoading:!1,isSearchingGift:!1},b.LV={SESSION_ID:"PRESENT_LIST",HASH_STRING:"/prslst",loadingReceived:!1,loadingSent:!1},b.LV.DELIVER_STAT=PRESENT_COMMON.DELIVER_STAT,b.LV.DELIVER_DTL_STAT=PRESENT_COMMON.DELIVER_DTL_STAT,b.LV.DELIVER_MSG=PRESENT_COMMON.DELIVER_MSG,b.URLs={RECEIVE_LIST:e.presentReceivedListData,SENT_LIST:e.presentSentListData,PRESENT_DETAIL:e.presentDetailUrl,PURCHASE_DETAIL:e.purchaseViewUrl,CHECK_NEW_PRESENT:e.presentListCheckNewData,WRITE_COMMENT:e.presentWriteCommentUrl,EDIT_COMMENT:e.presentEditCommentUrl,MAIN_URL:e.mainUrl},b.getSessionName=function(a){return b.LV.SESSION_ID+"_"+a},("localhost:8082"==location.host||"mt2.lotte.com"==location.host||"mo.lotte.com"==location.host)&&(a.$scope=b,"localhost:8082"==location.host&&""==b.URLs.PURCHASE_DETAIL&&(b.URLs.PURCHASE_DETAIL="/mylotte/purchase/m/purchase_view.do"))}]),d.directive("lotteContainer",["LotteStorage","$timeout","$http","$window","LotteCommon",function(d,e,f,g,h){return{templateUrl:"/lotte/resources_dev/mylotte/present/present_list_container.html",replace:!0,link:function(i,j,k){i.startOver=function(){i.loadListData()},i.loadListData=function(){console.log("LOAD DATA"),i.loadReceivedList(),i.loadSentList()},i.loadReceivedList=function(){if(0==i.loginInfo.isLogin||i.loginInfo.mbrNo==c||""==i.loginInfo.mbrNo)return void(i.UIStatus.isSearchingGift=!0);i.UIStatus.isReceivedLoading=!0;var a=i.URLs.RECEIVE_LIST,h={mbr_no:i.loginInfo.mbrNo};f.get(a,{params:h}).success(function(a){i.processListData(a.gift_lst.items),i.UIData.receivedList=a,i.UIStatus.isReceivedLoading=!1;var c=d.getSessionStorage("presentScrollY");null!=c&&""!=c&&(e(function(){b.element(g).scrollTop(c)},500),d.setSessionStorage("presentScrollY",""),d.setSessionStorage("presentTab",""),d.setSessionStorage("sortType",""))}).error(function(){console.log("Data Error : 받은 선물함"),i.UIStatus.isReceivedLoading=!1})},i.loadSentList=function(){if(0==i.loginInfo.isLogin||i.loginInfo.mbrNo==c||""==i.loginInfo.mbrNo)return void(i.UIData.sentList={gift_lst:{items:[]}});i.UIStatus.isSentLoading=!0;var a=i.URLs.SENT_LIST,b={mbr_no:i.loginInfo.mbrNo};f.get(a,{params:b}).success(function(a){i.processListData(a.gift_lst.items),i.processListData2(a.gift_lst.items),i.UIData.sentList=a,i.UIStatus.isSentLoading=!1}).error(function(){console.log("Data Error : 보낸 선물함"),i.UIStatus.isSentLoading=!1})},i.processListData=function(a){if(a!=c){var d;b.forEach(a,function(a,b){switch(d=a.gift_info.status+"",a.gift_info.canceled=!1,a.gift_info.commentable=!1,d){case"12":a.gift_info.canceled=!0;break;case"17":case"18":a.gift_info.commentable=!0}})}},i.processListData2=function(a){if(a!=c){var d,e,f;i.sendGift_total=a.length,i.sendGift_get=0,i.sendGift_yet=0,i.sendGift_end=0,b.forEach(a,function(a,b){d=a.gift_info.status+"",e=a.gift_info.gift_acq_agr_yn,f=a.gift_info.sct,a.giftType=10,"N"==e||"10"!=d&&"11"!=d&&""==e||"16"==f&&"21"==d||"11"==f&&"12"==d?(a.giftType=3,i.sendGift_end+=1):"Y"==e&&("16"!=f&&"21"!=d||"11"!=f&&"12"!=d)?(a.giftType=1,i.sendGift_get+=1):"10"!=d&&"11"!=d||""!=e||(a.giftType=2,i.sendGift_yet+=1)})}},i.selectSort=function(a){i.sortType=a},i.selectPresentList=function(a){i.UIData.presentListTab!=a&&(i.UIData.presentListTab=a,0==a&&(i.sortType=0))},i.showSearchGift=function(){i.UIStatus.isSearchingGift=!0,$(document).scrollTop(0)},i.searchReceivedGift=function(){var a=$("#srh_phone_no1").val(),b=$("#srh_phone_no2").val();if(b.length<3)return alert("전화번호를 입력해 주세요."),$("#srh_phone_no2").focus().select(),!1;var d=$("#srh_phone_no3").val();if(d.length<3)return alert("전화번호를 입력해 주세요."),$("#srh_phone_no3").focus().select(),!1;var e=$("#srh_password").val();if(e.length<4)return alert("선물함 비밀번호 4자리를 입력해 주세요."),$("#srh_password").focus().select(),!1;var g=i.URLs.CHECK_NEW_PRESENT,h={tel_no:a+"-"+b+"-"+d,pw:e};i.loginInfo.mbrNo!=c&&""!=i.loginInfo.mbrNo&&(h.mbr_no=i.loginInfo.mbrNo),f.get(g,{params:h}).success(function(a){if(i.UIStatus.isReceivedLoading=!1,"0000"==a.result_code)i.processListData(a.gift_lst.items),i.UIData.receivedList=a,i.UIStatus.isSearchingGift=!1;else{var b=a.error_msg;(b==c||""==b)&&(b="일치하는 선물 내역이 없습니다."),alert(b)}}).error(function(){i.UIStatus.isReceivedLoading=!1,alert("일치하는 선물 내역이 없습니다.")})},i.searchRestrictInput=function(a){var b=$("#"+a);if(0!=b.length){var c=b.val();c.length>4&&b.val(c.substr(0,4))}},i.goPresentDetail=function(a){var b=i.URLs.PRESENT_DETAIL+"?orderNo="+a.gift_info.order_no+"&ordDtlSn="+a.gift_info.ord_dtl_sn+"&"+baseParam;location.href=b},i.goPurseDetail=function(a){var b=i.URLs.PURCHASE_DETAIL+"?orderNo="+a.gift_info.order_no+"&"+baseParam;location.href=b},i.goCommentWrite=function(a){var b=i.URLs.WRITE_COMMENT;b+="?goods_no="+a.gift_pdf_info.goods_no,b+="&order_no="+a.gift_info.order_no,b+="&ord_dtl_sn="+a.gift_info.ord_dtl_sn,b+="&"+baseParam,location.href=b},i.goCommentEdit=function(a){var b=i.URLs.EDIT_COMMENT;b+="?goods_no="+a.gift_pdf_info.goods_no,b+="&order_no="+a.gift_info.order_no,b+="&ord_dtl_sn="+a.gift_info.ord_dtl_sn,b+="&"+baseParam,location.href=b},i.checkDeliveryState=function(e){var f=e.delivery_info.url;"17"==e.gift_info.status&&e.gift_info.detail_status!=c&&""!=e.gift_info.detail_status?(d.setSessionStorage("presentScrollY",b.element(g).scrollTop()),d.setSessionStorage("presentTab",i.UIData.presentListTab),d.setSessionStorage("sortType",i.sortType),f="/mylotte/purchase/m/smart_deli_info.do?"+i.baseParam+"&ord_no="+e.gift_info.order_no+"&dlv_unit_sn="+e.gift_info.dlv_unit_sn+"&inv_no="+e.delivery_info.invoice,location.href=f):i.appObj.isApp?openNativePopup("배송조회",f):a.open(f)},i.send_alarm=!1,i.reject_pop=!1,i.selectItem=null,i.send_diff="",i.send_cnt=0,i.sendAlarm=function(a){0==a.gift_info.gift_msg_rmnd_trns_cnt?alert("선물 알람 보내기는\n최대 3번까지만 가능합니다."):(i.selectItem=a,i.send_cnt=i.selectItem.gift_info.gift_msg_rmnd_trns_cnt,i.send_diff=l(i.selectItem.gift_info.date)+" ~ "+l(i.selectItem.gift_info.limit_date),i.send_alarm=!0)},i.show_alarmbtn=function(a){var b=new Date,c=b.getTime(),d=new Date(a.gift_info.limit_date.substring(0,4),parseInt(a.gift_info.limit_date.substring(4,6))-1,a.gift_info.limit_date.substring(6,8)),e=d.getTime(),f=!0;return c>e&&(f=!1),f},i.sendAlarmFnc=function(){f({url:"/json/order/gift_send_alarm.json",method:"GET",async:!1,cache:!1,headers:{Accept:"application/json",Pragma:"no-cache"},params:{ord_no:i.selectItem.gift_info.order_no,dlvp_sn:i.selectItem.gift_info.dlvp_sn,site_no:i.selectItem.gift_pdf_info.site_no}}).success(function(a){"0000"==a.result_code?(alert("알람이 발송되었습니다."),i.selectItem.gift_info.gift_msg_rmnd_trns_cnt-=1,i.send_cnt=i.selectItem.gift_info.gift_msg_rmnd_trns_cnt,location.reload()):alert(a.error_msg),i.close_pop()})},i.close_pop=function(){i.send_alarm=!1,i.reject_pop=!1},i.viewRefuse=function(a){i.reject_pop=!0,i.rfg_message=a.gift_info.rfg_msg};var l=function(a){return a.substring(0,4)+"."+a.substring(4,6)+"."+a.substring(6,8)};i.co_msg=PRESENT_COMMON.CHANGEORDER_MSG,i.er_psb_case=0,i.er_index=-1,i.open_er_psb=function(a,b,d){i.er_index=d,null==a.gift_info.ob_cd||""==a.gift_info.ob_cd?3==b?f({url:h.gift_optlist,method:"GET",async:!1,cache:!1,headers:{Accept:"application/json",Pragma:"no-cache"},params:{ordNo:a.gift_info.order_no,ordDtlSn:a.gift_info.ord_dtl_sn,rel_qty:a.gift_pdf_info.rel_qty}}).success(function(a){a.result_code!=c&&"ETC"==a.result_code?alert(a.error_msg):a.option_list!=c&&(i.selectOptList=a.option_list.option_list,i.er_psb_case=b)}):i.er_psb_case=b:"114"==a.gift_info.ob_cd&&3==b?alert("해당 선물은 반품 진행중입니다."):"115"==a.gift_info.ob_cd&&1==b?alert("해당 선물은 교환 진행중입니다."):i.er_psb_case=b+1},i.close_er_psb=function(){i.er_psb_case=0,i.er_index=-1},i.checkStatus=function(a){var b=i.LV.DELIVER_STAT[a.gift_info.status];return"14"==a.gift_info.sct||"16"==a.gift_info.sct?b="교환"+b:"15"==a.gift_info.sct?b="교환주문취소":"17"==a.gift_info.sct&&(b="교환반품취소"),"17"==a.gift_info.status&&a.gift_info.detail_status!=c&&""!=a.gift_info.detail_status&&(b=i.LV.DELIVER_DTL_STAT[a.gift_info.detail_status]),b},i.send_er_psb=function(a,b,d){var e="",g="",i="";if("114"==b){if(e=$("#rfg_select"+d).val(),i="선물 반품이 신청되었습니다.","0"==e)return void alert("반품사유를 선택해 주세요.")}else{if(e=$("#exch_select"+d).val(),g=$("#opt_select"+d).val(),i="선물 교환이 신청되었습니다.","-1"==g)return void alert("상품옵션을 선택해 주세요.");if("0"==e)return void alert("교환사유를 선택해 주세요.")}f({url:h.gift_change,method:"GET",async:!1,cache:!1,headers:{Accept:"application/json",Pragma:"no-cache"},params:{ordNo:a.gift_info.order_no,ordDtlSn:a.gift_info.ord_dtl_sn,ob_job_tp_cd:b,ob_rsn_cd:e,item_no:g}}).success(function(a){a.result_code!=c&&"ETC"==a.result_code?alert(a.error_msg):(alert(i),location.reload())})},e(function(){i.startOver()},0)}}}]),d.filter("convertOrderNumber",function(){return function(a){return a.indexOf("-")>=0?a:a.substring(0,4)+"-"+a.substring(4,6)+"-"+a.substring(6,8)+"-"+a.substring(8,a.length)}})}(window,window.angular);