function calcBytes(a){var b=0;for(i=0;i<a.length;i++){var c=a.charAt(i);escape(c).length>4?b+=2:"\n"==c?"\r"!=a.charAt(i-1)&&(b+=1):b+="<"==c||">"==c?4:1}return b}function maxLengthCheck(a,b,c,d){var e,f,g=c.value.length,h=parseInt(a),i="",j=0;if(0==g)null!=document.getElementById("spn_input_char")&&(document.getElementById("spn_input_char").innerText=h);else for(k=0;k<g;k++){if(e=c.value.charAt(k),"\n"==e&&j++,escape(e).length>4?h-=2:h--,0>h){alert("총 한글 "+a/2+"자 영문 "+a+"자 까지 쓰실 수 있습니다."),c.value=i;break}if(null!=b&j>parseInt(b)){alert("라인수 "+b+"라인을 넘을 수 없습니다."),j=0,f=i.length-1,c.value=i.substring(0,f);break}null!=document.getElementById("spn_input_char")&&(document.getElementById("spn_input_char").innerText=h),i+=e}}!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter","lotteSns"]);d.controller("commentWriteCtrl",["$scope","$timeout","LotteCommon","$http","$filter","$window","LotteUtil","LotteForm",function(b,d,e,f,g,h,i,j){b.showWrap=!0,b.contVisible=!0,b.subTitle="선물 이용후기 쓰기";var k=(b.appObj,function(){var a=getUrlParams().v?getUrlParams().v:null;if(null==a||"undefined"==typeof a||location.pathname.indexOf("present_comment_write_2")>0)return!1;var c="264",d="261",e="228";return b.appObj.isAndroid&&appChkVer(a,c)||b.appObj.isIOS&&appChkVer(a,d)||b.appObj.isIpad&&appChkVer(a,e)?!0:!1});b.input={},b.input.reviewTxt="",b.input.prc_stfd_val=5,b.input.qual_stfd_val=5,b.input.dsgn_stfd_val=5,b.input.dlv_stfd_val=5,b.input.size=1,b.input.color=1,b.isNewestApp=k(),b.UIData={},b.UIData.goods_no=""+i.getParameter("goods_no"),b.UIData.ord_no=""+i.getParameter("order_no"),b.UIData.ord_dtl_sn=""+i.getParameter("ord_dtl_sn"),b.UIData.isEditing=!1,b.UIData.isPresentApp=k(),b.URLs={PRESENT_LIST:e.presentListUrl,COMMENT_DATA:e.presentCommentProductData,COMMENT_SAVE:e.presentCommentSave,IMAGE_DELETE:e.presentCommentImageDelete};var l=i.getImagePath()+"/mobile/mobile_new/mylotte/blank.png",m=function(a,b){var d=b;return d!=c&&d.indexOf("|")>=0&&(d=b.split("|")[0]),a&&d?i.getImagePath("")+a+d:l};b.commentWrite={};try{var n=b.URLs.COMMENT_DATA,o={goodsNo:b.UIData.goods_no,orderNo:b.UIData.ord_no,ordDtlSn:b.UIData.ord_dtl_sn};f.get(n,{params:o}).success(function(a){b.commentWrite=a.gift_prd_info,b.commentInfo=a.comment_info,b.commentInfo!=c&&b.commentInfo.gdas_no!=c&&(b.UIData.isEditing=!0,b.commentWrite.gdas_no=a.comment_info.gdas_no,b.commentWrite.frst_gdas=a.comment_info.frst_gdas,b.commentWrite.wrtr_pur=a.comment_info.wrtr_pur,b.commentWrite.img_file_1_nm=a.comment_info.img_file_1_nm,b.commentWrite.img_path_1_nm=a.comment_info.img_path_1_nm,b.commentWrite.img_file_2_nm=a.comment_info.img_file_2_nm,b.commentWrite.img_path_2_nm=a.comment_info.img_path_2_nm,b.commentWrite.img_file_3_nm=a.comment_info.img_file_3_nm,b.commentWrite.img_path_3_nm=a.comment_info.img_path_3_nm,b.commentWrite.reviewTxt=a.comment_info.reviewTxt,b.commentWrite.prc_stfd_val=a.comment_info.prc_stfd_val,b.commentWrite.qual_stfd_val=a.comment_info.qual_stfd_val,b.commentWrite.dsgn_stfd_val=a.comment_info.dsgn_stfd_val,b.commentWrite.dlv_stfd_val=a.comment_info.dlv_stfd_val,b.commentWrite.prdt_size_eval_desc=a.comment_info.prdt_size_eval_desc,b.commentWrite.prdt_clor_eval_desc=a.comment_info.prdt_clor_eval_desc,(null==b.commentWrite.reviewTxt||"null"==b.commentWrite.reviewTxt)&&(b.commentWrite.reviewTxt=""),b.input.gdas_no=b.commentWrite.gdas_no,b.input.reviewTxt=b.commentWrite.reviewTxt,b.input.prc_stfd_val=b.commentWrite.prc_stfd_val,b.input.qual_stfd_val=b.commentWrite.qual_stfd_val,b.input.dsgn_stfd_val=b.commentWrite.dsgn_stfd_val,b.input.dlv_stfd_val=b.commentWrite.dlv_stfd_val,b.input.size=b.commentWrite.prdt_size_eval_desc,b.input.color=b.commentWrite.prdt_clor_eval_desc,b.input.frst_gdas_yn=b.commentWrite.frst_gdas?"Y":"N",b.input.wrtr_pur_yn=b.commentWrite.wrtr_pur?"Y":"N",b.input.goods_no=b.commentWrite.goods_no,b.input.usm_goods_no=b.commentWrite.usm_goods_no,b.input.img_1=m(b.commentWrite.img_path_1_nm,b.commentWrite.img_file_1_nm),b.input.img_2=m(b.commentWrite.img_path_2_nm,b.commentWrite.img_file_2_nm),b.input.img_3=m(b.commentWrite.img_path_3_nm,b.commentWrite.img_file_3_nm),b.hasImage=b.commentWrite.img_path_1_nm&&b.commentWrite.img_file_1_nm||b.commentWrite.img_path_2_nm&&b.commentWrite.img_file_2_nm||b.commentWrite.img_path_3_nm&&b.commentWrite.img_file_3_nm?!0:!1),b.input.goods_no=b.commentWrite.goods_no}).error(function(a){ajaxResponseErrorHandler(a)})}catch(p){console.error(p)}b.attachImage=function(){b.appObj.isApp?location.href="ghost://CommentWithPhoto":confirm("롯데닷컴 앱에서 이용 가능합니다. 지금 설치하시겠습니까?")&&(location.href=e.appDown+"?"+b.baseParam)},b.deleteAttachedImage=function(a){if(confirm("사진을 삭제하시겠습니까?")){var d={gdas_no:b.commentWrite.gdas_no,img_file_1_nm:b.commentWrite.img_file_1_nm,img_path_1_nm:b.commentWrite.img_path_1_nm,img_file_2_nm:b.commentWrite.img_file_2_nm,img_path_2_nm:b.commentWrite.img_path_2_nm,img_file_3_nm:b.commentWrite.img_file_3_nm,img_path_3_nm:b.commentWrite.img_path_3_nm,del_file:""};switch(a){case 1:d.del_file=b.commentWrite.img_file_1_nm,d.img_file_1_nm="",d.img_path_1_nm="";break;case 2:d.del_file=b.commentWrite.img_file_2_nm,d.img_file_2_nm="",d.img_path_2_nm="";break;case 3:d.del_file=b.commentWrite.img_file_3_nm,d.img_file_3_nm="",d.img_path_3_nm=""}var e=b.URLs.IMAGE_DELETE;return void f.get(e,{params:d}).success(function(b){if("0000"==b.result_code)$("#img_list img").eq(a-1).attr("src",l),$("#img_list a").eq(a-1).css("display","none");else{var d=b.error_msg;(d==c||""==d)&&(d="이미지를 삭제하지 못했습니다."),alert(d)}}).error(function(a){alert("이미지를 삭제하지 못했습니다.")})}},b.cancel=function(){confirm("선물 이용후기 작성을 취소하시겠습니까?")&&location.replace(b.URLs.PRESENT_LIST+"?"+b.baseParam)},b.save=function(){if(!b.commentWrite.healthfood){var a=b.input.reviewTxt,e=document.querySelector("#reviewTxt");if(0==a.trim().length)return alert("상품평을 작성해 주세요."),e.focus(),!1;if(calcBytes(a)<6)return alert("상품평을 한글 3자 이상 입력하세요."),e.focus(),!1;if(calcBytes(a)>4e3)return alert("상품평은 2000자[한글기준] 이내로 제한되어 있습니다."),e.focus(),!1}if(b.snsFlag&&(Kakao.cleanup(),1==b.appObj.isSktApp?Kakao.init("7a460fb5cdebe4589041db57d906ddda"):Kakao.init("574659987ca46095c123d71f72abac14"),b.prdComment="[상품평] "+b.input.reviewTxt,b.share_img=b.commentWrite.goods_img_url,b.share_url="/product/product_view.do?goods_no="+b.commentWrite.goods_no,1==b.appObj.isSktApp?b.noCdnUrl=location.protocol+"//"+location.hostname+b.share_url+"&cn=171127":b.noCdnUrl=location.protocol+"//"+location.hostname+b.share_url+"&cn=123624",1==b.appObj.isSktApp?(b.talkCdn="3093671",b.twitCdn="3093668",b.stotyCdn="3093670",b.smsCdn="3093672",b.mailCdn="3158697",b.faceCdn="3093669",b.urlCdn="3158696",b.appCdn="3158696"):(b.talkCdn="2929723",b.twitCdn="2929720",b.stotyCdn="2929722",b.smsCdn="2929725",b.mailCdn="2929724",b.faceCdn="2929721",b.urlCdn="2929719",b.appCdn="2929719")),b.input.qual_stfd_val==c?b.input.qual_stfd_val=5:(b.input.qual_stfd_val>5||b.input.qual_stfd_val<1)&&(b.input.qual_stfd_val=5),b.input.dsgn_stfd_val==c?b.input.dsgn_stfd_val=5:(b.input.dsgn_stfd_val>5||b.input.dsgn_stfd_val<1)&&(b.input.dsgn_stfd_val=5),b.input.dlv_stfd_val==c?b.input.dlv_stfd_val=5:(b.input.dlv_stfd_val>5||b.input.dlv_stfd_val<1)&&(b.input.dlv_stfd_val=5),b.input.color==c?b.input.color=1:(b.input.color>3||b.input.color<1)&&(b.input.color=1),b.input.size==c?b.input.size=1:(b.input.size>3||b.input.size<1)&&(b.input.size=1),b.input.reviewTxt==c&&(b.input.reviewTxt=""),b.commentWrite.site_no==c&&(b.commentWrite.site_no=1),b.commentWrite.gdas_no==c&&(b.commentWrite.gdas_no=""),b.input.frst_gdas_yn==c&&(b.input.frst_gdas_yn=""),b.input.wrtr_pur_yn==c&&(b.input.wrtr_pur_yn=""),0==b.UIData.isEditing&&b.UIData.isPresentApp){if(b.snsFlag){"sms"==b.snsFlag&&(b.sendTclick(b.tClickBase+"share_Clk_Pop_4"),b.kakaoType="",b.cnShareUrl="",b.cnShareUrl=b.noCdnUrl+"&cdn="+b.smsCdn),"kakaotalk"==b.snsFlag&&(b.sendTclick(b.tClickBase+"share_Clk_Pop_1"),b.appObj.isOldApp?b.kakaoType="[롯데닷컴 이거어때?]\n":b.kakaoType="",b.cnShareUrl="",b.cnShareUrl=b.noCdnUrl+"&cdn="+b.talkCdn),"kakaostory"==b.snsFlag&&(b.sendTclick(b.tClickBase+"share_Clk_Pop_3"),b.kakaoType="",b.cnShareUrl="",b.cnShareUrl=b.noCdnUrl+"&cdn="+b.stotyCdn),"facebook"==b.snsFlag&&(b.sendTclick(b.tClickBase+"share_Clk_Pop_6"),b.kakaoType="",b.cnShareUrl="",b.cnShareUrl=b.noCdnUrl+"&cdn="+b.faceCdn),"twitter"==b.snsFlag&&(b.sendTclick(b.tClickBase+"share_Clk_Pop_2"),b.kakaoType="",b.cnShareUrl="",b.cnShareUrl=b.noCdnUrl+"&cdn="+b.twitCdn),"url_copy"==b.snsFlag&&(b.sendTclick(b.tClickBase+"share_Clk_Pop_7"),b.kakaoType="",b.cnShareUrl="",b.cnShareUrl=b.noCdnUrl+"&cdn="+b.urlCdn),"moreapp"==b.snsFlag&&(b.sendTclick(b.tClickBase+"share_Clk_Pop_8"),b.kakaoType="",b.cnShareUrl="",b.cnShareUrl=b.noCdnUrl+"&cdn="+b.appCdn),"mail"==b.snsFlag&&(b.sendTclick(b.tClickBase+"share_Clk_Pop_5"),b.kakaoType="",b.cnShareUrl="",b.cnShareUrl=b.noCdnUrl+"&cdn="+b.mailCdn),b.share_img&&""!=b.share_img?b.share_img=b.share_img:b.share_img="http://image.lotte.com/lotte/mobile/common/share_img2016_v2.png";var f={url:b.cnShareUrl,title:b.kakaoType+b.prdComment.replace(/#/gi,""),imageUrl:b.share_img};b.appObj.isAndroid?h.lotteshare.callAndroid("lotteshare://"+b.snsFlag+"/query?"+JSON.stringify(f)):b.appObj.isIOS&&(h.location="lotteshare://"+b.snsFlag+"/query?"+JSON.stringify(f))}var g="ghost://SubmitPhotoComment/present";return g+="?goods_no="+b.UIData.goods_no,g+="&frst_gdas_yn="+b.input.frst_gdas_yn,g+="&wrtr_pur_yn="+b.input.wrtr_pur_yn,g+="&reviewTxt="+b.input.reviewTxt,g+="&size="+b.input.size,g+="&proc_sct_cd=0",g+="&mbrNm="+b.commentWrite.mbrNm,g+="&wrtr_cell_no="+b.commentWrite.wrtr_cell_no,g+="&qual_stfd_val="+b.input.qual_stfd_val,g+="&dsgn_stfd_val="+b.input.dsgn_stfd_val,g+="&dlv_stfd_val="+b.input.dlv_stfd_val,g+="&site_no="+b.commentWrite.site_no,g+="&color="+b.input.color,g+="&ord_no="+b.UIData.ord_no,g+="&ordDtlSn="+b.UIData.ord_dtl_sn,g+="&gdas_no="+b.commentWrite.gdas_no,b.isNewestApp||(g+="&radio1=",g+="&radio2="+b.input.color,g+="&radio2=",g+="&radio2="+b.input.color,g+="&radio3=",g+="&radio4=",g+="&radio5=",g+="&radio6=",g+="&check_cont=",g+="&img_no=",g+="&img_file_1=",g+="&img_file_2=",g+="&img_file_3=",g+="&img_file_4=",g+="&img_path_1=",g+="&img_path_2=",g+="&img_path_3=",g+="&img_path_4=",g+="&prdt_clor_eval_desc=",g+="&prdt_size_eval_desc=",g+="&use_flag=",g+="&wrtr_pur_dt=",g+="&div_stfd_val="+b.input.dlv_stfd_val),void d(function(){location.href=g},200)}var i={};i.goods_no=b.UIData.goods_no,i.reviewTxt=b.input.reviewTxt,i.size=b.input.size,i.proc_sct_cd=0,i.mbrNm=b.commentWrite.mbrNm,i.wrtr_cell_no=b.commentWrite.wrtr_cell_no,i.qual_stfd_val=b.input.qual_stfd_val,i.dsgn_stfd_val=b.input.dsgn_stfd_val,i.dlv_stfd_val=b.input.dlv_stfd_val,i.img_path_1_nm="",i.img_path_2_nm="",i.img_path_3_nm="",i.img_file_1_nm="",i.img_file_2_nm="",i.img_file_3_nm="",i.site_no=b.commentWrite.site_no,i.color=b.input.color,i.ord_no=b.UIData.ord_no,i.ordDtlSn=b.UIData.ord_dtl_sn,i.gdas_no=b.commentWrite.gdas_no,i.frst_gdas_yn=b.input.frst_gdas_yn,i.wrtr_pur_yn=b.input.wrtr_pur_yn;var g=b.URLs.COMMENT_SAVE+"?"+b.baseParam;return j.FormSubmitForAjax(g,i).success(function(a){b.snsFlag&&("sms"==b.snsFlag?(b.cnShareUrl="",b.cnShareUrl=b.noCdnUrl+"&cdn="+b.smsCdn,b.showSmsBox()):"kakaotalk"==b.snsFlag?(b.cnShareUrl="",b.cnShareUrl=b.noCdnUrl+"&cdn="+b.talkCdn,b.sendKakaoTalk()):"kakaostory"==b.snsFlag?(b.cnShareUrl="",b.cnShareUrl=b.noCdnUrl+"&cdn="+b.stotyCdn,b.sendKakaoStory()):"facebook"==b.snsFlag?(b.cnShareUrl="",b.cnShareUrl=b.noCdnUrl+"&cdn="+b.faceCdn,b.sendFacebook()):"twitter"==b.snsFlag?(b.cnShareUrl="",b.cnShareUrl=b.noCdnUrl+"&cdn="+b.twitCdn,b.sendTwitter()):"url_copy"==b.snsFlag&&(b.cnShareUrl="",b.cnShareUrl=b.noCdnUrl+"&cdn="+b.urlCdn,b.urlCopyClick())),d(function(){location.replace(b.URLs.PRESENT_LIST+"?"+b.baseParam)},200)}).error(function(a){ajaxResponseErrorHandler(a)}),!1},("localhost:8082"==location.host||"mt2.lotte.com"==location.host||"mo.lotte.com"==location.host)&&(a.$scope=b)}]),d.directive("lotteContainer",function(){return{templateUrl:"/lotte/resources_dev/mylotte/present/present_comment_write_container.html",replace:!0,link:function(a,b,c){}}})}(window,window.angular);var ajaxResponseFailHandler=function(a){alert("처리중 오류가 발생하였습니다."),a&&a()},ajaxResponseErrorHandler=function(a,b){if(a.error){var c=a.error.response_code,d=a.error.response_msg;return void alert("["+c+"] "+d)}else alert("처리중 오류가 발생하였습니다.");b&&b()};