!function(a,b,c){"use strict";var d=b.module("app",["lotteComm","lotteSrh","lotteSideCtg","lotteCommFooter"]);d.controller("TalkShoppingCtrl",["$scope","LotteCommon","commInitData",function(a,b,c){a.showWrap=!0,a.contVisible=!0,a.subTitle="음성 쇼핑",a.DEV_MODE="",a.ts_clause={toggle:!1,visible:!1,index:0},a.ts_showIntroPop=!1,a.ts_basicInfo={initiated:!1,showBasicInfo:!1,showGuideInfo:!1,prior_info_chk:!1,et_mbr_dlvp_chk:!1,base_op_pay_chk:!1},a.showExitConfirm=!1,a.ts_micStat={init:!1,inited:!1,open:!1,listening:!1,sending:!1,warning:!1},a.ts_stt={text:"",strength:0},a.ts_loadingData=!1,a.ts_currentStep=0,a.ts_currentGroup=null,a.ts_currentProduct=null,a.ts_currentGoodsNo=null,a.ts_currentOrderNo=null,a.ts_currentQue=null,a.ts_groupList=[],a.ts_prodGroup=[],a.ts_groupMap={},a.ts_prodList=[],a.ts_goodsList=null,a.ts_talkList=[{},{},{},{},{},{}],a.ts_toastList=[],a.TOAST_LIST={step1:['"생수"라고 말해보세요'],step2:['"1번 주문해줘"라고 말해보세요','"1번 자세히"라고 말해보세요'],step3:['"응, 아니"라고 말해보세요'],step5:['"처음으로"라고 말해보세요'],nospeak:["듣고 있어요"]},a.ts_toastCnt=0,a.ts_toastIdx=0,a.ts_orderReview=null,a.ts_orderPaying=null,a.ts_orderResult=null,a.ts_notRecogCnt=0,a.ts_currentTTS="",a.CHAT_QUE=[]}]),d.directive("lotteContainer",["LotteCommon","LotteUserService","LotteStorage","commInitData","$http","$timeout","$interval","LotteUtil","$window",function(d,e,f,g,h,i,j,k,l){return{templateUrl:"/lotte/resources_dev/talk/talkShopping_container.html",replace:!0,link:function(m,n,o){function p(a){ab=a,console.log("chat server changed: "+ab)}function q(){var a=g.query;if("Y"===a.isp){var b=a.resMsg;try{b=decodeURIComponent(b)}catch(c){}var d={resCode:a.resCode,resMsg:b,ord_no:a.ord_no};f.setSessionStorage("TALK_SHOP_ISP",d,"json"),history.replaceState({name:"talkshopping"},"talkshopping")}if(Za.member_no=m.loginInfo.mbrNo,Za.member_nm=m.loginInfo.name,Za.uagent=m.appObj.isAndroid?"Y":"N",Za.cp_schema=a.schema,Za.cp_v=a.v,Za.cp_udid=a.udid,Za.chl_no=a.cn,Za.voice="Y",!m.isValidString(Za.member_no)){var e=encodeURIComponent($a+"?"+m.baseParam);return void m.gotoService("loginUrl",{targetUrl:e})}f.getLocalStorage("TALK_SHOP_closeIntro")===m.getTodayDate()||"Y"===f.getLocalStorage("TALK_SHOP_noMoreIntro")?(m.ts_showIntroPop=!1,r()):m.ts_showIntroPop=!0}function r(){m.ts_showIntroPop=!1,z(),m.$watch("ts_currentStep",T),null==history.state||"talkshopping"!=history.state.name?(history.replaceState({name:"talkshopping"},"talkshopping"),v()):t()?i(ka,100):v(),b.element(a).on("unload",s)}function s(){if(Ya===!0){var c={};c.scrollTop=b.element(a).scrollTop(),c.currentStep=m.ts_currentStep,c.basicInfo=m.ts_basicInfo,c.talkList=m.ts_talkList,c.toastList=m.ts_toastList,c.groupList=m.ts_groupList,c.prodList=m.ts_prodList,c.currentGroup=m.ts_currentGroup,c.currentProduct=m.ts_currentProduct,c.currentGoodsNo=m.ts_currentGoodsNo,c.currentOrderNo=m.ts_currentOrderNo,c.goodsNoList=m.ts_goodsList,c.orderReview=m.ts_orderReview,c.orderPaying=m.ts_orderPaying,c.orderResult=m.ts_orderResult,f.setSessionStorage("TALK_SHOP_SSST",c,"json")}}function t(){if(Ya!==!0)return!1;var a=f.getSessionStorage("TALK_SHOP_SSST","json");if(a==c)return!1;try{if(m.ts_micStat={init:!0,inited:!0,open:!1,listening:!1,sending:!1,warning:!1},!m.isValidArray(a.groupList))return!1;m.ts_currentStep=a.currentStep,m.ts_basicInfo=a.basicInfo,m.ts_basicInfo.showBasicInfo=!1,m.ts_talkList=a.talkList,m.ts_toastList=a.toastList,m.ts_groupList=a.groupList,P(),m.ts_prodList=a.prodList,m.ts_currentGroup=a.currentGroup,m.ts_currentProduct=a.currentProduct,m.ts_currentGoodsNo=a.currentGoodsNo,m.ts_currentOrderNo=a.currentOrderNo,m.ts_goodsList=a.goodsNoList,m.ts_orderReview=a.orderReview,m.ts_orderPaying=a.orderPaying,m.ts_orderResult=a.orderResult,u(),i(function(){U(!0)},500),isNaN(a.scrollTop)||scrollTo(0,a.scrollTop)}catch(b){return!1}return!0}function u(){var a=f.getSessionStorage("TALK_SHOP_ISP","json");null!=a&&(f.delSessionStorage("TALK_SHOP_ISP"),talkOrderCallBack(a.resCode,a.resMsg,a.ord_no))}function v(){var a={member_no:Za.member_no};h.get(_a,{params:a}).success(w).error(x)}function w(a){if(a==c||a.data==c)return m.showHideBIPop(!0),void x();m.ts_basicInfo=a.data;var b=m.ts_basicInfo;b.initiated="Y"===f.getLocalStorage("TALK_SHOP_basicInitiated"),m.showHideBIPop(b.prior_info_chk!==!0||b.initiated===!1),"40"==b.pay_mean_cd?(fb=b.onlCno,B()):G()}function x(){}function y(a,b){m.showExitConfirm=!1,a===!0&&(ua(),i(function(){m.callAppAPI("exitTalkShop")},150),i(function(){m.gotoService("mainUrl",{tclick:Ka(b)})},300))}function z(){a.lpay=new Lpay({name:"lpay",url:cb,merchantSignKey:db,reqTypeCd:"6000002",style:"1",openMode:"0",closeCallback:A,__iframe:{},popupReturnUrl:""})}function A(){console.warn("lpayCloseCB")}function B(){var a={mchtAuthKey:eb,onlCno:fb,callback:C};lpay.merchantAuth(a)}function C(a){a==c||"S"!=a.resClac?F():D()}function D(){var a={onlCno:fb,callback:E};lpay.getPaymentMethod(a)}function E(a){if(a==c||"S"!=a.resClac)F();else{try{m.ts_basicInfo.fnCoNm="",m.ts_basicInfo.pmtMthdAlias="",b.forEach(a.pmtMthdList,function(a,b){a.pmtMthdId==m.ts_basicInfo.pay_card_rcgn_id&&(m.ts_basicInfo.fnCoNm=a.fnCoNm,m.ts_basicInfo.pmtMthdAlias=a.pmtMthdAlias)}),m.isValidString(m.ts_basicInfo.pmtMthdAlias)||F()}catch(d){F()}"function"==typeof La?La():G()}}function F(){m.ts_basicInfo.prior_info_chk=!1,m.ts_basicInfo.base_op_pay_chk=!1,m.showHideBIPop(!0),m.alert_2016("Lpay 결제수단 인증을 하지 못했습니다. 결제수단을 변경해 주세요.")}function G(){m.ts_currentStep=1,H()}function H(){var a=m.ts_basicInfo;0==a.showBasicInfo&&0==m.ts_prodGroup.length&&m.talkRecomDelegate("getProdGroup")}function I(a,b){m.CHAT_QUE.push({param:a,data:b}),J()}function J(){if(0!=m.CHAT_QUE.length&&!m.ts_loadingData){ua();var a=m.CHAT_QUE.shift();m.ts_currentQue=a,m.ts_loadingData=!0,m.ts_micStat.sending=!0,h.get(ab,{params:a.param}).success(L).error(K)}}function K(a,b,d,e){if(a&&a.err_msg&&""!=a.err_msg)m.alert_2016(a.err_msg);else{var f=!1;m.modalPopList2016!=c&&m.modalPopList2016.length>0&&"채팅 데이터 전송 에러"==m.modalPopList2016[0].message&&(f=!0),f||m.alert_2016("채팅 데이터 전송 에러")}m.ts_micStat.sending=!1,ma(),m.ts_loadingData=!1,4==m.ts_currentStep&&V(),J()}function L(a,b,d,e){a==c||"0000"!=a.err_cd||a.data==c?(K(a,b,d,e),J()):(m.ts_micStat.sending=!1,ma(),i(function(){var b=e.params,c=a.data;M(c,b)},200))}function M(a,b){Q(a,b),m.isValidArray(a.error_list)?N(a,b):"getProdGroup"==b.command?O(a,b):R(a,b),m.ts_loadingData=!1,s()}function N(a,b){a!=c&&m.isValidArray(a.tts_text)||(Sa=!1,console.warn(a.error_list.join("<br/>")))}function O(a,b){var c=m.ts_talkList[1];c.talk_list=a.talk_list,c.tts_text=a.tts_text,m.ts_groupList=a.group_list,P(),i(ka,1e3),Sa=!0,qa("step")}function P(){m.ts_prodGroup.length=0;var a=m.ts_groupList;if(m.isValidArray(a)){var b,d,e,f;for(d=a.length,b=0;d>b;b++)e=a[b],f=Math.floor(b/4),m.ts_prodGroup[f]==c&&(m.ts_prodGroup[f]=[]),m.ts_prodGroup[f].push(e),m.ts_groupMap[e.prod_grp_id]=e}}function Q(a,b){if(Sa=!1,m.isValidArray(a.tts_text)){Sa=!0;var c=a.tts_text.join("\n");i(function(){ta(c)},100)}}function R(b,c){switch(b.command){case"goFirst":return void W(1);case"goBack":return void V();case"gotoCart":Ja();break;case"scrollDown":return $("html, body").stop(!0),void $("html, body").animate({scrollTop:$(a).scrollTop()+a.innerHeight},500);case"scrollTop":return $("html, body").stop(!0),void $("html, body").animate({scrollTop:0},500)}switch(ea(b.talk_list),m.ts_currentStep){case 1:Y(b,c);break;case 2:Z(b,c);break;case 3:_(b,c);break;case 4:ba(b,c);break;case 5:ca(b,c)}Sa=!0,qa("step")}function S(a){a.error_list=["이해하지 못했어요."],N(a)}function T(a,b){a!=b&&i(U,500)}function U(c){ga();var d=$(".ts_step_cont > div"),e=d.children(),f=d.find(".user_text");if(0==d.length&&4!=m.ts_currentStep)return void i(U,100);d.stop(!0),e.stop(!0),f.stop(!0),d.css({top:1.02*b.element(a).height(),opacity:1}),e.css({opacity:0});var g={top:0},h={easing:m.checkJQueryEasing("easeInOutCubic"),duration:400},j={opacity:1},k={easing:m.checkJQueryEasing("easeInOutCubic"),duration:400};if(c===!0)d.css(g),e.css(j);else{var l,n,o=0;d.each(function(a,b){l=$(b),n=l.children(),o+=0==a?250:250/(a+1),l.delay(o).animate(g,h),n.delay(o+200).animate(j,k)})}}function V(){m.ts_currentStep>1&&(5==m.ts_currentStep?m.goHistoryBack():W(m.ts_currentStep-1))}function W(a){!b.isNumber(a)||1>a||a>5||(ga(),m.ts_currentStep=a,X(),qa("step"))}function X(){for(var a=5;a>=1;a--)a>m.ts_currentStep&&(m.ts_talkList[a]={});1==m.ts_currentStep?(m.ts_currentGroup=null,m.ts_currentGoodsNo=null,m.ts_goodsList=null):2==m.ts_currentStep&&(m.ts_currentGoodsNo=null,m.ts_currentProduct=null),m.ts_currentStep<3&&(m.ts_orderReview=null),m.ts_currentStep<4&&(m.ts_orderPaying=null,m.ts_currentOrderNo=null),m.ts_currentStep<5&&(m.ts_orderResult=null)}function Y(a,b){switch(a.command){case"selectGroup":if(m.ts_groupMap[a.prod_grp_id]==c)return void m.alert_2016("잘못된 그룹입니다.");m.ts_currentGroup=a.prod_grp_id,m.ts_goodsList=a.goods_no_list,m.ts_prodList.length=0;var d,e,f=m.ts_groupMap[m.ts_currentGroup].prod_list,g=f.length;if(m.isValidArray(a.goods_no_list))for(d=0;g>d;d++)e=f[d],a.goods_no_list.indexOf(e.goods_no)>=0&&m.ts_prodList.push(f[d]);else m.ts_prodList=[].concat(f);m.ts_currentStep=2;var h=m.ts_talkList[m.ts_currentStep];h.user_text=b.text,h.talk_list=a.talk_list,h.tts_text=a.tts_text,m.isValidString(a.user_text)&&(h.user_text=a.user_text);break;default:S(a)}}function Z(a,b){switch(a.command){case"productDetail":Ia(a.goods_no);break;case"selectProduct":if(!m.isValidString(a.goods_no))return void m.alert_2016("유효하지 않은 상품입니다.");m.ts_currentStep=3,m.ts_currentGoodsNo=a.goods_no;var d=m.ts_groupMap[m.ts_currentGroup];d!=c&&m.isValidArray(d.prod_list)&&d.prod_list.forEach(function(b,c){b.goods_no==a.goods_no&&(m.ts_currentProduct=b)});var e=m.ts_talkList[m.ts_currentStep];e.user_text=b.text,e.talk_list=a.talk_list,e.tts_text=a.tts_text,m.isValidString(a.user_text)&&(e.user_text=a.user_text),m.ts_orderReview=a.ret_object;break;case"selectGroup":if(m.ts_groupMap[a.prod_grp_id]==c)return void m.alert_2016("잘못된 그룹입니다.");m.ts_currentGroup=a.prod_grp_id,m.ts_goodsList=a.goods_no_list,m.ts_prodList.length=0;var f,g,h=m.ts_groupMap[m.ts_currentGroup].prod_list,j=h.length;if(m.isValidArray(a.goods_no_list))for(f=0;j>f;f++)g=h[f],a.goods_no_list.indexOf(g.goods_no)>=0&&m.ts_prodList.push(h[f]);else m.ts_prodList=[].concat(h);m.ts_currentStep=2;var e=m.ts_talkList[m.ts_currentStep];e.user_text=b.text,e.talk_list=a.talk_list,e.tts_text=a.tts_text,m.isValidString(a.user_text)&&(e.user_text=a.user_text),$(".ts_step_cont > div").css("opacity",0),i(U,500);break;default:S(a)}}function _(a,b){switch(a.command){case"payRequest":m.ts_orderPaying={r:a,q:b},"40"==m.ts_basicInfo.pay_mean_cd?(fb=m.ts_basicInfo.onlCno,La=aa,B()):aa();break;default:S(a)}}function aa(){var a=m.ts_orderPaying.r,b=m.ts_orderPaying.q;m.ts_currentStep=4;var c=m.ts_talkList[m.ts_currentStep];c.user_text=b.text,c.talk_list=a.talk_list,c.tts_text=a.tts_text,m.isValidString(a.user_text)&&(c.user_text=a.user_text),i(fa,10)}function ba(a,b){switch(a.command){case"payComplete":m.ts_currentStep=5;var c=m.ts_talkList[m.ts_currentStep];c.talk_list=a.talk_list,c.tts_text=a.tts_text,m.isValidString(a.user_text)&&(c.user_text=a.user_text),m.ts_orderResult=a.ret_object;break;default:S(a)}}function ca(a,b){switch(a.command){case"gotoPurchaseList":m.gotoPurchaseView();break;default:S(a)}}function da(a){return lb[a]}function ea(a){if(m.isValidArray(a))for(var b=a.length,c=0;b>c;c++)a[c]=a[c].replace(mb,da)}function fa(){var a,d;try{a=m.ts_orderReview.cart_sn,d=m.ts_orderReview.goods_list.items[0].goods_no}catch(e){}if(a==c||d==c)return void m.alert_2016("유효하지 않은 상품입니다.");var f=bb+"?talkYN=Y&"+m.baseParam+"&cart_sn="+a+"&goods_no="+d;b.element("#tsol_iframe").prop("src",f)}function ga(){a.scrollTo(0,0)}function ha(){b.element(".tsi_mov").removeClass("hide"),i.cancel(nb),nb=i(ia,3e3)}function ia(){b.element(".tsi_mov").addClass("hide")}function ja(a){switch(a.type){case"play":b.element(".tsi_mov").addClass("onplay");break;case"pause":b.element(".tsi_mov").removeClass("onplay");break;case"ended":b.element(".tsi_mov").removeClass("onplay"),m.closeIntroPop()}}function ka(){m.ts_micStat.init=!0,i(function(){m.ts_micStat.inited=!0},300),i(Aa,1e3)}function la(){i.cancel(Ta.activateMic),i.cancel(Ta.returnFirst),m.ts_stt.text="",qa("step"),ua(),m.ts_micStat.open=!0,Ta.activateMic=i(na,Ua.activateMic)}function ma(){ya(),i.cancel(Ta.activateMic),i.cancel(Ta.noSpeaking),i.cancel(Ta.quitRecognition),b.element(".tsm_box .tsmc_ripple div").stop().remove(),m.ts_micStat.open=!1,m.ts_micStat.listening=!1,m.ts_micStat.sending=!1,m.ts_micStat.warning=!1,m.ts_stt.text="",m.ts_stt.strength=0,Va.angle=0,Va.top=0,qa("none")}function na(){m.ts_micStat.listening=!0,i.cancel(Ta.noSpeaking),i.cancel(Ta.quitRecognition),Ta.noSpeaking=i(pa,Ua.noSpeaking),Ta.quitRecognition=i(oa,Ua.quitRecognition),xa()}function oa(){m.isValidString(m.ts_stt.text)?m.talkRecomDelegate("sendSpeech",m.ts_stt.text):ma()}function pa(){""==m.ts_stt.text&&qa("nospeak")}function qa(a){switch(j.cancel(Ta.rotateToast),"step"==a&&(a+=m.ts_currentStep),a){case"step1":m.ts_toastList=m.TOAST_LIST.step1;break;case"step2":m.ts_toastList=m.TOAST_LIST.step2;break;case"step3":m.ts_toastList=m.TOAST_LIST.step3;break;case"step5":m.ts_toastList=m.TOAST_LIST.step5;break;case"nospeak":m.ts_toastList=m.TOAST_LIST.nospeak;break;default:m.ts_toastList=[]}m.ts_toastCnt=m.ts_toastList.length,m.ts_toastIdx=Math.floor(Math.random()*m.ts_toastCnt),m.ts_toastCnt>1&&(Ta.rotateToast=j(ra,Ua.rotateToast))}function ra(){m.ts_toastCnt<=1||!m.ts_micStat.open||(m.ts_toastIdx=(m.ts_toastIdx+1)%m.ts_toastCnt)}function sa(){m.appObj.isIOS&&m.callAppAPI("hideHeader")}function ta(a){m.ts_basicInfo.showBasicInfo||m.ts_basicInfo.showGuideInfo||m.showExitConfirm||(a.indexOf("이해하지 못했어요")>=0||a.indexOf("2해하지 못했어요")>=0?m.ts_notRecogCnt++:m.ts_notRecogCnt=0,m.ts_notRecogCnt>=2&&(Sa=!1),Wa=!0,m.ts_currentTTS=a,m.callAppAPI("startTTS",{text:a}))}function ua(){Wa===!0&&(Wa=!1,m.callAppAPI("stopTTS"))}function va(){console.warn("TTS END",Sa,m.ts_currentStep),Wa=!1,Sa&&3==m.ts_currentStep&&la()}function wa(){Xa=!1,oa()}function xa(){m.ts_basicInfo.showBasicInfo||m.ts_basicInfo.showGuideInfo||m.showExitConfirm||(Xa=!0,m.callAppAPI("startSTT"))}function ya(){Xa===!0&&(Xa=!1,m.callAppAPI("stopSTT"))}function za(){m.ts_currentStep<=1?m.goHistoryBack():V()}function Aa(){j(Ca,20),j(Ba,500)}function Ba(){m.ts_micStat.listening&&(m.ts_stt.strength=Math.round(60*Math.random())+40)}function Ca(){if(m.ts_micStat.listening||m.ts_micStat.sending||m.ts_micStat.warning){Va.angle+=10;var a=b.element(".tsmc_dot span.a1"),c=b.element(".tsmc_dot span.a2"),d=b.element(".tsmc_dot span.a3"),e=b.element(".tsm_circle .tsmc_disc > div"),f=a.find("span"),g=c.find("span"),h=d.find("span");0!=a.length&&(m.ts_micStat.sending?Fa():m.ts_micStat.listening?(Da(),Ea()):m.ts_micStat.warning&&Ga(),a.css(Ma),c.css(Na),d.css(Oa),Pa.top=-Va.top,Pa.bottom=-Va.top,Qa.top=.6*-Va.top,Qa.bottom=.6*-Va.top,Ra.opacity=Ha(Ra.opacity,0),f.css(Pa),g.css(Qa),h.css(Pa),e.css(Ra))}}function Da(){if(m.isValidString(m.ts_stt.text)){var a=m.ts_stt.strength;if(m.isValidNumber(a)){m.ts_stt.strength=0,Ra.opacity=a/100;var b=a/6;Va.top<b&&(Va.top=b),a/=5;var c=$(".tsm_box .tsmc_ripple"),d=$("<div />");c.append(d);var e={left:-(33+a),right:-(33+a),top:-(33+a),bottom:-(33+a),opacity:0},f={duration:1200,easing:m.checkJQueryEasing("easeOutBack"),complete:function(){d.remove()}};d.animate(e,f)}}}function Ea(){var a=2,b=Va.angle,c=b-120,d=b-240;0>c&&(c=0),0>d&&(d=0);var e=b/180*Math.PI,f=c/180*Math.PI,g=d/180*Math.PI,h=Math.sin(e)*a,i=Math.sin(f)*a,j=Math.sin(g)*a;Ma.top=h,Na.top=i,Oa.top=j,Va.top=Ha(Va.top,0),Ma.opacity=Ha(Ma.opacity,1),Na.opacity=Ha(Na.opacity,1),Oa.opacity=Ha(Oa.opacity,1)}function Fa(){var a=.4,b=.6,c=Va.angle,d=c-60,e=c-120;0>d&&(d=0),0>e&&(e=0);var f=c/180*Math.PI,g=d/180*Math.PI,h=e/180*Math.PI,i=Math.sin(f)*a+b,j=Math.sin(g)*a+b,k=Math.sin(h)*a+b;Ma.opacity=i,Na.opacity=j,Oa.opacity=k,Va.top=Ha(Va.top,0),Ma.top=Ha(Ma.top,0),Na.top=Ha(Na.top,0),Oa.top=Ha(Oa.top,0)}function Ga(){Ma.top=Ha(Ma.top,0),Na.top=Ha(Na.top,0),Oa.top=Ha(Oa.top,0),Va.top=Ha(Va.top,0),Ma.opacity=Ha(Ma.opacity,1),Na.opacity=Ha(Na.opacity,1),Oa.opacity=Ha(Oa.opacity,1)}function Ha(a,b){var c=b-a;return Math.abs(c)<.05?b:a+c/20}function Ia(a){var b={curDispNoSctCd:94,goodsNo:a},c="";i(function(){m.productView(b,"","",c)},200)}function Ja(){i(function(){m.gotoService("cartLstUrl")},200)}function Ka(a,b){var c=!0,d=m.tClickRenewalBase+"VoiceOrder_Clk_";switch(a){case 1:d+="btn_inputaddress",c=!1;break;case 2:d+="btn_inputPayment",c=!1;break;case 3:d+="btn_closeadvancerg",c=!1;break;case 4:d+="btn_changeaddress",c=!1;break;case 5:d+="btn_changePayment",c=!1;break;case 6:d+="btn_StartVorceOrder";break;case 7:d+="apply";break;case 8:d+="btn_back";break;case 9:d+="btn_info";break;case 10:d+="btn_setting";break;case 11:d+="btn_prevStep";break;case 12:d+="btn_category_"+b;break;case 13:d+="btn_product_"+b;break;case 14:d+="btn_mic";break;default:return""}return c?void m.sendTclick(d):d}m.DEV_MODE="m.lotte.com"!=location.host&&"Y"==g.query.dev_mode;var La,Ma={top:0,opacity:1},Na={top:0,opacity:1},Oa={top:0,opacity:1},Pa={top:0,bottom:0},Qa={top:0,bottom:0},Ra={opacity:0},Sa=!1,Ta={activateMic:null,quitRecognition:null,noSpeaking:null,rotateToast:null,returnFirst:null},Ua={activateMic:500,quitRecognition:12e3,noSpeaking:4e3,rotateToast:2e3},Va={angle:0,top:0},Wa=!1,Xa=!1,Ya=!0,Za={},$a=d.talkShopUrl,_a=d.talkShopPriorInfo,ab=d.talkShopChatbot,bb=d.talkShopOrderFrame,cb="https://web.lpay.com:1452",db="e30f88c2c39f2a82af5d08f4691ba6b6",eb="00076790",fb="";("localhost:8082"===location.host||"10.149.132.91:8082"===location.host)&&(d.loginUrl="/login/m/loginForm_dev.html",setCookie("LOGINCHK","9nXuTbHiBiw="),setCookie("LOGINID","zE7jB5V8+oLdIjKcRj1zmA=="),setCookie("CUSTNO","XLbE+wLdXZE=")),m.delLS=function(){f.delLocalStorage("TALK_SHOP_basicInitiated"),f.delLocalStorage("TALK_SHOP_noMoreIntro"),f.delLocalStorage("TALK_SHOP_closeIntro"),f.delSessionStorage("TALK_SHOP_SSST"),f.delSessionStorage("TALK_SHOP_ISP"),m.reloadTS()},m.reloadTS=function(){location.href=d.talkShopUrl+"?"+m.baseParam+"&dev_mode=Y&tracable=Y&a="+Math.round(100*Math.random())},m.endTTSCB=function(){va()},m.notUnderstand=function(){switch(m.ts_currentStep){case 1:m.setSTTText("생수");break;case 2:m.setSTTText("1번");break;default:m.setSTTText("이해못함")}},m.stopSpeechRecogDV=function(){ua(),ma()},m.toggleDevSidebar=function(){b.element(".dev_sidebar").toggleClass("minimize")},m.talkUserInput=function(){var b=a.prompt();m.isValidString(b)&&m.talkRecomDelegate("sendSpeech",b)},a.changeServer=p,m.ispCBSimulate=function(a){var b=d.talkShopUrl+"?"+m.baseParam+"&dev_mode=Y&tracable=Y&isp=Y&a="+Math.round(100*Math.random());b+=a===!0?"&resCode=0000&resMsg=ISP 성공&ord_no=201711156267017":"&resCode=1111&resMsg=ISP 실패",location.href=b};try{var gb=b.element(a),hb=gb.width(),ib=gb.height(),jb=hb/ib*100;360>=hb&&jb>=65&&b.element("body").addClass("ts_fatty")}catch(kb){}m.changeBasicInfo=function(a,b){var c={tclick:Ka(b)};switch(a){case 1:m.gotoService("talkShopDelevery",c);break;case 2:m.gotoService("talkShopPayment",c)}},m.closeBasicInfo=function(a,b){var c=m.ts_basicInfo;switch(a){case 0:y(!0,b);break;case 1:case 2:if(c.prior_info_chk!==!0)return;f.setLocalStorage("TALK_SHOP_basicInitiated","Y"),c.initiated=!0,m.showHideBIPop(!1),H(),Ka(b)}},m.showHideBIPop=function(a,c){m.ts_basicInfo.showGuideInfo=!1,a===!0?(m.ts_basicInfo.showBasicInfo=!0,b.element("body").addClass("ts_basic_pop"),oa(),ua()):(m.ts_basicInfo.showBasicInfo=!1,b.element("body").removeClass("ts_basic_pop"),i(function(){U(!0)},10)),Ka(c)},m.showHideGuidePop=function(a){m.ts_basicInfo.showBasicInfo=!1,b.element("body").removeClass("ts_basic_pop"),a===!0?(Ka(9),m.ts_basicInfo.showGuideInfo=!0,oa(),ua()):m.ts_basicInfo.showGuideInfo=!1},m.goHistoryBack=function(){Ka(8),m.showExitConfirm=!0,m.confirm_2016("음성주문 서비스를 종료하시겠습니까?",{callback:y}),oa(),ua()},m.talkRecomDelegate=function(){if(0!=arguments.length){var a=[].slice.call(arguments),c=a.shift(),d={command:c,step:m.ts_currentStep,text:a[0],prod_grp_id:m.ts_currentGroup,goods_no:m.ts_currentGoodsNo,order_no:m.ts_currentOrderNo};m.isValidArray(m.ts_goodsList)&&(d.goods_no_list=m.ts_goodsList.join(","));var e=b.extend(Za,d);I(e)}},m.goPrevStepCall=function(a){m.ts_currentStep>1&&(5==m.ts_currentStep?m.goHistoryBack():m.talkRecomDelegate("sendSpeech","이전으로"),Ka(a))};var lb={"&lt;":"<","&gt;":">"},mb=new RegExp(Object.keys(lb).join("|"),"gi");m.talkOrderCallBack=function(a,b,c){"0000"==a?m.paymentSuccess(c):m.paymentFail(a,b),sa()},a.talkOrderCallBack=m.talkOrderCallBack,m.paymentSuccess=function(a){m.ts_currentOrderNo=a,m.talkRecomDelegate("sendSpeech","결제완료")},m.paymentFail=function(a,b){m.alert_2016("["+a+"] "+b),V()},m.selectProdGroup=function(a,b){m.talkRecomDelegate("sendSpeech",a.title+" 주문해줘"),Ka(12,b)},m.selectProduct=function(a,b){m.talkRecomDelegate("sendSpeech",a+"번 주문해줘"),Ka(13,b)},m.closeOrderLayer=function(){b.element("#tsol_iframe").prop("src","about:blank"),sa(),V()},m.closeIntroPop=function(a){document.getElementById("tsi_mov").pause(),a===!0&&f.setLocalStorage("TALK_SHOP_noMoreIntro","Y"),f.setLocalStorage("TALK_SHOP_closeIntro",m.getTodayDate()),r()};var nb;if(m.ts_playVideo=function(){b.element("#tsi_mov").unbind("play pause ended").bind("play pause ended",ja),b.element(".ts_intro .tsi_mov").addClass("playing"),b.element("#tsi_mov").prop("src","http://api.wecandeo.com/video/default/BOKNS9AQWrGGJyzEE7SMpSYWRC40kWDcnjDqgsTbYwRZ2kWreJmsLwieie"),document.getElementById("tsi_mov").load(),document.getElementById("tsi_mov").play(),ha()},m.playPauseIntro=function(){var a=b.element(".tsi_mov");a.hasClass("hide")?ha():(ha(),a.hasClass("onplay")?document.getElementById("tsi_mov").pause():document.getElementById("tsi_mov").play())},m.toggleClause=function(){m.ts_clause.toggle=!m.ts_clause.toggle},m.showHideClause=function(a){m.ts_clause.visible=a,a?0==m.ts_clause.index?i(function(){m.loadClause(1)},10):i(function(){m.loadClause(m.ts_clause.index)},10):i(function(){U(!0)},10)},m.loadClause=function(a){m.ts_clause.index=a;var c="";switch(a){case 1:c=d.clauseECommerce;break;case 2:c=d.clausePIUse;break;case 3:c=d.clausePIConsign;break;default:return}b.element(".ts_clause_cont > div").scrollTop(0),b.element(".ts_clause_cont > div").scrollLeft(0),b.element("#clauseHolder").load(c+" .clause_wrap")},m.micClick=function(){0!=m.ts_micStat.inited&&(m.ts_micStat.open?oa():la(),Ka(14))},m.callAppAPI=function(b,c){var d,e="talkshop://"+b,f="?";for(d in c)e+=f+d+"="+c[d],f="&";m.appObj.isApp?a.location.href=e:console.log("▷▷▷▷▷ ",e)},a.ttsEndCallback=va,m.setSTTText=function(a){m.ts_micStat.listening&&b.isString(a)&&(m.ts_stt.text=a)},a.setSTTText=m.setSTTText,a.sttEndCallback=wa,a.backKeyClicked=za,m.gotoPurchaseView=function(){i(function(){m.gotoService("purchaseViewUrl",{orderNo:m.ts_currentOrderNo})},200)},console.log("앱 버전 체크"),m.appObj.isApp){var ob="말로 쉽고 빠르게<br/>상품추천부터 결제까지!<br/>지금 바로 말로 하는 쇼핑을<br/>경험해 보세요!<br/><br/>지금 업데이트 하시겠어요?",pb={label:{ok:"승인",cancel:"취소"},callback:function(a){if(a)m.appObj.isIOS?location.href="http://itunes.apple.com/app/id376622474?mt=8":location.href="market://details?id=com.lotte";else try{appSendBack()}catch(b){var c=d.mainUrl+"?"+k.getBaseParam();l.location.href=c}}};m.confirm_2016(ob,pb)}else e.promiseLoginInfo()["finally"](function(a){i(q,200)})}}}])}(window,window.angular);