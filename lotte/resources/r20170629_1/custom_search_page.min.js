!function(a,b,c){"use strict";var d=b.module("app",["lotteComm"]);d.controller("customSearchPageCtrl",["$scope","LotteCommon",function(a,b){a.showWrap=!0,a.contVisible=!0}]),d.directive("lotteContainer",["LotteCommon","LotteStorage","$window","$location","$timeout","$parse","$http",function(a,d,e,f,g,h,i){return{templateUrl:"/lotte/resources_dev/search/custom_search_page_container.html",replace:!0,link:function(h,j,k){h.referrerUrl=document.referrer,h.inType="",f.absUrl().indexOf("inType=srhResult")>-1&&(h.inType="srhResult"),h.csUIStatus={visible:!1,tabSelection:0,brandLanguage:"ko",ajaxLoading:!1},h.csUIData={brandKeyword:"",brandKeywordSearch:"",brandList:[]},h.csURLs={baseData:a.srhListCustomSetting2016,customBrandTxt:a.sideCtgBrandSearch,customBrandIdx:a.sideCtgBrandData},h.csBrandIndex=[["ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"],["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]],h.csCustomSettings={customized:!1,category:[],brand:[],color:[]},h.csTempSettings={customized:!1,changed:!1,category:[],brand:[],color:[]},h.csCustomBaseData={},h.csBrandSearchTextTimer=-1,h.csSelectedScroll,h.csTabScroll,h.csIScrollOption={mouseWheel:!0,scrollY:!0,scrollX:!1,click:!0},h.csInitCustomSearch=function(){var a=d.getSessionStorage("customSearchBaseData","json");null==a?h.csLoadBaseData():(h.csCustomBaseData=a,h.csInitIscroll());var b=d.getLocalStorage("customSearchSettings","json");null!=b&&(h.csCustomSettings=b),h.csInitTempSettings(),g(h.csInitIscroll,0)},h.csLoadBaseData=function(){i.get(h.csURLs.baseData).success(function(a){h.csCustomBaseData=a,d.setSessionStorage("customSearchBaseData",h.csCustomBaseData,"json"),h.csInitIscroll(),h.csSetItemChecked("ctg"),h.csSetItemChecked("brd"),h.csSetItemChecked("clr")}).error(function(){console.error("Data Error : 맞춤설정 데이터")})},h.csInitTempSettings=function(){h.csTempSettings.customized=h.csCustomSettings.customized,h.csTempSettings.changed=!1,h.csTempSettings.category=[].concat(h.csCustomSettings.category),h.csTempSettings.brand=[].concat(h.csCustomSettings.brand),h.csTempSettings.color=[].concat(h.csCustomSettings.color),h.csSetItemChecked("ctg"),h.csSetItemChecked("brd"),h.csSetItemChecked("clr")},h.csSetItemChecked=function(a){if(h.csCustomBaseData!=c&&h.csCustomBaseData.category!=c){var d,e,f;switch(a){case"ctg":d=h.csTempSettings.category,e=h.csCustomBaseData.category.items,f="ctgNo";break;case"brd":d=h.csTempSettings.brand,e=h.csUIData.brandList,f="brnd_no";break;case"clr":d=h.csTempSettings.color,e=h.csCustomBaseData.color.items,f="colorCd";break;default:return}var g=[];b.forEach(d,function(a,b){g.push(a[f])}),b.forEach(e,function(a,b){a.on=g.indexOf(a[f])>=0})}},h.csCloseCustomSearch=function(){h.csDestroyIScroll(),"srhResult"==h.inType?e.location.href=h.referrerUrl:h.gotoPrepage()},h.csShowHideCustomSearch=function(a){"list"==a?h.sendTclick(h.tClickBase+"SrhResult_CLK_customizing_search_Btn"):"layer"==a&&h.sendTclick(h.tClickBase+"SrhLayer_Clk_Customizing_Search_Btn")},h.csSelectTab=function(a){h.csUIStatus.tabSelection=a,h.csInitIscroll()},h.csInitIscroll=function(){g(h.csInitIscrollDelay,50)},h.csInitIscrollDelay=function(){h.csRefreshSelectionArea(),h.appObj.isIOS?(h.csSelectedScroll==c&&$("#customSearchWrap .csw_selected").length>0&&(h.csSelectedScroll=new IScroll("#customSearchWrap .csw_selected",h.csIScrollOption)),h.csTabScroll!=c&&(h.csTabScroll.destroy(),h.csTabScroll=null),$("#customSearchWrap .csw_cont .scrollable > div").css("transform","translate(0, 0)"),$("#customSearchWrap .csw_cont .show .scrollable").length>0&&(h.csTabScroll=new IScroll("#customSearchWrap .csw_cont .show .scrollable",h.csIScrollOption))):($("#customSearchWrap .csw_cont .scrollable").css("overflow-y","auto"),$("#customSearchWrap .csw_selected > div").css({"max-height":"104px",height:"100%","overflow-y":"auto"}))},h.csDestroyIScroll=function(){h.csSelectedScroll!=c&&(h.csSelectedScroll.destroy(),h.csSelectedScroll=null),h.csTabScroll!=c&&(h.csTabScroll.destroy(),h.csTabScroll=null)},h.csRefreshTabScroll=function(a){g(function(){h.csRefreshTabScrollDelay(a)},100)},h.csRefreshTabScrollDelay=function(a){h.csTabScroll!=c&&(a===!0&&h.csTabScroll.scrollTo(0,0),h.csTabScroll.refresh())},h.csRefreshSelectedScroll=function(){g(h.csRefreshSelectionArea,100),g(h.csRefreshSelectedScrollDelay,200),h.csRefreshTabScroll()},h.csRefreshSelectedScrollDelay=function(){h.csSelectedScroll!=c&&h.csSelectedScroll.refresh()},h.csRefreshSelectionArea=function(){0!=$("#csw_selected").length&&$("#csw_selection").css("top",$("#csw_selected").height())},h.csSelectCategory=function(a){var b=h.csCheckExisting("ctg",a);if(!b){var c=h.csTempSettings.category;if(c.length>=2)return void h.alert_2016("카테고리 설정은 2개만 가능합니다.");a.on=!0,c.push(a),h.csUpdateCustomized(),h.csScrollTo("ctg")}},h.csSelectBrand=function(a){var b=h.csCheckExisting("brd",a);if(!b){var c=h.csTempSettings.brand;if(c.length>=10)return void h.alert_2016("브랜드 설정은 10개만 가능합니다.");a.on=!0,c.push(a),h.csUpdateCustomized(),h.csScrollTo("brd")}},h.csSelectColor=function(a){var b=h.csCheckExisting("clr",a);if(!b){var c=h.csTempSettings.color;if(c.length>=3)return void h.alert_2016("컬러 설정은 3개만 가능합니다.");a.on=!0,c.push(a),h.csUpdateCustomized(),h.csScrollTo("clr")}},h.csDeselectItem=function(a,b){switch(a){case"ctg":h.csSelectCategory(b);break;case"brd":h.csSelectBrand(b);break;case"clr":h.csSelectColor(b);break;default:return}h.csSetItemChecked(a)},h.csCheckExisting=function(a,b){var c,d;switch(a){case"ctg":c=h.csTempSettings.category,d="ctgName";break;case"brd":c=h.csTempSettings.brand,d="brnd_no";break;case"clr":c=h.csTempSettings.color,d="colorCd";break;default:return!0}for(var e,f=c.length,g=0;f>g;g++)if(e=c[g],e[d]==b[d])return b.on=!1,c.splice(g,1),h.csUpdateCustomized(),!0;return!1},h.csScrollTo=function(a){g(function(){h.csScrollToDelay(a)},250)},h.csScrollToDelay=function(a){var b=0;if(h.appObj.isIOS)h.csSelectedScroll!=c&&("ctg"!=a&&(b=h.csSelectedScroll.maxScrollY),h.csSelectedScroll.scrollTo(0,b,300));else{var d=$("#csw_selected > div");"ctg"!=a&&(b=d.prop("scrollHeight")),d.stop().animate({scrollTop:b},300)}},h.csUpdateCustomized=function(){var a=h.csTempSettings.category.length+h.csTempSettings.brand.length+h.csTempSettings.color.length;h.csTempSettings.customized=a>0,h.csTempSettings.changed=!0,h.csRefreshSelectedScroll()},h.csChangeBrandLanguage=function(a){"en"==a?h.csUIStatus.brandLanguage="en":h.csUIStatus.brandLanguage="ko",h.csRefreshTabScroll(!0)},h.csBrandSearchText=function(){clearTimeout(h.csBrandSearchTextTimer),h.csBrandSearchTextTimer=setTimeout(h.csBrandSearchTextDelay,500)},h.csBrandSearchTextDelay=function(){var a=h.csUIData.brandKeyword;if(a.length>=2){h.csUIStatus.ajaxLoading=!0,h.csUIData.brandKeywordSearch=a;var b={sch_nm:a};i.get(h.csURLs.customBrandTxt,{params:b}).success(h.csBrandSearchTextSuccess).error(h.csBrandSearchError)}else h.csUIData.brandKeywordSearch="",h.csUIData.brandList.length=0,h.csRefreshTabScroll(!0)},h.csBrandSearchCap=function(a,b,c){h.csUIStatus.ajaxLoading=!0,h.csUIData.brandKeyword="",h.csUIData.brandKeywordSearch=c;var d={btnIndex:a,tabIndex:b};i.get(h.csURLs.customBrandIdx,{params:d}).success(h.csBrandSearchTextSuccess).error(h.csBrandSearchError)},h.csBrandSearchTextSuccess=function(a){a&&a.brandList&&a.brandList.items&&(h.csUIData.brandList=a.brandList.items,h.csSetItemChecked("brd"),h.csRefreshTabScroll(!0)),h.csUIStatus.ajaxLoading=!1},h.csBrandSearchError=function(a){h.csUIStatus.ajaxLoading=!1,console.log("brand search error")},h.csResetCustomSearch=function(a){if(h.csTempSettings.customized||h.csCustomSettings.customized){var b={callback:h.csResetCustomSearchCB,label:{ok:"초기화"}};h.confirm_2016("맞춤 설정을<br/>초기화 하시겠습니까?",b)}a!=c&&h.sendTclick(a)},h.csResetCustomSearchCB=function(a){a===!0&&(h.csTempSettings.customized=!1,h.csTempSettings.changed=!1,h.csTempSettings.category.length=0,h.csTempSettings.brand.length=0,h.csTempSettings.color.length=0,h.csApplyCustomSearchCB(!0))},h.csApplyCustomSearch=function(){var a={callback:h.csApplyCustomSearchCB};h.confirm_2016("맞춤설정이<br/>검색결과에 반영됩니다",a),h.sendTclick("m_dc_customizing_search_CLK_complete_Btn")},h.csApplyCustomSearchCB=function(a){a===!0&&(h.csCustomSettings.customized=h.csTempSettings.customized,h.csCustomSettings.category=[].concat(h.csTempSettings.category),h.csCustomSettings.brand=[].concat(h.csTempSettings.brand),h.csCustomSettings.color=[].concat(h.csTempSettings.color),d.setLocalStorage("customSearchSettings",h.csCustomSettings,"json"),h.csCloseCustomSearch())},g(function(){h.csInitCustomSearch()},100),h.gotoPrepage=function(){h.appObj.isNativeHeader?appSendBack():history.go(-1)}}}}])}(window,window.angular);